# 隔离电流检测放大器在 PFC 升压系统中的应用


#  1. 简介：
PFC( Power Factor Correction)被称为“功率因数校正”，被定义为有效功率和总耗电量(视在功率)的比值。当使用于
大中功率开关电源时，提高功率因数可以降低电网传输中的损耗从而提高电能的输送效率。因此提高功率因数有着重
要的意义。
本文介绍了川土微电子 CA-IS120x 及 CA-IS130x 系列产品在 PFC 中的应用，针对实际应用提出了使用方法和控制建
议。


# 2 .功率因数的定义
功率因数定义为交流电路有功功率 P(W)对视在功率 S(V*A)的比值。当交流电压和电流相位不同时，则功率因数小于
1。用户电器设备在一定电压和功率下，该值越高效益越好，发电设备越能充分利用。常用cosθ表示，功率因数
\cos\theta=\frac{\mathrm{P}}{s}。
对于没有 PFC 的升压电路，主要由整流桥电路，升压功率级以及控制电路组成，如图 2 所示。整流电路将市电
(220V/50Hz)转化成直流电，整流后由于升压电路输入存在大电容(CBULK)造成有尖峰电流。另外，此时在输入市电侧产
生畸变的电流 iac，里面含有基波成分，也含有谐波成分。在该电路中，升压电路只控制输出电压 VOUT，对输入电流没
有任何调节。波形如图 3 所示：
PFC 电路将输入侧相电流也加入控制环路，对电流波形和相位进行调节，从而实现提高功率因数的控制。
如图 4 所示。检测到的输出电压和输出参考电压进行比较，通过 PI 或 PID 将输出误差放大，放大后的信号和输入总线
电压 Vbus 相乘，从而得到直流母线侧的电流的参考 包络线，最后通过控制器可以在保证输出电压达到预定值的情况
下母线电流追踪母线电压。该控制器有多种控制方法和架构，后面章节会讲述。
注：忽略直流侧输入母线电压过低引起的电压无法转换问题，实际存在填谷电路。


# 3 .高边电流采样
电流采样一般分为高边采样和低边采样。高边采样具有比较高的对地共模电压，可以使用川土微电子的产品
CA-IS3105W 做为隔离电源。R_SNS 为高边采样电阻，当电流流过电阻时，该电阻上产生压降，使用电流放大器
CA-IS1200/CA-IS1300 将压降传送到低压侧，通过 ADC 转换成数字信号送入 DSP 或 MCU。也可以使用 CA-IS1204、CA￾IS1305/06 将差分电压信号传送到低边，通过 MCU 直接读取低压侧的数字信号。
高边采样如图 5 和图 6 所示。
高边侧电流采样方式使用时有以下特点：
1> 供电复杂，必须使用隔离电源。
2> 隔离电源输出地连接采样侧的低电压端，不能连接至功率级 GND。
3> 使用隔离电源时要注意输入和输出侧使用 LDO 或滤波器，以防止输入输出侧电压纹波干扰其他信号。
4> 正常工作时高边侧供电隔离栅耐压为母线电压，因此对隔离器耐压是考验，最终影响芯片工作寿命。
5> 高边采样对于升压 boost 电路而言，可以对电感全开关周期内电流进行监控和控制， PFC boost 电路控制方式
多样灵活。
# 3.1.高边采样 PFC 升压电路的控制方法
# 3.1.1 定频峰值电流控制
电感峰值电流，定频率控制，如图 7 所示。输出电压和参考电压通过 PI/PID 进行比较放大，在和输入直流总线电
压相乘得到总线电流指令值。控制逻辑通过比较器 U2 和触发器 U1 产生。如果开关管 Q2 开通，Q1 关闭，那么电感
电流 ibus 增大。K_ibus 为 ibus 一定比例放大后的转换值。当电流 K_ibus 达到指令峰值 VCOMP 时,比较器 U2 输出高电平，重
置触发器 U1，此时开关管 Q2 关闭，Q1 开通，电感电流放电直至触发器由于固定频率的脉冲而被置高。
如图 8 所示，工作于 CCM(Continuous Current Mode) 的升压电路，当电感电流触碰到指令电流后，电感电流停止
充电开始放电，电感电流形成的包络线呈正弦波。包络线的平均值接近正弦波形。对于工作于 DCM(Discontinuous 
Current Mode)的升压电压。电感电流触碰到指令电流后，电感电流停止充电并开始放电，当电流降至零时触发电流过
零检测逻辑，开关管 Q1 关闭且保持关闭状态直至时钟信号触发下一开关周期的开关管通断。工作于峰值电流控制模
式时，开关频率保持定值。
还有一种介于 DCM 和 CCM 之间被称为 BCM(Boundary Current Mode)，即电感放电至过零时，启动下一开关周期
的通断，因此电路中需要电流过零检测(ZCD)环节。该模式下开关频率可变，随输入、输出、负载等情况变化。电路和
波形分别如图 9 和图 10 所示。
# 3.1.2. 迟滞控制
迟滞控制(Hysteresis Control)将被控量的上下限做为控制的参数。当电流碰到目标控制量上限时，电感电流开始放电，直至碰到控制量下
限。该种控制将被控量控制在一定范围内，控制相对简单，频率不固定，控制电路如图 11，波形如图 12 所示。


# 4. 低边电流采样
如果将采样电阻串联在开关管上为低边电流采样，如图 13 和图 14 所示。
低边采样具有低的对地共模电压，R_SNS 为高边采样电阻，当电流流过电阻时，该电阻上产生压降，使用电流放
大器 CA-IS1200/CA-IS1300 将压降传送到低压侧，通过 ADC 转换成数字信号送入 DSP 或 MCU，如图 13 所示。也可以使
用 CA-IS1204、CA-IS1305/06 将差分电压信号传送到低边，通过 MCU 直接读取低压侧的数字信号，如图 14 所示。该种
采样模式由于高压侧参考对地，因此可使用隔离电源 CA-IS3105W，但是隔离电源输入和输出建议串接 LDO 或者滤波
器连接至 VDD2，这样依然有一定的成本。另外一种方式即电阻和稳压管串联的，这种方式比较经济。
低边侧电流采样方式使用时有以下特点：
1> 供电相对简单，可以不使用隔离电源。
2> 如果使用隔离电源供电，要注意输入和输出侧使用 LDO 或滤波器，防止输入输出侧电压纹波干扰其他信号。
3> 正常工作时隔离栅电压很低，因此对一般情况下隔离栅承受应力很小。
4> 高边采样对于升压 boost 电路而言，开关周期内只能对电感充电电流进行监控和控制， PFC boost 电路控制方
式受限。
# 4.1.低边电流采样 PFC 升压电路的控制方法
# 4.1.1. 固定开关时间控制 COT(Constant OFF Time)
当电感电流触碰到指令电流后，电感电流停止充电开始放电，通过 One-shot 逻辑产生一个固定时间的脉冲宽度即
一个固定的放电时间。当这个固定的时间完成，电感电流开始充电直至电感电流再次碰到指令电流。电感电流形成的
包络线呈正弦波。包络线的平均值接近正弦波形。该模式下开关频率可变，随输入、输出、负载等情况变化。
除以上控制方式除外，还有其他控制方式例如平均电流模式控制，谷值电流控制，固定开通时间（Constant On
Time），电压控制模式等，本章不再详细叙述。
 # 4.2.高边采样和低边电流采样对比分析
 电流采样与控制方式比较
---table begin---
Table tile:AN0011电流采样与控制方式比较表
| 特性              | 高边电流采样                                                     | 低边电流采样                           | 备注                                     |
|------------------|-----------------------------------------------------------|-----------------------------------|---------------------------------------|
| 隔离栅承受电压     | 高                                                               | 低                                     | 最终影响芯片寿命                           |
| 高边供电情况       | 需要额外的隔离电源，且需要添加滤波                             | 供电电路相对简单，电阻和稳压管即可 | 额外电路影响成本和电路复杂度             |
| 控制方式          | 种类多                                                           | 受限                                   | 高边电流采样包含所有低边控制方式           |
| 对电流监控         | 全周期监控                                                       | 周期内部分时间监控                       |                                         |
---table end---


# 5. 电压采样
由于 PFC 电路中需要对输入母线和输出电压做采样。采样输入母线电压用于获得输入电压的相位信息，采样输出
电压用于负反馈回路，如图 15 所示。当需要电压采样时，要注意输入电压的范围以保证输入采样得到的共模和差模
电压在放大器的正常工作范围内。使用分压电阻将输入电压按比例降下来然后再送入电流放大器，必须满足以下条
件：
\mathrm{VRange}\geq\frac{R2}{\mathrm{R1}+\mathrm{R2}}\cdot Vbus\text{(公式 1})
R1//R2 = 𝑅𝑅3（公式 2）
\frac{1}{2\cdot\pi\cdot(\mathrm{R}1/\mathrm{R}2+\mathrm{R}3)\cdot\mathrm{C}1}\geq10\cdot f\_Vbus(\text{公式 3})
注：公式（3）非必须满足，使用 DSP 或者 MCU 滤波算法亦可实现数字滤波功能。
VRange 为放大器最大输入差分电压，Vbus 为输入直流母线电压最大值, f_Vbus 为输入直流母线电压频率。
R3=R2//R1 用来抵消放大器由于输入电流引起的失调电压。C1 和 R1，R2，R3 组成低通滤波器对放大器输入电压
进行滤波。详情请参看川土应用笔记《基于 CA-IS1200_1300 的隔离母线电压检测方案》。
采样输出压为了获得输出电压，用于负反馈控制，如图 15 所示。当需要输出电压采样时，要注意输出电压的范
围以保证输入采样得到的共模和差模电压在电流放大器的正常工作范围内。使用分压电阻将输入电压按比例降下来然
后再送入电流放大器，必须满足以下条件：


# 6. PCB 设计范例
 @6.1.电流检测放大器应用于检测电流注意事项
当电流检测放大器用于检测电流时，必须注意以下事项，如图 18 所示：
1> C1 和 C2 为芯片供电提供储能和滤波功能，因此 C1 和 C2 紧靠芯片 VDD1 和 VDD2 引脚摆放。
2> R_SNS 为电流检测电阻，当电流流过该电阻时产生压降，该压降通过送入电流检测放大器。设计时尽量用差分
走线方式。当差分线比较长时，可以采用 R1 和 R2，C2 做为滤波器，也可以减少差分线由于阻抗偏差造成的检测
误差，因此 R1=R2。
3> INP/INN、OUTP/OUTN 差分对容易受到干扰，设计时注意远离干扰源，一般为高𝑑𝑑𝑑𝑑
𝑑𝑑𝑑𝑑或𝑑𝑑𝑖𝑖
𝑑𝑑𝑑𝑑信号。
4> 如果输出为 OUTP 和 OUTN，建议设计成等长差分走线。如果走线比较长，建议串接欧姆级电阻以减少差分线由于
阻抗偏差造成的检测误差。
5> 如果输出为二次侧为 CLKIN 和 DOUT，该信号为强干扰信号，应远离其他信号。走线附近包地处理，即走线附近铜
箔通过过孔 VIA 连接 GND2。
6> 两侧地在 PCB 的顶层和底层保持 8mm 以上间距以防止高压爬电，如图 19 所示。
# 6.2.电流检测放大器应用于检测电压时注意事项
当电流检测放大器用于检测电压时，必须注意以下事项，如图 20 所示：
1> C1 和 C2 为芯片供电提供储能和滤波功能，因此 C1 和 C2 紧靠芯片 VDD1 和 VDD2 引脚摆放。
2> R_top 和 R_bot 为电压检测分压电阻，用于检测输出电容 Bulk Cap 上的电压。该两个元件尽量靠近芯片摆放。走线
方式。检测电压时，建议将电容两级电压分别走线送到送到分压电阻端，以提高检测精度。如果被检测电压很
高，则建议用多个分压电阻串联以降低单个电阻的功耗。
3> INP/INN、OUTP/OUTN 差分对容易受到干扰，设计时注意远离干扰源，一般为高𝑑𝑑𝑑𝑑
𝑑𝑑𝑑𝑑或𝑑𝑑𝑖𝑖
𝑑𝑑𝑑𝑑信号。
4> 如果输出为 OUTP 和 OUTN，建议设计成等长差分走线。如果走线比较长，建议串接欧姆级电阻以减少差分线由于
阻抗偏差造成的检测误差。
5> 如果输出为二次侧为 CLKIN 和 DOUT，该信号为强干扰信号，应远离其他信号。走线附近包地处理，即走线附近铜
箔用过孔 VIA 连接 GND2。
6> 两侧地在 PCB 的顶层和底层保持 8mm 以上间距以防止高压爬电，如图 19 所示。