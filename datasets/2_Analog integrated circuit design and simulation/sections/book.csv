section,n_tokens
" 
 
 
 
《模拟集成电路设计与仿真》 
何乐年 
 
 
 
 
 
 
 
 
科学出版社出版 
写工作，而且还帮助校对。另外，陆燕锋、胡博宇、宁志华、邱建平、邵亚利等同学
分别阅读了有关章节",97
"7 个附录。第 1 章介绍模拟集成电路的发展与设计方法。第 2、3 章介绍单级放
大器、电流镜和差分放大器等基本模拟电路的原理。第 4 章是电路噪声分析计算与仿真。第 5 章介绍
运算放大器的工作原理与分析、仿真方法。第 6、7 章以双端输入单端输出运算放大器以及全差分运算
放大器为例，介绍运算放大器的设计仿真方法；第 8、9 章以带隙电压基准和电流基准电路为例，介绍
了参考电压源和电流源的设计方",221
"......................................................................................48 
3.4.3 差分放大器的小信号模型分析..................................................................50 
3.4.4 共模抑制比..........",42
"分放大器...................................................................................60 
习题…………………………………………………………………………………67 
参考文献……………………………………………………………………………74 
 
第4章 噪声分析.........................",44
"....................................................................................75 
4.1.2 电路中的噪声类型和特点........................................................................76 
4.1.3 噪声在电路中的表示....",43
"..................................................................................................84 
4.2.2 共栅级.........................................................................................",18
"...........................................88 
4.2.5 差分电路....................................................................................................89 
4.3 噪声仿真技术.............................",35
"置....................................................................91 
4.3.3 设计实例及结果输出方式设置。............................................................93 
习题……………………………………………………………………………………102 
参考文献",40
"......................................... 106 
5.1.1 理想运算放大器.................................................................................... 107 
5.1.2 非理想运算放大器....................................",44
"................................................................ 109 
5.2.2 降低增益灵敏度.................................................................................... 113 
5.2.3 非线性失真的减小.............",46
"............................................................................ 120 
5.3.1 套筒结构................................................................................................ 121 
5.3.2 ",29
"...... 124 
5.4.1 增益(Gain) ............................................................................................. 124 
5.4.2 带宽（Bandwidth） ......................................................",40
"...................... 145 
5.4.5 转换速率(Slew Rate)............................................................................. 148 
5.4.6 共模抑制比(CMRR) ..................................................",45
"........................ 161 
5.5.1 比例运算电路........................................................................................ 161 
5.5.2 求和运算电路....................................................",38
".............................. 168 
习题……………………………………………………………………………………169 
参文献…………………………………………………………………………………171 
 
第6章 高增益运放与频率补偿......................................................................",46
".............................172 
6.1.2 采用套筒式共源共栅结构提高电路增益................................................173 
6.1.3 采用折叠式共源共栅结构提高电路增益................................................174 
6.1.4 采用增益自举式（",85
".............................................................................176 
6.3.1 系统稳定性原理与分析.............................................................................176 
6.3.2 米勒效应与米勒补偿.....",47
"端输出CMOS 运算放大器设计实例...........................................185 
6.4.1 运算放大器性能指标.................................................................................185 
6.4.2 性能指标到电路参数指标之间的转化和分析.........",63
"..............................189 
6.5.2 搭建测试平台.............................................................................................194 
6.5.3 直流偏置验证仿真.........................................",38
"................................................................209 
6.5.6 CMRR 和 PSRR 的测量............................................................................220 
习题………………………………………………………………………",30
"...........................................................................227 
7.1.1 全差分运算放大器结构框图..................................................................227 
7.1.2 常见的全差分运算放大器电路............",52
".........................................................................230 
7.2.2 共模采样的结构......................................................................................232 
7.3 差动电路的非线性......",36
"...........................................................237 
7.4 全差分运算放大器的设计实例......................................................................239 
7.4.1 设计指标..................................",37
"............................................................241 
7.4.4 全差分放大器电路设计和仿真..............................................................247 
7.4.5 结论.........................................",39
".............................................................275 
8.1 带隙电压基准的性能参数............................................................................. 275 
8.1.1 温漂系数..........................",42
"3 功耗.............................................................................................................275 
8.1.4 电源抑制比（Power Supply Reject Ratio, PSRR）.................................275 
",36
"276 
8.2.2 正温度系数电压.........................................................................................277 
8.2.3 实现零温度系数的基准电压....................................................................27",46
" 在运放的输出端产生基准电压................................................................282 
8.3.3 两种结构的性能比较.................................................................................286 
8.4 带隙电压基准的设计...",55
"...........................................................................290 
8.4.3 设置“Analog Environment”窗口...............................................................290 
8.4.4 仿真结果分析..........",38
"............................................296 
8.4.7 利用“Optimizer”进一步优化带隙基准电压源的温度特性....................303 
8.4.8 验证8.3.1 中关于闭环增益的推论..........................................................310 
8.4",74
"......323 
8.5 超低温漂带隙电压基准................................................................................. 324 
8.5.1 设计目标..............................................................................",43
"........................................326 
8.5.4 小结.............................................................................................................355 
习题…………………………………………………………………………………",27
"...........................................................358 
9.1.1 温漂系数..............................................................................................358 
9.1.2 电源抑制比（Power Supply Re",37
".................................................359 
9.3 常用基准电流源的几种结构..................................................................361 
9.3.1 利用电阻RS 在NMOS 管源极产生电压差V ..............................",60
"...............................................................................365 
9.4 基准电流源的设计实例..........................................................................366 
9.4.1 LDO 中基准电流源的性能指标..",45
"..........................................369 
9.4.4 电路仿真..............................................................................................372 
9.4.5 小结....................................",31
"...........................................................399 
10.1 开关电容电路..................................................................................................399 
10.1.1 采样开关电路.........",33
"等效电阻..............................................................................407 
10.1.4 开关电容放大器......................................................................................410 
10.1.5 开",33
".............................................................415 
10.2.2 DAC 的基本静态特性.............................................................................417 
10.2.3 几种常见结构的DAC.................",40
".............................................424 
10.3.2 奈奎斯特速率ADC.................................................................................425 
10.3.3 过采样率ADC..................................",40
"......................................................................434 
10.4.2 一阶连续时间 sigma-delta ADC 系统仿真.............................................451 
习题……………………………………………………………………………………464 
参考",43
"...........................472 
A.1.1 启动配置文件：.cdsinit..................................................................472 
A.1.2 其他配置文件................................................................",34
"..............................................................474 
A.2.2 CIW 中的其他部分.........................................................................476 
A.3 Library Manager 设计库管理器.............",33
"........................................478 
A.4 Virtuoso® Schematic Editor 电路图编辑器简介......................................486 
A.4.1 电路编辑器界面简介..........................................................",43
"................493 
A.5 Virtuoso® Analog Design Environment (ADE) 简介...............................494 
A.5.1 使用ADE 进行仿真的基本流程...................................................494 
A.6 瞬态分析（Transient",58
"真 的 激 励 信 号 源 及 其 参 数 设 置 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 5 0 0 
A.6.3 瞬态仿真实例..................................................................................503 
A.7 直流分析（D",90
".......................................................................................507 
A.8 交流小信号分析（AC Analysis）............................................................510 
A.8.1 仿真参数设置.......",37
"............................................................................................515 
B.1 “Results Browser”窗口简介..............................................................................",20
"7 
B.1.3 仿真结果保存路径.....................................................................................519 
B.1.4 “Results Browser”窗口的主体部分...........................................................520 ",41
"21 
B.2.2 读取仿真结果.............................................................................................521 
B.3 在“Results Browser”中选择数据...........................................................",33
"
B.4.2 将仿真结果输出到“Calculator”的缓存中................................................524 
B.4.3 输出两个结果的差值。.............................................................................524 
B.4.4 将两个仿真结果采用Yvs",62
"............................................................................................. 527 
C.1 “Waveform”窗口简介...................................................................................",21
" 
C.1.3 工具栏快捷键....................................................................................... 532 
C.2 打开“Waveform”窗口...........................................................................",38
".................... 533 
C.3.2 设置背景颜色....................................................................................... 534 
C.3.3 编辑“Waveform”窗口中的对象.............................................",44
"................................................ 538 
C.6 编辑图表属性............................................................................................... 538 
C.7 关于波形的操作........................",31
"................................................................................... 541 
C.7.3 给波形赋予坐标轴................................................................................ 541 
C.7.4 修改波形属",41
" 
C.9 关于鼠标的操作........................................................................................... 546 
C.9.1 使用波形光标..............................................................................",33
"................... 547 
C.9.4 使用差值光标....................................................................................... 548 
C.10 关于标签的使用..........................................................",35
"......................................................... 550 
C.10.3 移动标签............................................................................................... 552 
C.11 关于标记................",30
"552 
C.11.2 修改标记显示模式................................................................................ 556 
C.11.3 编辑标记...................................................................................",31
"................................. 559 
C.12.1 保存波形............................................................................................... 559 
C.12.2 载入波形......................................",35
"....................................................................................... 560 
C.15 保存图表..................................................................................................",16
"............. 561 
C.18 建立一个图表模版....................................................................................... 562 
 
附录D Calculator 简介........................................................",34
"...........................................................................564 
D.1.2 “Calculator”的菜单..................................................................................565 
D.1.3 代数计算器和",33
".................................................................................................567 
D.1.6 开启“Calculator”..............................................................................",18
"...............................................569 
D . 2 . 1  通 过 电 路 图 表 达 式 按 键 ， 点 击 电 路 图 中 的 节 点 和 端 口 从 而 获 得 相 关 数 据 
………………………………………………………………………………………………….569 
D.2.2 在“Waveform”窗口选择曲线........",101
".....................................................................................575 
D.3.2 以文本的形式输出“Calculator”缓存中表达式的值............................576 
D.4 使用存储器（Memories）........................",47
"...............................................................................581 
D.4.3 “Save…”子菜单.......................................................................................581 
D.4.4 “L",29
".......................583 
D.5.1 简单函数.....................................................................................................583 
D.5.2 作用两个表达式的函数和操作符....................................",39
"........................................................584 
 
附录E Parametric Analysis .................................................................................................592 
E.1 “Parame",22
"94 
E.3 “Parametric Analysis”的设置..................................................................................594 
E.3.1 “Parametric Analysis”中获得变量.................................................",35
".598 
E.4 查看仿真点.............................................................................................................598 
E.5 运行“Parametric Analysis”仿真和查看结果.....................................",38
"..................603 
E.8 删除变量和扫描范围.............................................................................................605 
E.8.1 删除扫描范围......................................................",41
"...............................................606 
E.10 保存“Parametric Analysis”的设置.................................................................608 
 
附录F Optimization.............................",28
"on”的仿真环境设置........................................................................610 
F.3 “Optimization”的启动和关闭............................................................................ 611 
F.4 “Op",35
"...............616 
F.5.1 定义对象.....................................................................................................616 
F.5.2 准备设计变量....................................................",32
"的得克萨斯仪器公司（TI）发明了世界上第一块集成电路后，集成电
路技术以惊人的速度发展。目前的集成电路已经可以在一块硅芯片上集成几千万个晶体管，
甚至上亿个晶体管。半导体集成电路技术一般可以分为[1-8]： 
� 
半导体集成电路工艺技术； 
� 
集成电路设计技术； 
� 
集成电路设计自动化（EDA）技术。 
目前集成电路工艺技术已经发展到超深亚微米阶段，特征线宽可达到 0.065μm，甚至
",214
"会提到“数字电路”和“模拟电路”。在集成电路设计领域，
数字集成电路和模拟集成电路意味着在集成在一个电子系统的这两种电路以不同的使命，
两者具有协调、互补的关系。另外，由于设计数字集成电路和模拟集成电路的流程、方法
以及对设计者知识面的要求各不相同，因此，事实上已经形成了“数字集成电路设计工程
师”和“模拟集成电路设计工程师”两个不同的群体。一个包含有数字电路和模拟电路的
SOC 芯片是数字工程师",200
"是与数字电路设计同步发展起来的，与集成电路的制造工艺和 EDA 工具的变迁
密不可分。本书中不仅分析模拟集成电路的基本理论知识，而且结合目前国际上主流的模
拟集成电路设计 EDA 工具，给出了具体设计电路的方法，以达到读者通过练习能够快速
掌握实际的模拟集成电路设计技术。 
这里需要强调的是对从事开发与设计模拟集成电路技术的工作人员来讲，除了模拟集成
电路设计外，还应该具备对电路系统，芯片应用环境",208
"下给出几个模拟集成电路的结构图进行说明。图 1- 1 是一个典型的低压差线性稳
压器（LDO）的结构图[10]。LDO 主要使用在电池供电的便携式电子产品中。便携式电子设
备在使用过程中，电池的输出电压逐渐下降，另外电子设备丰富的功能使得在使用时对电
能的要求变化很大，因此需要通过稳压器对输入电压（电池电压）进行调整，使输出电压，
即电子设备的供电电压在各种情况下达到稳定。如图 1- 1 所示，L",214
"件是芯
片外部的器件，Rout 是负载电阻，RF 是反馈电阻，电感与电容组成滤波。输出电压经过采
样后得到反馈电压，并与参考电压比较得到误差电压，误差放大器将误差电压放大后得到
比较器正端的电压信号，它与锯齿波信号在 PWM 比较器内比较后得到开关控制信号，以
决定开关管的开通与关闭时间，达到稳定输出电压的目的。 
 
4
 
图 1- 2 降压式直流电压转换器（DC-DC）的结构 
图 1- 3",214
"，而运算放大器的性能往往决定了整个模拟集成电路的性能，因此
运算放大器是模拟集成电路的基本电路也是核心电路。另外，专用模拟集成电路内部包含
有通用模拟集成电路通用模块。通用模拟集成电路应用于许多的领域中，其作为半导体产
品具有寿命长，性能稳定的特点，因此用户不必像使用专用模拟集成电路那样要承担巨额
的开发费用。并且因为有许多家生产厂家都在生产同一种型号的 LSI 产品，不必要担心购
 
5
买不到",219
"电路完成。 
1.2.2 
模拟集成电路的制造工艺技术 
目前，模拟集成电路的制造工艺主要有双极型工艺、CMOS 工艺、BiCMOS、砷化镓
和锗硅工艺。其中砷化镓和锗硅工艺技术用于制造射频集成电路，BiCMOS 技术是双极型
工艺和 CMOS 工艺的集合，既能够制造双极型器件，又可以制造 NMOS 和 PMOS 晶体管，
具有两种工艺的优点。另外，还有抗干扰性能强的 SOS（Silicon on",205
"电
路 IP 的复用技术以及模拟、数字以及混合信号电路设计验证技术的提高，使得集成电路设
计能力与半导体工艺技术之间的距离逐渐减小。 
由于模拟 CMOS 集成电路的处理的信号和电路工作原理与数字集成电路不同，因此两
者的设计流程是不同的。在数字电路中，为了提高集成度和降低电路的功耗，要求微细化
和低电压驱动。但是模拟集成电路的技术是建立在运算放大器、电流镜电路等基本电路模
块的基础上。这类电路的",212
"的设计工作由系统设计、电路设计、版图设计和测试程序设计等多个部
分组成的。如今手工设计超深亚微米模拟集成电路已经不可能，必须采用先进的 EDA 软
件工具，在计算机上进行设计。基于模拟集成电路与数字集成电路完成的功能，以及设计
参数的不同，因此在设计流程上是不同的，模拟集成电路一般采用模块化设计，即按系统
定义和要求，设计基本的单元电路，例如运算放大器、比较器和基准电流电压源等，并进
行复用。由于",187
"mulink，Cadence 公司的 Artist 或 IUS 系统仿真工具进行设计。 
1.3.2 
电路定义与设计  
按系统要求对电路进行定义设计电路。具体步骤为输入具体的晶体管级电路图，对电
路进行仿真，检测是否达到要求。检测内容除了基本功能外，需要对输入/输出动态范围、
频率特性、相位裕量、电流/电压增益、温度特性和误差特性等进行分析。如果不符合要求，
则对需要电路进行改进，并重新验证。",168
"CER 进行了改
进，开发出模拟集成电路设计仿真工具 SPICE。随后对 SPICE 改进，开发出 SPICE2E 和
SPICE2G，并公开了源代码。问世数十年的 SPICE 随着计算机性能的不断提高，也提高和
改善了自身的用户接口和分析功能，如今进行模拟集成电路设计已经离不开 SPICE 了。 
1.3.3 
版图设计与验证 
在电路设计完成后，要将晶体管、电阻和电容等各种器件有效地配置在芯片",172
"证需要的工具集合在一起，便于用户使用。比较著名的的版
图设计工具有 Cadence 公司的 Virtuoso。版图验证工具有 Cadence 公司的 Dracula 和 Assura
等。 
1.3.4 
掩模板制备、流片、封装与测试 
完成了上述芯片设计流程后，将 GDSII 格式的版图文件交到掩模板制备公司，加工掩
模板。然后送到集成电路加工生产线进行流片和芯片的封装。在芯片的研发阶段，芯片的",169
"grated Circuits. Fourth Edition, John Wiley & Sons, 
Inc., 2001 
 
8
[2] 
Behzad Rezavi, Design of Analog CMOS Integrated Circuits. The McGran-Hill Companies, Inc., 2001 
[3] 
Philips E Allen, Douglas",65
"
1997 
[5] 
洪志良，模拟集成电路分析与设计，北京：科学出版社，2005 
[6] 
 David A Johns and Ken Martin. Analog Integrated Circuit Design, John Wiley & Sons, Inc.1997 
[7] 
Roubik Gregorian. Introduction to CMOS OP-AMPS and Co",83
"片设计与实现. 浙江大学硕士学位论文，2007 年 6 月 
[12] http://www.analog.com  
 
 
9
第 2 章 单级放大器 
CMOS 运算放大器是 CMOS 模拟集成电路的最重要的模块，它的特性决定了模拟集成
电路的特性[1-3]。复杂的 CMOS 运算放大器的基础是简单的单级放大器。本章将介绍常用
的单级共源放大器、共栅放大器、源跟随器、共源共栅放大器。 
2.",179
"作时，我们首先定义信号的表示方法。模拟电路中有直流信号、交流信
号以及交流与直流混合叠加的信号。我们设定直流输入信号表示为VIN, 交流输入信号为vin, 
直流与交流的混合输入信号为 vIN。 
 
图 2- 1 包括输入信号和负载电阻的一般放大器示意图 
图 2- 1 为一般放大器示意图以及输入信号。放大器由有源器件和负载电流所构成。有
源器件中的电流 iD由输入电压或电流信号所控制。直流偏置",189
"联的 vs是小信号电压，RS是
内阻。vs的变化使总的输入电压 vIN有变化，因此使有源器件的总电流 iD变化。而 ID为一
个定值，因此输出电流 iout = id，id为有源器件的小信号电流。如果放大器的输入信号是电
流信号，那么直流偏置电流 IBIAS作为输入信号，保证有源器件，例如 MOS 的漏源电流 ID，
等于电流源电流 ISUP。与 IBIAS并联的是一个小信号电流源 is以及电流源",165
"当 ISUP = ID
时，IOUT = 0。另外一个条件是存在一个 VOUT值，使有源器件和直流偏置电流源器件都工
作在恒定电流区域。因此一般 VOUT被设定在 V+和 V -的中间。当计算静态直流工作点时，
要除去小信号源和内阻。在计算直流工作点时，由于 ID = ISUP，因此流过 RL的电流为零。 
对图 2- 1 的放大电路总结如下：输入电流或电压，使有源器件中的直流电流与电流源
电流相",176
"放大器 
在电压放大器中，控制源是压控电压源；在电流放大器中，控制源是电流控制的电流
源；在跨导放大器中，控制源是压控电流源；在跨阻放大器中，控制源是电流控制的电压
源。在双端口模型下计算小信号传输函数时，需包括作为输入信号的电压源或电流源的内
阻，并且需要将负载电阻连接在输出端口。如图 2- 3 所示，为计算开路电压增益 Av，我们
 
11
用零内阻的测试电压 vt连接在输入端口，输出端口开路",209
"相应的电流值，或者加一个测试电流源，测量电流源两端的电压值。测量输入电阻
时，需要将负载 RL 接在输出端口。为计算放大器的输出阻抗 ROUT，可在输出端口加测试
电压源或电流源，测量其相应的电流和电压值，此时输入端口的电压源短路，而电流源开
路，仅留内阻在输入端，如图 2- 3（f）所示。各种控制源、输入和输出电阻与放大器的器
件参数之间的关系十分重要。这种关系使得设计者可以了解如何改变器件的参",198
"图 2- 4 所示的是电压放大器的双端口小信号模型，包括输入电压源内阻 RS和负载电
阻 RL。其小信号电压增益可表达为： 
      
out
IN
L
s
IN
S
L
OUT
v
v
R
R
A
v
R
R
R
R
⎛
⎞
⎛
⎞
= ⎜
⎟
⎜
⎟
+
+
⎝
⎠
⎝
⎠
                 （2-1） 
 
图 2- 4 电压放大器的双端口小信号模型 
 
12
 
图 ",189
"OUT
S
i
R
R
G
v
R
R
R
R
⎛
⎞
⎛
⎞
= ⎜
⎟
⎜
⎟
+
+
⎝
⎠
⎝
⎠
                 （2-2） 
要使跨导值提高，则必须要有大的输入阻抗 RIN和大的输出阻抗 ROUT。 
2.2 共源放大器 
2.2.1 
电阻负载的共源放大器 
1. 
直流特性分析 
 
图 2- 6 共源放大器电路（a）包括小信号电压 vs、内阻 Rs和负载 RL；",191
"、内阻 RS
和负载电阻 RL电路图。NMOS 管作为输入管，电阻 RD作为负载。 
图 2- 7（a）为典型的 NMOS 管特性曲线，其中的漏源电压 VDS，即为输出电
压 VOUT，直流偏置电压 VBIAS为参数。注意 NMOS 管在饱和区时，其漏源电流 ID
和栅源电压 VGS成平方律关系[2]。 
我们在 NMOS 的特性曲线上画出式（2-3）所示的负载线。 
OUT
DD
D
D
V
V",181
"工作状态有以下三种[5]： 
1) 
当 VBIAS小于 NMOS 管的阈值电压 VTH时，即 VBIAS < VTH时，NMOS 管
截止，ID=0，输出电压 VOUT = VDD - IDRD = VDD，如图 2- 6（b）中的 AB
段线。 
2) 
当 VBIAS大于 VTH时，NMOS 管开通，输出电压 VOUT随着 VBIAS的增大开
始下降。如果 VBIAS<VOUT + VTH，",148
"UT +VTH时，MOS 管从饱和区进入线性区，输出电压如图 2- 6
（b）中的 DE 段线。此时的 VOUT与 VBIAS的关系如式（2-5）所示。 
(
)
2
OUT
DD
n
ox
BIAS
TH
OUT
OUT
D
1
2
2
W
V
V
C
V
V
V
V
R
L
μ
⎡
⎤
=
−
−
−
⎣
⎦
        （2-5） 
 
14
从图 2- 7（b）可知，当 NMOS 管工",172
"图 2- 8（a）电阻负载的共源放大器电路的小信号模型；（b）考虑了输入小信号与负载的小信号 
模型 
按双端口模型，在图 2- 8（a）所示电路的输入端口加一个测试电压源 vt，并
将输出端口短路，可以计算得到放大器的本征跨导为[6,7]： 
out
m
m
n
ox
D
t
2
i
W
G
g
C I
v
L μ
=
=
=
               （2-6） 
由于放大器的输入信号连接",172
"的交流双端口模型，（b）添加了电压源与内阻，
以及负载电阻后的双端口模型。图中的 ro 是 MOS 管的漏源电阻[6,7]： 
o
D
1
r
≈ λI
  
      
 
 
 
（2-8） 
其中，λ 为 MOS 管的沟道长度调制参数。 
 
图 2- 9（a）本征共源放大器的交流双端口模型；（b）添加了电压源与内阻，以及负载电阻后的
双端口模型 
以下分析交流小信号电压增益。如果将式（2",184
"小信号模型计算小信号电压增益。根据 KCL
定理，可得： 
m
in
out
o
D
(
//
)
0
g v
v
r
R
+
=
                     （2-10） 
因此，得到交流小信号增益： 
(
)
out
m
V
m
o
D
in
o
D
//
1
1
v
g
A
g
r
R
v
r
R
=
= −
= −
+
               （2-11） 
式（2-1",141
"             （2-12） 
式（2-12）表示的增益称为 MOS 管的本征增益。将式（2-6）和式（2-8）代
入式（2-12），可得： 
V
n
ox
D
1
1
2
W
A
C
L
I
μ
λ
⎛
⎞
= −
⎜
⎟
⎝
⎠
                   （2-13） 
由式（2-13）可以看出，MOS 管的本征增益 Av与 ID的平方根以及 λ 系数成反比。
在长沟道器",168
"= 50 µA/V2，λ=0.1V-1，W/L=50/2。 
求：[1.]用双端口模型，计算放大器的本征跨导 Gm（RS = 0 Ω，RL = 0 Ω）；[2.]在
接负载电阻 RL的情况下，为保证跨导 iout/vs大于本征跨导的 10%，那么 RL的取值
范围？ 
解：[1]当 RL = 0Ω, RS = 0 时，按式（2-6）计算本征跨导： 
2
m
m
D
n
ox
50
2
2 100μ",180
"i
R
G
v
R
R
λ
μ
−
=
=
=
Ω
=
=
Ω
⎛
⎞
=
⎜
⎟
+
⎝
⎠
而
 
按题意，
out
out
L
1
10
R
R
+ R >
，因此 RL < 9Rout，即 RL < 180 kΩ。 
2.2.2 
恒流源作负载的 CMOS 共源放大器 
1. 直流特性分析 
用恒流源可代替电阻 RD作为共源放大器的负载。给 MOS 输入管提供电流的
理想电流源负载应该具有",180
"接负载电阻 RL。为分析大信
号特性，我们设输入小信号电压和内阻对直流特性没有影响。另外忽略 MOS 管
的沟道长度调制效应（λ= 0 V-1）以及电流源的内阻（roc= ∞）。由于直流输出电流
IOUT为零，因此可以不考虑负载电阻 RL。这样可得到大信号分析电路图如图 2- 11
（b）。 
 
图 2- 11 恒流源作负载的共源放大器(a)包括了输入小信号电压 vs和内阻，以及负载电阻 RL，",191
"流 ID流过，
VOUT输出电压开始下降。随着 VBIAS的进一步增加，MOS 管进入饱和区，最后进
入线性区。我们的目标是将 MOS 管设定在高增益的饱和区。 
这里我们设 ID为一个定值，求直流偏置电压 VBIAS的值。根据 MOS 管饱和电
流公式[6,7]： 
(
)
2
D
SUP
n
ox
BIAS
TH
2
W
I
I
C
V
V
L μ
=
=
−
             （2-",167
"负载共源放大器的小信号负
载。不包含有输入小信号电压和内阻以及负载的放大器本征小信号模型如图 2- 23
所示。 
 
图 2- 13 不包含有输入小信号电压和内阻及负载的放大器本征小信号模型 
 
18
本征跨导 Gm 的计算方法为在输入端口加测试电压源 vt，输出端短路，这样
可得到[6,7]： 
out
m
m
n
ox
D
t
2
i
W
G
g
C I
v
L μ
=
=
=
     ",182
" 所示。图 2- 14（a）
为本征跨导小信号模型，（b）为本征电压放大小信号模型。因此，从图 2- 14（b）
可以得到电压放大系数 Av 为： 
(
)
out
v
m
o
oc
in
//
v
A
g
r
r
= v
= −
                    （2-18） 
 
图 2- 14 双端口共源小信号模型（a）本征跨导小信号模型，（b）本征电压放大小信号模型 
在实际电路设计",164
"极交流接地的 MOS 管作有恒流源负载 
2.2.3 
栅、漏短接的 MOS 管为负载的共源放大器 
图 2- 16（a）所示的栅、漏短接 MOS 晶体管有 VDS = VGS，因此只要 MOS 管
 
19
导通，即工作在饱和区，这个 MOS 管可以起一个小信号电阻的作用。与双极性
晶体管对应，它在模拟电路中叫做“二极管连接”器件。图 2- 16（b）是为计算等
效电阻的小信号等效电路。 
 
",195
"示。 
 
图 2- 17（a）二极管连接的 NMOS 管作负载， 
（b）二极管连接的 PMOS 管作负载的共源放大器 
在图 2- 17（b）中，M1管作为输入管，M2 管是二极管连接的 MOS 负载管。
将式（2-20）替代式（2-11）中的电阻 RD，可以得到电压增益为： 
m1
m1
n
1
2
V
o1
m2
o2
m2
p
2
1
1
1
g
g
W L
A
r
g
r
g
W L
",184
"管做负载的共源放大器的线性
特性。另外一种可改变放大器线性的电路如图 2- 18（a）所示，通过用一个串联
在输入 MOS 管源极的“负反馈”电阻来实现。电路“负反馈”的基本原理是随着 vIN
增加，iD也增加，同样在 RS上的压降也会增加，因此输入电压 vIN的一部分出现
在 RS上而不是全部作为栅源电压，因此 iD随 vIN的变化变得平滑。 
 
图 2- 18（a）带负反馈的 CMOS 共源",194
"
−
+
−
             （2-22） 
(
)
(
)
out
o2
out
o1
mb1 x
m1
in
x
x
v
r
v
v
r
g
v
g
v
v
=
−
+
−
−
          （2-23） 
因此得到： 
(
)
m1 o1 o2
m1 o2
V
o2
S
o1
m1
mb1
S o1
m1
S
1+
g
r r
g
r
A
r
R
r
g
g
R r
g
R
",150
"
x
out
m1
1
mb1
o1
out
S
m1
in
out
S
mb1
out
S
o1
    
(
)
x
v
i
g
v
g
v
r
i
R
g
v
i
R
g
i
R
r
=
−
−
=
−
−
−
      （2-25） 
因此可以得到， 
 
21
[
]
(
)
out
m1 o1
m
in
S
m1
mb1
S
o1
m1 o1
o1
S
m1
mb1
o1
m1
m1",157
"个重要的作用是增大共源级的输出电阻，以下借助图 2- 20 所示的等效电路
计算电路的输出阻抗。 
 
图 2- 19 计算带负反馈的共源级电路跨导 Gm的小信号等效电路 
 
图 2- 20 计算负反馈共源级的输出电阻的小信号等效电路 
 
流过 RS的电流等于 ix，所以 v1 = -ixRS，流过 ro1 上的电流是 
(
)
(
)
x
m1
mb1
1
x
m1
mb1
S x
i
g
",175
"+
⎡
⎤
⎣
⎦
                  （2-29） 
因为通常(gm1+gmb1)ro1>>1，因此上式可以简化为： 
(
)
OUT
m1
mb1
o1
o1
x
S
x
v
R
g
g
r R
r
= i
≈
+
+
                  （2-30） 
式（2-30）表明源极电阻的加入，使输出电阻增大了(gm1+gmb1)RS倍，这是一个重
要有用的结论。 
",151
"源极电阻 RS的加入，降低了电路的跨导，增加了电路的输出阻抗，
同时减少了跨导及 MOS 管的漏电流 ID与输入电压之间的非线性。 
2.3 共栅放大器 
本节主要讨论的是输入端为 MOS 管的源端，输出端为 MOS 管的漏端的放大
器，即共栅放大器。我们将会发现共栅放大器的输入阻抗较小，而输出阻抗较高。
图 2- 22 是共栅放大器电路，NMOS 的源端有输入电流源 is 和内阻 RS，以及直流",191
"应”的存在 VTH将随着 VBS变化。 
 
23
 
图 2- 22（a）共栅放大器电路，包括输入小信号、内阻以及负载电阻 RL； 
（b）设 is = 0A，Rs→∞，RL = 0，ISUP的内阻 roc→∞的电路 
 
为了分析共栅放大器的大信号特性，我们将图 2- 22（a）中的输入小信号源
以及内阻去掉，并将 RL置为零，如图 2- 22（b）所示。在输出端按 KCL 原理，
可以得到：",172
"
W
I
I
C
V
V
V
L
μ
λ
=
=
−
+
          （2-33） 
其中[2]， 
THn
THn0
n
F
SB
F
2
2
V
V
V
γ
φ
φ
⎡
⎤
=
+
+
−
⎣
⎦             （2-34） 
如果忽略 MOS 管的沟道长度调制效应，即 λn = 0，并且 VG = 0 V，可得到源端的
电压： 
SUP
S
THn
n
ox
2
I
V
V",161
"原
因是栅极无电流流入。 
 
24
 
图 2- 23 计算共栅放大器输出短路电流的小信号模型 
 
 
图 2- 24 计算共栅放大器的输入电阻的小信号模型 
图 2- 24 是计算共栅放大器的输入电阻的小信号模型。在输入端加一个测试
电流源，测量电流源上的电压值，可得到输入电阻。图中的 roc是 ISUP电流源的内
阻，RL为负载电阻，并注意到 v1 = –vx= –vt；vbs= –vt。",175
"/(gm+gmb)，因此式（2-37）可以简化为。 
IN
m
mb
1
R
g
g
≈
+
                      （2-38） 
 
25
图 2- 25 计算共栅放大器的输出电阻的小信号模型 
 
图 2- 26 共栅放大器的双端口模型 
 
图 2- 25 是计算共栅放大器的输出电阻的小信号模型。将输入小信号电流设
为零，即开路，但保留小信号内阻 Rs，ISUP电流源的",157
"-40） 
 
即， 
(
)
t
x
o
S
m
mb
o
1/
1/
v
v
r
R
g
g
r
=
+
+
+
              （2-41） 
 
将式（2-39）代入式（2-41），并整理得到： 
t
o
S
m o
mb o
t
S
1
v
r
R
g r
g
r
i
R
⎛
⎞
=
+
+
+
⎜
⎟
⎝
⎠
                （2-42） 
 
考虑到并联的",151
"    （2-44） 
 
注意：由于 MOS 管源极有电阻存在，因此有负反馈作用，使输出电阻值大大提
高了。因此，共栅放大器可以用作电流缓冲器，有低的输入电阻、单位增益电流
和高的输出阻抗。 
通过降低输入电阻可以增加跨导。可用提高 ISUP 电流或提高 MOS 管的 W/L
值达到增加跨导的目的。输出电阻的提高受到 ISUP电流内阻 roc的限制。共栅放大
器的双端口模型如图 2- 26 所示",188
"OS 管的阈值电压 VTH将是 VBS的函数[1,2]。 
 
图 2- 27（a）包括小信号电压 vs、内阻 RS和负载 RL的共漏放大器，（b）用于大信号分析的简
化电路，vs = 0V，RS =0Ω，RL→∞，roc→∞ 
图 2- 27（b）是共漏放大器大信号分析模型的简化电路，用于计算输入偏置
电压 VBIAS和输出电压 VOUT的关系。由图可见： 
BIAS
GS
OUT
V
V
V
",176
"2
V
V
V
γ
φ
φ
⎡
⎤
=
+
+
−
⎣
⎦            （2-47） 
 
图 2- 28 求共漏放大器开路电压增益的小信号模型 
 
图 2- 29 计算共漏级放大器的输出阻抗的小信号模型 
从电路图 2- 27，我们可以推测其电压放大系数近似为 1，电路有大的输入电
阻和小的输出阻抗。为计算双端口模型参数，首先画出如图 2- 28 所示的用于计
算开路电压增益 AV ",190
"
将式（2-48）代入式（2-49），可得： 
out
m
m
v
in
o
oc
m
mb
m
mb
1 (
//
)
v
g
g
A
v
r
r
g
g
g
g
=
=
≈
+
+
+
           （2-50） 
因为 ro//roc>>1/(gm+gmb)，因此 vout/vin近似等于 1。注意衬底偏置效应使 vout/vin
降低。因为 MOS 管的栅是绝缘的，所以 RIN→∞",154
"r
r
g
g
=
+
+
                   （2-52） 
由于，一般情况下 ro//roc>>1/(gm+gmb)，因此， 
OUT
m
mb
1
R
g
g
≈
+
                         （2-53） 
从而得到共漏放大器的双端口模型如图 2- 30。 
 
图 2- 30 共漏放大器的双端口模型 
2.5 共源共栅放大器 
在前节中提到共栅级",138
"放大器，M2管作共栅放大器，M3管是负载管。
输入信号加到 M1管栅极，输出信号从 M2管的漏极引出。 
 
图 2- 31 (a)恒流源负载；（b）栅、漏短接的 MOS 管作负载的单级共源共栅放大器电路 
 
29
2.5.1 
大信号特性 
设图 2- 31（a）中的 M1、M2 和 M3管的阈值电压分别为 VTH1、VTH2、VTH3。
VG2 和 VG3 分别是 M2 和 M3 的直流偏置",181
"下降。当 VOUT>VG3+|VTH3|时，
M3 管工作在线性区，而 M1 和 M2管工作在饱和区。如图 2- 32 中的 BC
段。 
3) 
当 VIN 继续上升，当 VOUT<VG3+|VTH3|时，M3 管进入饱和区。如果同时满
足 VOUT > VG2-VTH2，那么 M2 管工作在饱和区。对于 M1 管，如果 VGS1 = VGS2 
=VIN，那么当 VG2-VGS2 ≥VGS1 ",166
"
在饱和区。M1 和 M2管哪个先进入取决于 M1和 M2 管的宽长比和 VG2电
压。 
5) 
当输入电压继续增大，如果 VA <VIN-VTH1，那么 M1和 M2管都进入线性区，
M3 管工作在饱和区，输出电压缓慢下降。如图 2- 32 中的 EF 段。需要注
意的是，输出电压的最大值可达到 VDD，但最小输出值高于零电平，其值
取决于 M1、M2 和 M3管的宽长比以及偏置电压值。 
 ",192
"                （2-54） 
VOUT (最小) = VDS1 (饱和)+VDS2 (饱和)                （2-55） 
因此，为了增大输出电压的范围，可以通过增加各个管子的宽长比，以降低饱和
压降。 
2.5.2 
小信号特性 
图 2- 33（a）是恒流源负载共源共栅放大器电路（图 2- 32）的小信号模型等
效电路，按电流源拆分和置换原理，将此模型简化后可",167
"） 
由上两式求得小信号电压增益 vout/vin为： 
(
)
m1
m2
mb2
o2
o1 o3
out
m1 o3
in
o2
o3
o1
o1 o2
m2
mb2
1
(
)
g
g
g
r
r r
v
g r
v
r
r
r
r r
g
g
+
+
⎡
⎤
⎣
⎦
= −
≈ −
+
+
+
+
        （2-58） 
从式（2-58）可以看到，与共源放大器相比，共源共栅放大器",171
"
从式（2-59）可见，与共源放大器相比，共源共栅放大器具有更大的输出小信号
电阻。另外，计算从 vin到 M1 的漏极电压（vA）的小信号增益也是我们感兴趣的。
根据式（2-57）和式（2-58）可得： 
(
)
1 o1
o2
o3
1
A
in
o1
o2
o3
o1 o2
2
2
2
m
m
m
m
g r
r
r
g
v
v
r
r
r
r r g
g
−
+
=
≈ −
+
+
+
 ",185
"35 分别是共源级和共源-共栅级放大器中 CGD电容
的密勒效应原理图。根据密勒定理（详见第 5 章），我们可以得到图 2- 34 中共源
放大器中的 C11 = (1-A1)CGD，C12 = (1-1/A1)CGD，其中 A1 为共源放大器的电压增益。
一般情况下，共源放大器的电压增益 A1 比较大，因此密勒效应将在输入端口引入
较大的寄生电容。该寄生电容对电路的频率特性有较大影响。 
 
图",191
"寄生电容较小。共源共
栅放大器合适于对高频小信号的放大。 
 
 
习题 
2.1 在共源共栅电路中，增加电压增益可以通过增加输入 MOS 管的跨导（gm）或增大输出电
阻（rout）的方法。在图 2- 36 中，通过改变 M1管的电流 ID，可改变电压增益。试计算小
信号电压增益的一般表达式。 
 
图 2- 36 
 
 
33
2.2 图 2- 37 所示的是共源共栅电路，计其电压增益和输出",184
"/V2，μnCox=50 μA/V2，VTHn=+0.7 V，VTHp=-0.7 V。 
 
2.4 在图 2- 37 所示的共源共栅电路中，VG2从 0 升高到 VDD 画出小信号电压增益 vout/vin随之变
化的曲线，设 λ= γ =0。 
 
2.5 图 2- 38 是共漏电压缓冲器。                                
 
 图 2- 38 
 
器件参数：",138
"放大器的直流功耗？注意虚线框中的元件是用于小信号分析。 
(c) 求出以下小信号参数：gm、ro、CGS、ＣGD和 CSB。可以忽略ＣGB以及金属布线电容。参数：
Cjn = 0.1fF/μm2，φB = 0.9V（源漏扩散层），Cox  = 4.6fF/μm2， Cov=0.5 fF/μm，Cjswn=0.2 fF/μm。
源/漏与 poly-Si 栅的叠交部分 LD = 0.1μm，Ldiff",175
"39 所示的 NMOS 共栅电流缓冲器。 
 
图 2- 39 
器件参数: 
VT = 0.5V；L = 1μm；μnCox = 100 μA/V2，λn = 0.04V-1，RS = 10KΩ，ISUP = 200 μA，roc = 100 kΩ；
RL=50 kΩ；VBIAS=2V；IBIAS=200 μA 
(a) 当源电压为 1V 时，在所列出的偏置条件下，求 MOS 管的宽； 
(b)",151
"(c) 电流增益 
(d) 跨阻 
 
2.8 计算 2.7 题中电路的各个参数。参数器件参数如下： 
(a) RIN＝10 kΩ，ROUT＝100 Ω，RS＝100 Ω 以及 RL＝10 kΩ 
(b) RIN＝100 Ω ，ROUT＝10 kΩ，RS＝10 kΩ 以及 RL＝100 Ω 
 
2.9 如图 2- 41 所示 NMOS 共源放大器电路。 
 
图 2- 41 
 
器件参数：W/",154
"2 所示 NMOS 共栅放大器，电流源偏置，输入信号为小信号电流。求在
ISUP=100μA，VOUT=0V 条件下的各电路参数。 
 
36
 
图 2- 42 
器件参数：W/L=50/5；VTHn = 0.7 V；μnCox = 75 μA/V2；λn = 0.02V-1，roc = ro 
求：(a)  IBIAS的值 
(b)  计算双端口的模型中 RIN和 ROUT参数 
(c)  计",152
"UT＝0V 条件下，求 VBIAS的值 
 
(2) 计算双端口参数 RIN和 ROUT 
 
(3) 计算电压增益 
 
37
 
(4) 计算跨导 
 
2.14 如果 ISUP=20μA，计算 2.13 题中的参数。 
 
2.15 如图 2- 44 所示 PMOS 共漏放大器，电流源偏置，输入小信号电压。 
 
图 2- 44 
器件参数：W/L=20/2；VTP = -0.7 V；μnC",152
"t al. Analysis and Design of Analog Integrated Circuits. Fourth Edition, 
John Wiley & Sons, Inc., 2001 
[2]  Behzad Rezavi, Design of Analog CMOS Integrated Circuits. The McGran-Hill 
Companies, Inc.",57
"ted 
Approach. Prentice-Hall, Inc., 1997 
[5] 洪志良，模拟集成电路分析与设计，北京：科学出版社，2005 
 
38
[6] David A Johns and Ken Martin. Analog Integrated Circuit Design, John Wiley & 
Sons, Inc.1997 
[7] Roubik Gregorian",87
"差分放大器的基本概念、电路和性能，说
明差分放大器在模拟集成电路设计中的作用。最后讨论电流镜负载的双端输入单端输出的
差分放大电路的性能。 
3.1 MOS 电流源 
图 3- 1 中 MOS 管工作在饱和区。如果不考虑沟道长度调制效应，那么电流源或电流
阱的电流大小与漏源电压无关[1,2]，所以从图 3- 1 中的 MOS 管的漏极看进去，其电流是不
变的，是一个理想的电流源。如果考虑沟道长度调",203
"-2）可知，电流源的输出电阻与 λ 系数和直流电流 IDS的值成反比。电流 IDS的值越
大，则 ro的值越小，与理想的电流源距离就越大。另外，式（3-2）的计算结果是在一阶模
型基础上得到的，适合于沟道长度大于 10μm 的长沟道器件和沟道低掺杂的条件[3,4]。我们
知道 λ 系数与沟道长度成反比[2]，因此在亚微米工艺条件下，电流源的输出电阻将降低。
因此在设计电流源时，要根据实际需要设定 ",201
"输出电阻大，而且需要电压的工作范围宽。输出电阻越大，则在工
作电压范围内，电流源越恒定。 
3.2 基本电流镜 
从 3.1 节的介绍，我们知道可利用 MOS 管饱和区的特性，用 NMOS 管、PMOS 管和
偏置电压可构成电流源和电流阱，其电流大小可用式（3-1）表示。为了得到稳定的电流源，
 
40
需要保证式（3-1）中各项参数在工艺条件、电源电压和温度有变化时没有变化。但实际上
随着工艺的",210
"电流源 IREF（详见第
9 章），并将精确电流源进行复制，产生电流源和电流阱。 
 
图 3- 1 单个 MOS 管的（a）电流源；（b）电流阱 
 
图 3- 2 基本电流镜电路 
图 3- 2 是基本的电流镜电路。由 IREF在二极管连接的 M1 管通路上产生 VREF，
并加在 M2 管的栅极上产生电流源。为了计算输出电流 IOUT的值，假定 M1和 M2
管是匹配的，即两个管子的阈值电压",185
"流输出电流 IOUT为：  
 
41
(
)
2
REF
OUT
n
ox
THn
THn
2
n
ox
1
1
2
/
/ 2
I
W
I
C
V
V
L
W L
C
μ
μ
⎛
⎞
⎛
⎞ ⎜
⎟
=
+
−
⎜
⎟ ⎜
⎟
⎝
⎠ ⎝
⎠
           (3-6) 
即， 
(
)
(
)
2
OUT
REF
1
/
/
W L
I
I
= W L
                ",163
"件，即 M1 管和 M2 管的开启电压、载流子
迁移率等完全相同，因此 IOUT与 IREF的关系是 M2与 M1 的几何尺寸比例关系。 
以下我们分析如图3- 3所示的图3- 2电路的小信号模型[2]。将参考电流源开路，
M1 是二极管连接的 MOS 管，产生直流偏置电压 Vref。注意在图 3- 3 中，尽管画
了 M2管的压控电流源，但由于其小信号电压 vgs2为零，因此 M2 管的小信号模",188
"3- 6 产生多路电流源电路 
 
为提高电流源的小信号电阻，我们可以设计共源共栅的电流源，如图 3- 5 所
示。在这个电路中，输出电流 IOUT与 IREF的关系还是按(W/L)2/(W/L)1 的比例关系，
而输出电阻由于共源共栅结构得到大大提高。在以前的讨论中，我们知道 M2 和
M4 管组成了共源共栅结构，因此共源共栅电流源的输出电阻为： 
(
)
S
m4 o4
o2
R
g
r
r
",181
"应。 
器件参数：VTHn=1V；µnCox=50 µA/V2；λn=0.1V-1@L=1µm (λn
1/
∝ L) ；Lmin=2µm 
解：首先设定 M1和 M3的栅电压，以保证 M2 和 M4 工作在饱和区，并且 VD4 
=2.0V。开始时，我们设定 M1、M2、M3 和 M4的栅源电压 VGS为 1.5V， 这样 VGS4 
= 1.5V，并且 M4 管的源端，即 M2管的漏端的电压为",178
" IREF =10μA 的电
流。忽略背栅效应的条件下，可得： 
REF
GS
THn
n
ox
2
I
V
V
C
W
L
μ
=
+
 
将参数代入上式后，可以求出(W/L)1=(W/L)3=1.6。由于我们设定 M2和 M4管的宽
长比分别与 M1 和 M3管的宽长比匹配，并且 IREF =IOUT，因此(W/L)2=(W/L)4=1.6。
以下计算输出电阻 RS。 
(
)
S
m4 o4",161
"Ω。 
3.3 电流源与电流阱电路 
在前节中，我们将 NMOS 管构成的对地电流源也称为电流源，但按电流的流
向，我们应该正确地称之为电流阱或电流漏[3]。PMOS 管也可以构成电流源。如
果我们将一个稳定的电压源加到多个 MOS 管上，那么可以构成如图 3- 6 所示的
多电流源。 
每个电流源的值可以通过改变这些 PMOS 管的宽长比设定，输出电流为 
(
)
(
)
n
OUTn
REF
",179
"阱。输出直流电流源的值为： 
(
)
(
)
1
OUT1
REF
R
/
/
W L
I
I
= W L
                       (3-10) 
这样，我们可以得到 M2管中的电流源电流： 
    
(
)
(
)
2
OUT2
REF
R
/
/
W L
I
I
= W L
                        (3-11) 
相应的 M4管中电流阱电流为： ",115
"电流阱的小信号电阻需要大于 10 MΩ。电流源与电流阱的
VDS,SAT小于 0.5V。有一个 10μA 的基准电流源，可用于驱动其他器件。 
器件参数如下：VTHn=1V；VTHp= -1V；µnCox=50 µA/V2；µpCox=25 µA/V2；λn=λp 
=0.1V-1@L=1µm 
解：设计的电路如图 3- 8 所示。按设计要求为满足 VDS,SAT小于 0.5V，需要 VGS，
N",173
"MOS
管的设计可以按相同的方法： 
 
45
REF
SG
TP
p
ox
1.5 V
2
I
V
V
W
L μ C
=
= −
+
， 
将已知条件代入，可得(W/L)4 = 3.2。为保证 ID5 = 10µA，ID6 = 20µA 可得(W/L)5 = 3.2，
(W/L)6 = 6.4。以下检查小信号源电阻。 
对于 ID = 10µA 以及 L = 1μm 条件下 λn = λp =",151
"
128/20。 
读者也许会对如何产生参考电流 IREF感到疑惑。实际上有以下几种方法可以
产生参考电流 IREF
[4]：1)片外的一个电流；2)设计一个与电源电压无关的，并且经
过温度补偿的专门电路产生 IREF，具体电路在第 9 章介绍；3）利用经温度补偿的
带隙基准电压电路产生参考电流；4)用如图 3- 9 所示的一个简单的电路也可以产
生参考电流。 
 
图 3- 9 简单的产生参考电",196
") 
如果 MOS 管的宽长比很大，那么参考电流可以近似为： 
DD
THn
REF
V
V
I
R
−
≈
                           (3-15) 
因此，参考电流大小取决于电阻 R。该电路的最大的问题是，电流大小取决
于电源电压 VDD。在模拟集成电路设计中，一般需要 IREF 与电源电压与温度都无
关，因此需要设计更复杂的电路[2,5]。 
 
46
3.4 差分",159
"量，那
么在差分信号处理过程中，同时加在 A 和 B 上的任何信号将被去除。不需要的共
模信号有： 
1）随时间变化的电源电压波动； 
2）集成电路中的衬底电压波动； 
3）集成电路随温度的变化。 
3.4.1 
差分放大器的基本概念 
考虑如图 3- 10 所示的基本差分放大器电路。可以看到这个电路实际上是两
个共源电路和一个电流源所组成。有源器件，即输入对管是完全匹配的 MOS 管。
在两个输",198
"电压的中间值。我们将输出电
压设为零电压，因为电路是正负对称电压供电。这种设置与给共源放大电路直流
 
47
偏置使输出直流电压处于电源电压的一半相似。 
考虑大信号电压相同的情况，即 VI1 = VI2，并且小信号输入电压为零，因此
可以得到 VIN1 = VIN2。另外，由于我们设定 M1 和 M2 是匹配的，因此流入漏极的
电流完全相等，即 I1=I2。以下我们定量分析 I1 和 I2，并设",186
"
为零。设 RD1 = RD2 = RD，因此 IBIAS需要满足以下关系： 
BIAS
1
2
D
2V
I
I
I
R
+
=
+
=
                    (3-18) 
由于 M1 和 M2 是匹配的，并且 VI1=VI2，因此 IBIAS 可根据式（3-18）求出。也就
是说如果 IBIAS满足式（3-18），那么可以保证 VO1 和 VO2 的直流输出电压为零。 
应",143
" 
设有两个信号 x1和 x2，这两个信号对所要分析的差分电路来讲，可以是电压
也可以是电流。差模信号 xDM定义为这两个信号的差值，而共模信号 xCM定义为
两个信号的平均值，分别表示为： 
DM
1
2
x
x
x
=
−
                        (3-19) 
1
2
CM
2
x
x
x
+
=
                        (3-20) 
现在，",138
" vic两部分，如图 3- 11（b）
所示。按 KVL 定理，输入小信号电压 vi1 和 vi2可以分别表示为： 
id
i1
ic
2
v
v
= v
+
                          (3-21) 
id
i2
ic
2
v
v
= v
−
                            (3-22) 
按照共模信号和差模信号的定义，我们可以写出共模和差模信号与",122
" 3- 12 为例进行说明。假定电路的偏置电流设定是合适
的，而小信号输入电压仅仅输入到放大器的一边。这种情况下，我们可以将输入
信号分解成共模和差模信号，如图 3- 12（b）所示，差模信号 vid 等于 vin，共模信
号等于 vin/2。 
综上所述，我们可以将输入信号分别分解为差模和共模两个部分，然后，按
所输入的纯差模和共模信号来分析差分放大的特性。我们分析的是小信号线性电
路，因此通过",191
"可。差分放大器的基本目标是放大差分信号，抑制共模信号。 
差分放大器如图 3- 13 所示，设在 VI1 = VI2 =0 的条件下，IBIAS的值可保证输
出直流电压为零，小信号电压源被直接接到差分放大器。为方便起见，我们选择
直流输入电压信号为 VI1 = VI2 =0，设 IBIAS电流源有一个有限的电阻值 rob。 
 
图 3- 13 MOS 管为输入管的差分放大器，rob为电流源的有限",175
"通常 RD比 ro 要小得多）。直流偏置设为零，因此偏置电流源为零，即
开路，而直流电压源为短路。 
 
由于是电路是对称的，M1 和 M2匹配，并且小信号输入电压大小相等，方向
相反。所以 i1和 i2大小相等，方向相反，因此，无小信号电流流过 rob，vx电压值
可为零，因此可得： 
id
o1
m
D 2
v
v
= −g R
                           (3-25",162
"               (3-28) 
这里需要强调对全对称电路采用“半边电路分析技术”概念的理解。对全对称
的差分放大器的小信号电流的分析发现，rob上无电流流过。因此，图 3- 15 中的
x 节点可视为交流地，差分放大信号可以用两个如图 3- 15 所示的半电路来计算，
得到的 Adm 表达式与式（3-28）一样。需要注意的是“半边电路分析技术”，只能
用于全对称电路。 
 
 
51",179
" i2完全相等，因此，x 节点的电压值
为： 
x
1
2
ob
1 ob
2 ob
(
)
2
2
v
i
i r
i r
i r
=
+
=
=
                         (3-29) 
我们可以将图 3- 16 的电路按半边电路原理分解为如图 3- 17 所示的两个电路
图。注意图中偏置电流源内阻为 2rob。这是因为在半边电路中，电流为 i1 或 i2 ，
而 vx",152
"以得到： 
o1
o2
m
D
ic
ic
m ob
1
2
v
v
g R
v
v
g r
=
≈ − +
                          (3-30) 
因此，得到共模增益为： 
oc
o1
o2
m
D
cm
ic
ic
m ob
(
)/ 2
1
2
v
v
v
g R
A
v
v
g r
+
=
=
= − +
                    (3-31) 
",126
"v
A v
A
=
+
=
+
                     (3-32) 
 
od
id
o2
oc
cm
ic
dm
2
2
v
v
v
v
A v
A
=
−
=
−
                     (3-33) 
由于一般输入电压 vi1 和 vi2 与纯差分信号 vid 和纯共模信号 vic 的关系可用式
（3-23）和式（3-24）表示，代入式(3-32)和式（",127
"以求出其输出小
信号值。 
3.4.4 
共模抑制比 
正如前面指出的那样，差分放大器是用来放大差分输入信号，而对共模输入
信号进行抑制。用差模增益与共模增益的比值，即共模抑制比（CMRR）来描述
差分放大器的性能。CMRR 的表达式[2]： 
od
id
dm
m ob
oc
ic
cm
/
CMRR
1 2
/
v
v
A
g r
v
v
A
=
=
= +
                (",164
"信号源为单端，输出也为单端，单端电压定义为端口与地之间的电压，电路结构
对称，器件匹配。求共模增益和差模增益。 
 
53
器件参数：µnCox = 50 µA/V2，M1和 M2管的 W/L = 40 
 
图 3- 18 单端输入单端输出差分放大器 
 
解：  因为 vi1 = vin，vi2 = 0， 
所以 vid = vi1-vi2 = vin；vic=(vi1+vi2)/2 = vi",152
"
C
I
L
L
μ
−
−
⎛
⎞
=
=
×
×
×
×
= ×
⎜
⎟
⎝
⎠
 
从前节的分析可知：
dm
m
D
1mS 10kΩ
10
A
= −g R
= −
×
= −
 
m
D
cm
m ob
10
0.1
1
2
1
2 (1 mS) (50k )
g R
A
g r
−
−
=
=
≈ −
+
+ ×
×
Ω
 
所以 vo/vin= -0.05+5 ≈ 5 
注意：因为单",175
"与差分
输入电压的比值，即为-gmRD，由于 MOS 管的栅为绝缘栅，因此差分输入电阻为
Rid→∞。 
注意：如果输入有源器件为双极型晶体管，则需要利用半电路模型[2]，在输
 
54
入端加 vt/2 测试电压源测量其电流 it，从而计算输入电阻。为求出差分放大器的
输出电阻，我们仍然用半边电路分析方法，如图 3- 20 所示，加一个测试电压源
vt/2 在输出端口，输入电压被置为零，在这一条",192
"差分放大器中的应用 
正如前一章所述，放大器的双端口模型在理解电压/电流源内阻和负载电阻在
传输函数中的作用十分有帮助。图 3- 21（a）是内阻为 RS的差分输入电压，其等
效电路如图 3- 21（b）所示，正如预期的那样，差分等效输入电阻为差分半边电
路的输入电压源内阻的 2 倍。 
 
图 3- 21  (a)包含内阻 RS的差分输入信号；（b）等效电路 
如图 3- 22 所示，在差分放大",203
"压源内电阻与负载电阻计算方式，整个放大器的模型如图
3- 23 所示。完整的差分电压增益传递函数为： 
(
)
od
id
L
m
D
id
id
S
od
L
2
2
2
v
R
R
g R
v
R
R
R
R
⎛
⎞
⎛
⎞
=
−
⎜
⎟
⎜
⎟
+
+
⎝
⎠
⎝
⎠
            (3-38) 
该传输函数中有 3 项： 
1）放大器的输入电阻项，有限的输入电阻使放大器电压增益",204
"提出了差分放大器的双端口模型。用该模型可以分析电压/电流
源和负载电阻对差分放大器的传递函数的影响。 
 
例 3.4  MOS 差分放大器的差模频率响应 
图 3- 24 所示的 MOS 差分放大器电路，偏置电流源 IBIAS=50µA，源电阻 RS= 
5kΩ。计算 MOS 管的 W/L 和 RD的值，使低频差分电压增益达到－50，并求出 3dB
带宽。本例中，设直流共模输出电压为 VO1 =",186
"
56
gs
OX
OV
2
3
C
WLC
WC
=
+
，
Cgd=WCov
；
MOS
管
在
非
饱
和
区
：
gs
gd
OX
OV
1
2
C
C
WLC
WC
=
=
+
。 
 
图 3- 24 MOS 差分放大器的差模频率响应分析 
 
解：当输入差分电压 vid=0 时，为保证共模输出电压为零，需满足： 
BIAS
o1
o2
D
2.5V
0V
2
I
v
v
R
=
=
",166
"
另外，由于
BIAS
m
n
ox
1,2
2
2
I
W
g
C
L
μ
⎛
⎞
=
⎜
⎟
⎝
⎠
，所以得到： 
      
2
2
m
2
1,2
n
ox
BIAS
(0.5mS)
100
(50μA / V )50μA
g
W
L
μ c I
⎛
⎞
=
=
=
⎜
⎟
⎝
⎠
 
如果为保证频率响应取 L = 2µm，则(W/L)1,2 = 200/2。 
注意：对 L=2µm，",186
"0.5 fF/μm
0.1 pF
C
= WC
=
×
=
 
3dB 带宽可以用 Miller 近似方法求得： 
 
57
M
m
D
gd
50 (0.1pF)
5pF
C
≈ g R C
=
×
=
 
3dB
3dB
S
M
gs
1
1
5.97MHz
2
2
(
)
2
5k
5.37pF
f
R C
C
ω
π
π
π
=
=
=
=
+
×
Ω×
 
例3.5 MOS 差分放大器的",156
"BIAS有密切的关系。我们采用例 3.4 中的电路，并增加晶体管级的电流源偏
置电路，并将例 3.4 中电路的电流偏置用 MOS 管 M3 代替。包括偏置电路在内的
差分放大电路图如图 3- 25 所示。器件参数、电源电压已经在图中标出。 
要求：求出 M3、M4和 M5 管的宽长比 W/L 和 Rref的值。保证 IBIAS=50µA；直
流 CMRR＝2500。从例 3.4 中，我们已经求出 ",181
"M3 和 M4的尺寸是匹配的，将流过 50µA 电流。Rref上流过的电
流为 50µA。M1 和 M2以及 RD的电流为 50µA/2=25µA。因此，加在 RD两端的电
压为 2.5V。我们希望 Rref与 RD匹配，由此可得 Rref=2.5V/50µA =50kΩ。即 Rref上
的电流是 RD上电流的两倍，所以 Rref的阻值是 RD的一半，以保证两端的电压相
等。同样，M5 中流过的电",174
"
2
50μA
1.0V
1.1V
100 50μA / V
V
⎛
⎞
= −
+
= −
⎜
⎟
⎜
⎟
×
⎝
⎠
 
对 M3和 M4管， GS3,4
1.1V
( 2.5V)
1.4V
V
= −
− −
=
。现在可以求 M3 和 M4 管的(W/L)3,4。 
由于，
2
D3,4
BIAS
n
ox
GS3,4
TN
3,4
1
(
)
2
W
I
I
C
V
V
L
μ
⎛
⎞
",188
"生电容，会使 CMRR 频率响应变差。为达到直流条
件下的 CMRR 为 2500，（Adm=-50），我们需要： 
dm
cm
50
0.02
CMRR
2500
A
A
=
= −
= −
 
又因为：
m
D
D
cm
m
o3
o3
1
2
2
g R
R
A
g
r
r
−
= −
≈
+
 
所以： 
D
o3
cm
100k
2.5M
2
2 ( 0.02)
R
r
A
−
Ω
= ",166
"
L
×
⎛
⎞
=
=
≈
⎜
⎟
⎝
⎠
 
为分析频率响应，我们需要找出在 M3 漏极的电容 CE，CE 包含有：
Csb1+Csb2+Cdb3+Cgd3。 
gd3
3
ov
65μm
(0.5fF/μm)
32.5fF
C
W
C
=
×
=
×
=
 
Csb1,2 和 Cdb3 电容值可从版图中标出：设 M1 和 M2 的源极面积均为
200µm×5µm，M3 的漏与 M1 和 M2",179
"m)
(2μm
2μm)
2
17fF
C
C
C
=
×
+
+
×
=
 
因此总电容为： 
E
sb1
sb2
db3
gd3
182fF 182fF 17fF
32.5fF
414fF
C
C
C
C
C
=
+
+
+
=
+
+
+
≈
 
 
59
所以 CMRR 减少差分放大器的 3dB 带宽为： 
3dB
o3
E
1
1
154kHz
2
2
(2.5M ) (414fF)
f",156
"             (3-40) 
其中，差模电压增益为
dm
m
D
A
= −g R
；共模电压增益为
m
C
cm
m ob
1
2
g R
A
= − + g r
。 
对于如图 3- 26 所示电路，对差分输入信号的增益，从式（3-40）可以得到： 
o
dm
m
D
id
2
2
v
A
g R
v
= −
=
                    (3-41) 
对于共模输入",148
"我们可以看到图 3- 26 电路虽然可以完成差分到单端输出的转
换，但差分增益和 CMRR 仅仅是对称的差分双端输出电路的 50%。 
本节中我们设计一个单端输出的差分放大器电路，其增益与普通的双端输入
双端输出差分放大器具有相同的增益。图 3- 27 是 PMOS 电流镜负载放大电路。
从图中，我们可以看到电流镜使流过 M1管中的电流，也流过 M3和 M4，这样在
输出端增加了电流，使输出电压增",188
"此小信号电流加在 M1 中的直流电流
IBIAS/2。因此，M1 管的总电流可以表达为： 
BIAS
D1
D1
d1
m1 gs1
2
I
i
I
i
g v
=
+
=
+
                     (3-44) 
同样，M2管的总电流可以表达为： 
BIAS
D2
D2
d2
m2
gs2
2
I
i
I
i
g
v
=
+
=
+
                     ",134
"                       (3-46) 
差分输入电压为： 
id
i1
i2
gs1
gs2
v
v
v
v
v
=
−
=
−
                        (3-47) 
设 M1和 M2管完全对称，那么 gm1 = gm2 =gm，因此根据式（3-46），我们得到
小信号输出电流为： 
o
m
id
i
= −g v
                 ",115
"IAS/2，这一电流对小信号分析来讲，全部设为零。由
于电路结构不是全对称，因此，半边电路分析技术不能应用到该电路中。我们
首先对左边电路的 io1 按 KCL 定理分析： 
sg3
o1
o3
m3
sg3
m3
sg3
o3
v
i
i
g
v
g
v
r
=
=
+
≈
              (3-49) 
上式中我们设定
m
1/ o3
g
r
>>
，据 KCL 定理，在输出端口可",169
"m4 = gm3，则输出电路： 
 
62
o
o2
o1
i
i
i
=
−
                         (3-52) 
为计算差模跨导，我们设共模输入电压为零，求输入对管 M1和 M2 输出短路
电流。如果我们假定 o1,2
1/ m1,2
r
g
>>
，那么 
o1
m1
id
gs2
(
)
i
g
v
v
=
+
                     (3-5",132
"            (3-55) 
上述结果表明：PMOS 电流镜差分放大器电路的跨导等于输入 MOS 管的跨
导。 
 
图 3- 29 PMOS 电流镜差分放大器电路的小信号输出电阻 
以下计算双端输入单端输出的差分放大器双端口模型的参数。因为我们用
MOS 管为差分电路的输入管，所以输入阻抗近似为无穷大，即 Rin→∞。以下讨
论输出差分电阻 Rod。因为 Rod的值不明显，所以加一个电",173
"
=
−
= −
+
−
−
⎜
⎟
⎜
⎟
⎝
⎠
⎝
⎠
            (3-56) 
为推出 vsg4 的表达式，注意到 vsg4 = vsg3，我们可以写出 io1的表达式： 
 
63
sg3
x
o1
m
x
o1
sg3
o3
m3 sg3
o3
(
)
   
v
v
i
g v
r
v
i
g
v
r
−
+
= −
+
=
=
+
                  ",150
"ro3=ro4，将式（3-58）代入式
（3-56）可得： 
                
t
t
o2
o4
1
1
i
v
r
r
⎛
⎞
=
+
⎜
⎟
⎝
⎠
                      (3-59) 
从式（3-59）可得到，差分输出电阻是 PMOS 和 NMOS 管小信号电阻的并联值，
即： 
od
o2
// o4
R
r
r
=
                ",140
"      (3-61) 
注意：电流镜负载的双端输入单端输出差分放大器较图 3- 26 所示的电阻负载差
分电路的增益增加了一倍。这一事实证明了电流镜负载差分放大器作为双端输入
单端输出的优点。 
 
 
64
图 3- 31（a）PMOS 电流镜负载双端输入单端输出差分放大器共模小信号半边电路模型；（b）
忽略 ro1和 ro3后的简化模型 
分析共模输入响应问题，将差分输入信号设为零。共模输",192
"分析可忽略 M1 和
M3 管的输出电阻 ro1和 ro3，小信号电路简化如图 3- 31（b）所示。根据图 3- 31
（b）所示电路，注意到偏置电流源内阻为 2rob，我们可以求出共模增益为： 
o
m1
m3
vc
ic
m1 ob
m3 ob
/
1
1
2
2
v
g
g
A
v
g
r
g
r
−
=
= −
≈
+
               (3-62) 
从以上分析可以看到 P",165
"
m1
o2
o4
(
)
0.1mS 500kΩ
50
A
g
r
r
=
=
×
=
�
。 
求解 AVC，可用式（3-62）： 
vc
m3 o5
1
1
0.005
2
2 (0.1mS) (1MΩ)
A
g r
−
= −
=
= −
×
×
 
所以，
vd
vc
50
CMRR
10,000
0.005
A
= A
=
=
 
假设，我们需提高 CMRR，那么按式（3-62），我们",156
"提高
CMRR。如图 3- 33 所示，我们可以增加 M6～M9器件来提高输出电阻。忽略背栅
效应来来简化说明。当 M6 和 M8 提供合适的直流电压，而 M7 和 M9 管提高了输
出电阻。从严格意义上讲，M6 不一定要，但是 M6 使得放大器对称，并且当输入
差分电压为 0V 时，使左边电路的节点电压和右边电路对应的节点电压大体相等。 
 
图 3- 34 共源共栅差分放大电路的小信号模型 
",194
"提高了 100 倍，为找出新的共模增益，我们可以用类似图 3- 33
的分析方法。由图 3- 33，可得到求共模小信号增益的模型电路图 3- 34。 
因 1/gm6 电阻串联在电流源电路中，对共模增益无影响。用（3-62）式时，注
意将 1/gm3+1/gm8 代替 1/gm3，可得： 
m1
m3
m8
vc
m1 o5
m o
(1/
1/
)
2
0.01
1
2
2
g
g
g
A
g ",186
"2，忽略开启电压的背栅效
应，我们需要一个电流阱。直流电流为 Iout=75μA，电阻 roc=0.5 MΩ。 
 
图 3- 35 
器件参数：μnCox = 50 μA/V2；VTH = 1V；-2ΦP = 2Φn =0.8V；rn=rp= 0.6 V-1/2； 
λn=λp=0.05V-1@L=2μm；Cox=2.3 fF/µm2；Cjn=0.1 fF/µm2；Cjp=0.3 fF/µm2；",173
"）。沟道长度 Ldif = 2µm（Φn 
= 0.95V） 
(c) 在设该 MOS 管工作在饱和区的条件下，求 VOUT的最小值 
 
3.2 如图 3- 36 所示，MOS 电流源和电流阱电路中，IREF=100 µA，M3 和 M4 器件的尺寸为
(W/L)R=( W/L)4=10/2。设所有器件工作在饱和区，忽略背栅效应 
 
67
 
图 3- 36 
（a） 当 IOUT1=40µA",163
"源的输出电阻 
（c） 如果希望输出电阻达 500Ω，计算 MOS 管的 W/L 以及在此条件下的 VOUT的值 
（d） 如果电源电压改为 4.5V，根据(c)条件下的 W/L 值，计算 VOUT的值 
 
图 3- 37
3.4 如图 3- 38 所示电流源电路，其中 IREF=100 μA。 
 
 
图 3- 38 
 
68
(a) 希望由 M1产生的 VREF输出电阻为 1kΩ，在此条",158
"0/2，设所有器件工
作在饱和区，忽略背栅效应。 
 
图 3- 39 
（a）IOUT1=40µA 时，求(W/L)1 
（b）IOUT2=100µA 时，求(W/L)2 
（c）IOUT3=250µA 时，求(W/L)3 
（d）如果 IREF=20µA，重复(a)～(c) 
（e）如果 IREF=100µA，(W/L)R=30/2 时，重复(a)～(c) 
 
3.7 如图 3- 40 所示",159
"差分电路图，直流偏置 VI1=VI2=0V，按以下条件求 RD，使输出电压 VO1=VO2=( V+ 
+ V -)/2。 
（a）V + =2.5 V，V -=2.5V，IBIAS=100µA 
（b）V + =2.5 V，V -= 0V，IBIAS=100µA  
（c）V + =2.5 V，V -= -2.5V，IBIAS=500µA  
 
3.9 如图 3- 41 所示的差分放大电路，注",147
"大器电路，rob的值为 25 V/IBIAS，NMOS 管的(W/L)=100/2，按图
中所给的条件，求 RD的值，使当 vi1=vi2=0V 时，vo1=vo2=0V，并使用半边电路技术求 Adm，
Acm以及 CMRR。 
 
图 3- 42 
（a）IBIAS=100µA 
（b）IBIAS=500µA  
 
3.11 如图 3- 43 所示差分放大电路，求双端口模型参数，并在源电阻和负",153
"例 3.4 中差分放大器电路中，将 NMOS 管用 PMOS 管替代，计算并分析其差模频率响应。 
     器件参数：λp=0.05V-1，μpCox=50μA/V2，VTHp=-0.7V。 
 
3.13 如图 3- 44 所示的双端输入单端输出差分放大电路，NMOS 管(W/L)=100/2，vi1=10mV, 
vi2=12mV，IBIAS=100 µA 以及 rob=100 kΩ，求： ",160
"100μA/V2，μpCox=50μA/V2，并且 rob=100KΩ,
求： 
 
 
72
 
图 3- 45 
   (a) 差分跨导 io/vid 
   (b) 差分输出电阻 
(c) 差分电压增益 Avd=vod/vid 
   (d) 共模电压增益 Acm=voc/vic 
3.15 参考题 3.14 的电路图，画出 PMOS 为输入管，NMOS 为电流镜负载的双端输入单端输出
的差",151
"46 所示差分放大器电路，其中(W/L)=100/2，IBIAS = 500µA，VTHn=0.7V，
μnCox=100μA/V2。设跨在电流源偏置两端的电压要 0.5V 以上。求在以下条件下的 vo1，vo2和
vx 值，并说明在各个条件下电路中的每个器件是否工作在饱和区。 
  
 
图 3- 46 
 
73
 
(a) VI1=0V, VI2=0V 
(b) VI1=2V, VI2=2V",155
" Circuits. Fourth Edition, John 
Wiley & Sons, Inc., 2001 
[2]  Behzad Rezavi, Design of Analog CMOS Integrated Circuits. The McGran-Hill Companies, Inc., 
2001 
[3]  Philips E Allen, Douglas R Holber",64
"]  洪志良，模拟集成电路分析与设计，北京：科学出版社，2005 
[6]  David A Johns and Ken Martin. Analog Integrated Circuit Design, John Wiley & Sons, Inc.1997 
[7] Roubik Gregorian. Introduction to CMOS OP-AMPS and Comparator. J",79
"路的一种噪声。在射频电路中，有某一频率的无线电波信号，对需要接收这种信号的
接收机来讲，它是正常的目的信号，而对另一接收机它就是一种非目的信号，即是噪声。
在数字电路中。往往可以用示波器观察到在正常的脉冲信号上混有一些小的尖峰脉冲是
所不期望的，而是一种噪声。当一个噪声电压大到足以使电路受到干扰时，该噪声电压
就称为干扰电压。而一个电路或一个器件，当它还能保持正常工作时所加的最大噪声电
压，称为该",239
"种类，表示方法以及在各种单级放大器电路中的
分析与仿真技术。 
4.1 噪声类型与在电路中的表示 
4.1.1 
噪声的数学表达 
噪声在实际电路中是随机出现的，它与电路工作的环境，工作状态，操作方法等都
有直接的关系。噪声的具体幅值是不能被预测的，是一个随机过程。因此对于噪声的研
究只能通过长期的观察，建立在统计学的基础上。 
1. 平均功率，功率谱密度与噪声整形 
虽然噪声的幅值大小不能预测，",217
"
 75
如果用平均功率来度量类似于噪声这样的随机过程，定义如下： 
2
/ 2
av
/ 2
1
( )
lim
T
T
T
v t
P
dt
T
R
−
= →∞
∫
  
 
      
      (4-2) 
注意：在对噪声的度量过程中，习惯上对平均功率的单位使用的是 V2 而不是 W。
如果我们用电压单位 V，那表示均方根电压值
av
P 。 
除了平均功率，还常常使用功率谱密度（P",178
"f
H f
=
       
 
       (4-3) 
从上式可以看成，噪声实际上是可以受到系统整形的，因此，这为我们消除噪声的
影响提供了思路。 
2. 噪声的相关性 
在电路中，产生噪声的因素很多，我们需要考虑这些噪声是否可以直接叠加，这就
是噪声的相关性。对于随机过程，我们可以采用概率论中的相关性定义。假设两个噪声
源 S1(t)和 S2(t)同时作用，那么它们所产生的平均功率为： ",188
"
−
→∞
=
+
+
∫
∫
∫
∫
  
        (4-4) 
如果上式中最后一项为 0，即表示两个噪声源是不相关的。那么这两个噪声源的功
率是可以直接相加的。在大部分电路中，噪声源都是非相关的，这有助于我们简化电路
分析。 
4.1.2 
电路中的噪声类型和特点 
1. 
电阻热噪声和等效电路 
在各种导体中，由于电子的随机运动导致导体两端的电压会有波动，这种波动的程
度和绝对温度有",203
"谱密度为 0.1656×10-19V2/Hz，如果
用电压量表示约为0.4nV/ Hz 。这是一个有用的数值。在今后的计算中，只需乘以相应
的电阻值即可。 
电阻热噪声的等效电路图如图 4- 1 所示。图 4- 2 是 RC 电路组成的低通滤波器热噪
声等效电路。 
 
图 4- 1 （a）有噪电阻；（b）电阻热噪声电流等效模型；（c）电阻热噪声电流等效电压模型 
 
图 4- 2  (a) RC",205
"声为： 
2
nT,R
o
2
2
2
2
2
2
2
2
4
4
1
4
1
v
kTR
N
f R C
f R C
π
π
=
=
+
+            
 
(4-8) 
 77
根据式(4-8)可以看出输出噪声已经和频率有关，因此电阻热噪声已经被 RC 网络整
形。整形之前和之后的噪声频谱如图 4- 3 所示 
 
图 4- 3 （a）电阻热噪声，（b）通过低通滤波器整形后的电阻热",190
"只能增大电容 C。 
和前面讨论电阻热噪声类似的，为了方便记忆，我们可以事先把 KT/C 噪声归一化。
如果电容是 1pF，其总噪声电压约为 64μVrms。Vrms 表示均方根电压。 
3. 
MOS 管的热噪声和等效电路 
MOS 晶体管同样也有热噪声，这主要是由 MOS 管的沟道贡献的。工作在饱和区的
长沟道 MOS 器件的沟道热噪声可以等效为跨接在漏源两端的噪声电流源，如图 4- 4(a)",218
"    
2
nT,M
m
4kT
v
g
γ
=
              
 
 
(4-11) 
从上面的分析还可以得到一个重要结论，那就是系统的噪声功率和系统信号的输入
位置是无关的。正如将漏源电流源等效到 MOS 管栅端一样，同样如果需要也可以将该
噪声源等效到电源上或是系统输出端，其效果是一样的。 
 78
4. 
MOS 管的闪烁噪声 
MOS 管还有一种闪烁噪声，它主要来源于 M",172
"
 
 
 
 
(4-12) 
同样，也可以转化为一个压控电流源： 
2
2
nf,M
m
ox
1
K
i
= C WL f g
  
 
 
 
 
(4-13) 
在式(4-13)中 K 是与工艺相关的系数。f 代表频率值。因此，如果要减小闪烁噪声，
 79
只有增大 MOS 管面积。由于闪烁噪声和频率成反比，因此在低频情况下闪烁噪声值可
能很大。作为 MOS 器件，噪声源既有热噪声，又有",186
"声源和一个无噪网络来等
效[2]，如图 4- 7 所示。 
 
图 4- 7 （a）双端口网络，（b）噪声等效电路 
其中
2
vn,in
表示等效输入噪声电压源，即在电路输入端短路时，有噪网络输出噪声功
率等效到输入端的值。 2
in,in
表示等效输入电流噪声源，即当输入端开路时，有噪网络的
输出噪声功率等效到输入端的值。无噪电路内部电路结构相同和有噪电路相同，使用理
想元件。 
这里需要解释",195
"电
路理论知识，用一个电压源和一个电流源足以表示任何双端口网络。 
 
图 4- 8 单个噪声源的（a）电压等效电路；（b）电流等效电路 
在上面的分析中，我们指出在两个极端情况下，分别需要一个电压源或一个电流源
来表示电路噪声。但是在一般情况下用一个电压源和一个电流源来表示同一个噪声机制
是否会重复计算？实际上，由于两个噪声源表示的是同一个噪声，所以两个噪声源是相
关的。因此不能直接功率叠加而只",204
" 管热噪声和
闪烁噪声式可得： 
    
2
n,in
m
ox
2
4
3
K
v
kT
g
C WLf
=
+
 
 
 
 
 
 
(4-14) 
在电路开路时，那么由电流源产生的噪声应该和这个值一样，所以 
  
2
2
n,in
in1
m
ox
2
4
3
K
i
R
kT
g
C WLf
=
+
 
 
 
 
 
(4-15) 
 81
当同时用电压源和电流源来表示同一个噪声时",166
"加定理总是成立的。
因此在 MOS 管输入端产生的噪声电压 v 可以表示为： 
    
in1
in1
in2
n,in
n,in
in1
in2
in1
in2
R
R R
v
v
i
R
R
R
R
=
+
+
+
 
 
      
 
(4-19) 
即，
in1
n,in
n,in
in2
in1
in2
(
)
R
v
v
i
R
R
R
=
+
+
 
将
vn,in
， n,i",143
"噪声也没有被计算两
次。因此，这种等效方式是成立的。 
2. 
信噪比，噪声系数 
在信号处理电路中，我们往往需要了解噪声对信号的影响，是否噪声能够淹没信号。
因此可以给出信噪比的定义为信号与噪声的功率之比： 
p
p
S
SNR
= N
 
      
 
 
 
 
 
(4-21) 
在通常情况下，我们是用单位“分贝”表示信噪比，即： 
    
p
p
10log S
SNR
N
=
 ",177
"SNR
S
N
=
=
  
       
 
 
 
(4-24) 
同样用分贝表示为： 
(dB)
10log
NF
F
=
       
 
 
 
 
(4-25) 
 82
可以看出，噪声系数反应的是信号通过系统后，系统内部噪声对信噪比的恶化程度。
如果系统是无噪的，那么不管系统的增益多大，输入信号和噪声都同样被放大，而没有
添加任何噪声，因此输入输出信噪比相同，相应的噪声系数为 1",165
"输入，Gi 和 Fi 分别表示
各级网络功率增益和噪声系数。 
假设信号源本身是有噪的，输入噪声为 Ns。经过第一级放大器后，第一级放大器的
输出噪声为 
o1
s
1
1
1
N
N G
N G
=
+
  
      
 
 
(4-26) 
其中 No1 表示第一级放大器的输出总噪声，N1 表示由第一级放大器本身产生的等效
输入噪声。 
同理可得第二级放大器输出总噪声为： 
o2
s
1
",179
"F
F
F
G
G G
−
−
=
+
+
  
      
 
 
(4-29) 
正如前面所说的，噪声系数实际反应了系统对信噪比的恶化程度。因此从式 4-29 中
可以得到结论：为了降低级联系统的噪声系数，必须降低第一级，第二级的噪声系数，
并且尽量增大它们的功率增益。 
4.2 单级放大器中的噪声 
在分析了电路元件的噪声特性及其基本数学特性后，我们可以研究几种典型的单级
 83
放大器的",200
"路 
在图 4- 11(a)图中，噪声电流源
2
vnf,M
等效的是 MOS 管闪烁噪声，噪声电流源 2
inT,M
等
效的是 MOS 管的沟道热噪声。 2
inT,R
表示电阻热噪声。那么该放大器的等效输入噪声如
图 4-11（b）所示，其值为： 
2
2
nT,M
nT,R
2
2
n,in
nf,M
2
2
m
m
i
i
v
v
g
g
=
+
+
ox
m
m
1
8
4
3
K
k",194
"应的不
同电路状态。 
图 4- 13 中分别给出了求解等效输入噪声电流源和等效输入噪声电压源的对应等效
电路图。求解等效输入噪声电流源时，电路的输入端是开路状态，如图 4- 13（a）所示。
相反的在求解等效输入噪声电压源时，电路的输入端是短路到地的，如图 4- 13（b）所
示。 
 85
 
图 4- 13 （a） 2
in,in
和（b）
2
vn,in
的对应等效电路图 
由于在电路输入",183
" R 贡献的。 
 86
 
图 4- 14 （a）电阻热噪声；（b）MOS 管热噪声和闪烁噪声 
而当电路输入端短路时，所有噪声源都对输出噪声有贡献。可以求解出输入等效噪
声电压源为： 
(
)
(
)
2
2
2
2
2
2
2
2
n,out
nT,R
nT,M
nf,M
m
n,in
m
v
i
i
v
g
R
v
g R
=
+
+
=
  
 
 
(4-32) 
          ",180
" 15 （a）源跟随器；（b）等效输入噪声电压源 
 87
由 M2贡献的到输出端的噪声为： 
 
(
)
2
2
2
2
2
2
2
n,out
M
nT,M
nf,M
m2
o1
o2
m1
1
|
||
||
v
i
v
g
r
r
g
⎛
⎞
=
+
⎜
⎟
⎝
⎠
  
 
 
(4-34) 
而源跟随器从输入到输出的电压增益为： 
o1
o2
v
o1
o2
m1
||
1
||
r
",187
"： 
(
)
2
2
1
1
2
1
2
2
2
2
nT,M
nf,M
m2
o1
o2
nT,M
m1
2
2
2
2
n,in
n,in
M
n,in
M
nf,M
2
2
m1
v
1 ||
||
|
|
i
v
g
r
r
i
g
v
v
v
v
g
A
⎛
⎞
+
⎜
⎟
⎝
⎠
=
+
=
+
+
 （4-37) 
4.2.4 
共源共栅 
 
图 4- 16 （a）共源共栅电路；（",177
"kT
kT
C WLf
g
g R
γ
=
+
+
 
 
 
(4-38) 
 88
对于共栅级 MOS 管 M1，如果要计算它产生的噪声到输入端的贡献，那么可以利用
类似图 4- 13(a)中的等效电路。先将该 MOS 管的所有噪声等效成共栅级的输入噪声电流
源，然后再等效到共源级的输入端。而根据共栅级的计算结果，我们可以知道第一步等
效中的噪声电流源实际是不包含 MOS 管贡献量。所以，整个",191
"短接，因此可以差分对的两个栅级接到一起。虽然电路中
的噪声源很多，但是由于这些噪声源都是非相关的，因此可以直接功率叠加。值得注意
的是，由于噪声之间的非相关性，导致差分对的共源端不能认为虚地。我们以 M1 管的
1
2
inT,M
为例来说明如何将噪声等效到输入端。 
 89
 
图 4- 18  M1 MOS 管热噪声的等效计算和小信号模型 
从图 4- 18 中所示的小信号模型中可以求解分别流",199
"M1管的热噪声等
效电流源刚好一半流过电阻 R1，一半流过电阻 R2。那么该噪声源在输出端产生的噪声电
压为： 
1
1
1
nT,M
nT,M
nT,out
M
1
2
|
2
2
i
i
v
R
R
= −
−
 
 
 
      
(4-40) 
如果 R1＝R2，可以直接计算输出噪声功率谱密度为： 
1
1
2
2
2
nT,out
M
nT,M
|
v
i
R
=
  
      ",178
"阻的热噪声，那么在差分放大器的输出端的噪声为： 
 90
1
2
2
2
2
2
nT,out
nT,M
nT,M
(
)
2(4
)
v
i
i
R
kTR
=
+
+
            
(4-44) 
将上面的结果折合到放大器的输入端，只需除以放大器的增益即可。即为： 
1
2
2
2
2
nT,M
nT,M
2
nT,in
2
2
m
(
)
2(4
)
i
i
R
kTR
v
g ",171
"+
+
=
+
           (4-46) 
对比式（4-30）共源级的噪声，可以发现实际上差分放大器的噪声是共源级放大器
的两倍。 
4.3 噪声仿真技术 
4.3.1 
 功能基本介绍 
噪声分析将电路在直流工作点附近线性化后，计算在输出端的噪声频谱。如果设计
者指定了电路输入端，那么仿真器可以计算传输函数和等效输入参考噪声。另外，如果
信号输入源是有噪声的，也可以计算信号源的噪声系数",192
"- 1  共源极放大器器件参数 
MOS 管 
Instance Name 
Model
W
L 
Multiplier 
Library Name 
Cell Name 
View Name 
M0 
mn 
5u
10u 
1 
st02 
mn 
symbol 
M1 
mp 
5u
1u 
1 
st02 
mp 
symbol 
电阻 
Instance Name 
Model
W
L ",95
"1 
-- 
-- 
-- 
1u 
1 
analogLib 
cap 
symbol 
 
 92
4.3.2 
 传统的噪声分析及参数设置 
在ADE窗口中选择“Analysis”下拉菜单中的“Choose”命令，打开“Choosing Analysis”，
如图 4- 20 所示。在噪声分析中同样可以做“Frequency”、“Design Variable”、“Temperature”、",110
"到输出端的增益，再将输出端总噪声除以增益
后就等于等效输入噪声。下面着重讲述“Output Noise”和“Input Noise”的设置。 
 
图 4- 20 “Noise Analysis”设定窗口 
1. 
 “Output Noise” 
如前所述，仿真器计算的是在输出端的噪声。因此，首先需要给电路设置一对输出
电压（Voltage）或设置输出探针器件（Probe component）。",134
"de”选择地（GND）。 
2. 
 “Input Noise” 
当需要计算输入参考噪声时，用户需要通过“Input Port Source”指定等效输入噪声源。
这里着重介绍“Input Noise”中的“Voltage”模式。当选择“Voltage”模式后，软件要求我们指
定一个输入电压源“Input Voltage Source”，因此我们选择连接共源极放大器输入端的电压
源“V1”。（注",123
"
”运行仿真，仿真结果如图 4- 22 所示。因为扫描变量是频率，因此仿真结
果是输出噪声的功率谱密度（Power Spectra Density，PSD）。 
 94
 
图 4- 22  “Noise Analysis”仿真结果 
4.3.3 
设计实例及结果输出方式设置。 
 
虽然在上一小节中，我们得到了输出噪声的功率谱密度，但是这和我们习惯的用电
压表示噪声的方法还是有区别。因此我们需要",160
"义如下： 
1. 
Type 
计算噪声的方式 
� 
spot noise：给出某个频率点上的噪声报告。这实际是反映功率谱密度。 
� 
integrated noise：将频段内的噪声带权重的积分后给出噪声报告。这是给出的带
内噪声功率值。 
� 
noise unit：噪声的单位是采用电压单位“V”或是功率单位“V2”。 
2. 
Frequency Spot（Hz） 
计算噪声的频率点，默",162
" 
在整个频带内均匀积分。 
from weight file： 依据权重文件中的定义对频带内的噪声积分。 
3. 
Filter 
用户可以选择性的给出部分器件的噪声报告。在列表中给出了可供选择的器件。 
� 
“include All Types”：自动选择列表中的所有。 
� 
“include None”：将列表中所有项目都删除。 
� 
“include instances”：列出包括在",130
"数。 
by relative threshold： 
将贡献噪声超过总噪声规定百分比的器件列出。 
 96
by absolute threshold： 将贡献噪声超过某个绝对数值的器件列出。 
� 
Sort by：设置根据贡献噪声的大小或是器件名称的字母顺序等报告显示的顺序。 
 
图 4- 23 中的设置将对 1~20k Hz 范围内的输出噪声进行积分，然后以电压的形式显
示最大的 20 ",168
"体含义见表 4- 2，
噪声类型见表 4- 3。进一步可以看出，共源极放大器的输出噪声，主要由输入管 M0 的闪
烁噪声构成。 
表 4- 2 输出噪声表格栏的意义 
Device 
器件编号 
Param 
噪声类型 
Noise Contribution 
所产生的噪声大小 
% of Total 
在全部噪声中所占的百分比 
表 4- 3 噪声类型 
fn 
MOS 管闪烁噪声 
id 
M",163
"与负载网络存在两种匹配，使噪声系统最小匹配和最大输出功率匹配。请
计算图 4- 26 中双端口网络的噪声系数和功率传输系统（即输出功率与系统总功率之比）。比较系统分
别实现这两种匹配对电路要求的不同。 
 
图 4- 26 
4.4 
在图 4- 27 中，假设所有 PMOS 管 W/L =50/1，VDD电压 5V，VBIAS电压 3.5V。求输出噪声均方根
电压值为多少。 
 
 
图 4- ",184
"量。分析哪 
个器件贡献的噪声量最大，并找到它的噪声传播路径后优化。 
 
图 4- 29 
4.9 
根据图 4- 29 所示电路，在 vIN1和 vIN2之间加入一个正弦信号，测量该电路的谐波失真。 
分析造成失真的主要原因，并优化电路。 
 99
 
参考文献 
[1] 
Ravavi B. 模拟 CMOS 集成电路设计. 西安： 西安交通大学出版社， 2003 
[2] 
陈邦媛. 射频通",186
"。因此运算放大器是许多模拟系统和混合信号系统中的一
个重要部分。 
在本章中将着重讨论单级 CMOS 运放的分析和设计，将比较两种常用的运放结
构，即套筒式和折叠式的共源共栅结构间的性能差别，并给出运放性能的仿真测试方
法。多级运放的设计将在第 6 章介绍。 
 
5.1 运算放大器 
运算放大器是一种具有极高增益的电压放大器。图 5- 1 给出了运算放大器的符号。
标识为“+”和“−”符号的输入",203
"两个输入端的电压差值： 
D
P
N
v
v
v
=
−
 
 
 
 
 
 
（5-1） 
 
Av 是运算放大器的增益，也叫做无载增益，因为当输出不加负载时有： 
(
)
OUT
V
D
V
P
N
v
A v
A
v
v
=
=
−
 
 
 
 
（5-2） 
从图 5- 2 可以看出，理想的运算放大器是一个压控电压源，因此在 Spectre 软件
中可以利用如图 5-3 所示的电路来实",171
"益等同于理想
运放的增益，在“Voltage gain”设置该增益，这里将增益设置为“1000”，即“60dB”；在
“Type of transfer char”选择“linear”表示运放是线性放大的；在“Type of source”中选择
“vcvs”表示电源的类型是压控电压源；“Minimun Output Voltage”和“Maximum Output 
Voltage”分别表示输出",112
"先加入
了输入电阻 RI、输入电容 CI 和输出电阻 RO，从而引入了负载效应，使得信号源的输
出阻抗和负载的大小对运算放大器的性能都产生影响。其次加入了输入失调电压 VOS，
即运算放大器输出为零时，同向输入端和反向输入端之间的电压差。压控电压源
vP/CMRR 用来表示运算放大器的共模抑制比（CMRR），反映运算放大器的共模电平
对输出电压的影响。运算放大器的噪声通过均方电压源
2
ne 和均",195
"等方法，使实际运放的增益，输入输出电
阻接近理想情况。 
 
 
104
图 5- 6 理想运放输入输出特性 
 
 
图 5- 7 运算放大器等效电路 
5.2 负反馈 
5.2.1 
负反馈的基本原理 
通过环绕一个运算放大器，连接上恰当选取的外部元件，就能构成可以实现各种
运算的运算放大器电路。而负反馈是运算放大器和外部元件间常用的连接方式。实现
加、减、乘、除、积分和微分运算的运算放大器电",194
"号。从该框图中可以得到： 
( )
( )
( )
( )
( )
X s
Y s G s
H s
Y s
−
=
⎡
⎤
⎣
⎦
  
 
 
（5-3） 
 
105
因此，整理后得到： 
( )
( )
( )
( )
( )
1
Y s
H s
X s
G s H s
=
+
  
 
 
 
（5-4） 
在式（5-4）中，我们也将 H(s)称为“开环”传输函数，将 Y(s)/X(s)称",146
" xD，并产生输出
xO，xO 的表达式为： 
O
V
D
x
A
x
=
⋅
 
 
      
 
 
（5-5） 
其中，Av 是该运算放大器的低频小信号增益，也称为这个电路的开环增益。 
2. 
检测输出方式 
直接采用误差放大器的输出作为反馈网络的输入。 
3. 
反馈网络 
为了后面讨论的方便，这里使用一个与频率无关的量 β 代替 G(s)，称 β 为该电路
的反馈系数，并有： 
 ",171
" xF 和 xD，并根据闭环传输函数
 
106
定义电路的闭环增益为 A=xO/xI，求解得到： 
 
V
V
1
A
A
A
β
=
+
⋅
  
 
 
 
 
（5-8） 
 
当一个信号沿着由放大器、反馈网络和求和器组成的环路传播时，信号经历的总
增益为：Av × β ×  (−1)。它的绝对值称为环路增益，记为 T，有： 
 
V
T
A
β
=
⋅
 
 
 
 
 
 
（5-9）",163
"理想运放（图中三角型框内部分）和电阻分压网络（图
中矩形框内部分）组成的负反馈电路。输入信号和反馈信号的求和在运放的输入端实
现。这个负反馈电路实现了“ ×  2”运算功能。当输入信号在“1~2V”范围内变化时，输
出信号如图 5- 11 所示。 
在定义了理想闭环增益后，闭环增益可以表示为式（5-12）： 
(
)
ideal
ideal
ideal
1
1
1
1
1 1
1
A
A
A
A
",190
"） 
 
例如在图 5- 10 所示的运算放大器电路中，运算放大器的增益 Av 等于 1000，反馈
增益为 1/2，因此环路增益为 500，增益误差为-0.2%。 
对于差值信号 xD 和反馈信号 xF，环路增益对它们的影响为： 
 
D
I
1
1
x
T x
=
+
  
 
 
 
 
 
（5-14） 
 
F
I
1
1 1
x
T x
=
+
  
 
 
 
 
 
（5-15） ",165
"由于运算放大器的增益受负载和工艺的影响会发生偏移，因此现在研究在负反馈
结构中开环增益 Av（即运算放大器的增益）上的变化是如何影响闭环增益 A 的。对式
（5-8）进行微分，得到： 
(
)
2
V
V
1
1
dA
dA
A
β
=
+
⋅
  
    
 
 
（5-16） 
 
将式（5-8）代入式（5-16），重新整理后得到： 
 
V
V
1
1
dA
dA
A
T A
=
+
 
",183
"小的变化[3]。 
 
环路增益一般采用下面的方法进行计算。如图 5- 12 所示，将主输入置为零，在
环路中的某点将环路断开，按照原来信号流动的方向加一个测试信号 vT，使得该信号
流过整个环路，直到从另一个断点流出，从而获得一个输出信号。这个输出信号和测
试信号的比值的负值就是环路增益。如图 5- 12 所示，负反馈系统的环路增益为： 
F
T
v
T
= − v
   
 
 
 
 
  ",183
"
非线性失真的减小 
对于一个线性运算放大器，其输入输出特性应该为： 
            
O
1
D
x
a
x
=
⋅
 
 
 
             （5-20） 
对应的曲线应该是一条斜率为 a1 的直线。但是实际运算放大器的输入输出特性通
常是非线性的，并且运算放大器的增益 Av 必须更一般的定义为： 
O
V
D
dx
A
= dx
    
               ",142
"OUT
0
1
IN
2
IN
3
IN
v
a
a v
a
v
a
v
=
+
⋅
+
⋅
+
⋅
+�  
 
 
（5-22） 
因此在电路图中，选择可编程的压控电压源“pvcvs”，该器件可以在“analogLib”库
中找到，显示方式选择“symbol”，如图 5- 13 所示。可编程压控电压源的输入输出关系
为： 
(
)
2
3
OUT
0
1
IN
2
IN
3
IN
Gain
v",161
" Number”表示多项式最高幂次数，例如“2”表示多项式最高幂
 
111
次为平方项。 
3. 
“Poly Coeff n”表示各级幂次项的系数，分别与式（5-23）中的 an 对应。 
4. 
“Gain”表示压控电压源的增益，与式（5-23）中的“Gain”对应。 
因为我们只考虑一个轻度非线性的运算放大器，因此只在线性运算放大器的基础
上添加二次项，假设该非线性运算放大器的输入输出特性",167
"- 15 非线性运算放大器 
 
112
 
图 5- 16 非线性运算放大器的输入输出特性 
 
图 5- 17 获得运算放大器输出电压的仿真结果 
根据式（5-21）和图 5- 16 中的输入输出特性可以通过“Calculator”计算出运算放大
器的增益，步骤如下： 
1) 
在 ADE 窗口中启动“Calculator”。 
2) 
因为前面的仿真类型是“dc”，因此在“Calculato",150
" 18 所示。 
 
113
 
图 5- 18 对运算放大器输出电压求导 
4) 
点击“Calculator”中的“
”按键，输出计算结果，从而得到运算放大器增益随
输入电压变化的曲线，如图 5- 19 所示。 
从图 5- 19 可以看出，在根据式（5-24）给出的非线性运算放大器的增益随着输入
电压的升高而升高。因此运算放大器增益的不稳定也是运算放大器非线性的一个重要
表现。  
3. 
",178
"
图 5- 21 负反馈电路的输入输出特性 
 
115
 
图 5- 22 反馈电路的闭环增益特性 
 
可以看出采用负反馈结构后，电路的闭环增益呈现很好的线性性，这是因为，根
据 5.2.1 中的分析，电路的闭环增益主要反馈系数相关，由于反馈网络是线性的，因此
闭环增益是线性的。并且当环路增益越大时，运算放大器的开环增益对闭环增益的影
响越小，因此运算放大器的非线性对闭环增益的影响被削弱了。 ",209
"运放增益幅频特性中，增益幅值从直流增益下降 3dB 时
的频率。为了简化分析，我们仍然认为反馈网络不含频率分量。因此将式（5-25）代
入式（5-8）得到，闭环系统的传递函数为： 
 
( )
(
)
V
V
0
V
V
V
0
0
1
/
1
1
1
1
1
/
A
A
s
A
A s
A
s
A
s
ω
β
β
β
ω
ω
+
+
⋅
=
=
+
+
⋅
+
⋅
+
 
 
 
 
（5-26",184
" BW
A
ω
⋅
=
⋅
  
 
 
 
 
（5-27） 
 
由该运放构成的负反馈闭环系统的增益带宽积为： 
 
(
)
V
V
0
V
0
V
1
1
A
A
A
A
β
ω
ω
β
⋅
+
⋅
=
⋅
+
⋅
  
 
 
（5-28） 
 
对比式（5-27）和式（5-28）可以发现，不论反馈系数如何变化，运算放大器的
增益带宽积与由其构成的负反馈闭环系统的增益带宽积一致。这个现象为",193
"上，运算放大器的性能只能接近这些值。多数系统中，大于等于 2000
的开环增益就能满足需要。 
在第 3 章所研究的全部差动放大器均称为运放。图 5- 23 给出了单端输出和差动
输出两种最简单的结构。图 5- 24 给出了相应的运算放大器符号。 
 
 
图 5- 23 简单运放结构 
 
117
 
图 5- 24 运算放大器的符号 
 
这两种电路的低频小信号增益等于： 
(
)
mN
oN",184
"结构。
跟图 5- 23 中所给出的结构进行比较，可以发现套筒式结构是在简单运放的基础上将
单个 MOS 管替换成共源共栅结构后得到的。图 5- 25 中给出的运放的低频小信号增益
等于： 
(
)
(
)
V
m1
m3
mb3
o1 o3
m5
mb5
o5 o7
=
//
A
g
g
g
r r
g
g
r r
+
+
⎡
⎤
⎣
⎦  
 
 
（5-30） 
但是这是以减小输入范围和输出",186
"DD
OD3
OD5
OD7
TH1
IN1
CSS
TH1
V
V
V
V
V
v
V
V
−
+
+
+
≥
≥
+
 
 
（5-32） 
可以发现当尾电流较大或者 MOS 管尺寸较小的情况下，输入电压的范围很小。 
 
118
 
图 5- 25 套筒式运算放大器 
5.3.2 
折叠结构 
为了缓解套筒式结构对输入电压范围的限制，提出了折叠式运算放大器，图 5- 26
和图 5- 27 ",188
"中折叠式运放的输入电
压范围比图 5- 25 中对应的套筒式运放的输入范围大两个过驱动电压。 
虽然折叠式结构比套筒式结构有更大的输入共模电平范围，但是这是以减小增益
和带宽，增大功耗和噪声为代价实现的。图 5- 26 和图 5- 27 给出的折叠式运算放大器
的低频小信号增益为： 
(
)
(
)
(
)
{
}
m1
m3
mb3
o3
o1
o5
m7
mb7
o7 o9
//
//
g
g",204
"算放大器 
5.4 运算放大器的性能 
5.4.1 
增益(Gain) 
运算放大器的增益是一个重要的设计指标，例如在 5.2.1 中证明了运算放大器的增
益直接影响到负反馈系统的精度。在 5.3 中，式（5-29），式（5-30）和式（5-34）给
 
120
出了三种典型结构运算放大器的增益公式。更一般的方法是通过辅助定理计算运算放
大器的增益。 
 
图 5- 28 Gm 测量电路 
1. ",184
"Gm 的计算公式为： 
 
OUT
m
IN
i
G
= v
 
                  
（5-35） 
 
图 5- 29 ROUT 测量电路 
 
图 5- 29 给出了 ROUT 的测量电路，需要注意的是，上文所说的输入电压是指运算
放大器的差分输入电压，并不是指运算放大器的输入共模电压。因此在图 5- 29 中，
将运算放大器的同相输入端和反相输入端短接，从而使得运算放大器两",150
"器的增益曲线。这里我们主要研究的是运
算放大器增益的频率特性，因为该特性对信号滤波、反馈系统稳定性都起着决定性的
作用。因为 5.1.1 中提供的理想运算放大器模型并没有包含运算放大器的频率特性，因
此我们使用图 5- 23（a）中所示运算放大器结构来演示运算放大器增益的仿真验证，
电路图如图 5- 30 所示。器件参数如表 5- 1 所示。 
表 5- 1  运算放大器中 MOS 管的参数 
I",200
"
mp 
1.1u 
500n 
1 
st02 
mp 
symbol 
M5 
mn 
800n 
500n 
1 
st02 
mn 
symbol 
M6 
mn 
800n 
500n 
1 
st02 
mn 
symbol 
 
在图 5- 30 中，包含 2 个部分：运算放大器（Amplifier）和偏置电路（Bias Circuit）。
偏置电路为运算放大器提供电源电压（VDD）",121
" 32 所示。点击
按键“
”后开始仿真。 
 
 
122
 
 
图 5- 30 运算放大器增益仿真电路图 
 
 
123
 
 
图 5- 31 交流仿真设置 
2) 
读取并分析仿真结果 
 
运算放大器增益的频率特性通常包括增益的幅频特性（即增益幅值与频率的关
系）和相频特性（即增益相位与频率的关系）。由于运算放大器的输入信号频率范围常
常考虑到几赫兹到几兆赫兹甚至更宽，因此在工程上通",192
"er” 
弹出的“Results Browser”窗口如图 5- 34 所示。“Results Browser”的界面类似于
Windows 操作系统中的文件管理器，主体分为左右两个窗口。在左边的窗口中可以完
成文件的选择、打开和切换；在右边的窗口中，可以选择左边窗口选中文件夹内的数
据，或进入子文件夹。 
因为我们进行的是交流仿真，仿真结果保存在一个名叫“ac-ac”的文件夹中，如图
5- 34",157
" 34 “Results Browser”窗口 
 
 
125
 
图 5- 35 “ac-ac”文件夹中的内容 
 
 
图 5- 36 “Results Browser”窗口中的快捷键 
图 5- 36 中的第二个下拉菜单如图 5- 37 所示，下拉菜单中函数的功能如下： 
� 
Mag： 
 
计算仿真结果的幅值。 
� 
Phase：  
计算仿真结果的幅角。 
� 
WPhase： 
",132
"性，我们需要计算输出端的电压的幅值。根据上文的阐述，
我们在第二个下拉菜单中选择“Mag”函数，对输出电压“Vout”进行取幅值的预处理。然
后就可以将处理好的仿真结果输出到“Waveform”中观察。方法如下： 
1) 
在右边窗口选中输出电压“Vout”，然后点击鼠标右键，此时弹出一个选项菜
单，如图 5- 38 所示。在这个选项框中各个选项的功能如下： 
 
126
 
图 5- 37 第二",175
" “Calculator”： 将仿真结果直接送到“Calculator”的缓存中。 
2) 
在上述选项中选择“New Win”，创建一个新的“Waveform”窗口来显示运算放
大器增益的幅频特性，结果图 5- 39 所示。 
 
127
 
图 5- 39 运算放大器增益频率特性仿真结果 
 
对于运算放大器增益的幅频特性，除了直接显示幅值以外，更一般的是显示增益
幅值的 dB 曲线，即对幅值",157
"se”函数对交流仿真结果进行预处理后输出得到。“Results Browser”中的设置如
图 5- 42 所示，并通过“Append”命令，将运算放大器增益的相频特性添加到原有的幅
频特性中，结果如图 5- 43 所示。 
 
128
 
图 5- 40 以 dB 为纵轴，输出运算放大器增益的幅频特性 
 
 
图 5- 41 以 dB 为纵轴的运算放大器增益的幅频特性 
 
129
 
图 5",155
"变了运算放大器的直流工作点，使得仿真得到的运算放大器增益特
 
130
性和放大器在闭环情况下的增益不同。如图 5- 44 所示的方法，可以在不破坏运算放
大器直流工作点的情况下，对环路增益进行仿真。 
 
图 5- 44  测量反馈系统中运算放大器环路增益的方法 
 
与图 5- 9 相比，图 5- 44 在反馈通路中加入了三个器件：交流输入电压 vac、电感
LB 和电容 CS。其中电压 va",185
"置的情况下测量环路增益的频率特性。 
 
图 5- 45  图 5- 44 电路中的直流通路 
 
 
图 5- 46 图 5- 44 电路中的交流通路 
 
131
 
5.4.2 
带宽（Bandwidth） 
这里说的带宽，主要是指运算放大器的小信号带宽。常用的定义有两个：3dB 带
宽和单位增益带宽。 
1. 
3dB 带宽 
在 5.2.4 中提到了运算放大器的 3dB 带宽，并在式（5",179
" dB 做为增益单位时有： 
(
)
( )
( )
( )
( )
( )
V
V
V
0
0
0
V
V
0
0
20log
20log
1
/
2
          
20log
0
20log 2
20log
0
3
A
A
A
A
A
dB
ω
ω
ω
⎛
⎞
⎛
⎞
=
=
⎜
⎟
⎜
⎟
⎝ +
⎠
⎝
⎠
=
−
≈
−
      （5-38） 
从式（5-38）可以看出在主极",171
"”，在曲线
上添加标签，给出标记点的横坐标和纵坐标。如图 5- 47 所示，添加的标签给出了在
1.28Hz 的信号频率上，运算放大器的增益为 25.4dB。由此我们可以知道，运算放大器
3dB 带宽频率上的增益为 25.4-3=22.4（dB）。接着点击快捷键“v”，将光标切换的竖直
光标类型，即“Waveform”中的光标变成一条垂直的直线，并且直线上方有一个红色的
倒三角，通过拖动该三角型，",196
"放大
器的 3dB 带宽为 21.7MHz 
可以看出使用这种方法，由于仿真精度的影响，无法获得准确的运算放大器 3dB
带宽频率。精确获得 3dB 带宽频率的方法是使用“Calculator”软件中的“bandwidth”函
 
132
数。其方法如下： 
 
在“Results Browser”窗口中的“ac-ac”文件夹中选择“Vout”仿真结果。点击鼠标右
键，在弹出的下拉菜单中选择“Cl",160
"ator”的函数窗
 
133
口 中 选 择 “bandwidth” 函 数 。 点 击 该 函 数 后 ， “Calculator” 中 的 函 数 窗 口 变 为 对
“bandwidth”函数参数的设置。如图 5- 50 所示。其中默认设置就是求一个低通运算放
大器的 3dB 带宽。因此不需要更改其设置。点击“Ok”或者“Apply”完成“bandwidth”函
数的设置，点击“Calcu",134
"idth”函数计算出的运算放大器的 3dB 带宽 
2. 
单位增益带宽 
单位增益带宽则是运算放大器开环增益为 1 时的频率。对于式（5-25）给出的运
算放大器，有： 
(
)
V ( )
V
UGB
UGB
0
0
1
1
A
A
ω
ω
ω
=
=
+
  
 
 
 
（5-39） 
其中 ωUGB 为该运算放大器的单位增益带宽，由式（5-39）解得： 
( )
UGB
V
0
0
A
",174
"成立的，
因此我们基本可以认为闭环系统的 3dB 带宽就是运算放大器的单位增益带宽。 
 
和 3dB 带宽一样，运算放大器的单位增益带宽也可以从运算放大器增益幅频曲线
观察得到，但是为了得到更精确的单位增益带宽频率，我们需要使用“Calculator”中的
“cross”函数，该函数是专门用来计算曲线经过一个特定阈值时的横坐标。对于计算单
位增益带宽，我们只需要对运算放大器的增益曲线使用“cro",192
"
 
135
“cross”函数。 
 
图 5- 52 将“Calculator”设定为从电路图中获取交流电压仿真结果 
图 5- 53 给出了对“cross”函数的设置。如图 5- 53 所示，“cross”函数的设置包含四
个选项，其意义如下： 
1) 
“Signal”栏中填入的是需要处理的信号。如图 5- 53 所示，这一栏填入的是
“mag(VF(”/ Vout”))”，而不是我们从电",145
"mber”栏中填入的是穿越特定形式波形边沿的次数。因为我们是计算
运算放大器增益第一次为“1”时的频率，因此这里填入“1” 
4) 
“Edge Type”下拉菜单中选择的是曲线穿过阈值时的形式，是上升沿还是下降
沿，或者两者皆可。因为运算放大器的增益在单位增益带宽附近是随着信号
频率的增加而下降的，因此这里选择“falling” 
点击“Ok”或者“Apply”完成“cross”函数的设置，点击",189
"e) 
建立时间是另一项衡量运算放大器反应速度的重要指标，它表示从跳变开始到输
出稳定的时间。它主要是针对运算放大器的小信号特性，在整个跳变过程中，运算放
大器仍然保持线性。我们考虑图 5- 9 给出的负反馈结构，出于方便分析考虑，假设该
负反馈系统中的运算放大器只有一个极点，因此该负反馈结构的传递函数如式（5-26）
所示。图 5- 55 给出了这样一个负反馈系统对一个幅度为 b 的单位阶跃信号",207
" 
 
 
 
（5-41） 
由式（5-41）可以得到，输出信号的时域响应为： 
 
( )
( )
V
0
1
A
t
b
y t
t
e
β ω
β
−
⋅ ⋅
⋅
⎡
⎤
=
−
⎣
⎦  
 
 
 
 
（5-42） 
 
从 5.2.4 可以得知 βAvω0 为反馈系统的 3dB 带宽，若定义反馈系统的响应时间常
数 τ 为： 
 
V
0
1
A
τ
β
ω
=
⋅
⋅
  
 
",178
"此为了缩短系统的建立时间，则需要
减小系统的响应时间常数。由式（5-43）得，增大负反馈系统的 3dB 带宽就可以缩短
系统的建立时间。根据 5.4.2 中的阐述，单位增益负反馈系统的 3dB 带宽等于该系统
中使用的运算放大器的单位增益带宽。这就使得我们在设计时，可以通过对系统响应
速度的要求，获得对所需要设计的运算放大器单位增益带宽的要求，并通过增益带宽
 
138
积的概念，进一步获得对运算",201
"
在实际电路设置中，我们可以通过“Calculator”中的“settlingTime”函数来测量运算
放大器的建立时间。下面我们继续使用图 5- 30 中的例子阐述获得运算放大器建立时
间的方法。 
首先我们将运算放大器连接成单位增益负反馈的形式，即将运算放大器的反相输
入端和输出端短接。从而使得负反馈系统的闭环增益为 1，即输入电压跟随加载在运
算放大器同相端的输入信号。在运算放大器的同相端加",179
"低电平为 0V，高电平为 2mV，跳变延迟为
10ns，上升沿和下降沿宽度为 10ps，脉冲宽度为 1s。因此当瞬态仿真时间小于 1s 时，
都可以将该脉冲电压看作在 10ns 处跳变的阶跃电压。 
因为建立时间是运算放大器在时域对输入信号响应的一个性能参数，因此为了对
这个性能进行仿真测量，我们需要进行瞬态仿真（tran）。在 ADE 窗口选择瞬态仿真
（tran），结束时间设为 200ns，仿",202
"中状态，在选择模式中选择“tran”里的
“vt”项，如图 5- 60 所示，点击电路图中的“Vout”端，将“Vout”端的瞬态电压仿真结果
捕获到“Calculator”的缓存中。 
点击“Calculator”函数窗口中的“settlingTime”函数，并对其进行设置。如图 5- 61
所示： 
 
141
 
图 5- 60  将“Calculator”设定为从电路图中获取电压的瞬态仿真",143
"始值得大小。假如“Initial value type”中选择的是“x at y”，则输
入的是横坐标；假如假如“Initial value type”中选择的是“y”，则输入的是初始
值大小。 
3) 
Final value type: 结束值的类型。 
� 
x at y： 根据输入的是横坐标获得对应的电压值作为结束值。 
 
142
� 
y 
 ： 直接输入结束值的大小。 
4) 
Fi",133
"压作为初始值，190ns 时的输出电压作
为结束值，容差范围为 2%。点击“Ok”或者“Apply”完成“settlingTime”函数的设置，点
击“Calculator”中的“Eval”键，将在“Calculator”的缓存窗口中显示计算出的运算放大器
的建立时间，如图 5- 62 所示，计算出来的建立时间为 13.38ns。 
 
在 5.4.2 计算出图 5- 56 中使用的运算放大器的单",149
"，因此和图 5- 56 中的运
算放大器在直流工作点上略有偏差。但是这仍然说明利用运算放大器的单位增益带宽
预测使用该运算放大器的反馈系统的建立时间是可行的。 
 
图 5- 62 由“Calculator”计算出来的建立时间 
5.4.4 
相位裕度(Phase Margin，PM) 
相位裕度在电路设计中是非常重要的一个指标，主要用来衡量负反馈系统的稳定
性，并能用来预测闭环系统阶跃响应的过冲",180
"相位交点”（Phase Crossover Point），用 PX 表示，如图 5- 63 中的频率点 ω2。 
 
相位裕度（Phase Margin，PM）的定义为：运算放大器增益的相位在增益交点频
率时，与-180o 相位的差值，表达式为： 
 
(
) (
)
(
)
o
o
V
1
V
1
PM
180
180
A
A
ω
ω
= ∠
− −
= ∠
+
  
 
（5-45） 
 
式",142
"即将“Results 
Browser”中将仿真结果输送到“Calculator”中。如图 5- 64 所示。 
 
图 5- 63 运算放大器增益的波特图 
 
144
 
图 5- 64 从“Results Browser”中将仿真结果输送到“Calculator”中 
从图 5- 65 可以看出，仿真结果被输送到“Calculator”中。在“Calculator”的函数窗
口中选择“pha",122
"算放大器输出电压的交流仿真结果 
 
图 5- 67 利用“phaseMargin”函数获得的相位裕度 
5.4.5 
转换速率(Slew Rate) 
    假如在图 5- 56 中，输入阶跃信号的幅度是 200mV，并且单位增益负反馈系统驱
动一个 3p 的电容，如图 5- 68 所示，输出电压的时域响应如图 5- 59 所示。 
在图 5- 59 可以看出，输出电压“Vout”在跳变后的一",172
"端，因此输出电流都用来给负载电容 CL 充放电。我们首先
研究小信号下运算放大器的阶跃响应。如果输入 vIN 上有一个 ΔV 的变换，则 M1 管的
漏源电流 ID1 增加 gmΔV/2，而 M2 管的漏源电流 ID2 减少 gmΔV/2。由于 M3 和 M4 管的
镜像作用，|ID4|增加 gmΔV/2，因此运算放大器提供的总的输出小信号电流为 gmΔV。此
 
146
电流给负载电容 CL 充",181
"要 M2 管处在关断状态，对负载电容 CL 的充电电
流就不会发生变化，故输出电压的斜率不变。只有当输出电压接近 vIN 时，使得 M2 管
重新导通，并回到饱和区，电路回到线性工作状态，输出电压按照 5.4.3 中的描述进行
变化。 
同理，当输入电压为下降沿时也会发生转换现象。如果输入电压下降幅度很大，
使得 M1 管关断，则运算放大器可以简化为如图 5- 71 所示的形式。CL 的放电电流等",192
"小。 
在电路仿真时，可以使用“Calculator”中的“slewRate”函数根据瞬态仿真结果计算
运算放大器的转换速率。和 5.4.3 中使用“settlingTime”函数一样，先将“Vout”端电压的
瞬 态 仿 真 结 果 捕 捉 到 “Calculator” 的 缓 存 中 ， 再 点 击 “Calculator” 函 数 窗 口 中 的
“slewRate”函数。如图 5- 72 ",146
"函
数一致，因此不再描述。对于“Percent High”和“Percent Low”的取值方法如图 5- 74 所
示。在“slewRate”函数中，将“Final Value”作为“Percent 100%”，将“Initial Value”作为
“Percent 0%”，然后根据“Percent High”和“Percent Low”添入的百分数获得“转换”开始和
结束的时间。 
 
149",114
"”中的“Eval”键，
将在“Calculator”的缓存窗口中显示计算出的运算放大器的转换速率，如图 5- 75 所示，
计算出来的建立时间约为 0.48V/μs。 
 
图 5- 75 “slewRate”函数计算结果 
5.4.6 
共模抑制比(CMRR) 
差动放大器的一个重要特性就是其对共模扰动影响的抑制能力。如图 5- 76 所示
的理想运算放大器，其电路完全对称，并且 ISS 为理想",168
"出阻抗也不可能是
无穷大的，因此共模输入的变化还是会引起输出电压的变化。这里定义运算放大器的
共模增益为： 
out
CM
in,cm
v
A
= v
 
 
                 （5-46） 
 
这里，vout 和 vin,cm 是指输出端和共模输入上的交流小信号，而不是它们的直流偏
置电压。 
 
因为在绘制电路图时，无法体现出由于制造产生的不对称性，因此大多数时候是
采用保留",165
"
1 2
r
g
g
r
r
A
g
g
R
g
R
+
= −
= −
+
+
×
+
 
     （5-47） 
共模抑制比（Common Mode Reject Ratio，CMRR）的定义为运算放大器差分输入
增益与共模增益的比值： 
 
V
CM
A
CMRR
= A
  
 
 
 
 
（5-48） 
根据式（5-29）和（5-47）可以得到图 5- 77（a）中运算放大器的共模抑",147
"
 
下面介绍一种方法，可以直接获得运算放大器的共模抑制比，而不需要分别求出
运算放大器的差模和共模增益。电路图如图 5- 78 所示。运算放大器连接成单位增益
负反馈的形式，在运算放大器的同相和反相输入端加上相同的小信号电压 vcm。该电
路的等效小信号模型如图 5- 79 所示。从的小信号等效模型可以得到： 
 
(
)
CM
CM
V
CM
OUT
CM
OUT
A
v
A
v
v
v
v
",182
"仿真器来测试运算放大器的共
模抑制比。根据上文的叙述，如图 5- 80 所示，在图 5- 30 的基础上做以下修改：将运
算放大器的反相输入端和输出端用一个仅包含 1V 交流电压的电压源连接，该电压源
的正端和运算放大器的反相输入端相连。 
再次运行交流仿真，得到输出端“Vout”的增益曲线，即为运算放大器 CMRR 的倒
数的幅频特性曲线。如图 5- 81 所示（这里为了方便观察，采用了 dB ",196
"倒数 
5.4.7 
电源电压抑制比(PSRR) 
因为在实际使用中，电源也是含有噪声的，为了有效抑制电源噪声对输出信号的
影响，我们需要了解电源上的噪声是如何体现在运算放大器的输出端的。我们把从运
算放大器输入到输出的增益除以电源到输出的增益定义为运算放大器的电源抑制比
（PSRR： Power Supply Reject Ratio），所以电源抑制比可以写为： 
V
DD
dd
in
0
0
",171
"管的电流是固定的，因此 M3 管的栅源电压是定
值，从而使得 X 点的电位相对于 vDD 钳制，因此当 vDD 变化时，vX 上有相同的变化。
又由于电流镜的存在，使得运算放大器在差分输入信号为零时，输出端 vOUT 和 vX 有
相同的电位。因而 vDD 到 vOUT 的增益近似为 1。 
 
通过式（5-52）我们可以计算出运算放大器的电源抑制比，但是利用图 5- 84 所示
的结构可以更方便",181
"  
（5-53） 
因此 
OUT
DD
dd
V
1
v
A
v
A
PSRR
≅
=
 
 
 
 
 
（5-54） 
下面我们继续使用图 5- 30 中的例子阐述如何使用仿真器来测试运算放大器的电
源抑制比。根据上文的叙述，如图 5- 86 所示，在图 5- 30 的基础上做以下修改：将差
分输入电压源 V1 的交流电压值设为 0，在电压源 V2 中添加交流分量 1V，并将运算放
大器的",173
"配
情况，因此仿真得到的 PSRR 都要比实际测量时好，因此在设计的时候需要留有余量。 
 
图 5- 84 计算 PSRR 的方法 
 
 
图 5- 85 图 5- 84 的等效小信号模型 
 
158
 
图 5- 86 测量运算放大器电源抑制比 PSRR 的电路 
 
图 5- 87 运算放大器 PSRR 倒数的频率特性 
 
159
 
图 5- 88 使用“Calculator”中的“",148
"做差分输入方式。 
 
在 5.2.1 最后介绍了，当负反馈系统的环路增益 T 很大时，运算放大器的同相输
入端和反相输入端的电位一致，即差分输入电压 vD≈0，这种情况称为“虚短”。并且由
于输入端连接到 MOS 管的栅端，则可以认为运算放大器的输入电阻无穷大，输入电
流为零，这种情况称为“虚断”。利用“虚短”和“虚断”的概念就可以很容易的计算出由
运算放大器构成的运算电路中输入和输出的关系[4",203
"） 
 
因此： 
 
160
 
2
OUT
IN
1
R
v
= − R v
  
 
 
 
 
（5-57） 
当 R1 =R2 时，vOUT=-vIN，此时该电路也可作为反相器。 
 
 
图 5- 89 反相输入方式的比例运算电路 
 
图 5- 90 同相输入方式的比例运算电路 
 
2. 
同相输入方式 
同相输入方式的比例运算电路如图 5- 90 所示。 
 
利用“虚短”的概念",145
" 所示。输入信号 vIN1 和 vIN2 分别加载到运
算放大器的反相和同相输入端上。由于是两个独立的输入信号，因此计算时可以使用 
线性电路的叠加原理。 
 
 
在考虑 vIN1 时 vIN2 短路，电路变成类似图 5- 89 所示的结构，得到： 
 
'
2
OUT
IN1
1
R
v
= − R v
 
 
 
 
 
（5-60） 
 
在考虑 vIN2 时 vIN1 短路，电路变成类似",161
"
⎠
  
（5-62） 
 
 
图 5- 91 差分输入方式的比例运算电路 
 
162
 
图 5- 92 反相输入方式的比例运算电路 
 
5.5.2 
求和运算电路 
求和运算电路是指输出量为多个输入量比例运算的代数和。 
1. 
反相输入方式 
反相输入方式的求和运算电路如图 5- 92 所示。 
利用“虚短”和“虚断”的概念有： 
 
N
P
0
v
= v
=
 
 
 
 
 
",159
" 
 
163
 
图 5- 93 同相输入方式的比例运算电路 
 
 
图 5- 94 差分输入方式的求和运算电路 
 
2. 
同相输入方式 
同相输入方式的求和运算电路如图 5- 93 所示。 
 
利用线性叠加原理，可以得到运算放大器同相输入端的电位为： 
 
(
)
12
13
11
13
11
12
P
IN1
IN2
IN3
11
12
13
12
11
13
13
11
12
IN",145
"
因此 
 
164
 
(
)
2
OUT
N
1
IN1
IN2
IN3
2
11
12
13
1
11
12
13
1
1
//
//
R
v
v
R
v
v
v
R
R
R
R
R
R
R
R
⎛
⎞
=
⎜ +
⎟
⎝
⎠
⎛
⎞
⎛
⎞
=
+
+
+
⎜
⎟
⎜
⎟
⎝
⎠
⎝
⎠
  
（5-68） 
3. 
差分输入方式 
差分输入方式的比例运算电路如图 5- 94 所示。输入信",195
"−
−
  
 
 
 
 
（5-69） 
 
在考虑 vIN3 和 vIN4 时令 vIN1 和 vIN2 短路，电路变成类似图 5- 93 所示的结构，得到： 
 
''
5
5
3
4
OUT
IN3
IN4
1
2
3
4
1
2
3
4
1
1
//
//
R
R
R
R
v
v
v
R
R
R
R
R
R
R
R
⎛
⎞
⎛
⎞
=
+
+
+
⎜
⎟
⎜
⎟
+
+
⎝
⎠
⎝
⎠",186
"
⎠
      
 
 
 
 
 
 
 
 
 
 
 
 
（5-71） 
5.5.3 
积分和微分运算电路 
积分运算电路和微分运算电路都是利用电容充放电电流 ic 和电容两极板间的电压
vc 关系来实现的。 
 
图 5- 95 积分运算电路 
 
165
 
图 5- 96 微分运算电路 
 
1. 
积分运算电路 
积分运算电路如图 5- 95 所示，其中 iS 是信号源流出的电流",155
" 
 
 
 
 
（5-75） 
 
IN
OUT
C
IN
1
1
v
v
v
dt
v dt
C
R
CR
= −
= −
= −
∫
∫
  
 
（5-76） 
 
从而实现了输出电压为输入电压对时间的积分。 
2. 
微分运算电路 
把积分运算电路中的电阻和电容更换位子后，就可以得到微分运算电路，如图 5- 96
所示，其中 iC 是对电容充电的电流，iR 是流过反馈电阻的电流，vC ",170
"OUT
dv
v
= −RC dt
 
 
 
 
 
（5-81） 
 
从而实现了输出电压为输入电压对时间的微分。 
5.5.4 
对数和指数运算电路 
因为二极管的伏安特性方程为： 
(
)
D
T
D
T
D
S
S
1
v
V
v
V
i
I
e
I e
=
−
≈
           （5-82） 
 
其中 iD 是流过二极管的电流，vD 是二极管正负端之间的压降，IS 为二极管的",162
"R
−
=
=
 
 
      
 
（5-85） 
 
因此 
 
IN
OUT
D
T ln
S
v
v
v
V
RI
= −
= −
  
 
 
（5-86） 
 
从而实现了输出电压和输入电压间的对数关系。 
2. 
指数运算电路 
将对数运算电路中的二极管和电阻互换位子，就可以得到指数运算电路如图 5- 98
所示，利用“虚短”和“虚断”的概念有： 
 
N
P
0
v
= v
=",163
"出电压为输入电压的指数关系。 
 
 
167
 
图 5- 97 对数运算电路 
 
图 5- 98 指数运算电路 
 
习题 
5.1 
利用图 5-3 中的理想运算放大器模块和图 5- 7 中的电路图，在 Spectre 软件中建立对应的非理
想运算放大器模块。 
 
5.2 
利用压控电流源、电阻和电容，在 Spectre 仿真软件中实现图 5- 99 中的小信号模型，并建立相
应得符号，",170
"的增益，电路跨导为
100 × 10-6 S 的情况下，计算需要的输出电阻大小。 
 
5.4 
（a）在 Spectre 仿真器中，利用中的理想运算放大器模块搭建一个单位增益负反馈电路。 
（b）利用该单位增益负反馈电路驱动一个 1uF 的电容，输入激励为 0V 到 1V 的单位阶跃信号，
观察其瞬态（tran）仿真的波形。 
 
5.5 
（a）在 Spectre 仿真器中，利用“ss-opa",183
"b）将电路跨导（gm）在 1 × 10-6~100 × 10-6 S 的范围内变化，画出 3dB 带宽和单位增益带宽
以电路跨导为自变量的曲线。 
（c）输出电阻（Rout）在 1 × 106~100 × 106 Ω 的范围内变化，画出 3dB 带宽和单位增益带宽以
输出电阻为自变量的曲线。 
（d）输出电容（Cout）在 1 × 10-10~10 × 10-9 F 的范围内变化，画出 3dB 带",183
"60 度，第二个极
点需要满足什么条件？ 
 
5.11 画出图 5- 23（a）中运算放大器增益相对于输入共模电压为自变量的曲线。输入共模电压范围
从 0 V 到 VDD。注意区分输入管分别工作在截止区、线形区和饱和区的情况。 
 
5.12 通过 Spectre 仿真工具验证 5.11 中的结果。 
 
 
169
5.13 画出图 5- 27 中运算放大器增益相对于输入共模电压为自变量的曲线",178
"大器的最大输出电流为 1μA，输出电压摆幅为 0~5V。 
 
5.17 根据图 5- 95，设计积分电路，要求在输入电压为 1V 的情况下，输出电压从 5V 下降到 1V 的
时间小于 4μs，同时电阻大小不能小于 1kΩ。 
 
参考文献 
[1] 
Ravavi B. 模拟 CMOS 集成电路设计. 西安： 西安交通大学出版社， 2003 
[2] 
Allen P E. CMOS 模拟集成",172
"个电路不
可能在所有方面都有出色的表现。因此，在实际电路设计的过程中，当拿到一个待设计电
路的性能参数后，首先是应将这些参数区分对待。找出哪些是主要设计指标，哪些是次要
设计指标。当然，这种区分的依据是实际中电路的应用环境。比如说，在低压差线性稳压
器（LDO）的设计中，需要设计一个高增益的运算放大器用以减小静态误差，所以这种情
况下高直流增益是设计的主要目标。而在其他一些场合，例如用于麦克风的模",203
"的讨论都是以提高增益
为目标，同时尽可能兼顾优化其他性能。本章将针对几种运算放大器的结构进行讨论，从
最简单的运算放大器开始逐渐演化出我们所需要的高增益放大器电路结构。 
6.1 高增益运放概述 
6.1.1 
简单运算放大器结构 
 
 
 
图 6- 1 简单运算放大器结构 
在图 6- 1 的电路是一种最简单的双端输入，单端输出的运算放大器。一般情况下，该
电路的小信号增益为 gmn(ron",195
"6.1.2 
采用套筒式共源共栅结构提高电路增益 
正如第 2 章对简单放大器所讨论的那样，一个放大器的增益等于放大器输入跨导和放
大器输出阻抗的乘积。通过增大放大器输出阻抗可以明显增大增益。因此，我们可以采用
共源共栅电路提高电路增益，电路图如图 6- 2 所示。 
 
图 6- 2 套筒式运算放大器 
在图 6- 2 中，各层叠管的栅端电压由外部电压偏置引入。该电路中输入管的跨导仍然
是 gm",214
"路层叠了 5 个管子，如果 NMOS 和 PMOS 管的漏源电压相同，那么输出电压摆幅至少会
消耗 5VDS。其次，注意到由于在双端到单端的转换过程中必然会用到二极管接法，因此电
压裕度会进一步损失一个 VTH，即最后的输出电压摆幅为：  
DD
GS
TH
GS
4(
)
V
V
V
V
−
−
−
   
 
 
 
    （6-1） 
另外，这种套筒式电路不适于用作单位增益缓冲器。因为如果",189
" 折叠式共源共栅运算放大器 
从图6- 3 中可以看到折叠式共源共栅放大器继承了套筒式共源共栅电路中高输出阻抗
的特点，它的输入差分对跨导是 gmp，输出阻抗仍然是(gmnron)ron||(gmprop)rop。所以它的增益
几乎和套筒式共源共栅放大器的增益一样，也能轻松达到 70dB 以上。不过，它的改进思
路是尽量在一条支路上层叠比较少的管子。因此，它将输入管分离出来。在折叠式共源共
栅电路",212
"用于高增益运算放大器中，其基本思想仍然是提高输出阻抗。增
益自举式电路的原理和一个简单例子如图 6- 4 和图 6- 5 所示。 
 
图 6- 4 增益自举式电路原理图 
 
173 
 
图 6- 5 带增益自举的简单放大器 
增益自举式电路的原理是使得图 6- 4 中简单放大器的输出阻抗被放大了 Av倍，即 
out
V
m
o
load
r
A
g
r
R
=
⋅
⋅
⋅
        ",191
"仅电路包
含的晶体管数目增加，同时电路中还引入环路，使得保证电路稳定性成为重要的考虑
问题之一； 
� 
由于输出电阻的增大，导致电路的输出极点频率降低。也就是说电路的驱动能力和速
度下降。 
 
174 
为避免上述问题，可以采用两级简单运算放大器的级联达到提高增益的目的。每级运
放的增益到能达到 50dB，那么总增益同样也能做到 100dB 以上。同时，相比一个 100dB
增益的单级运放，两",195
"大多数实际电路中，我们往往采用反馈系统来改善开环系统抗干扰性差的问题。针
对运算放大器系统，我们利用反馈来获取精确的放大器电压增益。但是，负反馈系统由于
需要把系统输出反馈到系统输入，因此很有可能在设计中出现失误，导致负反馈变为正反
馈，系统发生振荡。因此，我们需要分析采用频率补偿电路来确保电路始终保持在负反馈
状态下工作。 
对一个系统稳定性的判断，我们可以采用“巴克豪森判据”[1]。即一个稳定",215
"
<
∠
=
�    
 
 
    (6-5) 
该判据表达的意思是，当输入信号受到扰动时，反馈信号能够对该扰动起到抑制作用
而不是进一步叠加放大，那么该系统是一个稳定的系统。在实际电路设计过程中，我们所
采用的方法是通过分析系统开环传递函数的 S 域零极点分布和构造波特（Bode）图来判断
 
175 
闭环系统的稳定性。 
 
图 6- 8 （a）稳定系统与(b)非稳定系统的波特图 
在",182
"度相位变化。在经过一个零点时，如果该零点是左半
平面零点，那么在 0.1ωz（其中 ωz表示零点的频率）频率处以+45 度/十倍频程斜率上升，
在 10ωz 频率处完成+90 度相位变化。而当经过一个右半平面的零点时，其相位曲线按-45
度斜率下降，最后完成-90 度相位变化。 
由于一个稳定的系统要求在增益为 1 时，相位变化不能超过 180 度，因此在图 6- 8 中，
（a）图表示一个稳定系",194
"度左右有较好的稳定性和响应速度上的折衷。 
6.3.2 
米勒效应与米勒补偿 
在前面两级运放的讨论中，曾经提到由于第一级运放的高输出阻抗和第二级运放的大
负载电容，有可能导致在两级运放输出端，分别产生的极点频率差不大。在波特图中表现
出在单位增益带宽内存在两个极点，导致相位裕度变差。因此，需要采用频率补偿电路来
保证系统的稳定性。最常见的一种补偿方式是米勒补偿，一种基于电路中广泛存在的米勒
效应",224
"
C
A
C
≈
⋅
，
2
m
C
≈ C
        
 
 
    (6-7) 
也就是说在如图 6- 11 中所示的两级放大器示意图中的第一级放大器输出端，利用一
个小电容能够建立一个对地大电容，将第一级放大器输出极点推向低频，成为主极点。而
第二级放大器的输出极点基本保持不变。图 6- 7 为两级运放结构中加入米勒补偿电容 Cm，
图 6- 7 为其小信号等效模型。 
 
图 6-",183
"s
s R C
C
R C
C
g
R R C
s R R C C
C C
C C
⎛
⎞
⎜ −
⎟
⎝
⎠
= +
+
+
+
+
+
+
+
 
 (6-8) 
 
178 
注意，其中的 gm1,2和 gm7即为第一和第二级的跨导。为了能够看清上式的内在含义，
需要做一些必要的假设：gm7R1RLCm>>R1(C1+Cm)，gm7R1RLCm>>RL (Cm+CL)，那么式（6-8）
可以",165
"
m
1
P
g
R R C
≈ −
            
  
       (6-10) 
 
m7
m
2
1
L
m
1
m
L
g
C
P
C C
C C
C C
≈ −
+
+
       
      
  (6-11) 
如果 CL>>C1，Cm>>C1，那么 P2可以进一步化简为： 
                     
m7
2
L
g
P
≈ − C
      ",119
"       (6-14) 
因此，主极点频率相比采用米勒补偿前减小了 gm7RLCm/C1倍，而次极点频率比补偿前
增大了 gm7RL倍。这是就是非常有用的极点分裂现象，如图 6- 14 所示。 
 
图 6- 14 极点分裂 
在上面的计算过程中，我们是将放大器的传递函数解出后，得到系统零极点表达式。
下面可以用米勒等效的方式来粗略计算极点。 
将图 6- 13 所示的小信号模型等效为如图 6",190
"        (6-16) 
那么，系统极点频率为： 
1
1
m1
1
m7
L
m
1
1
P
R C
R g
R C
≈ −
= −
    
                (6-17) 
                   
2
L
L
m2
1
(
)
P
R C
C
≈ −
+
                         (6-18) 
因此，可以看到如果采用米勒效应来计算",117
"右半平面的零点在波特图中起到提升增益曲线，增大相位变化的作用。因此，右
半平面零点实际上是削弱了系统的稳定性。消除右半平面零点的电路如图 6- 16 所示。 
 
图 6- 16 去右半平面零点的米勒补偿电路 
在图 6- 16 中的电路中，通过与 Cm串联一个电阻 Rm，使零点频率变为： 
             
m
m7
m
1
(1/
)
Z
C
g
R
=
−
     
 
    ",183
"180 
 
图 6- 17 两种多级米勒补偿电路 
 
 
181 
图 6- 18 多级米勒补偿的等效小信号模型 
在图 6- 18 中画出了图 6- 17 所示电路的小信号模型，其中的 gm1、gm2和 gm3分别为第
一、第二和第三级的放大器跨导。因此，可以直接计算系统的传递函数分别为： 
2
m2
m1
m2
m1
m2
m3
1
2
L
m3
m2
m3
V
2
m2
m3
m2
L
",180
"m3
m2
m3
v
2
m2
m3
m2
m2
m
L
m2
m1
m2
m3
1
2
L
m2
m3
m2
m3
(
1)
1
[
(
1/
)]
( )
(
)
(1
)
1
1
C C
g
R
g
g
g
R R R
s C R
C
R
g
s
g
g
A s
C
g
g
g
R
C C
sC
g
g
R R R
s
s
g
g
g
g
⎧
⎫
−
+
+
−
+
⎨
⎬
⎩
⎭
=
⎡
",189
"⎦
 
 
   (6-23) 
m1
m1
m2
m3
1
2
L
mL
v
2
m2
m3
m2
m2
m
L
m2
m1
m2
m3
1
2
L
m2
m3
m2
m3
1
( )
(
)
(1
)
1
1
C
g
g
g
R R R
s g
A s
C
g
g
g
R
C C
sC
g
g
R R R
s
s
g
g
g
g
⎛
⎞
⎜ +
⎟
⎝
⎠
=
⎡
⎤
−
−
+
+
+
⎢
",195
" 
 
 
 
 
(6-27) 
m
m3
1
R
g
=
 
      
  
 
 
 
(6-28) 
那么，由式（6-23）所示的开环传递函数构成的系统闭环传递函数将表现为三阶巴特
沃兹函数形式。此时对于系统的振荡系数 ξ 将等于
2 2 。既该系统的阶越响应，能够在超
调量和调整时间上达到最佳状态。此时，系统的非主极点频率为： 
m3
m3
2,3
L
L
2
2
g
g
P
j
C",179
"1) 
m
m3
1
R
g
=
 
 
 
 
      
 
(6-32) 
这种情况下得到的极点分布为： 
 
1
m1
m2
m3
1
2
L
1
P
C
g
g
R R R
= −
  
 
 
 
(6-33) 
(
)
(
)
m3
m3
2,3
m2
m3
L
m2
m3
L
2 1-
/
2 1-
/
g
g
P
j
g
g
C
g
g
C
=
±
 
 
 
(6-34) 
",156
"范围  
 
：  
-20~100ºC 
运算放大器直流增益 
：  
>100dB 
负载电容  
 
 
：  
=5pF 
增益带宽  
 
 
：  
>4MHz 
摆率  
 
 
 
：  
>5V/μs 
输出摆幅  
 
 
：  
>±1.5V 
电源抑制比 
 
 
：  
>80dB 
共模抑制比 
 
 
：  
>80dB 
6.4.2 
性能指标到电路参数指标之间的转",140
" 中，由于两级运放往往会产生两个低频极点，所以采用米勒电容 Cm来做频
率补偿。关于 Cm的大小计算会在后面详细叙述。由于设计增益要求达到 100dB 以上，我
们可以把它分配到两级放大器上 A1=70dB，A2=30dB，根据 A1，A2的计算式可以得到： 
            
[
]
1
m1
m12 o12 o10
m8 o8 o5
(
) || (
)
70 dB
A
g
g
r
r",166
"的开环相位裕度一
般至少大于 60 度。但是在两级放大器级联运放结构中，在两级放大器的输出端都有可能产
生较低频的极点，因此需要频率补偿。通常频率补偿的方式是采用米勒补偿或带调零点电
阻的米勒补偿。在这里为了简单，我们直接采用带调零电阻的米勒补偿。由于需要满足 60
度相位裕度的要求，通过理论计算可知，次极点要求在单位增益带宽外 2.2 倍以上[2]。如果
输出极点为次极点频率绝对值大小为： 
 ",221
"
2π
2.2
8.8MHz
2π
g
UGB
C
g
P
UGB
C
=
≈
×
=
>
×
=
×
 
 
 
 
 
(6-39) 
设计 Cm为 2pF，而负载电容根据指标规定为 5pF，那么可以计算出两级放大器的跨导： 
          
 
m1
m13
50.2 μS
276μS
g
g
≈
≈
  
 
 
 
 
 
    (6-40) 
还可以用一个米勒补偿电阻来调节系统",157
"极点放在高频，从
而减小其对环路的影响。 
按设计要求，摆率 SR>5V/μs。所谓摆率是指各级电路对其负载电容的最大驱动能力。
对于第一级放大器： 
       
SS5
1
m
I
SR
= C
  
 
              
  
(6-42) 
其中，ISS5是由 M5管提供的电流。对于第二级放大器： 
                           
SS6
2
L
I
",138
"的电流导致如果需要得到较大的 gm时，需要更大的 MOS 管宽长比值。我们由
此可以将指标规定的 100μA 电流分配到两级放大器中，一种比较合理的分配方法是第一级
放大器分配 40μA，第二级放大器分配 40μA，剩下 20μA 作为余量备用。在第一级放大器
中，分配给 M1,M2差分对管各 10μA 电流，M7~M12管各 10μA 电流，M4, M5电流源分配 20μA
电流。 
根据第一级",186
"μ = 215 cm / V s
⋅ , Cox= 2.76 fF/μm2。              
因此得到 NMOS 和 PMOS 管的跨导系数分别为： 
2
n
ox
110μA/V
μ C
=
，
2
p
ox
59μA/V
μ C
=
      
     (6-47) 
所以，M1 管的
1
1
2.13
1
W
L ≈
，同理可得 M13的宽长比为
13
13
16.13
1
",139
"假设 gm12 = gm8 = gm，并且 NMOS 管沟道调制系数 λ 估算为 0.1V-1，
PMOS 管沟道调制系数 λ 为 0.2V-1，由此可得： 
2
2
2
m
N
P
m1
2
2
m
m
N
P
1
1
3500
1
1
g
I
I
g
g
g
I
I
λ
λ
λ
λ
⎛
⎞ ⎛
⎞
⎜
⎟ ⎜
⎟
⎝
⎠
⎝
⎠
=
⎛
⎞
⎛
⎞
+
⎜
⎟
⎜
⎟
⎝
⎠
⎝
⎠
 
  ",228
"文件可以查到 VTHn = 0.755V，VTHp = -1.02V。
如果设计|VGS-VTH| ≈ 120mV，那么在 5V 供电电压情况下，VBIAS3=0.88V，VBIAS4=3.86V。因
此根据平方律式： 
(
)
2
n
ox
GS
THn
1
2
W
I
C
V
V
L
μ
=
−
 
 
 
 
 
 
(6-51) 
可以得到 M3、M4、M5和 M6的宽长比为： 
3
3
",159
"S 管 M9、M10如果同样设计过驱动电压为 120mV，可以利用平
方律式公式计算得到： 
 
186 
9
10
9
10
23
1
W
W
L
= L
≈
 
 
      
 
 
 
(6-53) 
4. 
偏置电路的设计 
图 6- 20 中给出了放大器主电路的设计，但是并没有说明共源共栅管和电流镜的栅端偏
置电压从何而来。在实际设计中往往是给一个模块电路提供一个由带隙基准（Band",172
"产生共源共栅管的栅压。
M15和 M23用来产生 PMOS 和 NMOS 电流镜管的栅压。通过前面的计算已经得到了主电路
各管的大小和流过的电流，现在仍然设计|VGS-VTH| > 120mV。这样设计所需的偏置电压，
可以得到： 
   VBIAS1=2.74V，VBIAS2=1.8V，VBIAS3=0.88V，VBIAS4=3.86V       
 (6-54) 
如果我们假设基准电流为 1",163
"电压时，采用最小的偏置电流，因此流过 M17、M19、M20
和 M21管的电流为 1μA，因此这些管子的宽长比为： 
17
17
6
1
W
L
=
，
19
20
21
19
20
21
3.2
1
W
W
W
L
L
L
=
=
=
  
 
 
 
 
(6-56) 
6.5 使用 Spectre 仿真优化电路 
在上面的计算过程中，使用了大量的理想条件和简单计算，很显然在实际的设计中还
",167
"提供的工艺库上，如图 6- 21 所示。 
 
  图 6- 21  新建项目库 
在“AMP”库中，还需要新建两个“cell”分别为“HGAMP”和“HGAMP_tb”。前者用于保
存运放主体电路，后者用于保存该运放的测试平台，如图 6- 22 所示。然后按照前面手工
计算的管子尺寸完成电路图绘制工作，如图 6- 23 所示。 
 
188 
 
                        ",145
"4、M5管宽长比同样为 5/4，20 个并联；设计 M6管宽长比为 5/4，40 个并联。那么和
原手工计算结果相差不大。同样可以设计其他电流镜管。我们在设计输入对管时，由于在
版图设计时有对称性要求，因此将原宽长比为 2.13/1 改为两个宽长比为 2.2/2 的管子并联。
另外，一般来说，单个管子的宽长比不能太大，否则在制造时会产生较大误差。将第二级
放大器 M13的 16.13/1 拆为 2",194
"
st02 
mp 
symbol 
M3 
mp 
7u 
3u 
20 
st02 
mp 
symbol 
M4 
mn 
5u 
4u 
20 
st02 
mn 
symbol 
M5 
mn 
5u 
4u 
20 
st02 
mn 
symbol 
M6 
mn 
5u 
4u 
40 
st02 
mn 
symbol 
M7 
mn 
16u 
1u 
2 
st02 
mn ",106
"mbol 
M13 
mp 
8u 
1u 
2 
st02 
mp 
symbol 
M14 
mp 
1u 
22u 
1 
st02 
mp 
symbol 
M15 
mp 
7u 
3u 
1 
st02 
mp 
symbol 
M16 
mp 
1u 
22u 
1 
st02 
mp 
symbol 
M17 
mp 
6u 
1u 
1 
st02 
mp 
symbol 
M1",105
"
mn 
5u 
4u 
1 
st02 
mn 
symbol 
M24 
mn 
5u 
4u 
1 
st02 
mn 
symbol 
M25 
mn 
5u 
4u 
1 
st02 
mn 
symbol 
电容 
Instance Name 
Model
W 
L 
Capcitance
Multiplier 
Library Name 
Cell Name 
View Name 
",85
"宽长比设计后，需要设置输入输出引脚，设置方法参见附录 A 所述。这
里需要注意的是我们往往把“VDD”和“GND”引脚设置为“inout”。我们可以为该放大器电路
生成一个“symbol”。“symbol”的作用相当于将电路打包放在一起。当其他人调用这个模块
时，无需关心该电路的具体细节，而只需要了解该电路的功能即可。“symbol”生成的方法
如下所示。 
选择工具栏中的“Design”→“Cr",159
"都在“symbol”
左边，输出引脚在“symbol”右边，而“VDD”和“GND”引脚分别在上下，如图 6- 26 所示。 
 
图 6- 26 引脚安排 
 
192 
 
图 6- 27 为运放电路生成的 symbol 
图 6- 27 显示了为本电路生成的 symbol。读者同样可以拖动引脚的位置，修改“symbol”
的名称等。 
6.5.2 
搭建测试平台 
电路需要仿真验证，我们需要",151
"包括： 
直流偏置激励：VDD电压 5V，偏置电流 IBIAS1，IBIAS2为 1μA，如图 6- 30 所示。而两
个输入端由电压源直接输入 2.5V 直流电压。 
 
      图 6- 30 直流偏置源 
 
194 
瞬态响应激励源：为测试该运放瞬态响应，将运算放大器的一个输入端固定在 2.5V
的直流电位，另一个输入端加载时变信号，例如正弦波、方波或三角波等。图 6- 31 所示，
",190
"ib 中可以找到）。电容
值设置为 1GF，电感值设置为 1GH。这样，对于交流信号来说，电感支路相当于断路，而
电容支路等效接地；而对直流信号来说，电感支路相当于短路，电容支路相当于断路，所
以输出直流电压是直接反馈到运放输入端的。 
 
测试放大器交流小信号增益和相位裕度等性能需要相应的交流信号激励源。如图 6- 32
所示。其中 V3 电压源只输出 1V 的交流电压信号。 
 
195 
 ",185
"这种设置将仿真并保存电路图中各个器件的直流工作点。点击“ADE”窗口中的
“
”按键，开始仿真。 
 
图 6- 33  保存器件的直流工作点 
仿真结束后，在如图 6- 29 所示的测试平台电路图中选中放大器的 symbol，使用快捷
键“shift+E”可以从测试平台直接进入到放大器的电路图中，以便进一步观察放大器各个器
件的直流工作点。 
 
196 
 
图 6- 34 “Anotate”",167
".017，VBIAS3=0.851V，VBIAS4=3.911V 
其中 VBIAS1和 VBIAS2与计算值有较大差别，将 M14、M16、M18和 M22的宽长比调整为：
( W/L)M14=( W/L)M16=1μm/11μm；( W/L)M18= ( W/L)M22=1μm /21μm 后，得到和计算值基本相
同的偏置电压。 
通过使用“Result”→“Print”→“DC Oprati",145
"从工艺文件中的电子迁移率等参数在仿
真中都回根据实际情况进行修正，这也是造成仿真结果和计算不一致的原因。 
 
198 
 
图 6- 36 第一级放大器输入管 M1的跨导 gm1 
 
图 6- 37 第二级放大器输入管 M13的跨导 gm13 
 
根据式（6-46），增大 gm可以通过增大宽长比和增大电流来实现。将 M1 和 M2的尺寸
变为 7μm/2μm，并联个数为 2；将 M13 的尺",170
"到运算放大器的反向输入端
“Vin1”，2.5V 的直流参考电压接入运算放大器的同向输入端“Vin2”，如图 6- 38 所示。 
 
图 6- 38 交流小信号测试平台 
在“Analog Design Environment”中设置好“AC Analysis”中的参数，扫描频率范围从
0.01Hz 到 100MHz，如图 6- 39 所示（具体操作请参考附录 A）。选择“Results”→“D",141
"
从图 6- 41 中，可以看出该放大器的增益有 80.1dB，相位裕度 49 度左右，单位增益带
宽 4.48MHz。用“shift+E”切入到运算放大器内部电路图后，同样的方法依次点击第一级放
大器的输出端“N1”和输入端“Vin1”，可以看到增益和相位曲线，结果如图 6- 42 所示。 
 
202 
 
图 6- 42 第一级放大器增益和相位曲线 
从第一级放大器的增益和相位曲线来看，它的",178
"”，如图 6- 43
所示。这样当我们修改 M9和 M10管的栅长时，将自动修改 M9和 M10管的栅宽。这里需要
注意的是，“M9_W”一定要在“M9_L”之后赋值，即在图 6- 43 中，“M9_W”排在“M9_L”之
后。 
 
图 6- 43  将 M9和 M10管的栅宽设为擅长的 23 倍 
为了寻找合适的栅长，将图 6- 19 中 M9，M10的栅长进行参数扫描，以观察不同栅长
情况下",183
"线，结果如图 6- 45 所示。从图 6- 45 的
仿真结果来看，改变负载管栅长能在一定程度上增大放大器的增益。例如，将 M9，M10管
栅长增大到 10μm，放大器增益可以达到 94.19dB，基本达到设计要求。但是在这种情况下，
M9，M10管的栅宽增加到 115μm，这将消耗很大的芯片面积，显然这种修改不是很理想。 
因此还需要进一步从其他方面入手优化电路，增大运算放大器的增益。例如增大流",194
"了保证相位裕度和单位增益带宽，调整了米勒补偿
 
204 
电容管的大小和 M13管的并联个数。调整后的设计参数如表 6- 2 所示。 
表 6- 2   调整后的放大器器件参数 
MOS 管 
Instance Name 
Model
W 
L 
Multiplier 
修改原因 
M1 ，M2 
mp 
20u 
2u 
2 
增大跨导，从而增加增益和单位增益带宽。 
M3 
mp 
7u 
",153
"直流工作点，提高输出阻抗 
M11 ，M12 
mp 
6u 
1u 
5 
保证直流工作点 
M13 
mp 
7u 
1u 
6 
增大第二级放大器输入管的跨导， 
从而提高增益和次极点的频率。 
提高次极点频率以提高相位裕度，增强稳定性。 
M14 ，M16 
mp 
1u 
11u 
1 
调整 VBIAS1的电位到计算值 
M15 
mp 
7u 
3u 
1 
-- 
M17 
mp ",160
"- 
-- 
5p 
1 
增强极点分裂作用，提高相位裕度 
电阻 
Instance Name 
Model
W 
L 
Capcitance 
Multiplier 
修改原因 
Rm 
-- 
-- 
-- 
2.85k 
1 
-- 
 
调整后放大器的交流仿真结果如图 6- 46 所示。增益达到 99.5dB，单位增益带宽约为
4.05MHz，相位裕度约为 59 度，基本满足设计要求。 ",144
"in2）的输入信号。在运算放大器的同
向输入端接入一个分段信号电压源，产生一个 0V 到 2.5V，上升沿为 1ns 的阶跃信号。该
电压源的设置见图 6- 48（该电压源的说明请参考附录 A） 
 
206 
 
图 6- 47 瞬态响应测试平台 
 
207 
 
   图 6- 48 单位阶跃激励源 
在 ADE 窗口中设置瞬态仿真，瞬态仿真结束时间设置为 10μs，仿真精度可以设计为
高精",183
"，不过
系统还能保持较高的稳定性。虽然我们在前面的交流仿真中得到运算放大器的相位裕度有
59 度，但是这是在运算放大器两个输入端的直流电位都为 2.5V 的情况下得到的。随着输
入端直流电位的变化，运算放大器的直流工作点也随之改变，进而造成了相位裕度的不足。
这告诉我们，在模拟电路的设计中，需要考虑电路的鲁棒性，在设计时需要留有一定的余
量。 
根据电路理论可知，输出响应分为大信号响应阶段和小信号",207
"为由于电容
馈通效应的存在，输出曲线会有个向下弯曲的过程。当然，也可以在“Calculator”中选择
“slewRate”函数来测量输出曲线的摆率。从“Results Broser”中将输出端的瞬态仿真结果输送
到“Calculator”的缓存中（具体操作请参考附录 B）。然后在“Calculator”中使用“slewRate”函
数，如图 6- 53。“slewRate”函数的设置如图 6- ",143
"value type 
：  y 
� 
Initial value 
 
： 0 
� 
Final value type 
： y  
� 
Final value 
 
： 2.5 
� 
percent low 
 
： 10 
� 
percent high 
 
： 40 
点击“Apply”后，将计算表达式载入到缓存中，点击“Eval”后看到计算结果。 
 
211 
 
图 6- ",93
"定当输出曲线进入到距离终值多
大范围内，认为放大器完成建立过程。一般容差范围可以在 5%到 0.1％以内。以 0.1%的误
差为例，如果在终值电压为 2.5V 的情况下，当放大器输出电压达到 2.5±0.0025V 范围内时，
可以认为该放大器完成建立。同样，我们利用“Calculator“中的“settlingTime”函数来测量建
立时间，函数的选择和设置如图 6- 56 和图 6- 57 所",181
"r”中与我们前述的容差范围含义略有不同，它是指“Final value – Initial value”的百
分比。这里给出在本例中的测试参数： 
� 
Initial value type 
： x at y 
� 
Initial value 
 
： 1n 
� 
Final value type 
：  x at y 
� 
Final value 
 
：  10u 
� 
Percen",102
"指放大器对输入端共模信号的抑制能力。其计算表达式为： 
vd
vc
A
CMRR
= A
  
 
 
 
 
 
(6-58) 
 
其中，Avd表示差模增益，Avc表示共模增益。按照第 5 章介绍的方法，把运算放大器
连接成单位增益负反馈的模式，在运算放大器的同向和反向输入端加上相同的交流电压，
共模增益测量电路图如图 6- 59 所示。再次进行交流仿真，得到的仿真结果如图 6- 60 所示。",180
"是 1/PSRR，因此运算放大器的低频电源抑制比为
84.6dB。满足设计要求。 
 
215 
 
图 6- 61 PSRR 测试电路 
 
216 
 
图 6- 62 PSRR 测试结果 
 
 
习题 
6.1 
请计算图 6- 2 套筒式运算放大器的增益和输出摆幅。 
          器件参数：VDD=5V，μpCox=50μA/V2，λp=0.2V -1，μnCox=110μA/V",152
"大器模型，如果要获得 45 度相位裕度，要
求次极点频率位于 1.22 倍单位增益带宽以上，零点频率位于 10 倍单位增益带宽以上。 
6.5 
请根据图 6- 18，利用米勒等效的方法估算系统的零极点分布，并与式(6-21)和式(6-22)比较结果。 
6.6 
一种在实际设计中常用的米勒补偿方式如图 6- 64 所示。该补偿方案是将米勒电容反馈到共源
共栅级。试画出这种情况下的小信号模型并计算",206
"=0.75V，VTHp= -1.0V，μnCox=110μA/V2，μpCox=50μA/V2。 
 
图 6- 65 
6.8 
用 Cadence 软件仿真题 6.7 中设计的电路，比较和手工计算的差异，并用优化器优化。 
6.9 
用 Cadence 中自带的函数计算题 6.7 所示运算放大器的摆率，相位裕度，功耗等参数。 
6.10 
根据下面的参数，请设计一个运算放大器。器件参数同 6.",165
"： 西安交通大学出版社， 2003 
[2] 
Allen P E. CMOS 模拟集成电路设计. 第 2 版. 北京：电子工业出版社，2005 
[3] 
Franco S. 基于运算放大器和模拟集成电路的电路设计. 第 3 版. 西安： 西安交通大学出版社， 2003 
[4] 
Ka Nang Leung and Philip K. T. Mok. Analysis of multistag",135
"入，差分输出结构的运算放大器。差分放大
器相对于单端输出的放大器具有如下一些优势。首先，由于随着 CMOS 工艺尺寸地不断
缩小，从 0.5μm 减小至 0.35μm，0.18μm，90nm，芯片的供电电压也不断减小，从 5V 降
到 3.5V，1.8V，1.2V 甚至更低。在如此低的供电电压的情况下，单端输出的运算放大器
很难能理想地工作，为了保证电路能够得到足够大的信号摆幅，我们需要采用全差分",216
"构和原理，比较了几种常用的全差分放大
器。然后，介绍了全差分放大器中的一个重要部分—共模反馈，并详细讲述了共模反馈
的原理和要求，接着简单提了一些常用的共模反馈结构。接下来，又介绍了全差分放大
器的非线性问题以及提高电路线性度的几种电路结构。最后，本章设计了一个高带宽的
全差分运算放大器电路，并进行了总结。 
7.1 概述 
7.1.1 
全差分运算放大器结构框图 
图7- 1是一个全差分运算放大",209
"共模反馈环路不会对交流信号产生影响，相当于
说共模环路对于交流是开路的。所以，电路的差分增益和相位就由主放大器决定。但是，
对于输入的共模信号，共模反馈环路决定了输出的共模电平，这时，共模环路的增益和
相位就会对电路的输出共模电平的精度和稳定性产生影响。 
图 7- 2 给出了全差分放大器在应用中的一种电路形式，从中可以看出差分输出的信
号摆幅 vO1-vO2 为单端信号 vO1（vO2）摆幅的两",207
"路，它的增益会比较大，可以达到 60~70dB，但
同时会消耗比较大的功耗，因为它有四条支路需要电流。折叠式运算放大器在实际的应
用中会比较广泛，因为它单级的增益比较大，这样可以避免使用多级电路实现高增益，
也就避免了多级放大器的频率补偿问题。 
 
222
 
图 7- 3 常见的全差分放大器结构（a）普通全差分放大器；（b）折叠式差分放大器 
图 7- 4（a）是套筒式全差分运算放大器电路，它",215
"绝对值。例如，在增益
 
223
上，套筒式共源共栅和折叠式共源共栅差不多，但是在速度上，前者要快一些。我们在
设计电路时，要根据设计的需求分析放大器的结构性能，不仅仅是折叠式和套筒式共源
共栅，可能还有其他的结构，从而选择合适的结构作为设计的基础。 
表 7- 1 折叠式共源共栅和套筒式共源共栅的比较 
电路结构 
增益 
速度 
输出摆幅 
噪声 
功耗 
套筒式共源共栅 
 
 
 
 
 ",206
"匹配，那么这个差值电流会在输出端产生一个电压 Vo = ΔI·rO = (Ip-In) (rop//ron)。例如，
ΔI = 1μA，ro= 2MΩ，那么 Vo=2V。但实际上这个电压是不可能在电路中产生的，所以必
然会使得 Ip的电流源进入线性区，也就是输出电压升高，从而使得 ΔI =0。 
 
图 7- 5 电流源不匹配的简化模型 
 
224
 
图 7- 6 共模反馈电路的结构 
既然全",174
"其中，Vo,cm为输出共模电平，Vo,dm为输出差分电压，α1，α2，α3 为系数。 
对于理想的共模电平采样电路，后面两项均为 0。α2Vo,dm 来自共模电平采样电路的
不可避免的失配，α3Vo,dm
2 是由于电路的非线性 I-V 特性所导致的。 
    对于全差分运算放大器电路，由于其拥有共模放大和差模放大两种信号，为了考虑
共模和差模之间的交叉放大，所以通常会使用信号流图来简化全差分运",196
"o,cm之间是共模环路，其环路
增益（Loop Gain）为 LGCM= ASC·ACS；VS和 Vo,dm间的环路的存在会影响差分信号的输出，
可以把这个环路称为内部差分环路，其环路增益为 LGDM= ASD·ADS。但是，LGDM比 LGCM
小很多，几乎可以不考虑。另外，图 7- 7 中还给出了共模信号和差分信号之间的交叉增
益，可以表示为 ΔLGCM=ACS· ASD和 ΔLGDM=ADS",160
"
DD
CS
(1
)
A
LG
A
LG
A
A
A
D
A
−
+
⋅Δ
=
≅ −
    
 
 
（7-4） 
*
CC
DM
CD
DM
DS
CC
CD
CS
(1
)
0
A
LG
A
LG
A
A
A
D
A
−
+
⋅Δ
=
≅ −
≅
  
 
 
（7-5） 
其中，D=1-LGCM-LGDM 
 
图 7- 7 全差分运算放大器的信号流图 
 
因此，我们可以得到一些结论",160
"分运算放大器电路的共模采样。表 7- 2 列出了在全差分放大电路中经常会采
用的共模电平采样电路[3]。 
表 7- 2 共模电平采样电路结构 
共模采样 
性能 
优缺点 
1  
1
α =1
 
2
4
R
R
α
Δ
=
 
3
α = 0
 
� 
线性度好 
� 
对于实际的 IC 电阻
来说，差分增益会大
大降低 
� 
放大器需要缓冲器
（buffer） 
 
226
2  
1
",181
" 
源跟随器会引入很大
的失调电压（offset） 
� 
电阻的失配是引起 α2
的主要原因 
3 
 
1
2
V
α
= β
⋅Δ
 
2
2
V
β
α
= Δ
⋅Δ
 
3
α = 0
 
� 
MOS 管工作在线性
区，表现为一个受控
电阻 
� 
Req和 Vo,dm成正比 
� 
载流子的迁移率调制
会导致非线性的 α3 
4 
1
4
2
T
B
B
V
I
I
β
β
α
β
",179
"出和差分环路
关联的共模反馈方式，如果对差分环路和共模环路分别进行分析，我们可以发现这种共
模反馈方式的共模环路和差分环路具有类似的增益和相位性能。 
上面提到的共模反馈方式都是连续时间的共模反馈，在离散电路，如采样电路中，
经常使用开关电容的共模反馈，如图 7- 9 所示。 
 
227
 
   图 7- 8  输出和差分环路关联的共模反馈 
 
 图 7- 9 开关电容共模采样电路 
电容 ",188
"来说，连续时间共模反馈和离散时间共模反馈各有优缺点，在选择共模反馈电
路时要根据实际电路情况进行确定。 
7.3 差动电路的非线性 
7.3.1 
非线性的原理和差动对的非线性 
首先我们考虑任何一个非线性的系统，它可以由式（7-6）来表示： 
2
3
0
1
2
3
( )
( )
( )
( )
y t
x t
x t
x t
α
α
α
α
=
+
⋅
+
⋅
+
⋅
+�   
     ",181
"7-7） 
 
228
化简后，得到 
   
3
3
2
2
3
3
2
2
0
1
3
( )
cos(
)
cos(2
)
cos(3
)
2
4
2
4
A
A
A
A
y t
A
t
t
t
α
α
α
α
α
α
ω
ω
ω
⎛
⎞
⎛
⎞
⎛
⎞
⎛
⎞
⋅
⋅
⋅
⋅
=
+
+
+
+
+
⎜
⎟
⎜
⎟
⎜
⎟
⎜
⎟
⎝
⎠
⎝
⎠
⎝
⎠
⎝
⎠
 
 
 
 
 
 
 ",219
"3
3
2
3
3
3
3
1
1
4
3
4
4
A
A
HD
A
A
α
α
α
α
α
⋅
⋅
=
≅
⋅
⋅
+
 
 
 
 
 
（7-10） 
2
2
2
2
3
4
THD
HD
HD
HD
=
+
+
+�   
 
 
（7-11） 
 
理论上来说，全差分放大器输出的偶次谐波分量会由于相减而消失，但由于电路中
失配的存在会导致有限的偶次谐波失真。如果运算放大器系统有 ε%的失",184
"S1
TH
(
)
2
I
V
V
= β
−
，
2
2
GS2
TH
(
)
2
I
V
V
= β
−
      
     （7-13） 
其中，
n
ox
W
C
L
β
= μ
，所以： 
d
1
2
2 (
)
v
I
I
β
=
−
  
 
 
 
 
（7-14） 
那么可以得到输出电流： 
2
1/ 2
d
O
1
2
d
DC
DC
(1
)
4
v
I
I
I
v
I
",154
"         （7-17） 
所以，由式（7-10）可得： 
2
3
2
DSAT
1
32
A
HD
V
=
 
 
 
 
 
 
（7-18） 
另外，因为我们在计算式（7-15）时忽略了 MOS 管和其他的一些失配，所以在式
（7-16）中没有 vd的偶次项出现，也就没有 HD2 这一项了。 
 
图 7- 10 简单的差动输入对 
 
 
图 7- 11 含非线性放大的反馈系统 
由",155
"os(2
)
Sy
x t
y t
V
a
t
b
t
β
β
ω
β
ω
=
−
⋅
=
−
⋅
−
⋅ ⋅
  
 
 （7-19） 
所以，系统的输出为： 
2
1
m
2
2
2
m
1
m
2
m
1
( )
[(
)cos(
)
cos(2
)]
[(
)cos(
)
cos(2
)]
(
)
[
(
)
(
)
]cos(
)
[
]cos(2
)
2
m
y t
V
a
t
b
t",155
"-21） 
 
230
 
2
2
m
1
(
)
2
V
a
b
b
α
β
α
β
−
⋅
= −
⋅
⋅ +
  
 
 
 
 
（7-22） 
如果 α2和 b 都很小的话，那么由式（7-21）和式（7-22）简化后得到： 
2
m
2
1
1
1
1
2
(1
)
V
b
a
α
α
β α
⋅
=
+
⋅
 
 
 
 
 
 
（7-23） 
若没有反馈，那么该比值为： 
2
m
",169
"的线性度比较高，那么就需要对输入差动对进
行线性化。最常用的线性化方法是源极退化（source degeneration），如图 7- 12 所示[1]。 
 
图 7- 12 源极退化线性化技术 
在图 7- 12 中的（a）和（b）电路具有相同的输出电流表达式[4]： 
n
2
n
ox
B
n
id
o,sd
id
DS(sat)
2
1
2(1
)
1
C I W
L
v
i
v
N V
",165
"7- 3 普通差分对和源极退化差分对的比较 
参数 
普通差分对 
源极退化 
 
231
小信号跨导（Gm） 
n
m
n
ox
B
n
2
W
G
C
L I
μ
=
 
m
m,sd
1
G
G
N
=
+
 
三阶谐波失真（HD3） 
2
id
3
DSAT
1
32
v
HD
V
⎛
⎞
=
⎜
⎟
⎝
⎠
 
2
3
1
1
HD
N
⎛
⎞
⎜
⎟
⎝ +
⎠
 
电流消耗 
2IB",204
"） 
当然，也可以让 MOS 管工作在饱和区作电阻来用，如图 7- 14 所示。表 7- 4 比较了图
7- 13 和图 7- 14 中的源极退化电路结构，并介绍了各自的特性。 
 
 
图 7- 13 有源器件工作在线性区的源极退化电路结构 
 
 
232
图 7- 14 MOS 管工作在饱和区的源极退化电路结构 
表 7- 4 有源器件源极退化电路的比较 
电路结构 
跨导 
特性 
图 7",186
"1
g
g
g
+
； 
1
2
3
M
M
M
=
=
 
对输入共模范围不敏感，线
性度提高不大，需要占用较
多的面积 
7.4 全差分运算放大器的设计实例 
以下以设计一个带宽为 500MHz 的全差分运算放大器电路为例说明设计流程。 
7.4.1 
设计指标 
电源电压： 
 
 
 
3.3V 
开环增益： 
 
 
 
≥65dB 
单位增益带宽： 
 
 
≥500MHz 
相位裕度",168
"放大器结构选择 
 
图 7- 15 高速全差分放大器的仿真设置 
 
 
图 7- 15 为所设计的全差分运算放大器的外围电路参数。运算放大器的结构主要有
三种：（a）简单两级运放（two-stage）；（b）折叠式共源共栅（folded-cascode）；（c）套
筒式共源共栅（telescopic cascode）。 
 
简单的两级运放的直流增益较小，很难达到 80dB 的增益。而且，该运",167
"的输出阻抗和大的输出电
压摆幅；前馈级用来产生零点，以抵消放大器传递函数中的一个极点；共模反馈级用来
确定输出的共模电平，其中的共模电平采样方式采用了表 7- 2 中第一种共模电平采样方
法。 
 
 
234
 
图 7- 16 折叠式全差分运算放大器电路 
7.4.3 
性能指标分析 
1. 
差分直流增益 Adm≥65dB 
 
该运算放大器存在两级：折叠式输入级（M0~M8，M9a，M9b",190
"A
G R
g
g
r
r
r
r
g
r r
g
g
g
g
g
g
g
g
g
g g
= −
= −
= −
+
+
+
   
（7-27） 
第二级的增益： 
m13
2
m2
o2
m13
o11
o13
o11
o13
(
//
)
g
A
G
R
g
r
r
g
g
= −
= −
= −
+
 
 
 （7-28） 
所以，整个运算放大器的增益为： 
m1
m7
m5
m13
d",165
"： 
out
C
max
max
C
|
|
dv
I
SR
dt
C
=
=
  
 
 
 （7-30） 
� 
第一级的转换速率为：SR=IM0/C1，其中 C1 为第一级放大器的负载电容，它实际上
是管子寄生电容的总和。 
� 
第二级的转换速率为：SR=2IM11/(CC+CL) 
 
所以，放大器的转换速率为：SR=Min{ IM0/C1，2IM11/(CC+CL)} 
 
236
3",148
"写成： 
2
f
n,in
m
ox
2
1
4
3
K
v
kT
g
WLC
f
=
+
⋅
   
 
 
    （7-31） 
其中，式（7-31）的右边第一项表示由于沟道电阻产生的热噪声在输入端的表现，
第二项表示 MOS 管的闪烁噪声。 
 
图 7- 18 MOS 管的噪声来源和等效输入参考噪声 
 
 
对于图 7- 17 的电路，因为共源共栅 MOS 管（M5，M6，M7，M8）",176
"
2
2
3
(
)
3
3
1
1
1
2
2
2
(
)
(
)
(
)
g
g
g
K
v
kT
g
WL C
f
g
g
g
g
g
K
K
K
WL C
f
WL
C
f
WL
C
f
g
g
g
⎡
⎤
+
=
⋅
+
⋅
+
⋅
+
⋅
⋅
⎢
⎥
⎣
⎦
+ ⋅
⋅
⋅
+
⋅
⋅
⋅
+
⋅
⋅
⋅
  （7-32） 
5. 
相位裕度 
 
假设放大器只有两个极点 p1和 p2",212
"裕度都达
到要求。 
 
图 7- 16 的等效框图和小信号等效电路分别如图 7- 19，图 7- 20 所示，其中 vIN表示
输入的差分信号，
1v 表示第一级的输出信号，vOUT表示第二级的输出信号，其中没有包
括共模反馈部分的电路。 
 
237
 
图 7- 19 全差分运算放大器的等效框图 
 
 
图 7- 20 全差分运算放大器的小信号等效电路 
 
在图 7- 20 中的电阻和电",171
"
  
   （7-35） 
out
L
C
≈ C
 
 
 
 
 
 
（7-36） 
 
从图 7- 20 中我们可以计算传递函数为： 
mf1
o1
C
m1
mf1
o1
m1
mL
v
2
2
1
0
[
(
)
]
( )
C
s g
C
C
g C
g
g
g
g
A s
s d
sd
d
+
−
+
+
=
+
+
 
     （7-37） 
其中： 
2
o1
C
out
",143
"238
out
out
1
g
R
=
  
 
 
 
 
 
 
（7-42） 
如果认为 Cc比任何的寄生电容都要大很多，gm1，gmf1，gmL也比 go1，gout 大很多，
那么 d2、d1、d0 这些参数可近似表示为： 
2
L
C
d
≈ C C
 
 
 
 
 
 
 
 
（7-43） 
1
o1
L
mL
C
d
g C
g
C
=
+
 
 
 
 
 
 
（7-44）",143
"= −
+
−
+
≈ −
−
 
 
 
 
 
（7-46） 
0
p1
1
OUT
L
m1
o1
L
1
(
)
d
d
R
C
g
R C
ω
≈ −
= −
+
（ωp1为主极点位置） 
（7-47） 
o1
L
mL
C
1
p2
2
L
C
g C
g
C
d
d
C C
ω
+
= −
≈ −
 
 
     
 
（7-48） 
由前面计算出的开环增益，可得： 
m1
u
d",163
"馈环路的直流增益要尽可能地大； 
� 
共模反馈环路的带宽也要尽可能大，最好能和差分通路接近； 
� 
共模反馈环路的稳定性也必须达到一定的要求。 
 
这次设计采用了最简单的电阻来作为共模电压的检测，然后通过一个简单的放大器
放大后进行反馈，如图 7- 21 所示。 
 
239
 
图 7- 21 全差分运算放大器的共模反馈 
 
共模反馈环路也是一个两级的放大器，图 7- 21 只给出了共模",192
"路 
 
 图 7- 22 宽摆幅电流偏置电路 
 
240
 
电路中需要 4 个偏置电压，为了能够得到大的电压摆幅，电压偏置电路采用了宽摆
幅的电流源。 
7.4.4 
全差分放大器电路设计和仿真 
 
图 7- 23 和图 7- 24 给出了在 cadence 软件中调用 CSMC 0.5μm 工艺 PDK 中的元件
绘制的电路图。在电路图中，最左边部分是所加的电压源和信号激励，中间部分是电",192
"
 
图 7- 24 高速全差分放大器在 Cadence 环境中的电路图 
表 7- 5 高速全差分放大器每个 MOS 管的尺寸 
MOS 管 
Instance Name 
Model
W 
L 
Multiplier 
Library Name 
Cell Name 
View Name 
M0 
mp 
12u 
0.55u 
45 
st02 
mp 
symbol 
M1 , M2 
m",114
"
10u 
0.5u 
8 
st02 
mn 
symbol 
M11 , M12 
mp 
12u 
0.55u 
80 
st02 
mp 
symbol 
M13 ,M14 
mn 
10u 
0.5u 
120 
st02 
mn 
symbol 
M16 ,M17 
mp 
10u 
2.2u 
10 
st02 
mp 
symbol 
M18 ,M19 
mn 
10u 
2u 
",107
"
 
 
242
表 7- 6 偏置电路的 MOS 管的尺寸 
MOS 管 
Instance Name 
Model
W 
L 
Multiplier 
Library Name 
Cell Name 
View Name 
M0 
mp 
12u 
0.55u 
45 
st02 
mp 
symbol 
M1 , M6, M7 
mn 
12u 
1u 
25 
st02 
mn 
symb",101
"M14 ,M15 
mn 
12u 
0.5u 
120 
st02 
mn 
symbol 
表 7- 7 电阻和电容的值 
电阻 
Instance Name 
Model
W
L
Resistance 
Multiplier 
Library Name 
Cell Name 
View Name 
R 
rhr1K
-- 
--
10k 
1 
st02 
rhr1K 
symbol 
RC",93
"
0.4pF 
1 
st02 
cpip 
symbol 
1. 
增益和相位裕度 
 
增益和相位裕度的仿真是通过“AC analysis”来实现的。如前面章节所述，我们首先
要在 ADE 的“Setup”�“Model libraries”里面设置仿真所需要的工艺库，如图 7- 25 所示。
设置完成后，选择“Analyses”的“ac”，设置如图 7- 26 所示。电路的激励如图 7- 2",143
"tor”
 
244
旁的“Open”，可以打开“Calculator”窗口，如图 7- 29 所示。选择“ac”的“vf”项，这时窗口
会回到电路图中，这时选择差分放大器的正输出端，然后点击“Calculator”的“Enter”；然
后再点击差分放大器的负输出端；然后点击“-”号；接着再选择“dB20”，这时差分放大器
的增益表达式就在“Calculator”里面表示出来了，如图 7- 30 ",149
"称可以自己定，但为了表达清晰，可以根据自己想要显示的曲
线内容来定，如图 7- 31 所示。用同样的方法，我们可以添加差分放大器的相位表达式，
只是选择的函数不同而已，仿真相位应该调用“phase”函数，如图 7- 32 所示。 
 
完成之后，点击“OK”，这两个表达式就会出现在 ADE 的窗口中，如图 7- 33 所示，此
时，点击最右边倒数第三个按钮“
”就可以进行仿真了，我们可以得到如图 ",177
"得到，直流增益为 69.9dB＞65dB，相位裕度为 180°-127°=53°，单
位增益带宽为 531MHz。 
2. 
阶跃响应仿真转换速率 
 
电路的阶跃响应激励如图 7- 35 所示，图中的“Vip”也是加在差分放大器的正输入端，
“Vin”加在差分放大器的负输入端。它和仿真增益和相位裕度时的激励没有本质区别，只
是把信号源改成了“Vpulse”，其中“Vpulse”的设置如图 7- ",189
"的
端口的名字。这里，我们选择了输入信号端和正输出端，如图 7- 37 所示。这样，可以
得到仿真的结果如图 7- 38 所示。 
 
图 7- 38 给出了差分放大器的转换速率曲线，在曲线图上按“d”键，就会弹出如图所
示的两个标签，它可以对标签之间的曲线求斜率，其值在图的最右下角可以看到。 
 
从图 7- 38 中，我们可以得到设计的全差分运算放大器的转换速率为：
 
250
SR=1.30",180
"大的电感和电容。这个电感和电容都使用了理想的元件，因为它们只是用来
做仿真用的。大电感保证环路的直流电压不被隔断，而大电容可以把交流信号耦合进到
电路里面。电感和电容可以从“analogLib”里面调出来，它们的 Cell 名分别为“ind”和“cap”，
图 7- 40 给出了电感在“analogLib”里面的具体位置。 
 
 
 
251
 
图 7- 39 共模反馈环路仿真的激励信号 
 ",176
"反馈环路的带宽再做得大
一点。 
 
 
图 7- 41 共模反馈环路的增益和相位曲线 
 
4. 
共模抑制比的仿真 
 
共模抑制比定义为差分增益和共模增益的比值。它反映了一个放大器对共模信号和
共模噪声的抑制能力。因此，我们需要仿真差分放大器的差分增益和共模增益。我们可
以利用两个放大器，一个连接成差模放大，一个连接成共模放大。图 7- 42 给出了仿真
共模抑制比的信号激励，图中的左边是仿",209
"的共模抑制比。 
 
 
图 7- 42 仿真差分增益和共模增益的信号激励 
 
 
图 7- 43 输出波形表达式的编辑 
 
254
 
图 7- 44 差分增益，共模增益和共模抑制比的仿真曲线 
 
从图7- 44 中，我们可以得到全差分放大器的差分增益为 70.6dB，共模增益为-60.4dB，
所以电路的共模抑制比为 70.6dB-(-60.4dB)=131dB。 
5. 
电源抑制比的",176
" 7- 45 所示。图 7- 46 为 VDD的电源抑制比的仿真曲线。 
 
 
255
 
图 7- 45 电源抑制比的表达式设定 
 
 
图 7- 46 VDD 的电源抑制比仿真曲线 
 
从图 7- 46 可以得到，全差分放大器的差分增益为 69.9dB，从电源到输出的增益为
-41.2dB，所以放大器的电源抑制比就是 69.9dB-(-41.2dB)=111.1dB。 
 
6. 
输出",168
"信号频率为 10MHz。我们需要对电路进行瞬态仿
真，所以选择“Analyses”中的“tran”，仿真设置如图 7- 48 所示。图 7- 49 设置了我们需要
观察的输入信号和输出信号，图 7- 50 给出了瞬态仿真的输入和输出信号。 
 
 
图 7- 48 瞬态仿真设置测试动态范围 
 
 
图 7- 49 瞬态仿真输出设置 
 
 
257
 
图 7- 50 输入信号和输出信号的时域波",162
"”，从而判断是
否满足要求，如图 7- 53 所示。 
 
 
图 7- 51 Calculator 中的 thd 函数 
 
 
258
 
图 7- 52 thd 函数的设置 
 
 
图 7- 53 输入信号为 100mV 时输出信号的 thd 
 
从图 7- 53 中，我们得到放大器在输入信号为 100mV 时，输出的失真为 0.03%，小
于 0.1%，满足性能的要求。我们可以通过扫描",144
"ge Source”可以选择加在输入端的直流电压源。 
 
要观察仿真的结果，我们可以选择“Results”→“Direct plot”→“Main form”，如图 7- 55
所示。同时，它会弹出图 7- 56 所示的对话框，按图中这样的设置选定后，点击“Plot”按
钮，就可以得到输入等效噪声的曲线，如图 7- 57 所示。 
在仿真等效输入噪声时，电路中不同的管子对噪声的贡献都不一样，详细",166
"在
Cadence Spectre 下进行了仿真。全差分放大器主要由主放大器和共模反馈部分组成，共
模反馈环路部分是全差分放大器的设计难点。整个全差分放大器的性能都达到了设计指
标要求，具体的参数如表 7- 8 所示。 
 
 
261
表 7- 8 全差分运算放大器设计指标和仿真结果 
Parameter 
Specification 
Simulation result 
直流增益 
65dB",144
" 管基本参数如下： 
NMOS：µnCox=120µA/V2; VTHn=0.7V; λn= 0.02V -1 
PMOS：µpCox = 40µA/V2；VTHp= -0.8V；λp= 0.01V-1 
 
7.1 图 7- 58 中的电路是对称的结构，画出以下条件下的（vOP-vON）的草图。 
 
（a）vIP和 vIN为差分信号，且从 0 变化到 VDD。 
 
（b）vIP和 vIN相等",156
" 
 
7.3 图 7- 60 中，假设所有的 MOS 管都工作在饱和区，λ≠0，计算电路的小信号差分电压增益。 
 
图 7- 60 
 
7.4 图 7- 61 中，假设所有 MOS 管都工作在饱和区，电流源当理想的考虑，λ≠0，计算电路的共模反馈
环路的增益。 
 
263
 
图 7- 61 
 
7.5 图 7- 62 为一个 current-mirror 结构的差分放大器，假设电路结构",168
" 所示，W/L=20/1，I=100 µA，RD= 10kΩ，该电路被用于图 7- 11 的反馈环路中，其中 β=0.1，
 
264
输入信号的峰峰值为 20 mV 的输入正弦波。试计算输出端的 THD。 
 
图 7- 63 
 
7.7 如图 7- 12 所示电路，试推导式（7-25），并计算输入差分对的 Gm。 
7.8 如图 7- 13（a）所示电路，试推导输入差分对的 Gm表达式。 
",169
"e Common-mode Component in CMOS Continuous-Time Fully 
differential Signal Processing．Analog Integrated Circuits and Signal Processing, 1993, 4: 131-140 
[4] E.Sanchez-Sinencio, J.Silva-Martinez． CMOS",58
"f a Two-Stage Fully Differential 
CMOS Amplifier with High Unity-Gain Bandwidth and Large Dynamic Range at Output．Circuits and 
Systems, 2005, 2: 984-987 
 
265
第8章  带隙电压基准 
电压基准是模拟电路设计中不可或缺的一个单元模块。它为",93
"的结构和设计流程。 
8.1 带隙电压基准的性能参数 
8.1.1 
温漂系数 
 
温漂系数是衡量带隙基准电压源输出电压随温度变化的一个性能参数。其单位为
ppm/℃。表示当温度变化 1 摄氏度时，输出电压变化的百万分比。其计算公式为： 
[（基准电压最大值-基准电压最小值）/（基准电压的平均值×温度范围）]×1000000 
符号表达式为： 
 
(
)
max
min
mean
max
mi",196
"：测量带隙基准的输出端的噪声谱密度，
在关心的频率范围内对噪声谱进行积分，然后对积分值进行开方，从而获得带隙基准输出
端在关心的频率范围内的噪声大小。 
8.1.3 
功耗 
功耗是衡量电路在正常工作情况下消耗电流多少的一个参数。为了获得更小的噪声以
及更快的响应速度，都需要增加功耗。然而芯片由于应用的要求，以及散热条件的制约，
其功耗是受到制约的。因此每个单元电路都会有相应的功耗要求。 
8.1",225
"反温度系数（Temperature Coefficient）的电
压以合适的权重相加，最终获得具有零温度系数的基准电压。例如，电压 V+拥有正温度系
数，电压 V-拥有负温度系数，存在合适的权重 α 和 β，使得满足： 
0
V
V
T
T
α
β
+
−
∂
∂
⋅
+
⋅
=
∂
∂
                       (8-3) 
这样就得到具有零温度系数的基准电压，其原理如图 8",177
"温度成正比。因此，双极晶体管可构成带隙电压基准的核心。 
8.2.1 
负温度系数电压 
对于一个双极型晶体管，其集电极电流（IC）与基极-发射极电压（VBE）的关系为： 
(
)
C
S
BE
T
exp
I
I
V
V
=
 
 
          
 
 
(8-5) 
其中，IS是双极型晶体管的饱和电流；VT = kT/q ，k 为波尔兹曼常数，q 为电子电荷。进一
步利用饱和电流 IS",191
"此如果正温度系数是一个
固定值，与温度无关，那么在带隙电压基准中的温度补偿就会出现误差。这也是在后文中，
只能使得基准电压在一个温度点上获得零温度系数的原因。 
 
267
8.2.2 
正温度系数电压 
如果两个同样的晶体管(IS1=IS2=IS，IS为双极晶体管饱和电流)偏置的集电极电流分别为
nI0和 I0，并忽略它们的基极电流，那么它们基极-发射极电压差值 ΔVBE为： 
BE
BE1
B",215
"温度系数的基准电压 
利用上面的正、负温度系数的电压，可以设计一个零温度系数的基准电压，有以下关
系： 
(
)
REF
BE
T ln
V
V
V
n
α
β
=
⋅
+
⋅
          
             (8-9) 
因为∂VBE/ ∂T ≈-1.5mV/℃，∂VT/ ∂T≈0.087mV/℃，因此令 α =1，只要满足式（8-10），便可
得到零温度系数的 VREF。 
(",175
"TAT）的
电流，再通过电阻将该电流转变为电压，并与双极型晶体管的 VBE相加，最终获
得和温度无关的基准电压。 
� 
通过运算放大器完成 VBE和 ΔVBE的加权相加，在运算放大器的输出端产生和温度
无关的基准电压。 
 
268
8.3.1 
利用 PTAT 电流产生基准电压 
1. 
电路结构和基准电压的生成 
在 8.2.2 中介绍了，如果两个双极晶体管工作在不相等的电流密度下，那么它们",193
"W
W
L
L
M
L
⎛
⎞
⎛
⎞
⎛
⎞
=
=
⋅
⎜
⎟
⎜
⎟
⎜
⎟
⎝
⎠
⎝
⎠
⎝
⎠
                  （8-12） 
使得 I1= I2= I3/ M，因此流过双极晶体管 Q1 和 Q2 的电流相等，进而 Q1和 Q2 基极-发射
级电压的差值为：ΔVBE=VTlnn，和绝对温度成正比。其中 n 是 Q1 和 Q2 管并联个数的比
值。另外，由于运算放大器",211
" 
 
(8-14) 
图 8- 2 中的 PTAT 电流生成电路可以很容易改为产生带隙基准电压的电路，如图 8- 3
所示。将 PTAT 电流 I3 流过电阻 R2，从而产生 PTAT 电压 I3·R2，再将这个电压加到双极
晶体管 Q3 的基极-发射极电压上，从而获得输出基准电压： 
2
REF
BE,Q3
T
1
ln
R
V
V
M
V
n
R
=
+⋅
⋅
⋅
       
 
 
(",184
"隙基准电压源的系统结构图 
图 8- 4 提供了图 8- 3 中带隙基准的方框图。其中 A1 是误差放大器，增益为 AV1；
B1 是 M5作为输入管，R1和 Q1 作为负载的共源极放大器，增益为 β1；B2是 M6 作为输入
管，Q2 作为负载的共源极放大器，增益为 β2；A2 是 M8作为输入管，R2和 Q3 作为负载
的共源极放大器，增益为 AV2。由图 8- 4 得到反馈环路的传递函数为：",195
"        (8-17) 
根据图 8- 3 中的电路图有以下关系：  
(
)
1
m5
1
Q1
g
R
R
β =
+
  
 
 
 
 
 
(8-18) 
2
m6
Q2
g
R
β
=
  
 
 
 
 
 
 
(8-19)  
 
271
其中，RQi 表示双极型晶体管 Qi 发射极对地的等效电阻，因为： 
1
1
2
1
ln
/
ln
T
T
Q
Q
C
T
V
V
R",151
"使得基准电压拥有零温度系数，需要满足
2
1
ln
17.2
R
M
n
R ⋅
⋅
=
，即为： 
1
2
17.2
ln
R
R
M
n
=
.  
 
 
 
 
 
 
(8-23) 
又因为 
M8
M5
W
M W
L
L
⎛
⎞
⎛
⎞
=
⎜
⎟
⎜
⎟
⎝
⎠
⎝
⎠
 
 
 
 
 
 
(8-24) 
因此， 
D8
D5
I
= M I
⋅
  
 
 
 
 
 
(8",190
"n
ln
18.2
1
ln
ln
A
A
g
R
R
R
R
M g
g
R
M
n
M
R
R
M g
g
R
M
n
M
n
M R
n
R
n
=
⋅
+
⎛
⎞
=
⋅
⋅
+
⎜
⎟
⎝
⎠
⎛
⎞
=
⋅
⋅
+
⎜
⎟
⎝
⎠
=
=
⋅
+
  
      
(8-28) 
综合考虑 MOS 管的热噪声和闪烁噪声。MOS 管沟道中存在的噪声电流的谱密度为： 
2
2
m
n,M",219
"益。因此，注意到 RQ1=RQ2=RQ，可计
算得到各个 MOS 管在输出端产生的噪声： 
(
)
REF
2
2
p
m3
2
m3
2
n,
2
2
M3,4
1
m1
m1
OX
3
1
4
ln
V
K g
g
R
V
kT
R M
n
g
g C
WL
f
γ
⎛
⎞⎛
⎞
=
+
+
⎜
⎟⎜
⎟
⎜
⎟⎝
⎠
⎝
⎠
 
 
 
(8-30) 
(
)
REF
2
2
n
2
n,
",199
"
+
⎜
⎟
⎜
⎟
⎜
⎟
⎝
⎠
⎝
⎠
 
 
(8-32) 
(
)
REF
2
2
p
m8
Q
2
n,
m8
2
M8
OX
8
4
V
K g
R
V
kT g
R
C
WL
f
M
γ
⎛
⎞⎛
⎞
=
+
+
⎜
⎟⎜
⎟
⎜
⎟⎝
⎠
⎝
⎠
  
 
 
 
(8-33) 
8.3.2 
在运放的输出端产生基准电压 
1. 
电路结构和基准电压的生成 
通过图 8- 6 中",218
"=
  
 
 
 
 
 
(8-34) 
根据 8.2.2 中的分析，Q1和 Q2 基极-发射极电压的差值为：ΔVBE=VTlnn，和绝对温度
成正比，其中 n 是 Q2 和 Q1管并联个数的比值。因此流过电阻 R2和 R3 的电流为 VTlnn/R3。
则运算放大器输出端的电压为： 
(
)
2
3
REF
BE,Q2
T
3
ln
R
R
V
V
V
n
R
+
=
+
⋅
 
 
 
 ",167
"和 Q2 构成的分压网络，增益为 β2。
由图 8- 7 得到系统的传递函数为： 
(
) (
)
1
REF
2
REF
V1
REF
X
V
X
V
A
V
β
β
+
−
−
⋅
−
−
⋅
=
⎡
⎤
⎣
⎦
       
    (8-36) 
 
274
 
图 8- 7 带隙基准电压源的系统结构图 
 
因此，当误差放大器的增益足够大时： 
(
)
V1
V1
REF
V1
1
2",177
"osed-loop
3
Q
Q
1
2
2
3
Q
1
Q
2
3
Q
1
Q
3
Q
1
Q
2
3
Q
Q
2
3
Q
1
Q
2
2
1
3
Q
1
3
Q
Q
2
Q
3
Q
Q
2
3
Q
1
Q
1
3
1
1
A
R
R
R
R
R
R
R
R
R
R
R
R
R
R
R
R
R
R
R
R
R
R
R
R
R
R
R R
R R
R R
R
R R
R R
R
R
R
R
R
R
",188
"
275
3
T
T
T
Q
C
BE
3
T
3
ln
/
ln
R
V
V
V
R
I
V
R
V
n R
n
=
=
=
=
Δ
  
 
 
 
(8-42) 
(
)(
)
2
3
Q
1
Q
closed-loop
1
2
1
3
3
3
2
3
1
18.2
18.2
1
ln
ln
17.2
1
ln
18.2 18.2
1
ln
ln
17.2
1
ln
18.2
1
1
ln
",154
"同误差放大器时，误差放大器在第二种结构中产生更大的输出噪声。 
 
图 8- 8 带隙基准电压源的电路实现 
 
图 8- 8 给出了图 8- 6 中带隙电压基准的电路实现。为了计算带隙基准的输出噪声，
需要将各个 MOS 管产生的噪声，等效到误差放大器的输入端，再乘以式(8-43)计算出的
系统增益。各个 MOS 管在输出端产生的噪声： 
(
)
REF
2
2
p
m3
2
m3
n,
2
2",201
"
WL
f
n
n
γ
⎛
⎞⎡
⎤
⎛
⎞
=
+
+
⎜
⎟
⎜
⎟
⎢
⎥
⎜
⎟
−
⎝
⎠
⎣
⎦
⎝
⎠
     
(8-45) 
(
)
(
)
REF
2
2
p
2
n,
M5
m5
OX
m0,1
o0
o4
5
1
1
18.2
1
4
1
//
ln
17.2
ln
V
K
V
kT
g
C
WL
f
g
r
r
n
n
γ
⎛
⎞⎛
⎞ ⎡
⎤
⎛
⎞
=
+
+
⎜
",228
"
⎜
⎟
⎢
⎥
⎜
⎟
⎜
⎟
−
⎝
⎠
⎣
⎦
⎝
⎠
⎝
⎠
(8-47) 
8.3.3 
两种结构的性能比较 
在 8.3.1 和 8.3.2 中介绍了两种常用的带隙电压基准的结构。虽然它们都能提供和温
度无关的基准电压，但是在驱动能力和噪声方面各有优劣。 
1. 
驱动能力 
    8.3.1 中的电路不能直接为后续电路供电流，需要在带隙电压基准和后续电路中间加
入缓冲器（Buffe",240
"。因此使用该种带隙电压基准结构，必须同时使用缓冲器将带隙电压基准隔离。 
2. 
面积 
8.3.2 在中介绍的带隙电压基准，需要使用 3 个电阻，并且在双极晶体管 Q1和 Q2 管
并联个数的比值 n 较小的情况下，需要更大阻值的 R1 和 R2电阻。由于 CMOS 工艺的特
性，无源电阻会消耗较多的芯片面积，因此 8.3.2 中的结构比 8.3.1 中的结构需要更多的
芯片面积。 
3. 
噪",213
"- 9   带隙基准电压源电路实现 
图 8- 9 给出了 8.3.1 中带隙基准的电路实现结构。其中 M0~M4 管构成误差放大器，
用来使 X 和 Y 节点拥有相同的电位。M7 和 M9管为误差放大器提供偏置电压。表 8-1 给
出了 MOS 管、电阻和双极型晶体管的初始参数设置。 
表 8- 1  带隙基准电压源器件参数设置 
MOS 管 
Instance Name 
Model
W
L ",186
"M4 
mp 
1.1u
550n 
1 
st02 
mp 
symbol 
M5 
mp 
1.1u
550n 
1 
st02 
mp 
symbol 
M6 
mp 
1.1u
550n 
1 
st02 
mp 
symbol 
M7 
mp 
1.1u
550n 
1 
st02 
mp 
symbol 
 
278
M8 
mp 
1.1u
550n 
1 
st02 
mp 
sy",111
"-- 
-- 
--
1k 
1 
analogLib 
res 
symbol 
双极型晶体管 
Instance Name 
Model
W
L 
Multiplier 
Library Name 
Cell Name 
View Name 
Q1 
qvp5 
-- 
-- 
7 
st02 
qvp5 
symbol 
Q2 
qvp5 
-- 
-- 
1 
st02 
qvp5 
sy",91
"比例
为 7:1:1。 
选择双极晶体管 Q1，点击快捷键“q”，弹出“Edit Object Property”对话框。如图 8- 10
所示。在图 8- 10 所示的对话框中，在“Multiplier”栏将 Q1 管的并联个数设置为 7 个。为
了方便观察电路结构，可以在“Multiplier”栏后的下拉菜单中选择“both”选项，这将在电
路图中显示双极晶体管的并联个数，如图 8- 11 所",166
"因为 M5、M6和 M8拥有相同的宽长比，式(8-15)中的 M =1。根据 8.2.3 中的分析，
为了获得零温度系数的带隙电压基准，电阻 R1和 R2 需要满足下面的关系 
2
1
17.2
8.83
ln 7
R
R ≈
=
 
                       
(8-48) 
令 R1=26kΩ，则 R2=230 kΩ。依此数据设置电路中的电阻值。在电路图中选择电阻
R1，点",170
"
路仿真和优化。 
1. 
设置模型库文件 
首先在“Tools”下拉菜单中选择“Analog Environment”命令，打开 ADE 窗口。在 ADE
窗口中，首先在“Setup”下拉菜单中选择“Model Libraries”添加模型的库文件。如图 8- 14
所示。完成库文件设置后的“Model Library Setup”窗口如图 8- 15 所示。 
2. 
设置仿真类型和范围 
在",135
"示。 
 
 
图 8- 13  电阻 R2的参数设置 
 
281
 
 
图 8- 14 在 ADE 窗口中添加模型的库文件 
 
 
图 8- 15 完成设置后的“Model Library Setup”窗口 
 
 
282
 
图 8- 16 完成设置后的“Choosing Analyses”窗口 
3. 
设置仿真结果输出 
在 ADE 窗口中，选择“Outputs”下拉菜单，选择“T",123
"度的升高而下降。这表明
基准电压中的正温度系数过小。从前面的分析中可以得出这是由于 R2/R1 的值过小造成
的。 
 
 
图 8- 17  在 ADE 窗口中选择输出信号 
 
283
 
 
图 8- 18  “dc”温度扫描结果 
8.4.5 
使用“Parametric“分析，寻找合适的 R2、R1电阻比值 
为了能更快的找出合适的 R2/R1 比值，可采用“Parametric”分析。",167
"30k”
改为“res”，如图 8- 19 所示。 
在 ADE 窗口中，选择“Variable”下拉菜单中的“Copy From Cellview”选项。在 ADE
窗口的“Design Variable”栏中将出现“res”项。如图 8- 20 所示。双击“Design Variable”栏中
的“res”项，将弹出“Editing Design Variables”窗口，在该窗口右边的“Ta",123
"1 给电路图中的变量赋值 
 
285
 
图 8- 22  选择参数分析 
2. 
设置“Parametric Analysis” 
在 ADE 窗口中，选择“Tools”下拉菜单中的“Parametric Analysis”命令，打开
“Parametric Analysis”窗口，如图 8- 22 所示。 
在“Parametric Analysis”窗口中选择“Setup”下拉菜单中的“P",115
" 24  选择“Sweep1”的扫描变量 
“Sweep1”的扫描范围为 230kΩ~460kΩ。“Total Step”设置为“5”。完成设置后的
“Parametric Analysis”窗口如图 8- 25 所示。 
 
286
 
 
图 8- 25 完成设置后的“Parametric Analysis”窗口 
在“Parametric Analysis-spectre”窗口选择“Anal",114
"随温度的升高而升高。因此 R2 合适的阻值在 402k~460k 的范围内。
再次运行“Parametric Analysis”仿真，将“res”的扫描范围设置为 402kΩ~460kΩ。这时得到
的仿真结果如图 8- 27 所示。 
 
287
 
图 8- 27 再次运行“Parametric Analysis”的仿真结果 
观察得到当 R2 电阻为 416.5kΩ 时，基准电压有最好的温度特",161
"0000   (8-49) 
1. 
“Calculator” RPN（逆波兰)模式回顾 
在“RPN”模式中，一些函数或操作符同时作用于缓存和堆栈中最上层的表达式。对
于这些函数或操作符而言，堆栈中的表达式永远在缓存中表达式的左边，具体内容见表
8-2。在表 8- 2 中，堆栈中最上层表达式用“stack”表示，缓存中的表达式用“buffer”表示。 
表 8- 2 各个计算符号下缓存和堆栈的运",182
"果中包
含有多组数据时，可以将其全部选中。因为基准电压的温度系数是通过 dc 仿真获得的，
因此在“Calculator”的数据选择模式中选择“swept_dc”；因为需要得到的是电压信号，因
此进一步选择“vs”。在电路图中选择“VREF”端，此时“dc”扫描产生的“VREF”端的电压
数据被输送到“Calculator”的缓存中，如图 8- 28 所示。 
 
 
图 8- 28 通过“Cal",157
"culator”缓存右端的“
”按键，将显示堆栈中的数据。如图 8- 30 所示。 
 
289
 
图 8- 30 再次通过“Calculator”选择仿真结果“VS(“/VREF”)”，并显示堆栈中的内容 
在“Calculator”的函数窗口中选择并点击“ymin”函数对“VS(“/VREF”)”进行操作。处
理后的数据表达式在“Calculator”的缓存中显示，如图 8- 31 所示。 ",136
"age”函数对“VS(“/VREF”)”进行操作。结果如
图 8- 33 所示。 
 
 
图 8- 33 对“VS(“/VREF”)”求平均值 
在“Calculator”的缓存中，紧接着表达式“average(VS(“/VREF”))”直接键入
“*125”，其中“125”是扫描的温度范围，“*”表示乘法。注意：这里不要点击“Calculator”
键盘中的乘号（“×”)，因为这会将缓存中的数",150
" 缓 存 中 ， 紧 接 着 表 达 式 “(ymax(VS(""/VREF"")) 
-ymin(VS(""/VREF"")))/(average(VS(""/VREF""))*(125))”直接键入“*1000000”，“*”表示
乘法，结果如图 8- 36 所示。 
 
 
图 8- 36 编辑好的温漂系数计算公式 
点击“
”，在弹出的“Display Results”对话框中（如下图所示)选择“Va",133
"esults Display Window”窗口显示了两列数据，分别是变量“res”的值，和带
隙基准电压源温度系数。可以看出当 R2 电阻的阻值为 416.5kΩ 时，带隙基准电压源
有最小的温漂系数。32.6832ppm/℃。 
为了下次能直接调用带隙基准电压温度系数的计算公式，需要将编辑好的表达
式保存。在“Calculator”中的“Memories”下拉菜单，选择“Table”�“New",167
"pm”，完成对表达式的命名。结果如图
8- 40 所示。点击“OK”或者“Apply”保存设置。 
 
293
 
 
图 8- 40 完成设置后的“Memory Editor”窗口 
通过上述的操作，带隙基准电压温度系数的计算公式被保存到“Calculator”的存
储器中。但是当退出“Calculator”后，存储器中的内容将被清空，因此为了能在下一
次的仿真中调用该计算公式，还需要将存储器中",152
"读取保存的文件，即可以获得计算“ppm”的表达式。（具体操作请参
考附录 D。） 
 
294
 
 
 
图 8- 42 完成设置后的“Save”窗口 
8.4.7 
利用“Optimizer”进一步优化带隙基准电压源的温度特性 
通过上面的方针可以发现，当 R2 电阻阻值为 416kΩ 时，带隙基准电压源的温度特
性接近全局最优。此时可以通过软件“Optimizer”来进行最后的优化，从而提高",167
"添加优化对象 
在弹出的“Adding Goals”窗口中设置优化对象。在这里将带隙基准电压源的温漂系数
作为优化对象。因此在“Name”栏中填入“ppm”，如图 8- 45 所示。 
优化对象的表达式通过“Calculator”获得。首先点击“Calculator”栏中的“Open”命令打
开“Calculator”。在“Calculator”中，在“Memories”下拉菜单中选择“Selec",136
"到“Expression”栏中，如图 8- 45 所示。 
 
 
图 8- 45 将“Calculator”中的表达式拷贝成优化对象的表达式 
因为带隙基准电压源的温漂系数越小越好，因此将“Direction”设置为“minimize”。因
为是寻找最小的温漂系数，因此在“Target”填入“12”，远小于“Parametric Analysis”仿真中
的最优结果“32.6832”。在“Acc",144
"Edit…”命令，如
图 8- 47 所示。 
 
296
 
 
图 8- 47 在“Optimizer”中添加变量 
在弹出的“Editing Variable”窗口的“Name”栏中选择变量“res”。根据 3.2.8 中的仿真结
果。R2电阻的最优值在 402kΩ~431k Ω 之间。因此在“Initial Value”栏中填入“416.5kΩ”；
在“Minimum Value”中填入“",134
"timizer”窗口如图 8- 49 所示： 
 
 
297
 
图 8- 49 完成设置后的“Optimizer”窗口 
由于在测试时优化算法“CFSQP”没有成功优化，因此将优化算法改为“LSQ”。（两种
算法的区别请参考附录 F）具体方法如下，在“Analog Circuit Optimizer”的“Session”下拉
菜单中选择“Options”命令，如图 8- 50 所示。 
 
 ",133
"中的“Run”命令，开始优化，如图 8- 52 所示。优化结果如
图 8- 53 所示。 
 
 
298
 
 
图 8- 52 运行“Optimizer” 
 
 
图 8- 53 优化历程 
在“Analog Circuit Optimizer”窗口的“Results”下拉菜单中选择“Update Design”命令，
如图 8- 54 所示。将优化后的变量值返回到 ADE 窗口的设置中。 ",132
"益如式（8-28）所示，当
M=1 时有： 
2
total
1
1
ln
R
A
R
n
=
+
  
 
 
 
 
(8-50) 
在 M1的栅端和 Q2 的发射极之间加入电压源“V1”。修改后的电路图如图 8- 56 所示。
ADE 窗口中，双击“Analysis”中的“dc”分析，如图 8- 57 所示。 
 
300
 
 
图 8- 56 加入测试电压源 V1后的电路图 
 
 
图",155
"t Parameter”对话框，在该对话框中选择“dc”，如图 8- 
 
301
59 所示，点击“OK”完成选择。 
回到“Choosing Analysis”窗口中，在“Sweep Range”栏中填入扫描范围“-2m~2m”，这
是因为该电压过大将影响电路的直流工作点。完成设置后的“Choosing Analysis”窗口如图
8- 60 所示，点击“OK”或者“Apply”保存设置。点击",135
"
 
图 8- 61 仿真结果 
在“Waveform”窗口中，点击快捷键“d”，调出“差值光标”。（关于“差值光标”和
 
303
“Waveform”的具体操作请参考附录 C。）将红色光标移动到仿真结果曲线的左端，蓝色
光标移动到右端。在“Waveform”窗口的下端有四个小窗口，依次给出“红色光标的 XY 坐
标”， “蓝色光标的 XY 坐标”，“两个光标间的 XY 坐标的差值”以及“斜率”",187
"为 181.54kΩ，获得最小的温漂系数。
在此双极型晶体管个数和 R1、R2 电阻值的设置情况下，重复上述步骤，得到的仿真结果
如图 8- 63 所示。 
可以看出此时的闭环增益为 6.36，与 R2/R1=181.54k/26k=6.98 非常接近。对比两次
仿真的结果，可以发现带隙基准电压源的闭环增益与 R2/R1的比值成正比，与 Q1双极型
晶体管的并联个数成反比。
 
 
图 8- 62",195
"es”下拉菜单中选择“Choose”命令。在弹出的“Choosing 
Analyses”窗口的“Analysis”栏中选择“noise”；“Sweep Variable”栏选择“Frequency”；“Sweep 
Range”栏中填入扫描范围为“20~100k Hz”。 在“Output Noise”下拉菜单中选择“Voltage”；
点击“Positive Output Node”后的“Se",107
"0”。完成设置后的“Choosing Analyses”窗口如图 8- 64 所示。点击“OK”或
者“Apply”保存设置。返回到 ADE 窗口中。点击快捷键“
”运行仿真，如图 8- 65 所示，
仿真结果如图 8- 66 所示。 
 
305
 
 
图 8- 64 在“Choosing Analyses”窗口中完成对“noise”分析的设置 
 
 
图 8- 65 完成“noise”分析",134
"ated noise”；“noise unit”栏的下拉菜单
中选择“V”；积分范围设置成“20~100k Hz”；在“FILTER”栏中选择“Include All Types”；
将“TRUNCATE & SORT”中的“top”栏改为“20”，表示显示头的 20 个噪声源；保持“sort by”
栏中的“noise contributors”选项，表明是按噪声贡献大小排序。完成上述设置的“N",128
"见表 8- 3，噪声类型
见表 8- 4。 
表 8- 3 输出噪声表格栏的意义 
Device 
器件编号 
Param 
噪声类型 
Noise Contribution 
所产生的噪声大小 
% of Total 
在全部噪声中所占的百分比 
表 8- 4 噪声类型 
fn 
MOS 管闪烁噪声 
id 
MOS 管热噪声 
rn 
电阻热噪声 
ib 
双极型晶体管基极电流散粒噪声 
ic",171
"将“Apply To”栏的第一个下拉菜单更改为“all 
selected”，使得修改的器件参数应用于所有选中的器件。将“Length”增加到“10u”；“Finger 
Width”增加到“100u”；将“Fingers”增加到 2。完成参数修改的“Edit Object Properties”窗口
如图 8- 69 所示。点击“OK”或者“Apply”保存设置。 
 
308
 
 
图 8-",121
"M1 的闪烁
噪声占总输出噪声的 86.09%。根据 4.2 中的验证，为了降低输出总噪声，可以增加双极
型晶体管 Q1的并联个数，减少 R2/R1的比值。当调整 Q1的并联个数到 47，R2的电阻值
为 181.54kΩ 后，再次运行仿真。此时输出噪声如图 8- 71 所示。 
 
 
309
 
图 8- 70 修改 M0和 M1宽长比后的输出噪声 
 
 
图 8- 71 修改双极型晶体管 ",188
"
输出噪声，如表 8- 5 所示。 
表 8- 5 两种器件参数下的输出噪声 
器件 
噪声类型 
n=7, R2=414.8k 
n=47, R2=181.54k 
比值 
M0 
fn 
0.000632883 
0.000232465 
2.7225 
M1 
fn 
0.000635013 
0.000231187 
2.7468 
M0 
id 
0.000179053 
7.10294",134
"此在上表中，电阻 R1 在两种电路设置下产
生的热噪声的比值，与对应的闭环增益的比值相同。这与理论分析的结果相符，证明了
带隙基准电压源输出噪声计算公式的正确性。 
因为 M0 和 M1 管的闪烁噪声仍然占较大的比重。因此增加 M0 和 M1 管的面积是有
效降低总输出噪声的方法。将 M1和 M0管的“Length”增加到“30u”；“Finger Width”增加
到“100u”；将“Finge",189
"1 管的热噪声和闪烁噪声对总输出噪声的贡献基本一致。因此可以通过
减少 M0 和 M1 管的热噪声的方法，减少带隙基准电压源的输出噪声。由 4.3.3 得到，当
M0 和 M1 管的跨导（gm）增大时，其热噪声对输出噪声的贡献减小。根据 MOS 管跨导
的计算公式： 
饱和区 
： 
(
)
m
D
OX
2
/
g
I
W L
μC
=
  
 
 
 
 
(8-51) 
亚阈值区： 
(
)",211
"器件的直流工作点。在 ADE 窗口的“Tools”下拉菜单中选
择“Results Browser…”命令，启动“Results Browser”，如图 8- 73 所示。 
 
 
图 8- 72 调整 M0 和 M1 管宽长比后的输出噪声 
 
311
 
 
图 8- 73 在“Results Browser”中选择“dcOpInfo-info” 
为了查看 M2管的工作区域。因此在“Res",129
" 8- 74 选择“M2”管 
 
312
 
图 8- 75 选择“region”，并将其数值以表格的形式输出 
 
 
图 8- 76“M2”管的工作区域 
“region”中的数字和 MOS 管工作区域的对应关系如表 8- 6。 
表 8- 6“region”所代表的工作区域 
0 
截止 
1 
线性区 
2 
饱和区 
3 
亚阈值区 
 
因此，在上述电路设置中 M2 管工作在线性区。",156
" VGS，M2，需要增加 M9 管的宽长比。在保持 M9 管栅长不
变的基础上增加 M9管的栅宽，既增加了 M9管的宽长比，减小了 M2管的栅源
电压 VGS，M2，同时也减小了 M9 管的闪烁噪声。 
2） 根据 KCL 定理和 M5、M6 的镜像关系，流过双极型晶体管 Q2 的电流等于 M5
和 M6 管的漏源电流。由于增大 Q2 管的发射极-基极电压 VBE，Q2 需要增加流过
Q2 的电流",205
" M0和 M1 管的闪烁噪声 
上述的三种方案都可以让 M2 管工作在饱和区的同时，减小带隙基准电压源的输出
噪声。因为单独采用一种方案，需要大幅度的修改器件参数，因为这里同时采用三种方
案，使器件的参数取值在一个合适的范围。修改后的器件参数如表 8- 7。 
表 8- 7 修改后的带隙基准电压源器件参数及修改原因 
MOS 管 
Instance Name 
Model
W 
L 
Multip",183
"小栅源电压 
电阻（为了设计简化，这里使用了理想电阻） 
Instance Name 
Model
W 
L 
Resistance 
Multiplier 
修改原因 
R1 
-- 
-- 
-- 
6.5k 
1 
增加流过 M5、M6管的电流；增加 Q2的发
射极-基极电压；减小电阻的热噪声 
R2 
-- 
-- 
-- 
34.21k 
1 
根据 R1的阻值，获得最佳的温度特性 
双",152
"基准电压源器件参数整体调整后的 M2管的工作区间 
在该器件参数设置下，带隙基准电压源输出电压的温度特性和输出噪声如图 8- 78
和图 8- 79 所示。 
 
314
 
图 8- 78 带隙基准电压源器件参数整体调整后的输出电压的温度特性 
 
图 8- 79 带隙基准电压源器件参数整体调整后的输出噪声 
输出噪声大小为 100.702μV。此时 M0、M1管的闪烁噪声和热噪声以及 M2管的",198
"k Ω。最终的输出
电压温度特性和输出噪声如图 8- 81 和图 8- 82 所示。温漂系数为：16.75ppm/℃。
 
图 8- 80 调整 M2管并联个数后的输出噪声 
 
图 8- 81 再次优化 R2电阻值后的输出电压温度特性 
 
316
 
图 8- 82 再次优化 R2电阻值后的输出噪声 
8.4.10 小结 
在这个实例中，着重突优化了带隙电压基准的输出噪声和温度特性，并没有考虑",192
"
虽然设计软件可以辅助电路的设计和优化，但是只有对电路结构充分了解，才能找
出最佳方案，同时提高电路的多个性能。 
 
8.5 超低温漂带隙电压基准 
8.5.1 
设计目标 
前面已经介绍了低噪声带隙电压基准的设计。在实际应用中还有一类应用中最为关
注的指标是温漂系数。以下就介绍一个超低温漂电压基准的设计。 
设计参数指标如下： 
PSRR:   
大于 80dB@1000Hz 
温漂: 
 
",200
"数是 Q2的 n 倍，
因而在 R3 上产生了只和温度相关的电压 VR3=VTlnn。 
VT和绝对温度成正比，是一个正温度系数的电压，而 VBE电压是一个负温度系数的
电压。输出电压是这两个电压的线性组合。 
(
)
2
3
REF
BE,Q2
T
3
ln
R
R
V
V
V
n
R
+
=
+
⋅
 
 
 
 
 
(8-53) 
由于 VT是一个一阶温度系数的电压，通过精确调整 R2/R",176
"BE
r
G
r
r
r
C
r
(
)
ln
ln
(
)
I
T
kT
T
kT
V
T
V
T
V
T
V
T
T
q
T
q
I
T
η
⎡
⎤
⎛
⎞
⎛
⎞
⎛
⎞
⎛
⎞
=
+
−
−
+
⎡
⎤
⎜
⎟
⎜
⎟
⎜
⎟
⎜
⎟
⎢
⎥
⎣
⎦
⎝
⎠
⎝
⎠
⎝
⎠
⎝
⎠
⎣
⎦
  (8-54) 
其中，电场因子 η 是由工艺决定的常数，Tr是一个给定的常数温度。因为 IC与",252
"
 
 
 
 
 
 
 
 
 
 
 
 
 
(8-55) 
最后一项是 TlnT 项的非线性的分量，所以在一阶补偿之后仍然存在。在大部分工艺
下，由于工艺参数 η 的值和由电阻引入的系数 δ 不能很好抵消，最后无论如何调节电流
和电阻配比，温度系数都不能达到足够的精度。 
为了得到温漂系数足够低的带隙电压基准，高阶温度系数需要进一步的补偿。补偿
的方法是采用如图 8- 85 中给出的电路",195
" 和 Q2端提供一个 TlnT 项电
压差值，并将这个差值项引入到输出端，修正输出电压的温度系数。 
 
319
 
图 8- 85 高阶温度补偿的 Bandgap 电路结构 
温度补偿的方法如下：假设 A2 的增益足够大，那么 VR4=VBE2，因此经过电流镜镜
像之后，在 Q2 和 Q3 之间将产生一个 TlnT 项的电压。假设这个电压为 C1
.TlnT；另外在
Q2 和 Q3 的电压差中含",183
"56) 
其中，gM1和 gM2 分别表示 A1 运放两个输入对的跨导。在这些参数中，常数 C1 和 C2由
电阻的阻值、温度系数以及几个三极管的 VBE电压控制；gM1和 gM2 的比例则由 2 个输入
对的工作点和宽长比决定。实际制造中，电阻的温度系数一般不能自由选择，所以 C1
和 C2 可以通过调节 R4 来控制，同时 gM2/gM1也可以通过运放的设计人为控制。 
需要注意的是 gM2/",183
"anager”中选择建立新的“Library”选项，如图 8- 86 所示。在弹出的
 
320
“New Library”对话框中，输入库名 BG，如图 8- 87 所示，点击 OK。弹出的“Technology 
File for New Library”对话框询问是否需要附加到一个 Tech File 上，选择第二个选项：
“Attach to an existing techfile”，如",107
"V 工艺库，
库名是“st02”，如图 8- 89 所示。 
 
321
 
图 8- 89 选择 Technology Library 
选择 OK 后在 CIW 窗口中将会显示“attach”是否成功，如果成功就可以进入下一步
操作。 
现在，在“Library Manager”中选定新建的库 BG，在菜单中选择新建“cell view”，如
图 8- 90 所示。 
然后就会弹出设定“Cel",124
"图 8- 90 从菜单建立新的 View 
 
图 8- 91 设定 View 的名称和类型 
 
322
 
图 8- 92 电路编辑器 
2. 
电路的绘制和初始参数的设定 
1) 
器件的选用 
采用和低噪声带隙电压基准的例子中介绍的类似的方法，选用适当的元器件来搭建
这个电路。其中使用的器件类型如表 8- 8 所示。 
表 8- 8 使用器件的类型 
器件 
Library 
Cell N",162
"- 93 所示的电路结构： 
 
323
 
图 8- 93 电路结构图 
3) 
设定电流镜初始宽长比 
为了方便设计，减少不必要的仿真，电路中 MOS 管的初始宽长比都要根据计算设
定。出于功耗考虑，设定电流镜中的电流为 0.3µA。在这个电路中没有画出提供基准电
流的电路，而采用了理想电流基准作为输入的基准电流。图中 MN0 和 MP0 所在支路的电
流就是由理想电流源提供的。NMOS 管中",193
"，并点击快捷键“q”，在弹出的属性对话框中修改。
例如 MN0管就输入：“Length: 5u，Width: 8u, Multiplier: 1”，如图 8- 94 所示。 
其它电流镜 MOS 管都以这几个管子为标准，修改它们的“Multiplier”，以调整流过
的电流。“Multiplier”就是并联的 MOS 管数。在一个支路中如果将电流镜的“Multiplier”
都改为 N 则该电流镜",141
"值为“res6”，仿真时可以设定“res6”的一个更大的
初始值，例如 3MΩ，以保证 MN0初始状态工作在饱和区，如图 8- 95 所示。同理，R5 的
阻值为“res5”，仿真时初始设定为 2MΩ。 
 
324
 
图 8- 94 设定 MN0的参数 
 
图 8- 95 给 R6 电阻设定阻值 
4) 
四输入运放初始宽长比的讨论 
首先是四输入运放。这个运放由图 8- 96 中阴影的部分",171
"
L
I
μ
μ
=
=
⋅
 
  (8-57) 
这也就表示 2 个输入对管宽长比、电流镜中 MOS 管宽长比都必须成精确比例。由
于单个 MOS 管在不同的工艺角下长、宽的偏差是不同的，最可靠的比例关系来自倍乘
数(Multiplier)。所以为了方便仿真，可以用参数来表示倍乘数。特别是在 MP12、MP13 和
MP14、MP15 的倍乘数分别设定为 N1 和 N2，且两对输入管的电流镜偏",182
"管
流入的电流总共有(N1+N2)IBIAS，MN1 和 MN2 的总对地电流为 2(N1+N2)IBIAS，因而 MP1、
MP2、M'P1、M'P2、M'N1、M'N2 应当分别流过(N1+N2)IBIAS/2 的电流。为了保证电流精确，
MOS 管被尽量设置为电流镜中的 MOS 管尺寸。综合考虑，MOS 管参数设定如表 8- 9
所示。 
表 8- 9  4 输入端运放 MOS 管参数设置 ",172
" 
symbol 
M’
P9 
mp 
8u 
1.5u 
N2 
st02 
mp 
symbol 
MP12 , MP13 
mp 
15u 
5u 
N1 
st02 
mp 
symbol 
MP14 , MP15 
mp 
15u 
5u 
N2 
st02 
mp 
symbol 
MN1 , MN2 
mn 
8u 
5u 
N1 +N2 
st02 
mn 
symbol 
M’",106
"ectre”会自动对其取整，所以可以使用
(N1+N2)/2 这样的倍乘数，如图 8- 97 所示。 
 
 
图 8- 97 设定 MN1 管的参数 
 
327
5) 
双端输入运放的设定
 
 
图 8- 98  双端输入运放的位置 
双端输入运放的位置如图 8- 98 中阴影的部分所示。由于这个运放只有一级，结构
又和四输入运放相似，而且可以利用已有的共栅管栅压，所以设计相对简单。采用和四",173
"M’
P10 
mp 
8u 
1.5u 
2 
st02 
mp 
symbol 
MP16 , MP17 
mp 
15u 
5u 
2 
st02 
mp 
symbol 
MN3 , MN4 
mn 
8u 
5u 
2 
st02 
mn 
symbol 
M’
N3 , M’
N4
 
mn 
8u 
1.5u 
1 
st02 
mn 
symbol 
MP3 , MP4 
mp 
",110
"、R2、R3、R4 电阻的阻值和双极晶体管的电流直接相关。假设 Q1、Q2 的中的电
流约为 600nA。那么 Q2管上流过的电流可以用下式表示： 
 
328
Q1
Q2
3
kT ln
N
I
I
q
R
=
=
 
 
 
 
 
 
(8-58) 
所以，R3≈90kΩ，在电路中将 R3 的阻值设定为 90kΩ。R1 和 R2 的阻值分别设定为
“res1_2”，初始值根据 Razavi[",169
"管 
Instance Name 
Model
W 
L 
Multiplier 
Library Name 
Cell Name 
View Name 
MN5 
mn 
5u 
5u 
1 
st02 
mn 
symbol 
MP5 /MP6 
mp 
8u 
3u 
2 
st02 
mp 
symbol 
M’
P5 /M’
P6 
mp 
8u 
1.5u 
2 
st02 
mp 
",94
"
3. 
电路仿真 
电路仿真的目的主要是在结构确定好的前提下，对电路中器件的参数进行微调，以
达到需要的性能。下面是对这个电路的仿真过程 
1) 
启动仿真器并进行基本设定 
(1) ADE 的启动 
在电路图编辑窗口中选择“Tools”�“Analog Environment”，如图 8- 99 所示，弹出的
ADE 窗口如图 8- 100 所示。 
 
329
 
图 8- 99 ADE 的",155
"工艺中需要的几个模型，如图 8- 102 所示。一般当 PDK 安装正常，
而且库已经连接（attach）了“st02”工艺库时，ADE 启动后可以自动设置好所需模型。 
 
图 8- 102 选择需要添加的模型库 
(3) 设置变量 
在 ADE 中设置电路中的变量。在菜单中选择“Variables”�“Copy From Cellview”
获得电路图中的变量列表，如图 8- 103 所示。对",146
"les”对话框中依次设定各个变量的初始值如图 8- 106 所示。
完成变量初始值设定后开始电路的仿真和优化。 
 
图 8- 105  变量编辑框 
 
图 8- 106  变量的初始值 
2) 
通过仿真调节电流镜工作点 
共源共栅电流镜中，为了保证电流基准的稳定和精确，必须保证共源管的 VDS电压
 
332
足够高。同时为了降低最低输入电压，VDS电压又不能太高。一般来说大于 0.3V～0",192
"1 管 DS 两端之间的电压，可以用以下的方法设
定。在 ADE 中选择菜单中的“Output”�“Setup”，如图 8- 108 所示。 
点击输出设定对话框中的“open”，打开计算器(Calculator)。在计算器中依次点击
“swept_dc”和“vs”选项（图中高亮的部分)，打开结点选择模式。这个模式表示从电路图
中手动选择节点，计算器将得到这一点的直流扫描电压的表达式，如图 8- ",162
"
结点的名字。“VS”表示求结点直流扫描电压的函数。 
回到输出设定对话框，点击其中的“Get Expression”按钮，计算器中的公式就会被复
制到“expression”一行。如果需要的话，可以给这个表达式加一个名字，比如说 VDS_P。
 
333
这个表达式设定好后，点击“Apply”，新表达式就成为一个输出, 如图 8- 110 所示。 
 
图 8- 108  输出设定对话框 
 
",144
"够正好保持在 0.3～0.35V 之间。 
注意：在一项仿真结束后，为了方便以后调用，将现在的 ADE 仿真设置保存为一
个“state”, 如图 8- 112 所示。以后如果需要再进行这项仿真就可以直接调用这个“state”，
这样可以节省大量时间。 
 
图 8- 112  保存上述 state 
采用类似的方法，也可以通过 MN0管的 VDS电压扫描确定 R6 的阻值。如果希望 MN0
管的",161
"防止原始设计丢失的糟糕情况。 
 
335
 
图 8- 113  需要接地的输入端（图中的叉号) 
 
图 8- 114  运放输入接地后的电路 
然后仿真电路的静态工作点。在 ADE 中选择仿真类型的对话框中选择下列选项，
如图 8- 115 所示。 
 
336
 
图 8- 115  仿真直流工作点 
点击
开始仿真。仿真完成后观察哪些管子工作在不正常的状态。可以在 ADE 的
菜单中选择",174
"的信息；也可以标
注 DC 结点电压(DC Node Voltages)，显示的是各个结点的电压。瞬态仿真之后也可以将
最终时刻的状态标注工作点(Transient Operating Points)或节点电压(Transient Node 
Voltages)。 
 
图 8- 116  标注子菜单 
这时再看电路图中标注出了各器件上的重要参数，例如 MOS 管就标注了 IDS、VGS、
VDS",132
"略计算过了 R3 电阻和 R1、R2 电阻 res1_2 的初始值为 744kΩ。现在要进
一步调整 R1 和 R2 的电阻到最优值。首先在原电路的基础上将用于高阶温度补偿的一个
输入对的信号接地，也就是图 8- 117 中用○
╳符号标注出来的两个信号。修改后的电路如
图 8- 118 所示。 
 
图 8- 117  电路中接地的两个结点 
 
图 8- 118  修改后的电路结构 
修改好电",178
" Schematic”，如图 8- 120 所示，
然后在电路图中点击 VREF节点，VREF就被加入到了输出的列表中。 
 
图 8- 120  Select On Schmatic 菜单选项 
 
339
另外就是在整个温度域内的温度漂移表达式，参照低噪声带隙电压基准例子中的介
绍的方法加入总温漂表达式表达式作为输出。如图 8- 121 所示，该表达式为： 
(ymax(VS(""/Vref"")",158
"E项的温度系数为负，第二项温度系数为正。所以应当提高 R1和 R2 的电阻。 
图 8- 122 显示 R1、R2 的电阻不足，因而需要采用参数扫描对 R1、R2的阻值进行选
择。在 ADE 窗口中选择菜单“Tools”�“Parametric Analysis”，如图 8- 123 所示。 
 
图 8- 122  输出电压 vs. 温度 
 
 
340
图 8- 123  选择参数分析 
在",155
"范围为 0.94MΩ～1.12MΩ，再进行一次参数分析。如图 8- 126 所示,结果显示
在 res1_2=1.03MΩ 的时候可以得到最小的温漂，大约 20ppm/℃。将现在 ADE 的设置保
存为 temp，后面还会用到。 
 
 
341
图 8- 126  第二遍参数扫描结果 
5) 
调节双端输入运放 
调节的方法和四输入运放差不多，也是在输入被接地的情况下进行工作点分析，观
察电路的",175
"是 
4
BE2
/ Q2
1M
R
V
I
=
≈
Ω  
 
 
 
 
(8-61) 
正好是 R4 的初始值。所以原来设定的 R4 初始值是比较合适的。 
7) 
调整 N1、N2 
在按照上述过程调整变量之后，电路核心电路可以工作。但是并没有达到要求的温
漂。原因主要是用于补偿的高阶温度分量补偿不准确，所以得不到精确的补偿。 
(
)
1
3
m1
m1
REF
BE1
1
3
R1
B",187
"对高阶温度补偿有一定作用的同时。也对输出电压的总一阶温度系数有一定影响。很
难用温漂来作为仿真的指标。因而输出电压的导数“Deriv”是一个更直观的指标。 
Deriv=derive(VS(“/VREF”)) 
另外，输出电压导数的摆幅“swing”更为重要，因为这个指标确定了一个电路的高阶
温度补偿的准确度。 
swing=ymax(derive(VS(“VREF”)))-ymin(derive",171
"的“state”。
注意高亮部分可以选择载入哪些内容。这里只需要“Analysis”的设置, 如图 8- 127 所示。 
 
342
 
图 8- 127  Load State 
输出设置方面，设置了输出电压、“Deriv”和“swing”这三个输出, 如图 8- 128 所示。 
 
图 8- 128  输出设定 
在没有补偿的时候（N2 输入对接地)，电路的电路仿真结果如图 8- 129 ",135
" 进行参数扫描。由于 N1/N2 需要继续加大，
为了降低总的电流使用，N2 就被锁定在 1。只对 N1进行参数扫描就行了。因为 N1必须
是整数，需要注意圈中的选项，如图 8- 131 所示。 
 
图 8- 131  对 N1 进行参数扫描 
扫描的结果如图 8- 132 所示，可见当 N1 =16 和 17 的时候有最小的 swing，
swing16,17<26µ。 
 
图 8- 132",169
"ate”为
“deriv_Vref”，然后取出原来用于调节一阶温度补偿的“state”中输出的设定。选择“Session”
�“Load State”，载入刚才保存的名叫“temp”的“state”，只选择载入“Output”，如图 8- 134
所示。 
 
图 8- 134  载入 Output 的设置 
然后对“res1_2”的阻值进行优化。在 ADE 窗口中选择菜单“Tools”�“Opt",133
"ptimization 窗口 
 
图 8- 136  设定优化目标 
在最优化窗口中点击
按钮设置扫描的变量。在对话框中选择扫描“res1_2”，由于
当“res1_2=1.03MΩ 时，VREF的温度系数为正，所以 res1_2 应当减小，可以将 1.03M 作
为最大值。初始值应当设定在最大和最小值之间，如图 8- 137 所示。 
另外在最优化窗口中选择菜单“Session”�“Optio",167
" 8- 140  最优化的过程 
回到 ADE 中，按照前面的结果设定所有变量，如表 8-12 所示。最后的温度特性如
图 8- 141 所示。 
表 8- 12 最终的变量优化结果 
res1_1 
res4 
res5 
res6 
N1 
N2 
955.8KΩ 
1MΩ 
1.2Ω 
1.5Ω 
16 
1 
 
347
 
图 8- 141  温度扫描的结果 
8) 
工艺角分析 
前面",158
"“Corners”，打开工艺角分析窗口。 
建立工艺。在工艺角分析界面中选择菜单“Setup”�“Add Process”，弹出如下对
话框，如图 8- 142 所示。 
 
图 8- 142  添加工艺对话框 
其中“Process Name”可以任意取，“Base Directory”和“Model File”可以分别从 ADE 中
的模型库设置对话框（在 ADE 中选择菜单“Setup”�“",133
" MOS 为例。 
在工艺角分析窗口中选择菜单“Setup”�“Add/update model info”，然后在对话框
中选择“Group/Variants”。并在下面建立叫 MOS 的一组工艺角，并在选项中输入 MOS 的
5 个工艺角的名称，中间用空格隔开，如图 8- 144 所示。各个选项组的名称和选项如表
8-13。全部加入后工艺角分析窗口如图 8- 145 所示。 
 
图 8- 1",151
"工艺角 
在界面中点击 Add Corner 按钮，依次加入 TT FF FS SS SF 这 5 个工艺角，如图 8- 146
所示。 
 
图 8- 146  输入新加入的工艺角的名字 
这时可以通过下拉菜单修改每个工艺角使用的器件模型，如图 8- 147 所示。 
 
图 8- 147  用下拉菜单设置每个仿真中使用的工艺角 
点击 Run，最后仿真结果如图 8- 148 所示。可见温漂完全",161
"阻，在实际设计当中要采用工艺模型提供
的电阻，这对于这种带隙电压基准的温度漂移会有影响。 
 
习 题 
8.1 
试计算图 8- 149 中基准电压的温漂系数。 
 
 
351
图 8- 149 基准电压温度曲线 
8.2 
试计算图 8- 150 中 Z 节点和 Y 节点间的电压差，假设 I1=I2。 
 
图 8- 150 PTAT 电流生成电路 
 
8.3 
根据 8.2 中的结果，计",188
" 中的结构，设计产生 3.75V 基准电压得电路结构。 
8.7 
图 8- 6 中电阻 R3=1kΩ，并且通过它的电流为 50μA。要得到零温度系数，计算 R1、R2和 n 的值 
8.8 
仿照 8.4.8 中的方法，使用 Spectre 软件仿真测试图 8- 8 中的带隙电压基准的闭环增益。 
8.9 
试问为了获得较小的 输出噪声，对图 8- 8 中 MOS 管 M1~M7的尺寸有什么要求",191
"vavi B. 模拟 CMOS 集成电路设计. 西安： 西安交通大学出版社， 2003 
[2] 
Allen P E. CMOS 模拟集成电路设计. 第 2 版. 北京：电子工业出版社，2005 
[3] 
LEE I， KIM G， KIM W. Exponential curvature-compensated BiCMOS bandgap references，IEEE 
Journal ",110
"2001, 36(7): 1076-1081. 
[5] 
US patent 6255807 
 
 
353 
第 9 章 基准电流源 
基准电流源是指在模拟集成电路中用来作为其它电路的电流基准的高精度、低温
度系数的电流源。电流源作为模拟集成电路的关键电路单元，广泛应用于运算放大器、
A/D 转换器、D/A 转换器中。偏置电流源的设计是基于一个已经存在的标准参考电流
源的复制，然后输出给系统",180
"的设计为例详细介绍基准电流源的设计流程，并引入一种输出
基准电流高阶温度补偿的方法。 
9.1 基准电流源的性能参数 
9.1.1 温漂系数 
基准电流源的一个重要的指标是电流基准在宽温度范围下的工作稳定程度。温漂
系数不仅是衡量带隙基准电压源输出电压随温度变化的一个性能参数，也是衡量基准
电流源输出电流的一个重要参数。与基准电压源的温漂系数类似，基准电流源的温漂
系数同样表示输出基准电流随温度变",224
"系数，ppm/℃;  
      
IMAX
——基准电流最大值，A; 
      
IMIN
——基准电流最小值，A;  
      
IMEAN
——基准电流平均值，A; 
      
TMAX
——温度最大值，℃; 
      
TMIN
——温度最小值，℃。 
 
354 
9.1.2 电源抑制比（Power Supply Reject Ratio, PSRR） 
通常，基准电流",126
"
I
I
V
V
⎛
⎞
Δ
=
⎜
⎟
⎝ Δ
⎠
               （9-2） 
式中：PSRR： 
电源抑制比，单位 dB； 
IREF  
：  
标准电流值，A； 
ΔIREF ： 
  
电流变化值，A； 
      VDD 
：  
电源电压； 
      ΔVDD ：  
电源电压 VDD 的变化，V。 
9.1.3 功耗 
与基准电压源类似，基准电流源中也有功耗的",161
"得出一个对 VDD 不敏感的解决方法，要求基准电流 IREF 与输出电流 IOUT 镜像，也就
是说，IOUT 是 IREF 的一个复制。图 9-1 所示就是一种电流复制的电路实现。其工作原
理如下[1]： 
M1 与 M2 构成一对电流镜结构，因为 M1 与 M2 具有相同的尺寸，所以 IREF＝IOUT。
但是由于电压 V 的作用，M3 与 M4 的 VGS 不相等，我们假设 M4 的宽长比是",171
"1
1
OX
I
V
C
W L
K
μ
⎛
⎞
−
=
⎜
⎟
⎝
⎠
                （9-5） 
因此， 
(
)
2
N
N
OUT
2
1
2 1
OX
V
C
W L
I
K
μ
=
⎛
⎞
⎜ −
⎟
⎝
⎠
                    （9-6） 
正如所希望的，电流与电源电压 VDD 无关，但仍旧是工艺和温度的函数。 
为了消除输出基准电流对温度的影响",181
"V，即 RS 两端的电压 V＝IOUTRS，由于 IREF＝IOUT，我们可以得到[1]， 
(
)
(
)
OUT
OUT
TH3
TH4
OUT
S
N
N
N
N
2
2
OX
OX
I
I
V
V
I
R
C
W L
C
K W L
μ
μ
+
=
+
+
    （9-7） 
忽略体效应的影响，我们有 
(
)
OUT
OUT
S
N
N
2
1
1
OX
I
I
R
C
W L
K
μ",157
" 
由式（9-9）我们可以看出，输出基准电流的温度特性与工艺有关，要产生与温度
无关的输出基准电流，首先，要对其温度特性进行分析。 
1) 输出基准电流的温度特性分析 
由式（9-9）输出基准电流的表达式，表明输出基准电流与载流子迁移率和电阻有
关，而载流子迁移率和电阻都是与温度有关的函数。 
其中，载流子迁移率与温度的关系可以表示如下[2]  
0
0
T
T
T
α
μ
μ
−
⎛
⎞
=
⎜",203
" 次方成反比。显然，温度对基准电流的稳定性会造成很大的影响。 
由以上分析我们可以知道，利用电阻 RS 产生基准电流的结构，如果不进行温度补
偿，其温度特性很差。因此，提高图 9-2 电路结构中的输出基准电流的温度特性是必
须的。 
2) 输出基准电流温度补偿方案 
由式（9-9）输出基准电流的表达式及上文的分析可以看出，输出基准电流与电源
电压无关，但是仍然与温度有关。其一阶温度系数的计算公式可",213
"                （9-12） 
由式(9-10)我们知道 
0
0
T
T
T
α
μ
μ
−
⎛
⎞⎟
⎜
=
⎟
⎜
⎟
⎜⎝
⎠
                   （9-13） 
所以 
 
358 
1
0
0
0
N
N
0
0
1
T
T
T
d
dT
T
T
T
α
α
α μ
μ
α
μ
μ
−
−
−
⎛
⎞
−
⎜
⎟
⎝
⎠
⋅
=
= −
⎛
⎞
⎜
⎟",191
"了输出基
准电流的温度特性。 
在实际的工艺中，受工艺的限制，可能没有与载流子迁移率温度特性相匹配的电
阻，这时，我们可以使用两种不同的电阻，通过电阻阻值的匹配来实现与载流子迁移
率的温度系数的相互抵消[3]。具体例子可见下文中的设计实例。 
9.3.2 利用电阻 RS 在 PMOS 管源极产生电压差 V 
 
图 9-3 电阻 RS 在 PMOS 管源极产生电压差 V 
图 9-3 为利用电阻 ",201
"这种结构的优点是在常用的 N 阱工艺中可以消除了体效应的影响[1]。比较图 9-2
 
359 
的结构，我们假设忽略了体效应，由于图 9-2 中 M3 和 M4 的源极位于不同的电位，所
以考虑体效应后，前面的假设 VTH3＝VTH4 会产生一些误差。在图 9-3 中，我们在 PMOS
管 M2 的源极引入电阻，在 N 阱 CMOS 工艺中，可以通过将每个 PMOS 晶体管的源极
和衬底相连来消",187
"和 M4 管的 X 点和 Y 点的电
位差显然很大，因而 IREF 和 IOUT 显然是不等的。在实际电路设计中这常常导致仿真或
实际芯片中的基准电流和利用公式计算的预期值有很大不同，甚至导致电路不能顺利
工作。当电源电压 VDD 发生变化时，X 点和 Y 点的波动会更大，此时，输出基准电流
很可能完全背离我们计算的表达式。 
为了减小沟道长度调制效应，电路中所有晶体管一般均采用相对较长的沟道，但",206
"电流随电源电压 VDD 变化
的量，即提高了输出基准电流的 PSRR，使输出基准电流与计算表达式更加匹配。 
 
360 
 
图 9-5 共源共栅电流源 
9.3.4 三支路基准电流源 
 
图 9-6 三支路基准电流源 
为了进一步提高输出基准电流的 PSRR，在图 9-2 的基础上添加了第三条支路，
 
361 
构成了三支路结构的基准电流源，如图 9-6 所示。输出基准电流的表达式与式（9",179
"电压升高时，M2 管相当于一个共源级，根据共源级增益为负
来看，VY 电压与 VX 电压变化相反，所以 VY 电压降低，同样，M3 管又可以看作是一
个共源级，所以 M3 的漏端电压升高，即 VX 电压升高。这样，形成了 VX→VY→VX 正
反馈环路，所以整个系统的 PSRR 较低，输出基准电流随电源电压变化较大。 
而对于图 9-6 所示的三支路基准电流源来说，由于多了一条支路，形成了负反馈，",210
"下面我们以低压差线性稳压器（Low Dropout Regulator，LDO）中所应用的低功
耗、低温度系数的基准电流源为例来设计并仿真一个基准电流源的电路。 
 
362 
9.4.1 LDO 中基准电流源的性能指标 
1. 低电流 
LDO 由于具有低噪声、低功耗、结构简单及封装尺寸较小的优点，在便携式电子
产品中作为电源转换电路得到了广泛的应用。对于低功耗 LDO 的设计来说低电流的
基准",192
" 
1. MOS 管工作区域的确定 
由于我们要求设计的基准电流较小，是纳安量级的。如果仍然采用 9.2 节所述的
电路，而且其 MOS 管工作在饱和区。那么，MOS 管的宽长比将是一个非常小的值（倒
比管），所以芯片的面积会很大。一般饱和区工作的 MOS 管流过的电流一般为微安量
级的，所以 9.2 节所述的计算表达式已经不能适用于我们所要求的基准电流源的设计。
为了得到纳安级的输出基准电流，我",206
"   （9-17） 
其中，I0 为单位饱和电流，VT＝kT/q，ζ 是亚阈值斜率因子。因为 VDS>>VT，那么
DS
exp
T
V
V
⎛
⎞
⎜−
⎟
⎝
⎠
可以忽略。又因为 IREF＝IOUT，所以， 
GS3
GS4
REF
0
OUT
0
N
N
exp
exp
T
T
V
V
W
W
I
I
I
K
I
L
V
L
V
ζ
ζ
⎛
⎞
⎛
⎞
⎛
⎞
⎛
⎞
=
=
=
⎜
⎟
",210
"长比的比值和电阻
唯一确定的。这说明基于传统的基准电流源的工作原理，工作在亚阈值区的 MOS 管
是可以用来生成和电源电压无关的基准电流的。 
和饱和区工作状态下的电流计算公式相比，载流子迁移率已经不会影响亚阈值电
流了。在亚阈值电流公式中只有电阻 RS 和 VT 这两个与温度有关的变量。其中，VT 电
压与温度成正比。而实际工艺中的电阻也有其温度系数。我们可以根据 9.3 节所述的
 
364 ",204
"与饱和区流过的电流不在同一数
量级，电流减小了很多倍，原来形成的负反馈系统是基于 MOS 管的单级放大器原理，
由于电流的减小，负反馈系统已经不能很稳定地工作，所以，我们对其结构进行了稍
许修改，以增强其负反馈系统的增益，如图 9-9[4]。 
 
图 9-9 三支路结构的变化 
在图 9-9 中，我们又形成了另一种负反馈系统。当 X 点电压升高时，IOUT 与 I3 均
减小，由 VY＝（IOU",202
"等，RS2 的阻值比图 9-6 中 RS 的阻值大
大的减小，从而节省了芯片的面积。 
9.4.3 基准电流源参数的调试 
1. MOS 管参数的粗略估计 
为了得到输出基准电流为 30nA 的基准电流源，我们要预先对各个 MOS 管的宽长
 
365 
比做一下初步估计。 
由我们采用的 CSMC 公司 0.5µm CMOS 混合模拟信号仿真库可以知道，PMOS
管和 NMOS 管的参数可以估计",183
"数一般为 2,4,6,8 等等偶数，在这里，我们取 K＝6。由 IREF＝
30nA，根据公式 
GS
N 0
exp
T
V
W
I
K
I
L
ζV
⎛
⎞
⎛
⎞
=
⎜
⎟
⎜
⎟
⎝
⎠
⎝
⎠
                 （9-21） 
可以计算出，M3 和 M4 管的宽长比(W/L)N＝5/10。 
同样道理，图9-9中PMOS管M1和M2工作在饱和区，我们已经知道VTHp＝9",196
"(W/L)P＝3/10。 
为了减小 RS 的阻值，节省面积，我们初步设计第三支路 M5、M6 流过的电流为基
准电流源的 2 倍，所以图 9-9 中 M5 的并联数为 2。 
2. 电阻参数的估算 
假设 M1 的并联数为 K1，M5 的并联数为 K5，由 MOS 管参数的确定可知道，K1
＝1，K5＝2。由电流的表达式 
1
S
1
5
ln
VT
K
I
K
R
K
K
= ς
×
×
+
",182
"
=
Ω °
∂
∂
+
          （9-25） 
也就是说，电阻的一阶温度系数为 
 
366 
3
1732
/
2.42 10
/ C
715k
C
−
Ω °
=
×
°
Ω
                 （9-26） 
表 9-1 是 CMSC 0.5μm CMOS 混合信号模型，除 N 阱电阻外，其余类型电阻的一
次温度系数都小于
2.42 10−3
×
/℃，但是由于 ",155
"系数（/℃） 
二次温度系数（/℃2） 
N 阱 
5.630×10-3 
1.060×10-5 
N 扩散 
1.705×10-3 
1.475×10-6 
P 扩散 
8.551×10-4 
1.877×10-6 
多晶硅 1(P 注入) 
3.590×10-4 
-6.661×10-7 
多晶硅 1(N 注入) 
3.250×10-4 
6.581×10-7 
多晶硅 2 
3.214×10",157
"       （9-27） 
最后计算得出， 
NWELL
186k
R
=
Ω                       （9-28） 
rhr1k
529k
R
=
Ω                        （9-29） 
根据计算出的 MOS 管和电阻的大小，最终画出的电路如图 9-10。电阻先用理想
电阻代替。 
注意：图 9-10 中 MOS 管的编号和图 9-6 中的不一样，",129
"bol 
M2 
mn 
5u
10u 
2 
st02 
mn 
symbol 
M3 
mn 
3u
10u 
2 
st02 
mn 
symbol 
 
367 
M4 
mp 
3u
10u 
1 
st02 
mp 
symbol 
M5 
mn 
3u
10u 
1 
st02 
mn 
symbol 
电阻 
Instance Name 
Model
W
L 
Resistance",98
"后，我们就可以对所设计的电路图进行仿真。 
1. 直流工作点的仿真 
首先在“Tools”下拉菜单中选择“Analog Environment”命令，打开 ADE 窗口。在 ADE
窗口中，首先在“Setup”下拉菜单中选择“Model Libraries”添加模型的库文件。如图 9-11
所示。 
 
图 9-11 添加模型库文件 
完成库文件设置后的“Model Library Setup”窗",130
"了。 
 
369 
 
图 9-13 直流工作点仿真设置 
2. 查看直流工作点 
如图 9- 14 所示，在 ADE 中选中“Results”→“Annotate”→“DC Operating Points”，
在电路图上将会出现各个管子的直流工作点，如图 9-15 所示。 
 
图 9- 14 查看直流工作点的操作 
 
370 
 
图 9-15 直流工作点举例 
从直流工作点的具体数据可",139
"将会出现各个管子的工作状态列表，在列表的
后端，有一列名为“region”的列，如图 9-18 所示。对应的数字表示管子的工作区域，
如 3 为亚阈值区，2 为饱和区，1 为线性区。由工作区域的查看可以知道，我们最初的
参数设置满足工作区域的要求。（具体 MOS 管参数名称可以参考附录 B.5） 
 
图 9- 16 查看工作区域 
 
371 
 
图 9- 17 Results Browser",159
"公式改为： 
AC
DC
AC 1V
I
I
PSRR
= V
                        （9-30） 
式（9-30）将电源电压 VDD 定为 1V。将输出变量取名为 PSRR，点击“Open”打
开 Calculator。在计算器中点击“ac”栏中的“if”选项，打开交流电流选择模式。这个模
式表示从电路图中手动选择流过节点的交流电流，计算器将得到这一点的交流扫描电
流的",144
"流的函数。 
回到输出设定对话框，点击其中的“Get Expression”按钮，计算器中的公式就会被
复制到“expression”一行。这个表达式设定好后，点击“Add”，新表达式就成为一个输
出, 如图 9-22 所示。 
 
图 9-22 设定好的 PSRR 输出 
 
2) PSRR 的仿真 
设置好仿真模型后，在 ADE 窗口中选择“Analysis”→“Choose”，设置仿真类型。",134
"4 进入 Save all 设置 
 
图 9-25 Save all 设置 
为了方便观察 ac 电流，我们在输出设置中同样加入 ac 电流值。在 ADE 窗口中选
择“Outputs”�“To Be plotted”�“Select On Schematic”，如图 9-26 所示。在电路编缉窗
口选择 M0 管的 D 端电流。 
 
375 
 
图 9-26 输出电流的设置 
对电路图中的",128
"仿真，使各个 MOS 管工作在合适的
区域。 
 
图 9-27 PSRR 的输出结果查看 
 
376 
 
图 9-28 改进后的 PSRR 
4) PSRR 的提高 
利用“Parametric Analysis”对 PMOS 管的栅长进行扫描。（具体操作参考附录 E） 
首先在电路图中将所有 PMOS 管的栅长设成参变量“L”。选中 PMOS 管，点击快
捷键“q”，在“Edit Obje",144
" 9-30 在 ADE 窗口中获得电路图中的变量 
双击“Design Variable”栏中的“L”项，将弹出“Editing Design Variables”窗口，在该
窗口右边的“Table of Design Variables”栏中选择“L”项，在左边的“Value（Expr）”栏中
填入开始计算得到的“10u”，完成设置后的窗口如图 9-31 所示。点击“Apply”或者“OK”
保",129
"iable”
命令，并选择“Sweep1…”，如图 9-33 所示。 
 
 
图 9-33 在“Parametric Analysis”窗口中为“Sweep1”添加扫描变量 
在“Parametric Analysis Pick Sweep1”对话框中选择“L”， 将“Sweep1”的扫描变量设
置为“L”。 “Sweep1”的扫描范围为 5u~15u。“Total Step”设置为“5”。完成",122
"管的
栅长增加时，PSRR 会增大，于是我们将 PMOS 管的栅长适当增大为 15μm，得到较高
的 PSRR 仿真结果。如果需要进一步提高输出基准电流的 PSRR，我们还可以将本次
设计的三支路基准电流源改为三支路共源共栅基准电流源，这样，PSRR 会进一步提
高。 
 
379 
 
图 9-35 PSRR 的提高 
4. 基准电流的温度系数调整 
根据 9.4.3 中电阻参数的估算设置电阻阻",178
"里面将扫描范围设置为-50～150，如图 9-37 所示。 
 
图 9-37 dc 扫描设置 
同时，参照 9.4.4 节中 PSRR 输出的设置，我们可以在输出变量中设置温度系数
PPM。PPM 的表达式为 
(
)
o
MAX
MIN
MEAN
MAX
MIN
PPM
1000000
(ppm/ C)
I
I
I
T
T
−
=
×
−
　　
      （9-31） 
在 ADE 中选中“",147
"的漏端，选中“ymin”
函数；然后点击“－”按钮；再一次选中 M0 的漏端，选中 average 函数，点击“/”按钮，
在得到的式子中手动加入“/200*1000000”，最终得到的表达式为：
“(ymax(IS(""/M0/D""))-ymin(IS(""/M0/D"")))/average(IS(""/M0/D""))/200*1000000”，其中，200
是扫描的温度范围。输入完毕后，点击“Get",134
" 9-42 PPM 的初步计算 
之所以输出基准电流会出现弧线，是因为我们所使用的电阻具有二阶温度系数，
造成了输出基准电流值与温度的关系是一个曲率基本固定的抛物线。在这种情况下，
在一定温度范围内抛物线两端相等时，基准电流的温度系数达到最小。利用“Parametric 
Analysis”对电阻进行参数扫描，调整电阻的阻值。当 R1 为 350kΩ，R2 为 330kΩ 得到
图 9-43 所示",188
"0u 
1 
-- 
M2 
mn 
1u
10u 
1 
增加高频 PSRR 稳定性 
M3 
mn 
3u
15u 
2 
提高 PSRR 
M4 
mp 
3u
15u 
1 
提高 PSRR 
M5 
mn 
3u
15u 
1 
提高 PSRR 
电阻 
Instance Name 
Model
W
L 
Resistance
Segments
修改原因 
R1 
rhr1k
1.3u
",120
"作电压，在仿真过
程中，需要根据实际仿真模型不断进行调整，以达到最好的特性。在实际的工程设计
中，可能会牺牲一些特性以达到特殊的目的，比如牺牲功耗利用复杂电路以达到低温
度系数的目的等。根据设计指标的不同，参数的仿真设计也会不尽相同。 
 
习题 
9.1  假设在仿真温度范围内，基准电流的最大值 IMAX=1.015μA，最小值 IMIN=1.012167μA，温度范
围是－40～125℃，平均",203
"和 M4 管衬底偏置效应的影响，如果考虑到衬底偏置效应，试
计算基准电流的偏差是多少。 
9.5  在 9.3.2 节中提到，在 PMOS 管源端接电阻，同时通过将每个 PMOS 晶体管源端和衬底相连来
消除体效应。这里，我们提出另一种如图 9-45 所示的消除体效应的结构。试推导 IOUT 的表达
式。 
 
385 
 
图 9-45 
9.6  在图 9-5 中，PMOS 与 NMOS 共源",183
"系数来补偿基准电流温度系数的方案。参照第 8 章带隙基
 
386 
准电路，可以知道，带隙基准电路可以生成 PTAT（正比于温度）电流和负温度系数电流，如
果能将这两路电流相加，就可以得到与温度无关的电流，如图 9-47 所示。试结合带隙基准电
路的原理，解释图 9-47 的温度补偿原理。 
 
图 9-47 
9.9  在 9.4 节的设计实例中，从 PSRR 的仿真可以看出，当 MOS 沟道",195
"的情况，即在 dc 仿真中，电源电压
从 0V 变化至 5V，观察基准电流的变化情况，完成此项仿真任务。 
9.12  如果要设计一个基准电流为 1μA 的三支路基准电流源，试计算 NMOS 和 PMOS 管的宽长比 
（提示：1μA 的基准电流可以工作在饱和区 λ ） 
9.13  用上题计算出的结果在仿真器里面设置参数，并进行仿真和直流工作点的验证，如果仿真结
果与计算结果不符，进行参数的调节",183
"Steyaert. A cmos temperature-compensated current reference. IEEE J. 
Solid-State Circuits, 1988, 23: 821-824 
[3]  Jingmei Lu, Yi Wang, Nuo Xu et al. Temperature Compensation in Bootstrapped Current R",61
"集成电路设计.冯军等译. 北京：电子工业出版社，2006 
388 
第 10 章 模拟与数字转换电路 
虽然这个自然世界是一个模拟信号的世界，但是现代信号处理技术的发展依赖于超
大规模集成电路的高速发展，特别是像 DSP 这样的数字信号处理核心。因此，一个精确
的模拟到数字（ADC）或从数字到模拟（DAC）的转换电路是现代电子系统不可或缺的。 
10.1 开关电容电路 
在上世纪 70 年代以前",188
"处理的信号在幅值上是连续的。 
10.1.1 采样开关电路[1，2] 
我们知道，一个 MOS 管在大信号工作情况，利用导通或者截止的特性，本身就可
以等效为一个最简单的开关。用一个 MOS 管和电容就可以构成一个简单的采样保持电
路如图 10- 1 所示。 
 
图 10- 1 简单采样电路和 MOS 开关 
 
图 10- 2 理想开关采样波形 
 
所谓采样，就是在一个时钟周期内输入信号通过",180
"的各种非理想效应。 
如图 10- 1 所示，在实际电路中，通常使用 CMOS 管来实现采样开关。下面通过三
种简单的情况，来理解采样电路是如何对输入信号进行采样的。 
 
图 10- 3 输入信号为零，采样电容初始电压为高电平条件下的采样电路响应 
 
图 10- 3 给出了输入信号为零，采样电容初始电压为高电平条件下的采样电路响应，
假设开关 NMOS 管 M1 栅端的时钟信号在 t0 时刻由",192
" 
DS,M1
DD
TH
GS,M1
TH
V
V
V
V
V
=
−
=
−
 
 
 
 
 
(10-2) 
 
因此 M1 管进入线形区，电容 C 继续放电，直到 vOUT的电压接近零，此时的放电电
流为： 
 
(
)
2
D
n
ox
DD
TH
OUT
OUT
M1
1
2
W
I
C
V
V
v
v
L
μ
⎛
⎞
⎡
⎤
=
−
−
⎜
⎟
⎢
⎥
⎝
⎠
⎣
⎦
  
 
(",186
"
⎞
−
⎜
⎟
⎝
⎠
 
 
 
 
 
(10-5) 
390 
下面考虑相反的情况，即输入信号为高电平，采样电容初始电压为零条件下的采样
电路响应，假设开关 NMOS 管 M1 栅端的时钟信号在 t0时刻由低电平变为高电平，从而
将 M1管导通，闭合了开关。电路图和响应结果如图 10- 4 所示。 
 
因为 vIN端的电压比 vOUT端的电压高，因此电流从 vIN端流向 vOUT端。对于",189
"        (10-6) 
 
图 10- 4 输入信号为高电平，采样电容初始电压为零条件下的采样电路响应 
 
 
 
式（10-6）可以改写为： 
(
)
OUT
n
ox
2
M1
DD
OUT
TH
1
2
dv
W
C
dt
L
V
v
V
μ
⎛
⎞
=
⎜
⎟
⎝
⎠
−
−
              (10-7) 
 
将式（10-7）等号两边积分，得到： 
 
(
)
OU",159
"⎜
⎟
−
⎝
⎠
 
      
(10-9) 
 
从式（10-9）可以看出当 t→∞时，vOUT→VDD-VTH。这是因为当 vOUT 接近 VDD-VTH
时，M1 管的过驱动电压接近零，使对电容 C 的充电电流可以忽略不计。当然，考虑二
级效应，当 vOUT接近 VDD-VTH时，M1 管会先进入亚阈值区，还会传输亚阈值电流对电容
C 充电，如果时间足够长，那么 vOUT的值最终还是会",185
" (
)
GS,M1
DS,M1
DD
OUT
IN
OUT
DD
IN
TH
V
V
V
v
v
v
V
v
V
−
=
−
−
−
=
−
>
 
 
 
(10-10) 
由式（10-10）可以看出，当输入电压小于 VDD-VTH 时，M1 管一直工作在线性区。
那么根据上文的分析，电容 C 将被充电，从而使得 vOUT接近 a。当 vOUT≈a 时，M1管等
效为导通电阻，其阻值为： 
(",164
"），进而降低了电路的
响应速度。
 
因此为了保证采样电路的速度，必须使得作为开关的 MOS 管有较小的导通电阻。
在图 10- 1 中的采样电路中，为了满足这一要求，将严重限制输入电压的摆幅。为了在
采样电路中，获得较大的电压摆幅，我们注意到 PMOS 管在输入电压很大的正电压时，
有较小的导通电阻，如图 10- 7 所示[1]。因此我们采用 CMOS 互补开关，就可以在保证
较小的导通电阻的前",209
"
p
ox
IN
p
ox
THP
N
N
P
P
//
1
1
//
1
R
R
R
W
W
C
V
v
V
C
v
V
L
L
W
W
W
W
C
V
V
C
C
v
C
V
L
L
L
L
μ
μ
μ
μ
μ
μ
=
=
⎛
⎞
⎛
⎞
−
−
−
⎜
⎟
⎜
⎟
⎝
⎠
⎝
⎠
=
⎡
⎤
⎛
⎞
⎛
⎞
⎛
⎞
⎛
⎞
−
−
−
−
⎜
⎟
⎜
⎟
⎜
⎟
⎜
⎟
⎢
⎥
⎝
⎠
⎝
",259
"开关电容采样电路 
 
 
图 10- 9 互补开关的导通电阻
10.1.2 沟道电荷注入效应[1] 
当 MOS 管的栅源电压 VGS大于阈值电压 VTH时，会在栅氧化层和硅的界面间产生电
荷沟道，将 MOS 管导通。对于 NMOS 管，沟道由负电荷构成；对于 PMOS 管，沟道由
正电荷构成，沟道中的电荷数为： 
(
)
ch
ox
GS
TH
Q
WLC
V
V
=
−
  
 
 
 
 ",189
"NMOS 管关断，导电沟道消失，但是由于电荷守恒定理，
形成沟道的负电荷不能凭空消失，而是通过 NMOS 管的源端和漏端流出。这种现象被称
为“沟道电荷注入效应”。假设通过源端和漏端流出的电荷数相等，对于图 10- 1 中的
394 
NMOS 管，从左边端口流出的电荷会被信号源吸收，而从右边端口流出的电荷将沉积在
采样保持电容 C 上，这样就影响了电容 C 上的电荷总量，从而改变了电容 C 上保",206
"T
IN
OUT
ox
DD
IN
TH
IN
ox
ox
IN
DD
TH
2
1
2
2
v
v
v
WLC
V
v
V
v
C
WLC
WLC
v
V
V
C
C
=
− Δ
−
−
=
−
⎛
⎞
=
+
−
−
⎜
⎟
⎝
⎠
  
 
(10-16) 
从式（10-16）可以看出 “沟道电荷注入效应” 对输出电压的影响有两个方面：非
单位增益，1+WLCox/C；固定的失调电压，WLC",180
"中，NMOS 管的衬底都是接地的，因此在图 10- 1 所示的开关电容
采样保持电路中，有： 
BS
IN
V
= −V
 
 
 
 
 
 
 
 
 
(10-18) 
395 
因此得到[1]： 
[
)
(
)
(
)
(
)
ox
OUT
IN
DD
IN
TH0
B
IN
B
ox
ox
ox
IN
B
IN
DD
TH0
B
2
2
2
1
2
2
2
2
2
WLC
V
v
V
",152
"应”是使用开关电容时需要考虑的一个重要问题。
这里可以给出两种减小电荷注入效应的常用电路结构。 
 
 
图 10- 11 互补开关电容采样电路 
 
图 10- 12 差分开关电容采样电路
 
图 10- 11 是一个利用互补 CMOS 传输门做开关管。这种开关有两个好处： 
1. 由于 NMOS 管具和 PMOS 管互补的传递特性，可以有效的减小在电压传递过程
中的阈值损失。 
2. 由于在 ",184
"0- 12 是一个差分结构的采样电路。可以想象，如果两个开关管都发生电荷注入
效应，由于是相同的管子，那么电荷注入效应的抵消应该要比互补结构要好。但是，这
种差分结构的问题在于前面分析过电荷注入效应并不是输入电压 vIN的线性误差，因此，
由于差分输入 vIN1 和 vIN2 之间本身就具有差别，因此这种电荷抵消不可能全部消除。不
过，需要注意该电路对非线性误差的消除仅限于偶次方项。对这个概念的理",202
"等效电阻 
1. 
并联开关电容等效电阻 
开关电容电路除了用来采样以外，还被大量的用来替代电路中的电阻器件，从而提
高电路的精度。下面，我们将先介绍开关电容的等效电阻，接着将分析开关电容电路对
电路时间常数精度的影响。 
 
图 10- 13 并联开关电容等效电阻 
397 
 
图 10- 14 典型的两相非重叠时钟 
考虑图 10- 13 中的开关电容电路[2]，该电路由两个独立直流电压源 ",196
"分析该电路，对于一个电容器，它极板上的电荷 Q 等于电容
器的容值 C 和两极板间的压降 V 的乘积，数学表达式为： 
Q
= C V
⋅
  
 
 
 
 
 
 
(10-22) 
 
因为时钟波形
1φ 和
2
φ 是不重叠的，因此在每个时钟周期内电容 C1 先和电压源 V1 相
连，然后再和电压源 V2 相连。假设电压源是理想的，并在时钟周期内保持稳定，即当电
容和电压源相连时，被瞬间充",191
"V1 和 V2 间的平均电流 Iavg为： 
 
(
)
1
1
2
1
avg
C V
V
Q
I
T
T
−
= Δ
=
  
 
 
 
(10-24) 
 
由平均电流和两个电压源间的压降，我们可以计算出等效电阻 Req为： 
 
1
2
eq
avg
1
c
1
1
V
V
T
R
I
C
f C
−
=
=
=
 
 
 
 
(10-25) 
其中 fc是时钟周期的倒数，即时钟频率。",153
"图 10- 15 给出了一个简单的低通滤波器。该滤波器的传递函数为： 
 
( )
1
`
1
1
1
1
C
H s
R C s
s
τ
=
=
+
⋅
+
⋅       
 
 
(10-26) 
 
其中  
 
1
1
C
R C
τ
=
  
 
 
 
 
 
 
(10-27) 
 
τC 称为电路的时间常数，它的精度影响信号处理电路的频率和时间的精度。τC 的精
度可以表达为： ",156
"串联开关电容等效电阻 
 
现在我们用图 10- 13 中的开关电容电路代替图 10- 15 中的电阻，得到如图 10- 16 所
示的电路结构。如果我们定义这种电路的时间常数为 τD，那么有： 
 
D
2
2
1
c
1
1
T
C
C
C
f C
τ
⎛
⎞
⎛
⎞
=
= ⎜
⎟
⎜
⎟
⎝
⎠
⎝
⎠
 
 
 
 
 
(10-29) 
 
因此 τD的精度可以表示为： 
399 
 ",187
" 0.1%。这种精度对于大多数信号处理都是足够的，这也是开关电容电路广泛运
用的一个原因。 
2. 
串联开关电容等效电阻 
 
类似图 10- 13 中的并联开关电容等效电阻电路，图 10- 17 给出了一种串联结构的开
关电容等效电阻。除了电容的连接方式，图 10- 17 中所有期间设置和图 10- 13 中一致。 
 
在
1φ 相位，开关 S1 闭合，开关 S2 断开，电容 C1两极板被短",185
"开关 S2 的断开，电容 C1 两极板上
的电荷再次清零，所以在每一个时钟周期内，都有 ΔQ1 的电荷从电压源 V1 转移到电压
源 V2。根据上文的分析，我们可以计算出串联开关电容的等效电阻为： 
1
2
eq
eq
1
c
1
1
V
V
T
R
I
C
f C
−
=
=
=
 
 
 
 
 
(10-32) 
可以看出并联开关电容电路和串联开关电容电路的等效电阻是一样的。 
10.1.4",178
"在任意一个时钟相位（
1φ 或
2
φ ）上，运算放大器上都没有反馈，这显然是不希
望出现的。并且这种设计会使得运算放大器的输出端在
2
φ 相位周期时不确定。对于这个
问题，我们将电容 C2改为串联方式，根据 10.1.3 中的分析，这并不影响等效电阻的阻值。
并且使串联开关电容的
2
φ 开关在整个周期内闭合，即省略这个开关。修改后的电路结构
如图 10- 20 所示。 
 
400 
 
图",184
"2
1
OUT
IN
IN
c
1
2
1
1
f C
C
v
v
v
f C
C
= −
= −
  
 
 
 
(10-34) 
 
下面我们从电荷转移的角度来验证式（10-34）。在
1φ 相位，图 10- 20 得等效电路如
图 10- 21 所示。 
401 
 
图 10- 20 采用串联模拟电阻的开关电容放大器 
 
图 10- 21 
1φ 相位时图 10- 20 的等效电路 
",158
"放大器的反向输入端“虚地”，因此电容 C1
上的压降为零，即电容 C1 的极板上没有电荷。由于电荷守恒定理，电容 C1 在
1φ 相位时
储存的电荷ΔQ1不可能消失，并且由于CMOS运算放大器的输入阻抗很大，因此电荷ΔQ1
只能转移到电容 C2的极板上，如图 10- 22 所示。因此电容 C2上的压降为： 
 
IN
1
1
C2
2
2
v C
Q
V
C
C
= Δ
=
  
 
 
 
 
",188
"分器是很多信号处理系统中的重要组成部分，例如滤波器，过采样模数转换器等
等。在第 5 章中，我们给出了连续时间积分器，如图 10- 23 所示。当运算放大器增益很
大时，它的输出电压可以表示为： 
IN
OUT
C
IN
1
1
v
v
v
dt
v dt
C
R
CR
= −
= −
= −
∫
∫
  
 
 
 
(10-37) 
 
类似 10.1.4 中的方法，使用开关电容电路来代替连续",179
"中(n-1)用来表示上一个时钟周
期。在
2
φ 相位时，图 10- 24 得等效电路如图 10- 26 所示。 
403 
 
图 10- 24 离散时间积分器  
 
图 10- 25 
1φ 相位时图 10- 24 的等效电路 
 
因为运算放大器的“虚短”概念，运算放大器的反向输入端“虚地”，因此电容 C1
上的压降为零，即电容 C1 的极板上没有电荷。由于电荷守恒定理，电容 C1 在
1",181
"n
Q
v C
V
n
V
n
C
C
−
+ Δ
=
=
−
+
  
 
(10-39) 
 
运算放大器输出端电压为： 
( )
( )
( )
(
)
(
)
IN
1
1
OUT
N
C2
C2
C2
OUT
IN
2
2
1
1
v C
C
v
n
v
V
n
V
n
V
n
v
n
v
C
C
=
−
= −
= −
−
−
=
−
−
 (10-40) 
 
式（10-40）说明在",156
"tal-Analog Converter，DAC）是现代数字电路中重要的接口电路
之一。在数字系统中，我们用到的是一系列用“0”，“1”这样字符串所代表的离散电
平量。DAC 的输入正是这样一组二进制信号，利用基准电压，将这组二进制信号转化
为等效的模拟信号。 
10.2.1 理想数模转换器基本结构 
一个理想的数模转换器结构框图如图 10- 28 所示。n 位二进制序列（b0b1b2…bn－1）",173
" 
405 
其中 K 为输出放大器的电压放大倍数。 
图 10- 28 中 B 表示： 
1
2
0
1
1
2
2
...
2 n
n
B
b
b
b
−
−
−
−
=
⋅
+
⋅
+
+
⋅
  
 
 
 
(10-42) 
 
图 10- 28 理想 DAC 结构图 
 
图 10- 29  2 位理想 DAC 输入输出曲线 
 
图 10- 29 是一个 2 位理想 DAC 的输入输",151
"[1~6] 
1. 
有限精度的 DAC 与量化噪声 
在实际情况中，由于 DAC 的位数是有限的，因此，它的输出值是离散化的，不
可能完全模拟出自然界中的连续信号。在图 10- 30 中画出了一个有限精度的 DAC 输
入输出曲线和一个无限精度的 DAC 的输入输出曲线。 
在图 10- 30 中，这里值得注意的是数字序列“00”对应的模拟量输出为 0.125V。
当然我们也可以安排“00”代表",173
"曲线之间的差值即为
量化噪声。从图 10- 32 中可以看出，第一种赋值方法的最大量化噪声为 0.5LSB。而第
二种方法的最大量化噪声为 1LSB。因此，我们在实际电路设计中更趋向于采用第一种
赋值方法。 
量化噪声是由有限的 DAC 位数造成的，因此无法从电路结构上优化使它降低到
0.5LSB 以下。因此我们只需要将 DAC 的其他误差优化到 0.5LSB 以下即可，因为这些
误差会被量化噪声",197
" 不同赋值方法 
 
图 10- 32 不同的量化噪声 
DAC 的动态范围用 DR 来表示。它等于输出的满刻度范围（FSR）和可分辨最小
值（1LSB）的比： 
FSR
DR
= LSB
  
 
 
 
   (10-44) 
其中满刻度范围代表了 DAC 能输出的最大电压，虽然往往 DAC 的输出值无法取
408 
到 VREF ，不过为了计算方便，我们仍然可以用 VREF 作为最大输出电压",163
"大不失真信号强度与同时
发出的噪声强度之间的功率比作为信噪比的数学定义。 
(
)
rms
rms
dB
20log
S
SNR
N
⎛
⎞
=
⎜
⎟
⎝
⎠
 
      
 
 
(10-47) 
这里需要注意的是我们由于对噪声的衡量往往都是采用平均功率值，因此信号也需
要用平均功率来表示。在式（10-47）中的下标 rms 表示均方根，可以理解为平均功率值
开平方。 
对于量化噪声，它的",193
"( )
1
f x dx
∞
−∞
=
∫
, f(x)在[-LSB/2，LSB/2]范围的大小为
1/LSB。因此根据式（10-48）得到： 
rms
12
LSB
N
=
 
 
              
 
(10-49) 
根据式（10-47）中对信噪比的定义，并且假设信号是从 0 和 VREF 之间的正弦波，
409 
我们可以得到： 
REF 2 2
2
2 2
2
6
20log",151
"个隐含的前提，即我们认为每一个码字都有唯
一一个模拟值与之对应。并且，这些模拟值都是按照我们事先的安排确定好的。但是，
在实际情况，有可能 DAC 的输出值会发生偏离预先设置的模拟值等情况。这些误差都
被包含在静态转换误差中，包括失调误差，增益误差，积分非线性，微分非线性等。 
4. 
失调误差 
失调误差又被称为漂移误差，正如它的命名所指出的一样，该误差的表现是相当于
在理想输出曲线图 10- ",213
"线性误差又分为
积分非线性误差（INL）和微分非线性误差（DNL）。 
积分非线性 INL 简单的说是 DNL 的累计。也就是说在某个台阶处测量的积分非线
性是在此之前的所有微分非线性之和。 
 
图 10- 36 非线性误差 
 
微分非线性 DNL 是指每个实际输出曲线中的台阶相对于理想输出曲线的偏移量而
不是在整个范围内比较。 
411 
10.2.3 几种常见结构的 DAC 
 
DAC ",187
"，Ri连接参考电压源 VREF；
当 bi＝0 是，相应的电阻接地。图 10- 38 给出了两种不同情况下的电路结构。 
 
图 10- 38 两种不同情况下的输出电压计算电路 
由图 10- 38 中可以看出，当电阻接地时，没有电流流过放大器的负反馈电阻 RFB。
而当电阻接 VREF时，流过加权的电流大小为： 
REF
2
i
i
i
V
b
I
R
=
 
      
 
 
 
 
(1",165
"41），可以看到结果是一致的。 
2. 
开关树 DAC 
另一种简单的 DAC 是利用开关来控制电阻分压的方法获取模拟输出。一个 2bit 的
开关树 DAC 的结构如图 10- 39 所示。 
 
图 10- 39 开关树 DAC 
图 10- 39 中，当 bi＝1 是，所有由 bi控制的开关闭合。而当 bi＝0 时，所有由
ib
−
控
制的开关闭合。那么，数字序列“00”所对应的输出电压",160
" DAC。它的基本思想是利用
电荷在电容上按比例分配的方法来实现加权。 
413 
 
图 10- 40 加权电容 DAC 
所以，根据图 10- 40 所示的电路原理，这种电容阵列式的 DAC 其实质是利用电容
1
0 2
n
i
i
i
Cb
−
=∑
和电容
1
1
0
2
2
n
i
n
i
i
C b
C
−
−
−
=
+∑
之间分压来得到输出电压。因此，输出电压的表达式为： 
1
1",183
"）原理和性能 
10.3.1 ADC 基本概念 
与 DAC 相对应的信号转换器是模拟到数字信号转换器（Analog-Digital Converter），
简称为 ADC。它的功能是将输入的模拟信号转换为对应的二进制数字字符码。由于模拟
信号在时间和幅值上都是连续的，而数字码则是离散，因此 ADC 系统中包含信号采样
与保持过程。同时还需要对采样下来的信号进行量化和编码。ADC的基本结构如图10",165
"进行相应的编码。 
414 
ADC 的基本特性和 DAC 相类似。同样也包括量化误差，动态范围，信噪比以及失
调误差，增益误差，非线性误差等。具体含义可以参见 DAC 部分，这里就不再详述了。
而采样保持电路的基本特性请参考开关电容电路部分的介绍。 
在现在大规模实际应用的 ADC 电路结构中，根据采样速率的不同，可以分为奈奎
斯特速率 ADC 和过采样率 ADC（也称为 ΔΣ ADC）。下面将",189
"C 因为其快速的转换时间和中等程度的电路复杂度成为实现 ADC 转
换器的一种常用方法。逐次逼近型 ADC 的算法本质是二分查找法。以查找在 1 到 64 中
的随机数为例，首先确定该数是否比 32 大或比 32 小。如果该数比 32 大，那么是否比
48 大或比 48 小。第三次查找在第二次查找的区间内进一步缩小范围，如此继续下去直
到找到相应的数。一个逐次逼近区间划分的过程示意图如图 10- ",194
"/H 的输出
415 
电压经过比较器比较后再反馈到 SAR 寄存器组中调整直到最后 DAC 无法再分辨为止。
一个具体的 3-bits SAR 结构 ADC 如图 10- 44 所示。 
 
图 10- 43 逐次逼近型 ADC 系统结构图 
 
图 10- 44 一个简单的 3-bits SAR 结构 ADC 
2. 
并行 ADC（Flash 结构） 
并行结构的 ADC 是一种高速转换 A",140
" 
 
图 10- 45 并行 ADC 结构图 
 
3. 
流水线型 ADC（Pipeline 结构） 
流水线型 ADC 是也一种高速高精度 ADC。相对逐次逼近型和并行 ADC 来说，流
水线型 ADC 在芯片面积和转换时间上有较好的折衷。 
流水线型 ADC 是多级比较网络的级联，每级只得到一位数字码，如果需要得到 n
位数字，那么就需要比较 n 次。输入采样信号必须从头传到尾才能完成一次",161
" ADC。而本节介绍的
ΔΣADC 是一种以高于奈奎斯特速率采样的 ADC，一般是奈奎斯特速率的 8~512 倍。这
种转换器在高分辨率，中低速的系统中（比如高质量的数字音频处理器）已经得到广泛
应用。这种过采样率转换器的主要好处是减小了对模拟电路的性能要求，但这是建立在
更复杂的数字逻辑电路基础上的。这在当今超大规模集成电路高速发展的背景下是相当
容易的。另外，这种过采样数据转换器减小了普通 A",210
"种。两种不同结构的调制器对
比如图 10- 47，图 10- 48 所示。 
418 
 
图 10- 47 Δ调制器模型 
 
图 10- 48 ΔΣ 调制器模型 
图 10- 47（a）是一个基本的Δ调制器模型。它由一个内部低分辨率（往往就是 1bit）
的 ADC 和 DAC 以及一个环路滤波器（在这里是图中的积分器）构成反馈回路。由于
ADC 和 DAC 存在量化误差和非线性误差，同时，在",171
"1Hz。
而积分器的在 Z 域模型中用
1
1
z − 来代替。那么该系统的输出（注意是数字值）是： 
OUT
IN
IN
( )
( )
(
1)
( )
(
1)
v
n
v
n
v
n
E n
E n
=
−
−
+
−
−
        
(10-57) 
正如这种调制器名称所表明的那样，式（10-57）表明输出 vOUT(n)正是当前采样值
和前一次采样值之差。这种调制器的优点是显而易",162
"v
n
E n
E n
=
−
+
−
−
 
 
 
 
(10-58) 
419 
2. 
噪声整形技术 
我们其实在在第四章介绍 KTC 噪声时就接触过“噪声整形技术”的概念。我们可
以首先回忆一下 KTC 噪声的产生原因。 
 
图 10- 49 KTC 噪声的产生 
 
图 10- 50 通过低通滤波器整形后的电阻热噪声 
我们知道在图 10- 49 中电阻产生的噪声电压源实际是一个白噪",186
"z
E z
−
=
−
+
 
      
 
(10-59) 
1
1
OUT
IN
( )
( )
(1
) ( )
v
z
z v
z
z
E z
−
−
=
+
−
  
 
 
(10-60) 
在这里，我们有必要研究一下 H1(z)=z-1 和 H2 (z)=1-z-1 的两个系统函数的频率响应。 
我们知道从 Z 域转化到频谱表达式的方法是令：z=ejω=ej2πf/fs，而|H(",151
"以看出，Δ调制器中信号和噪声都要通过（1-z-1）滤波器，也就是该调制器
不仅对噪声整形而且对信号也整形。而相比之下，ΔΣ 调制器只是对噪声整形。因此，
420 
ΔΣ 调制器在实际中更容易实现，系统要求也简单很多。 
在前面 DAC 的分析中，我们曾经介绍过量化噪声的概念和实际的计算模型。在加
入噪声整形技术后，我们理所应当的想要知道这种量化噪声被整形后的功率谱密度和信
噪比大小。 
假设输入信",220
"等于 LSB2/12，并且双边定义的功率等于±fs/2 内 Se(f)下的面积。
由此可以计算出功率谱密度的峰值 Ax。其算数表达式为： 
( )
s
s
s
s
2
2
2
2
e
x
x
s
-
-
12
f
f
f
f
LSB
S
f df
A df
A f
=
=
=
∫
∫
        
 
(10-63) 
解式（10-63）得到： 
x
s
1
12
LSB
A
f
=
    ",159
"
b
b
2
2
q
q ( )
f
f
V
S
f df
= ∫−
  
      
       
 
(10-66) 
b
b
2
2
2
q
s
s
1
2sin
12
f
f
f
LSB
V
df
f
f
π
−
⎛
⎞
=
⎜
⎟
⎝
⎠
∫
 
 
 
 
(10-67) 
3
2
2
2
b
q
s
2
36
f
LSB
V
f
π
⎛
⎞
≈ ⎜
⎟
⎝
⎠
 
 
 
   ",178
"R
LSB
OSR
π
=
 
 
 
 
 
(10-71) 
20log6
20log(2 2 )
30log(
)
2.61 30log(
)
SNR
OSR
OSR
π
=
−
+
=
+
 
 
(10-72) 
一般的如果输入信号是 0~2nLSB 的正弦波，并且采用 n-bits 量化，那么信噪比可以
表示为： 
3
2
2
2 2
20log
6(
)
n LSB
SNR
LSB
",141
"10-75) 
从式(10-75)可以看出，第一项为量化器造成的信噪比，OSR 项是从过采样率中得到
的信噪比的增强。每增加一倍过采样率，直接使得信噪比提高了 9dB，或等价于输出数
字信号增加了 1.5bit。 
3. 
两级ΔΣ 调制器 
一种有效增加分辨率的方法是增加调制器的环路滤波器阶数。这里介绍一种两阶的
ΔΣ 调制器。图 10- 52 展示了经典的 Boser-Wooley 二阶ΔΣ ",199
"(10-77) 
带内噪声功率为： 
2
4
2
5
q
( 1
)
60
LSB
V
OSR
π
=
 
 
 
 
 
(10-78) 
输入信号是 0~2nLSB 的正弦波，过采样率 OSR 为 2N，那么信噪比可以表示为 
6.02
11.14
50log(
)
SNR
n
OSR
=
−
+
        (10-79) 
6.02
11.14 15
SNR
n
N
=
−
+
   ",151
"字滤波器。该滤波器的决定了信号带宽，并对带外噪声完全衰减。虽然
更高的阶数使得量化噪声越小，但是当阶数在 3 阶以上时，这种调制器环路会带来不稳
定性问题。在实际设计过程中，2~3 阶电路是比较普遍的。调制器的稳定是指，无论积
分器的初始状态如何，只要调制器的输入信号是有界的，那么调制器的所有内部变量在
整个调制过程中都是有界的[5]。 
4. 
利用电阻电容构建简单的连续时间ΔΣ 调制器 
在这",223
"设计实例 
当前很多 ADC 的书籍着重阐述 ADC 的工作原理和电路结构，而缺少行为级的系统
仿真。这里我们以 Verilog-A 为工具，简单阐述 ADC 行为级的系统仿真。 
10.4.1 Verilog-A 简介 
Verilog-A 是在 Verilog 语言的基础上开发的一种针对模拟电路设计的一种硬件描述
语言，他继承了 IEEE 1364 Verilog HDL 中的所有定义。它允许",152
"方法。  
424 
1. 
运算放大器的 Verilog-A 代码： 
 
 
 
`include ""discipline.h"" 
`include ""constants.h"" 
 
 
`define PI   
3.14159265358979323846264338327950288419716939937511 
 
//-------------------- 
// diff-op",68
"vspply_p: 
 
positive supply voltage [V,A] 
// vspply_n: 
 
negative supply voltage [V,A] 
// 
// INSTANCE parameters 
//    gain           = gain [] 
//    freq_unitygain = unity gain frequency [Hz] ",57
"[A] 
//    slew_rate      = slew rate [A/F] 
//    rout           = output resistance [Ohms] 
//    vsoft          = soft output limiting value [V] 
// 
// MODEL parameters 
//    {none} 
 
425 
 
mod",57
"in  = 1.0e6; 
parameter real rin = 1e6; 
parameter real vin_offset = 0.0; 
parameter real ibias = 0.0; 
parameter real iin_max = 100e-6; 
parameter real slew_rate = 0.5e6; 
parameter real rout = 80; 
",77
"t_n; 
 
  
   analog begin 
 
      @ ( initial_step or initial_step(""dc"") ) begin 
 
 c1 = iin_max/(slew_rate); 
 
 gm_nom = 2 * `PI * freq_unitygain * c1; 
 
 r1 = gain/gm_nom; 
 
 vmax_in = iin_max",68
"in; 
 
//4 
      I(vref, vin_p) <+ ibias;  
 
 
 
 
 
 
 
//1 
      I(vref, vin_n) <+ ibias;  
 
 
 
 
 
 
 
//2 
 
      // 
      // GM stage with slewing 
      // 
      I(vref, cout_p) <+ V(vre",72
"max; 
      end 
 
 
      else if (vin_val < -vmax_in) begin 
         I(vref, cout_p) <+ -iin_max; 
 
  
 I(vref, cout_n) <+ iin_max; 
      end 
 
      else begin 
         I(vref, cout_p) <+ 0.5*",71
"  
 
 
 
//9 
      I(cout_p, vref) <+ V(cout_p, vref)/r1;  
 
 
 
 
//11 
      I(cout_n, vref) <+ ddt(c1*V(cout_n, vref));  
 
 
 
//10 
      I(cout_n, vref) <+ V(cout_n, vref)/r1;  
 
 
 
 
//12 
",89
"t_n, vref)/rout; 
 
 
 
 
//14 
      I(vout_n, vref) <+ V(vout_n, vref)/rout; 
 
 
 
 
//16 
 
      // 
      // Soft Output Limiting. 
      // 
      if (V(vout_p) > (V(vspply_p) - vsoft)) 
      ",78
"(vspply_p) - vsoft)) 
         I(cout_n, vref) <+ gm_nom*(V(vout_n, vspply_p)+vsoft); 
      else if (V(vout_n) < (V(vspply_n) + vsoft)) 
         I(cout_n, vref) <+ gm_nom*(V(vout_n, vspply_n)-vsoft)",85
"的。这一点将在后文中介绍。 
 
""constants.h""中包含的是 Verilog-A 中预先定义的一些常量，例如电子电荷、自然对
数、波尔兹曼常数以及普朗克常数等等。 
2) 
定义常数 
 
 
除了使用""constants.h""中的常数外，也可以自己定义常数。方法如上文所示。其中
“`define”是关键字，随后的是常数名称，然后是常数值。 
3) 
说明文档 
 
一个好的程序代码需要",152
"nts.h"" 
// diff-opamp 
// 
// - differential operational amplifier 
// 
// vin_p,vin_n:  
differential input voltage [V,A] 
// vout_p, vout_n: differential output voltage [V,A] 
// vref: 
 
reference ",60
"块式通过关键字“module”和“endmodule”定义的。他们中间
的内容就是模块体。需要注意的是“module”和“endmodule”是不能相互嵌套的。下
面的定义就是错误的。 
 
 
在“module”的后面是模块的名称，随后的括号中是模块的管脚，各个管脚间用逗
号隔开。在运算放大器的例子中，对于模块的定义如下： 
 
模块名称：opamp 
 
模块管脚：vout，vref，vin_",162
"些信号的大
小；输出管脚对外输出电流或者电压信号，并且这些信号的大小只受模块内部器件的影
响。 
 
可以看出在运算放大器的实例中，vref、vspply_p、vspply_n 是输入管脚；vout_p、
vout_n、vin_p、vin_n 是输入输出管脚。 
6) 
参变量 
module opamp (vout, vref, vin_p, vin_n, vspply_p, vspply_n)",140
"nteger”，分别表示参变量的类型是实数和整数。随后
是参变量的名称，参变量的默认值可以通过添加等号和数值得到。如在实例中，定义了
运算放大器的增益为参变量，名称为“gain”，类型为实数，默认值是“835e3”。 
定义的参变量将应用到电路仿真计算中，同时这些参变量在电路仿真时也可以模块
调用时被重新赋值。在电路图中，选中 Verilog-A 模块的符号，点击快捷键“q”，进入“Edit 
O",168
"r real freq_unitygain  = 1.0e6; 
parameter real rin = 1e6; 
parameter real vin_offset = 0.0; 
parameter real ibias = 0.0; 
parameter real iin_max = 100e-6; 
parameter real slew_rate = 0.5e6; 
paramete",76
"ctrical”定义的节点将具有电学特性，即
我们可以获得节点的电压和流过节点的电流量。因为我们后面进行的电路仿真，都是针
对守恒的电路系统，因此该电路系统中的所有节点都用“electrical”来定义。 
8) 
支路 
 
在定义了节点之后，就可以定义支路。支路是两个节点间的一条通路，支路的类型
由该支路包含的两个节点的类型决定。支路是通过关键字“branch”来定义的，关键字
后面的圆括号包",163
"
在上文定义节点时，使每个节点都含有电压量和电流量，通过信号获取函数 V( )和
I( )，可以在 Verilog-A 获取节点的电压量和电流量，或者为他们赋值。在例子中，n1 和
n2 表示两个节点，b1 表示一条支路。 
 
例子中各个信号获取函数分别表示： 
V(n1) 
：节点 n1 对地电压。 
V(n1, n2) ：节点 n1 和节点 n2 间的电压。 
V(b1) 
：支路 b1 起",160
"函数“V(n1, n2)”或“I(n1, n2)”，则在节点 n1 和 n2 间建立了一
个未命名的支路。 
10) 赋值符号 
在 Verilog-A 中，针对模拟电路提供了对应得赋值符号“<+”,用来提供输入信号和
输出信号之间的数学映射关系，从而进行行为描述。赋值符号“<+”将赋值语句分为左
右两个部分，左边要求是一个电压源或者是一个电流源；右边是一个结果为实数的表达
式。因此模拟电路的行为",181
"xpression 1; 
I(n3, n4) <+ expression 2; 
433 
 
图 10- 56 使用赋值语句生成的电压源和电流源 
11) 电源和探针 
在 Verilog-A 中可以将对模块的行为级描述可以转换为受控电源和探针组成的网络。
配合上文讲述的信号获取符号和赋值符号。 
� 
探针：如果一个支路的电压量和者电流量都没有被赋值，那么这条支路就是一个探
针。进一步，如果",163
"
例子：下面将介绍如何使用电源和探针来实现电路中常见的受控电源和电阻、电容
和电感网络。 
 
压控电压源： 
 
module VCVS (pc, nc, ps, ns); 
 
inout pc, nc, ps, ns; 
 
electrical pc, nc, ps, ns; 
 
parameter real A=1; 
 
branch (pc, nc) in; 
 
branch (",113
"rameter real A=1; 
 
branch (pc, nc) in; 
 
branch (ps, ns) out; 
 
analog begin 
 
 
I(out) <+ A * V(in); 
 
end 
endmodule
module CCVS (pc, nc, ps, ns); 
 
inout pc, nc, ps, ns; 
 
electrical pc, nc",75
"ctrical pc, nc, ps, ns; 
 
parameter real A=1; 
 
branch (pc, nc) in; 
 
branch (ps, ns) out; 
 
analog begin 
 
 
I(out) <+ A* I(in); 
 
end 
endmodule 
435 
电阻（电压源形式） 
 
电阻（电流源形式） 
 
 
电容（电流源形式） 
mo",93
"n; 
 
electrical p, n; 
 
parameter real R=1k; 
 
branch (p, n) cond; 
 
 
analog begin 
 
 
I(cond) <+ V(cond) / R; 
 
end 
endmodule 
436 
 
电容（电压源形式） 
 
电感（电压源形式） 
 
module capacitor_C (p, n); 
ino",83
"n; 
 
parameter real C=1p; 
 
branch (p, n) cap; 
 
 
analog begin 
 
 
V(cap) <+ idt(I(cap)) / C; 
 
end 
endmodule 
module induction_V (p, n); 
inout p, n; 
 
electrical p, n; 
 
parameter real L=1p",73
")
( )
1
t
d
v t
R i t
L
i t
i
d
dt
C
τ
τ
−∞
=
+
+
∫
i
i
  
 
 
 
(10-81) 
 
因此在 Verilog-A 代码中需要使用电压源形式的电阻、电容和电感，串联 RCL 网络
的 Verilog-A 为： 
 
并联电阻、电容和电感网络 
module induction_C (p, n); 
inout p, n; 
 
ele",130
" real R=1k; 
parameter real L=1p; 
 
parameter real C=1p; 
 
 
 
analog begin 
 
 
V(p, n) <+ R * I(p, n) + L *ddt(I(p, n)) + idt(I(p, n)) / C; 
 
end 
endmodule 
438 
 
图 10- 58 并联电阻、电容、电感网络 
如图 10- ",97
"子中，都可以看到关键字“analog”，后面跟随一个顺序过程
（“begin-end”对）。这是声明随后的顺序过程里是对模拟电路的行为描述。后面介绍的
模拟操作符都只能在模拟顺序过程中使用。 
 
下面将介绍一些常用的模拟操作符： 
(1) 时间微分操作符 
在 Verilog-A 中，“ddt( )”是时间微分操作符，它计算括号中的变量对时间进行微分
的值。例如在上文中，电容（电流源形式）的 V",169
"idt(V(p, n)) / L + ddt(V(p, n)) * C; 
 
end 
endmodule 
I(cap) <+ C * ddt( V(cap)); 
439 
 
等效的数学表达式为： 
 
( )
( )
d
i t
C
dt v t
=
i
 
 
 
 
 
 
 
(10-83) 
(2) 时间积分操作符 
在 Verilog-A 中，“idt( )”是时间积分操作符，",108
"大器的
Verilog-A 代码，可以画出它所描述的运算放大器的小信号模型，如图 10- 59 所示。 
 
图 10- 59 运算放大器 Verilog-A 代码所描述的小信号模型 
 
在图 10- 59 中，每个器件都被赋予了编号，从 1 到 16。在运算放大器的 Verilog-A
代码中，有些语句也在末尾用注释标出了相应的编号，这表示该语句表述了小信号模型
中对应的器件。 
10.4.2",163
"续时间 sigma-delta 模数转换器电路图 
图 10- 60 给出了 ADC 的电路图。主要的电路模块有 3 个：运算放大器，比较器和
D 触发器。他们都是由 Verilog-A 代码编写而成的。其中运算放大器的 Verilog-A 代码在
10.4.1 中给出，比较器和 D 触发器的代码在本章最后给出。其余电阻、电容以及电源使
用“analogLib”库中的理想器件。 
 
为了简化分析",159
"输入端提供正电荷，进而使得积分期的输出电压下降。反之，
当积分器的输出电压小于零时，积分器的输出电压上升。 
441 
2. 
输入为 0,差分运算放大器的输出仿真 
首先观察 ADC 对于零输入信号的响应。将积分器的正向和反向输入端都接地，如
图 10- 61 所示。检测 D 触发器输出电压 FF_p 和积分器的差分输出电压 y，其中 
y = integ_p -integ_n
 
 
 
 
",173
"的同相输入端和反向输入端
之间加入直流输入信号。在电路图中为在运算放大器的两个输入端之间加入一个直流电
源，大小为 30mV。电路图如图 10- 63 所示。 
443 
 
图 10- 63 输入为直流电平时的仿真设置 
444 
 
图 10- 64 输入为直流电平时的仿真输出 
 
 
如图 10- 64 所示，当输入接入直流电平时，由于差分运算放大器两端的电容的充电
速度不同，导致差分运算",168
"下关系：假设输入电压为 u=a/b，如
果 0<a<b，并且 a 和 b 都是奇数且没有公约数，则取 b 个输出电压，其中包括（a+b）/2
个＋1, (b-a)/2 个－1，则平均数为 a/b，刚好与输入电压 u 相等。在 b 个采样周期后，输
出电压又重新回归到最初的值，所以，输出电压以 b 为周期不停变化。 
同样，如果 a 与 b 中有一个为偶数，则 a+b 为奇数，输出电压以 2b 为周",179
"分函数选择“Calculator”中的“integ”函数，该
445 
函数的设置如图 10- 65 所示。需要一次填入积分信号、积分起始时间和积分结束时间。 
 
图 10- 65 积分函数的设置 
计算出的结果约为 0.012，如图 10- 66 所示。因为 0.012/0.4=0.03=u。 
 
图 10- 66 积分结果 
4. 
输入信号为交流信号时，ADC 的仿真和测试 
无论是在实",147
"个输入端之间加入一个正弦信号电压源，幅值为 0.3V，频率为 7.8125Hz。电路图
如图 10- 67 所示。选择 7.8125Hz 作为正弦信号的原因是，为了“dft”的计算方便，采
样点一般为 2N，因此在随后的仿真结果处理中，选择了 2048 个采样点，而时钟周期为
2ms，因此每个周期采一个数据，采样时间持续 0.002s×2048=4.096s。将 4.096s 做为输入
信号的基波",182
"10- 68 给出了输入为正弦信号时的仿真输出，可以发现无法通过直接观察仿真结
果来评价 ADC 性能的好坏，因此需要借助“Calculator”中的“dft”函数，对输出数据
进行处理。 
 
图 10- 69 “Calculator”中“dft”函数的设置 
 
图 10- 69 给出了“Calculator”中“dft”函数的设置。处理得的信号为 D 触发器的
正向输出电压“FF_p”，采样",144
" ADC 输出数据的功率谱的细节。 
 
图 10- 70 ADC 输出数据的功率谱 
 
449 
 
图 10- 71 ADC 输出数据的功率谱的细节 
为了能更好的观察输出数据的能量谱，可以将纵轴改为对数坐标系。图 10- 70 变为
图 10- 72 所示。 
450 
 
图 10- 72 对数坐标系 ADC 输出数据的功率谱 
 
图 10- 73 中显示了输出信号功率谱中的输入信号，",149
"升，
“Calculator”
在读取和计算数据时都会花去大量的时间，并且没有直接的函数用来计算信噪比 SNR。
因此更常用的方法是将 Spectre 仿真的数据直接导出到文件中，然后通过 Matlab 读取文
件中的数据，在 Matlab 中通过卷积来绘制 ADC 输出数据的频谱图，并计算信噪比 SNR。
下面将介绍使用 Matlab 处理数据的方法。 
 
首先导出 Spectre 仿真数据到",140
"utput ""filename"" data ?from start_point ?to end_point ?step step_point) 
452 
式可以从“Results Browser”导出到“Calculator”中后获得；“start_point”是开始导出
数据的横坐标；“end_point”是结束导出数据时的横坐标；“step_point”是步进。 
 
下面的命令是针对图 1",99
"令 
 
输出的数据如图 10- 75 所示。 
 
图 10- 75 从 Spectre 中输出的数据 
这里需要注意的是： 
ocnPrint(?output 
""~/CT_ADC"" 
v(""/FF_p"" 
?resultsDir 
""/home.fireworks/wangy/simulation/continuous-ADC/spectre/schematic/psf"" ?resul
t ",91
" Spetre 和 Matlab 的数据格式 
Spetre 
Matlab 
f 
e-15 
p 
e-12 
u 
e-9 
n 
e-6 
m 
e-3 
K 
e3 
M 
e6 
G 
e9 
T 
e12 
当完成数据处理后，可以运行以下 Matlab 程序，进行快速傅立叶变化，并计算信噪
比 SNR。“%”后的内容是注释部分。在这个程序中，需要填入的内容有（“：”后为程
序中的变量",140
"  % oversampling rate 
N = 2048 ;  % window width. 
v1=CT_ADC(ntot-N+1:ntot,2:2);   %  get the exact number of the output as the window width 
  
 
 
 
 
 
 
%  from the end of the output array. 
454 ",67
" 
%  Computer modulator output and actual NTF 
fsignal = 32/4.096 ;  % the signal frequence. 
fs = 1/2e-3;     % sampling frequence. 
  
fbin = N*fsignal/fs; %the number of bins in fft result that rep",66
"1)^2;   % calculate the noise bandwidth 
V = fft(w.*v)/(w1/2);  % do the fft 
 
%computer SNR 
signal_bins = fbin + [-(nb-1)/2:(nb-1)/2];  %calculate the bins number that represent the signal 
inband_",68
" dbp (sum(abs(V(signal_bins+1)).^2) / sum(abs(V(noise_bins+1)).^2));    
455 
 
 
运行 Matlab 程序后，得到输出数据的频谱图，并根据在 Matlab 程序中填入的信号
频率、采样频率和过采样率等信息计算出的信噪比（SNR），如图 10- 76 所示。可以看
出，信噪比为 35.5dB。 
 
图 10- 76 ",131
"'linewidth', 1.5); 
s=sprintf('SNR = %4.1fdB\n', snr); 
text(0.1, -120,s); 
figureMagic ([1/N 0.5],[],[],[-140 0],10,2); 
 
456 
 
对于未单独声明的 MOS 管，其参数如下。 
NMOS： 
 
6
2
n
ox
THn
1
n
10
120 10
A V
0.7
=0",117
"入电压为 1V。 
 
10.2 
计算图 10- 3 中采样开关 MOS 管在采样开始时的等效电阻。 
（a） 时钟信号高电位为 5V，输入电压为 3V，采样电容初始电位为 5V。 
（b） 时钟信号高电位为 5V，输入电压为 3V，采样电容初始电位为 0V。 
 
10.3 
计算图 10- 8 中采样开关 MOS 管在采样稳定后的等效电阻。 
（a） 时钟信号高电位为 5V，输入电压为 3V",188
" 5V，输入电压为 3V。 
（b） 时钟信号高电位为 5V，输入电压为 1V。 
 
10.6 
计算图 10- 8 中由于电荷注入效应引起的误差。 
（a） 时钟信号高电位为 5V，输入电压为 3V。 
457 
（b） 时钟信号高电位为 5V，输入电压为 1V。 
 
10.7 
假设时钟频率为 1kHz，若需要 1MΩ 的等效电阻，计算图 10- 13 中电容大小。 
 
10.8 
根据",176
"比。 
 
10.11 绘出一个 4 位 DAC 的模拟输出-数码输入曲线。它具有±1 LSB 的微分线性度和±1 LSB 积分线性
度。假设任意的模拟满刻度。 
 
10.12 在一个基准电压 VREF为 5V 的理想 12 位 DAC 的输入端加上一个幅值为 1V 的正弦信号，求数字
化模拟信号的最大信噪比 SNR。 
 
10.13 一个 8 位 DAC 电路结构如图 10- 37 所示。假",165
"一致。假设运算放大器的
增益有限，并且为 A，试证明： 
 
458 
图 10- 77 开关电容一阶调制器 
（a） 电容 C2上的电荷 Q2 存在以下时序关系： 
     
( )
(
)
( )
(
)
(
)
( )
(
)
2
2
2
1
ref
2
1
sgn
1
1
in
out
Q
n
Q
n
Q
n
C V
n
V
V
n
C
A
⎡
⎤
=
−
+
−
×
−
−
⎢
⎥
+",170
"成电路设计. 西安： 西安交通大学出版社， 2003 
[2] 
Allen P E. CMOS 模拟集成电路设计. 第 2 版. 北京：电子工业出版社，2005 
[3] 
Franco S. 基于运算放大器和模拟集成电路的电路设计. 第 3 版. 西安： 西安交通大学出版社， 
2003 
[4] 
Johns DA，Martin Ken，模拟集成电路设计，北京，机械工业出版社，2005 
[",156
"demic Publishers，1999 
 
459 
 
附录 
1. 
比较器的 Verilog-A 代码： 
 
// PARAMETERS: 
//   hys = Input voltage threshold, after offset, required for 
//   output to change state [V] 
//   n_off = Offset volta",64
"bstol for clock) [S] 
//   td = intrinsic delay  from threshold cross to output change [S] 
//   tfall = Transistion time for output fall [S] 
//   trise = Transition time for output rise [S] 
//   vt",59
"s active: High  
// 
460 
 
module comp (vin_p, vin_n, enable, vout) ; 
input vin_p, vin_n, enable; 
output vout; 
electrical vin_p, vin_n, enable, vout; 
 
parameter real    td = 50.0u  from (0:inf);",71
"parameter real   one = 5.0; 
parameter real  zero = 0.0; 
parameter real   vth = 2.4; 
parameter real slack = 10.0p from (0:inf); 
parameter integer  init = 1; 
 
real vin, halfhys, outstate; 
 
    a",72
" zero : one ; 
 
        if (traceflag)  begin 
        end 
      end 
461 
 
     
2. 
D 触发器的 Verilog-A 代码 
 
`include ""discipline.h"" 
`include ""constants.h"" 
// d_ff -  D-type flip flop 
// vin_d: ",68
"= voltages above this at input are considered high [V] 
//    vtrans_clk  = transition voltage of clock [V] 
//    tdel, trise, tfall = {usual} [s] 
// 
// Triggered on the rising edge 
vin =V(vin_p) ",65
"ag) 
    end 
 
    V(vout) <+  transition (outstate, td, trise, tfall ); 
    end 
endmodule 
462 
 
module d_ff(vin_d, vclk, vout_q, vout_qbar); 
input vclk, vin_d; 
output vout_q, vout_qbar; 
elect",75
":inf); 
parameter real trise = 1u from (0:inf); 
parameter real tfall = 1u from (0:inf); 
 
   integer x; 
 
   analog begin 
      @ (cross( V(vclk) - vtrans_clk, +1 )) 
         x = (V(vin_d) > vtra",73
", tfall ); 
    end 
endmodule 
 
465
 
图 A- 1 命令行窗口（CIW） 
A.2.1 
命令行窗口（CIW）菜单 
CIW 菜单展开包含的选项如图 A- 2 所示，下面将介绍其中比较重要的一些选项。 
 
图 A- 2  CIW 菜单展开内容 
1. 
“ Files”菜单 
� 
“New”命令 
 
通过选择“File”�“New”，可以建立新的设计",145
"器：例如，如果一个“View”是一个符号（symbol），则 Cadence
将选择 Virtuoso Symbol Editor 打开；如果是一个电路图（schematic）则 Cadence 会选择
 
466
Virtuoso Schematic Editor 来打开；如果是一个版图（layout）则会用 Virtuoso Layout Editor
打开；如果是 Verilog 或 Ver",88
"ger”，可以打开“Library Manager”对话框如图 A- 3 所
示。后面将详细介绍其中的内容。 
 
图 A- 3 “Library Manager”界面 
 
图 A- 4 “Library Path Editor”界面 
� 
“Library Path Editor”命令 
通过选择“Tools”�“Library Path Editor”，可以打开“Library Path ",92
"真环境中切换，以适用于不同的模拟电路和数字电路的混合仿真。 
� 
“Analog Environment”命令 
通过选择“Tools”�“Analog Environment”中的子菜单，可以打开 4 种用于模拟电路仿真
的工具，4 个工具包括： 
“Simulation”：  
 打开 Virtuoso® Analog Design Environment（ADE），如图 A- 5
所示。
",124
"le Tool Box”对话
框，如图 A- 6 所示。这个对话框用于管理设计库和模型库之间的对应关系的设置。  
 
  图 A- 5 “Analog Environment”界面 
 
图 A- 6“Technology File Manager”界面 
3. 
“Options”菜单 
该菜单内的选项主要用于配置“icfb”的环境并保存/载入需要的配置。该菜单中还提供了
用于管理产品秘钥的工",133
"命令行 
CIW 中的输出窗口和命令行合在一起实际上就是一个命令界面。命令语言是 SKILL
语言。图形界面只是在命令行基础上的扩展。在图形界面上的任何操作或者快捷键都是通
过命令行来最终实现的。因而理论上用命令行可以完成一切操作，当然能实际应用中这样
做并不方便。 
命令行的好处是可以采用语言控制复杂的操作，并且可以进行二次开发，将命令与界
面整合起来。这样就提高了整个软件的可扩展性和易用性，这",206
" Library Manager 设计库管理器 
首先介绍的是设计库管理器(Library Manager)。图 A- 3 中的窗口是设计库管理器的窗
口，如果打开平时隐藏的分类(Category)面板和文件（Files）面板则显示界面如图 A- 10 所
示。该界面分为如下几部分：菜单栏、面板显示选项栏、设计库浏览面板和信息，以下将
一一介绍。 
A.3.1 
设计库浏览面板 
设计库浏览面板如",150
"元“pcapacitor”所包含的内容。 
 
469
 
图 A- 10 设计库管理器的分类(Category)面板和文件（Files）面板 
另外，还可以打开“Show Files”选项，显示各个单元和“View”所对应的文件，也就是图
中面板管理器右下角的两栏，标题是“Files in Library”和“Files in Cell”。这里解释各个层次
的含义，以便理解这些栏的用途。 
1)",134
"者顶层模块。 
3) 同一个单元（Cell）在设计中需要不同的表示方法，例如一个模拟电路模块，在设计内
部结构的时候可能需要将它表示为电路图，而在引用该模块的时候则需要将其表示为
一个器件符号。在绘制版图的时候可能需要将该模块表示为版图的一个部分。所以一
个单元就必须有多种表示方式，称为“Views”。上面举例的模块就可以有电路图
（schematic）、器件符号（symbol）、版图（layou",167
"中，用鼠标右键点击设计库、单元或者“View”都会有弹出菜单出现。
其中包含了很多常用命令，比如打开、删除、移动、复制、属性等。这些操作都有完整的
图形界面向导，这里就不再详细介绍。 
A.3.2 
设计库浏览器菜单 
菜单中有很多命令和设计库管理器面板的右键菜单中的命令是相同的，这里主要介绍
其中只有菜单中才有的命令 
 
470
1. 
“ Files”菜单 
� 
“New”命令 
通过选择",187
"，可以从.cdsenv 文件中读取默认设置。 
� 
“Open Shell Window”命令 
通过选择“File”�“Open Shell Window”命令，可以打开 Shell 命令行窗口，在管理设计
库的时候经常要用到一些文件操作，这时可以打开 Shell 窗口，在命令行中进行文件操作。 
2. 
“Edit”菜单 
� 
“Copy”命令 
通过选择“Edit”�“Copy”，可以对",123
"。这表示拷贝整个设计库（Library），即
包括该设计库（Library）中的所有单元（Cell）和每个单元的所有显示（View）。注意，因
为有些单元会包含子单元，因此在拷贝的时候除了拷贝每个单元本身，还需要考虑单元之
间的连接关系。因为这里是拷贝整个设计库，因此不会出现子单元遗漏没有拷贝的情况，
因此只需要考虑单元间的连接关系是否也被拷贝到新的设计库中。在“Copy Library”窗口有
",175
"图 A- 12 中窗
口标题被圈出的部分，其中三个名称依次为：“old”（单元所在设计库的名称）、“top”（单
元名称）和“schematic”（单元显示类型）。单元“down”的从属关系在“Edit Object Properties”
窗口中显示。在“Library Manager”窗口中拷贝设计库“old”到新的设计库“new”。图 A- 13 显
示了没有选择“Update Instan",125
"old”中单元“top”和子单元“down” 
 
472
 
图 A- 13 没有选择“Update Instance”拷贝后的设计库“new”中的单元“top”和子单元“down” 
 
473
 
图 A- 14 选择“Update Instance”拷贝后的设计库“new”中的单元“top”和子单元“down” 
如果在“Library Manager”窗口中不仅选择了设计库（Librar",117
" 
474
 
图 A- 15 只选择“Library”和“Cell”以及“Copy Cell”窗口 
“Copy Hierarchical”表示结构拷贝，即拷贝选中单元中所有直接和间接引用的子单元。
继续使用上文中的例子，在设计库“old”的单元“top”中引用了子单元“down”，并将单元“top”
拷贝到新的设计库“new 中”。假如，在“Copy Cell”窗口中不选择“Copy Hier",133
"Copy Hierarchical”的拷贝结果 
 
475
 
图 A- 17 选择“Copy Hierarchical”的拷贝结果 
在“Copy Hierarchical”中包含一个子选项“Skip Libraries”，在这个子选中注明了结构拷
贝中的排除设计库，即来自排除设计库的单元在结构拷贝时不会被拷贝的新的设计库中，
而是在新的设计库中继续引用排除设计库中的单元。例如在“top”单元",133
"gLib”、
“basic”等，用来实现电路中的公共地、引脚等功能。这些设计库中的单元除了常见的
“schematic”、“symbol”等显示方式外还有用于仿真器的显示方式“spectre”、“spectreS”等等，
因此简单的拷贝会造成这些单元中的数据不完整，进而造成电路仿真不能继续。所以在拷
贝时专门提供了排除设计库，将这些软件自己定义的设计库排除在拷贝范围之外，从而保
证了单元数据的完整",172
"用了子单元“down”，并将单元“top”精确结构拷贝到新的设计库“new”中。
注意，在单元“top”中引用的是子单元“down”的“symbol”显示方式，如图 A- 12 所示。因此
在使用精确结构拷贝时，子单元“down”只有“symbol”显示方式被拷贝到新的设计库“new”
中，如图 A- 20 所示。在“Exact Hierarchy”选项下，还有“Extra Views” 
 
4",141
"wn”的“veirloga”显示方式作为额外拷贝一同拷贝到设计库“new”中，
如图 A- 21 所示。 
 
图 A- 20 精确结构拷贝后的子单元“down”（“Extra Views”栏中无内容） 
 
478
 
图 A- 21 精确结构拷贝后的子单元“down”（“Extra Views”栏中为“veirloga”） 
“Copy All Views”选项表示拷贝单元的所有显示方式。当使",141
"iews”选项
和“Exact Hierarchy”选项不能同时作用，因为他们都是用来指定显示方式的拷贝范围。在使
用“Exact Hierarchy”选项时，软件会自动关闭“Copy All Views”选项和“Views To Copy”栏。 
如果在“Library Manager”窗口中不仅选择了设计库（Library）和单元（Cell），还选择
了显示（View），那么在选择“Edit”",119
"e Reference Library”弹出“Rename Reference Library”窗口如图
A- 23 所示。这个命令可以用于批量修改设计中的单元之间的引用，例如，图中演示的就
是将设计库SDIC_bandgap中所有引用自analogLib中的单元改为引用自设计库tsmc35mm。 
� 
“Delete by view”命令 
通过选择“Edit”�“Delete by view",113
"
来修改设计单元或者设计库的所有权和权限。 
� 
“Catagories…”命令 
通过选择“Edit”�“Catagories…”用来建立、修改、删除分类的命令 
� 
“Library Paths” 
通过选择“Edit”�“Library Paths”弹出图 A- 4 中的“Library Path Editor”，从而修改设计库
的路径。 
 
图 A- 23 “Rename Refer",103
"so® Schematic Editor 电路图编辑器简介 
在电路设计的过程中，模拟电路的设计主要是依靠电路图编辑器(Schematic Editor)完
成。电路图编辑器可以通过在 CIW 或者设计库管理器中新建或者打开单元的电路图 
(schematic)“View”打开，其基本界面如图 A- 26。下面介绍电路图编辑器的使用方法。 
 
481
 
图 A- 26 电路编辑器 
A.4.1",134
"
增强。因此图 A- 26 中白色的部分，在实际软件中为黑色），是实际用来绘制电路
图的部分。 
� 
鼠标命令：提示鼠标的左中右键分别对应的命令。 
� 
提示：显示的是当前命令的提示信息。 
A.4.2 
常用命令 
在一般电路设计中常用的命令一般有以下几个： 
1. 
添加器件： 
1) 
点击快捷键“i”；或者选择菜单“Add”�“Instance”；或者点击按钮“
”，弹出“Add 
I",179
"型之后，窗口中将会出现一些器件的初始参数设置。可以在其中直接
输入需要的器件参数，其界面如图 A- 28 所示。 
3) 
这时将鼠标指针移动到电路编辑器的工作区将会有器件的符号跟随鼠标指针移
动。 
4) 
点击按钮“Rotate”/“Sideways”/“Upside Down”则在工作区中显示的器件符号会相
应旋转/水平反转/垂直反转。 
5) 
这时在工作区单击，器件最终位置将被确定，符号",174
"d”�“Wire 
(Wide)”；或者点击按键“
”/“
”，分别在电路图中添加细连接线/粗连接线 
 
483
 
图 A- 29 连接线的设定 
2) 
调用命令后，在工作区单击鼠标左键确定连线的第一个端点，然后拖动鼠标，将
看到连线的走线方式。此时点击右键，可以在不同的走线方式之间切换；再次点
击鼠标左键，确定第二个端点，连接线被确定。在确定第二个端点之前，如果按
F3 键会调出详细设置如",178
"法。 
4. 
添加标签(Label) 
1) 
点击快捷键“i”；或者选择菜单“Add”�“Label”；或者点击按钮“
”，探出“Add Wire 
Name”对话框，如图 A- 31 所示 
2) 
在“Add Wire Name”对话框中输入标签名字之后，如果将鼠标指向电路图，则会
出现随鼠标移动的标签；鼠标点击后标签位置被确定。如果标签被放置在连线上，
则该连线会被用标签的名字命名。 
",162
"贝 / 拖 动 / 移 动 ； 或 者 选 择 菜 单
“Edit”�“Copy”/“ Stretch”/“Move”分别是拷贝/拖动/移动；或者点击按钮“
”/“
”
分别是拷贝/拖动。 
3) 
首先选定需要操作的电路部分，包括器件、连线、标签、端口等；然后调用命令；
这时点击鼠标左键确定基准点；这时移动鼠标发现选定部分随鼠标指针移动，移
动量相当于基准点到现在指针所在点之间的距离；再次点击鼠",198
"其它部分
的连接线的走线方式。 
注意：可以用鼠标在工作区框选电路的一部分。按住 Shift 键框选表示追加部分；按住
Ctrl 键框选表示排除部分；可在同一个 icfb 中打开的不同电路图之间使用拷贝和移动命令；
 
485
拖动命令只能在当前电路中进行。 
6. 
删除器件 
1) 
选择电路的一部分 
2) 
点击键盘“del”键；或者选择菜单“Edit”�“Delete”，将选中的部分删除",168
"以选择设置应用范围： 
only current： 只修改但前器件； 
all selected：  修改所有选中器件； 
all：  
 
电路图中所用相同器件。 
第二个下拉菜单可以选定需要修改的元素类型 
instance： 
器件实例； 
wire segment：连接线。 
4) 
在“Edit Object Properties”中修改器件的属性，完成后点击“OK”或者“Apply”保",113
"3 个命令： 
 
486
下降编辑： 用编辑模式进入一个子模块（如果没有足够的权限会自动为只读模
式）； 
下降只读： 
用只读模式进入一个子模块； 
回退： 
 
如果下降到了子模块中，可以用这个命令回到上一层。 
2) 
操作 
快捷键： “E”/“e”/“Ctrl+e”分别是下降编辑、下降只读、回退 
菜单： 
“Design”�“Hierarchy”�“Descend Edit ”/“D",162
"存、检查保存、另
存。 
按钮：“
” /
“分别是保存、检查并保存。 
注意：电路仿真中经常依靠电路图编辑器的检查功能查找一些明显的错误，所以
一般应该使用检查并保存选项，而不要强行保存。 
11. 
撤销和重做（只支持最近一次操作的撤销和重做） 
键盘：“u ”/ “U”键分别是撤销和重做。 
菜单：“Edit”�“Undo ”/ “Redo”分别是撤销和重做。 
按钮：“
 ”/“
”分别是",177
"名为 vdd。这个器件只用来标示等电位，而不是电源。 
� 
vdc/idc： 
 
 
直流电压/电流源，用于为电路提供直流电压/电流。同时还可以提供交流电流，
在交流（AC）分析中使用。 
� 
vpulse： 
 
487
 
时变电流源，在 DC 分析中可以输出固定的 DC 电压，AC 分析中可以输出固定
的 AC 电压，在瞬态分析中可以生成不同占空比的方波、三角波、梯形波、锯齿
波。 
",171
" Name 栏应当填上
nvn、pmos4 填 nvp、pnp 填 pnp5，否则电路将不能正确进行仿真。 
� 
res / cap / ind： 
 
 
 
这三个器件分别是电阻、电容、电感。如果进行简单仿真，这些器件参数设置中
不需要指定模型名称，这是这些器件将表现为理想器件。如果需要根据工艺详细
仿真，则可以在器件参数设置中，根据工艺模型库中的电阻、电容、电感的模型
定义这些器件。 
A",166
"Analog Environment”，这是打开的 ADE
窗口中已经设置为仿真调用 ADE 的电路图。 
在介绍仿真的过程之前，先介绍一下 ADE 的界面。图 A- 34 是 ADE 的基本界面。窗
口中的主要部分在图中已经标出。 
 
488
 
图 A- 34 ADE 的基本界面 
 
A.5.1 
使用 ADE 进行仿真的基本流程 
1. 
选择仿真的电路 
如果是从 CIW 窗口中打开的",151
"使用的 spectre 仿真器来说，应当使用.scs 模型库文件。为了
配置模型库，可以在菜单中选择“Setup”�“Model Libraries”，然后有如图 A- 36 所示窗口出
现。 
 
489
 
图 A- 36 工艺库文件设置 
在这个窗口中可以在“Model Library File”栏输入需要使用的模型库文件名，在“Section”
栏输入该模型文件中需要的段(Section)",124
"中选择一个或几个对其做禁用、启用、修改或删除操作。 
 
图 A- 37 工艺库文件的选择 
 
图 A- 38 仿真变量设置
3. 
设置变量 
由于电路中作任何改变之后都需要检查完整性并保存，所以在对电路进行仿真时，经
常在电路中定义一些变量作为器件的参数。例如可以将一个 MOS 管的宽度定义为 w = W1，
 
490
则 W1 就成为一个设计变量。这些设计变量在仿真中都需要赋值，否则仿真",166
"
4. 
设置分析类型 
根据不同的需要，可以对电路进行不同类型的分析。常用的有直流（DC）分析、交流
（AC）分析、瞬态(Transient)分析、噪声分析、零极点分析。其中又以前三种最为常用。
设置仿真的时候，可以点击菜单“Analyze”�“Choose”或按钮“
”，如图 A- 39 所示的仿真
设置选择菜单就会打开。 
 
图 A- 39 仿真设置选择窗口 
选定需要的仿真类型后，该仿真",168
"就
会出现。在电路图中选择连线会在输出中添加该线的电压；选择一个器件的端口
则会添加这个端口的电流作为输出；直接选择一个器件则会把该器件的所有端口
电流都加入输出。 
2) 
也可以手动添加输出，在菜单中选择“Output”�“Edit”或按钮“
”可以打开如图
A- 40 所示的窗口。在该窗口中可以添加需要的输出的表达式。如果表达式比较
复杂，还可以点击“Calculator”栏的“open”按",160
"态，进行导入。 
 
图 A- 43 导入以前的仿真状态 
3) 
点击菜单“Session”�“Save Script”可以将现在的仿真设置保存成“OCEAN”脚本，
利用该脚本，可以在命令行执行仿真任务。 
A.6 瞬态分析（Transient Analysis） 
瞬态仿真分析是在给定的输入激励下，在设定的时间范围内计算电路的时域瞬态响应
性能。要验证设计电路的稳定性、速度、精确度等问题必须",167
".6.1 
仿真参数设置 
打开“Analog Design Environment”�“Analyses”�“tran”，基本参数设置界面如图 A- 44
所示。主要内容包括用于控制仿真时间的“Stop Time”和用于控制仿真速度和精度的
“Accuracy Defaults（errpreset）”设定。 
1) 
“Stop Time”仿真终止时间的设定。 
在默认设置中瞬态分析总是从 t ",127
"ral”的仿真速度最快，但是精确度最低。这种精度的仿真适合于数字电路或
者是变化速度较低的模拟电路；“moderate”作为仿真器默认的设置，其精确度类似于
用 SPICE2 计算的仿真结果；“conservative”的具有最高的精确度但速度最慢，适合于
敏感的模拟电路仿真。 
A.6.2 
常用于瞬态仿真的激励信号源及其参数设置 
在功能介绍部分曾经提到瞬态仿真时需要读者自行设计多种电路工作环",196
"信号，也可用来表示电源上电或者电源跳变过程等。打开“vpulse”的参数列表如图 A- 45
所示。该参数列表包括两部分“Property”和“CDF Parameter”。其中“Property”部分在从
“analogLib”中选中信号源后由系统自动填写。值得注意的时，在“View Name”一栏中应当
采用“symbol”。图 A- 45 中“CDF Parameter”只截取了一部分有关瞬",132
" time 
延迟时间 
100μ 
s 
Rise time 
上升时间 
0 
s 
Fall time 
下降时间 
0 
s 
Pulse width 
脉冲宽度 
50μ 
s 
Period 
周期时间 
100μ 
s 
2. 
分段信号“vpwl” 
当用户需要自己定义线性分段波形是是可以利用“vpwl”信号源。它允许用户定义分段时
刻和该时刻的电压值。该信号源的设置参数和“vpu",141
"电压 
2 
V 
Time 2 
第 2 个转折点时间 
250μ 
s 
Voltage 2 
第 2 个转折点电压 
2 
V 
 
495
Time 3 
第 3 个转折点时间 
500μ 
s 
Voltage 3 
第 3 个转折点电压 
5 
V 
Time 4 
第 4 个转折点时间 
1m 
s 
Voltage 4 
第 4 个转折点电压 
5 
V 
 
 
图 A- 46 ",140
" 和图 A- 48 分别是正弦信号
 
496
“vsin”的设定参数以及对应的波形。 
表 A- 3 正弦信号“vsin”的设定参数 
参数 
含义 
实例 
单位 
Amplitude 
振幅 
3 
V 
Frequency 
振荡频率 
10 
Hz 
Delay time 
延迟时间 
0 
s 
Damping factor 
阻尼因子 
1 
1/s 
 
 
图 A- 48 表 A",126
" RC 充放电电路来完成一次瞬态仿真，该电路图如图 A- 50 所示。电阻
和电容都采用“analogLib”中的理想电阻模型和理想电容模型。激励源是“vpluse”周期性方
波。采用“conservative”的精度。由于没有设置初始条件，仿真器会先执行直流分析，将其
结果作为初始解。仿真的结果如图 A- 51 所示。 
 
图 A- 50 用于瞬态仿真的 RC 电路 
 
498
 
图 A-",170
"仿真器将计算各个节点的电压，各支路电流，包括 MOS 管的
各个直流参数，例如跨导（gm），阈值电压（VTH），工作区域（region）等。而在直流特性
扫描中包含了电路的温度（Temperature），设计变量（Design Variable），器件参数（Component 
Parameter），器件模型参数（Model Parameter）等多个参数的特性仿真。 
A.7.1 
仿真参数设置",137
"变量，方便设计和修改。比如，可以将电源电压（VDD），MOS 的栅长（L）
和栅宽（W）设置为变量，使用变量扫描，观察电路在各种设计下的工作情况。 
� “Component parameter”：器件参数扫描，和“Design Variable”扫描比较类似。不过，
器件参数扫描不用预先将电路中某器件参数设置为变量（Variable）。 
� “Model Parameter”：如果用户能够对库",148
"计算（Add Specific 
 
499
Points）。 
 
图 A- 52 “DC Analysis”参数设定 
 
图 A- 53 “Temperature”扫描设定 
� “Sweep Range”：指定扫描范围，可以包括指定起始值（Start-Stop）或指定中点值
（Center-Span）两种方式。 
� “Sweep Type”：指定扫描方式。步进可以是线性的（Linear）",113
"制仿真精
度和时间。当用户对输出模式没有特殊要求时，可以采用系统默认设置
（Automatic）。系统默认的设置是在当终值与初值比小于 10 时，采用线性模式输
出。而在该比例大于 10 时，采用对数模式输出。三种模式的设置窗口见图 A- 54。 
� 
“Add Specific Points”：加入特殊点计算。在仿真过程中，用户可以指定某些点一
定需要计算，在该选项中添加即可。各点之间用空格隔",164
" 
 
图 A- 55 “Design Variable”设定 
A.7.2 
设计实例  
 
以一个简单共源级放大器为例说明“DC Analysis”的仿真过程，电路如图 A- 56 所示。
直流仿真的激励源使用普通的“analogLib”�“vdc”即可。 
1. 
设计变量扫描“Design Variable” 
 
在图 A- 56 中，将对 M0 的偏置电压由 3V 改变设置为变量“V",137
"输出电压的变化情况。 
 
501
 
图 A- 56 共源级放大电路 
 
图 A- 57 选择扫描变量 
 
502
 
图 A- 58  “Vout” 随”VBIAS”变化的 
仿真波形 
2. 
器件参数扫描“Component” 
器 件 参 数 扫 描 和 设 计 变 量 扫 描 相 类 似 。 点 击 “Component Parameter”�“Select 
Component”",130
"0 管参数 
 
503
 
 
图 A- 60 M0管的栅长从 1μm 到 20μm 变化时的输出电压变化 
有些转移曲线的绘制需要用“DC Analysis”中的参数扫描和其他仿真工具混合使用。比
如 MOS 管的转移曲线就需要“Design variable”和“Parameter analysis”共同使用，仿真结果如
图 A- 61 所示。                        ",124
".8 交流小信号分析（AC Analysis） 
交流小信号分析（AC Analysis）是用来计算电路的小信号频率响应特性。在分析时，
仿真器首先计算电路的直流工作点，然后将电路在工作点附近线性化，并以此计算电路的
频率响应。仿真时需要设置专门的交流信号源。类似于直流分析（DC analysis），在交流小
信号分析中，设计者同样有“Frequency”、“Design Variable”、“T",149
"的设定 
注意：如果是做“Frequency”扫描，“Sweep Range”填写的是频带范围。目的是观察电
路系统对不同频率信号的响应。而在其他扫描方式中例如“Temperature”扫描中，“Spectre”
要求用户指定在某个频率点上进行仿真。因此，用户在“At Frequency（Hz）”中填写仿真
频率，而在“Sweep Range”中填写的是温度扫描范围。其他参数扫描的设置也类似如此。",158
"在图 A- 64 中，由于交流信号是直接从“M0”管的栅极加入，那么在具有交
流信号的同时，必须要给该 MOS 管设置一个直流偏置电压。在信号源中需要设置交流振
幅和直流偏置。如图 A- 65，在“vsin”信号的设置中包括交流信号幅值（AC magnitude），交
流信号相位（AC phase），直流偏置电压（DC voltage）等多个选项。“AC magnitude”通常
都设置为 1V，",159
"1.5V，交流幅值设置为 1V，该 MOS 管阈值电压 1V。那
么“M0”会不会进入到截止区呢（1.5V-1V<1V）？实际上仿真结果显示“M0”管不可能进入
截止区。在本章最开始陈述过，“AC Analysis”的前提是先进行了“DC Analysis”。所以，电
路状态固定，加入交流信号后不会影响直流工作点。在计算电路交流增益时，仿真器是将
输出端的交流信号幅值除以输入交流信号幅值。所以，“",183
"拉菜单中，表示多种方式输出： 
“Mag”：幅度绝对值曲线。 
“Phase”&“WPhase”：相位曲线，两者不同之处在于“Phase”是从 360°开始作图，而
“WPhase”是从 0°开始作图，如图 A- 67 所示。 
“Real”，“Imag”：由于频域在数学上往往可以用 exp 的指数形式表示，所以可以用实
虚数来表示。 
“dB10”，“dB20”：在波特图中幅频特性通常换算成分贝",162
"ion）详
见“瞬态分析（tran analysis）”中的介绍。
507 
 
图 A- 67 “phase”与“wphase”分析图 
 
图 A- 68 电压增益与频率的关系
 
508 
 
附录 B  Results Browser 
“Results Browser”是一个非常实用的工具，通过它可以读取所有节点的电压和选中的
端口电流的仿真结果。并且可以对数据进行预处理，在合适的窗口类",130
"Results Browser”采用类似 Windows 文件系统的方法，将仿真数据分级保存在各个文
件夹中。通过点文件夹，可以将文件夹展开，从而进入下一级文件夹获得更具体的信息。
图 B- 1 显示了“Results Browser”窗口。 
 
图 B- 1 “Results Browser”窗口 
B.1.1 
“Results Browser”的菜单。 
“Results Browser”",116
"  
Open Graph as Template… 
以模板的形式打开保存图形 
Open Table 
打开保存的表格 
Clear 
将选中的仿真结果，从“Results Browser”中清除。当只有一个仿真结果时，无需
选择，即可将其清除。 
Reload 
重新读取仿真结果 
Save Session 
保存当前“Results Browser”的设置 
  
Close 
关闭“Re",98
"的波形。 
510 
New SubWin 
在原来的窗口中，建立子窗口，用来显示新的波形。 
New Win 
创建一个新的窗口显示新的波形。 
Graph Type 
  
Default 
默认方式 
Rectangular 
直角坐标系 
Polar 
极坐标 
Impedance 
阻抗圆图 
Admittance 
导纳圆图 
  
RealVsImag 
实部 VS 虚部 
Tool",120
"开仿真的输出结果，等同“File”�“Open Results” 
� 
：按照“Plot Style”中选择的方式，以图形的方式显示选中的仿真结果 
� 
：打开“Calculator”，如果在“Results Browser”中选择仿真结果。那么该结果的表
达式将直接送到“Calculator”的缓存中。 
� 
：选择两个仿真结果，将它们的差值以图像的形式输出。 
� 
注意：该快捷键在一个",133
"orner Analysis”或者“Parametric Analysis”后，该选
项被激活。可以通过它选择特定功能角或者设计变量值下的仿真结果，等同于
“Setting”�“Select Data”。 
511 
2. 
第一个下拉菜单 
 
图 B- 4 第一个下拉菜单中的内容 
 
图 B- 5 第二个下拉菜单中的内容 
 
如图 B- 4 所示，第一个下拉菜单是选择图表类型，等同于“Se",133
"。 
� 
Phase：计算仿真结果的幅角。 
� 
WPhase：计算仿真结果的幅角，并在 0~360 度的范围内显示。 
� 
Real：取仿真结果的实部。 
� 
Imag：取仿真结果的虚部。 
� 
dB10：对仿真结果进行“10log n”变化。 
� 
dB20：对仿真结果进行“20log n”变化 
4. 
 第三个下拉菜单 
如图 B- 6 所示，第三个下拉菜单是选择创建显示窗口的",157
"拉菜单中选择了“~/simulation/BIAS_P/spectre/ schematic/psf”，
发现该仿真结果出现在“Result Browser”中，如图 B- 8 中左栏内的高亮部分所示。 
513 
 
图 B- 8 “Results Browser”中仿真结果的保存路径的下拉菜单 
B.1.4 
“Results Browser”窗口的主体部分 
“Results Browser",109
" 
finalTimeOP-info 
仿真结束时器件参数的工作点 
ac-ac 
交流仿真中所有节点电压值和选择保存端口的电流值 
dcOp-dc 
工作点的直流仿真，所有节点的电压值和选择保存的端口电流值 
dcOpInfo-info 
工作点的直流仿真，所有器件的参数。在该文件夹下有以器件名命名的子文件夹，分别保存各个器件的直
流工作点参数。 
dc-dc 
直流扫描仿真时，所有节点电压值和",156
"designParamVals-info 设计参数值 
variables 
设计变量。该文件夹下包含以设计变量名命名的子文件夹，分别保存各个设计变量的信息。 
B.2 启动“Results Browser”并读取仿真结果 
B.2.1 
打开“Results Browser” 
通过下面任意一种方式可启动“Results Browser”： 
1) 
在 Unix 命令行中键入“wavescan",114
"弹出“Results Browser”窗口。 
B.2.2 
读取仿真结果 
通过选择“File”�“Open Result”或者快捷键
打开“Choose Data Directory”窗口，如
图 B- 9 所示，从而选择仿真结果保存路径。 
 
图 B- 9 选择仿真结果保存路径 
 
 “Choose Data Directory”窗口打开时，将“icfb”的启动路径作为默认路径。在 AD",117
".3 在“Results Browser”中选择数据 
比较图 B- 10 和图 B- 11，可以发现“Results Browser”中文件夹系统和“Windows”操作系
统中的文件夹系统十分类似。 
 
图 B- 10 “Results Browser”中文件夹 
 
图 B- 11 “Windows”中的文件夹 
如同在“Window”操作系统中，在左边的资源管理器中完成文件的选择、打开和",112
"方式，
以图形的方式显示选中的仿真结果。 
2) 
在选中需要的仿真结果后，点击鼠标右键，此时弹出一个选项菜单，如图 B- 12
所示。下拉菜单中各个选项的功能： 
 
图 B- 12 点击鼠标右键出现的下拉菜单 
� 
 “Append”：以“Plot Style”为“Append”的方式，显示选中的仿真结果。 
� 
“Replace”：以“Plot Style”为“Replace”的方式，显",145
"“Results Browser”中对仿真结果的预处理不在生效。例如在图 B- 12 中，
第二个下拉菜单选择“Phase”，即输出仿真结果的幅角。这个功能对上述 5 个选项都有用。
但是对于“Calculator”选项，送到“Calculator”中是未经处理过的数据。如果需要显示幅角，
则需要在“Calculator”中对该数据使用“phase”函数。 
B.4.2 
将仿真结果输出到“Cal",129
"13 中所示。选择第二个仿真结果后，将按照“Plot Style”中的设置输
出两个仿真结果的差值，即“Result1 – Result 2”。 
 
 
图 B- 13 输出两个数据的差值  
B.4.4 
将两个仿真结果采用 YvsY 的方式输出 
 
在选择第一个仿真结果后，点击快捷按键“点击快捷按键“
”，此时“Results Browser”
将会提示选择另一个仿真结果，如图 4.12 ",141
"- 3 MOS 管工作区域的数字表示 
Region 
工作区 
0 
关断 
1 
线性区 
2 
饱和区 
3 
亚阈值区 
4 
击穿 
518 
3) 
reversed：MOS 管是否反向，可能值为 yes 或 no。 
4) 
ids (A)： 阻性漏源电流 
5) 
lx4 (A)： ids 的别名，当 MOS 管反向时有相反的符号。 
6) 
lx50 (A)：衬源电流。 
7) ",148
" 
15) gm / lx7 (S)：共源跨导。 
16) gds / lx8 (S)：共源输出跨导。 
17) gmbs / lx9 (S)：衬底跨导。 
18) betaeff (A/V2)：有效 β 值。 
19) cjd / lx29 (F)：漏区衬底结电容。 
20) cjs / lx28 (F)：源区衬底结电容。 
21) lx12 (Coul)：衬底电荷（Qb） 
22) lx14 ",146
"Vb 
30) cdg / lx32 (F)：dQd_dVg 
31) cdd / lx33 (F)：dQd_dVd 
32) cds / lx34 (F)：dQd_dVs 
33) cdb (F)：dQd_dVb 
34) csg (F)：dQs_dVg 
35) csd (F)：dQs_dVd 
36) css (F)：dQs_dVs 
37) csb (F)：dQs_dVb 
38) cbg",132
"(A)：源端 PN 结电流。 
47) lx6 (A)：漏端 PN 结电流。 
48) pwr (W)：处于工作点时的功耗。 
49) gmoverid (1/V)：Gm/Ids 
50) lv36 (F)：栅源交叠电容。 
51) lv37 (F)：栅漏交叠电容。 
52) lv38 (F)：栅衬底交叠电容。 
53) lx10 (S)：漏区二极管跨导。 
54) lx11 (S)：源区二极管跨",157
"m”窗口简介 
C.1.1 
 “Waveform”窗口界面。 
 
图 C- 1 典型的“Waveform”窗口 
C.1.2 
 “Waveform”窗口的菜单 
 
图 C- 2 列出了“Waveform”中的所有菜单（除“Bus”字菜单），它们的功能见表
C- 1 
521 
 
图 C- 2 “Waveform”的菜单 
表 C- 1 “Waveform”中的所有菜单和它们的功能 
菜单",142
"Save Session 
保存当前“Waveform”窗口的设置。 
Close 
关闭当前“Waveform”窗口。 
  
Exit 
关闭所有“Waveform”窗口。 
Edit  
Move 
移动选中的标签或记号。 
Swap 
移动两个波形、相关坐标轴或者图表。 
Delete 
删除选中的标签、记号、图例、波形或者图表。 
Hide 
隐藏选中的标签、记号、图例、波形或者图表。 ",128
"窗口。 
Horizontal 
横排显示子窗口。 
  
Card 
层叠显示子窗口。 
Display Type 
图标类型。 
Rectangular 
直角坐标系。 
Histogram 
柱形图。 
RealVsImag 
实部 VS 虚部。 
Polar 
极坐标。 
Impedance 
阻抗圆图。 
  
Admittance 
导纳圆图。 
Font 
字体大小选择，影响标题、子",120
"
Snap Off 
选中后，波形上的数据读取框追随系统鼠标。 
Snap-to-Data 
选中后，标记仅仅作用在仿真数据点上。 
Snap-to-Peaks 
选中后，标记仅仅作用在波形峰值上。 
Color Schemes 
设置背景色。 
Defualt 
使用默认背景色，通常为白色。 
Gray 
背景色设为灰色。 
  
Black 
背景色设为黑色。 
Template 
模板设置。",145
"标轴的主网格。该选项只在坐标轴选中后才被激活。 
Minor Grids On 
选中后将显示选中坐标轴的次网格。该选项只在坐标轴选中后才被激活。 
Log 
选中后将选中的坐标轴切换到对数模式。该选项只在坐标轴选中后才被激活。 
Strip 
将每条波形单独分栏显示。 
  
  
  
  
Edit 
打开“Axis Atrributes”对话框。该选项只在坐标轴选中后才被激活。 
Trac",183
"一个新建的“Waveform”窗口中。 
Copy New SubWindow 
将选中波形拷贝到一个新建的“Waveform”子窗口中。 
  
Move New SubWindos 
将选中波形移动到一个新建的“Waveform”子窗口中。 
Bus  
Create 
根据选中的数字波形，创造一条总线。 
  
Expand 
将总线中的数据分开显示。 
Trace Cursor 
开启或关",119
"格式保存波形。 
524 
Edit 
打开“Trace Attributes”对话框。该选项只有在波形被选中时才有效。 
Select All 
选中当前“Waveform”窗口中的所有波形。 
Mark  
Place 
  
Trace Marker 
在波形上添加一个标记，包含该点的横竖坐标。 
Vert Marker 
在波形上添加一个标记，包含该点的横竖坐标，并做一条通过该点的垂直线。",135
" 
Find Max 
将标记移动到选中波形的最大值处。 
Find Min 
将标记移动到选中波形的最小值处。 
Create 
打开“Marker Attributes”对话框，从而创建一个新的标记。 
Edit 
打开“Marker Attributes”对话框，从而编辑选中的标记。 
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
Select A",99
" Left 
将图表左边的部分移至显示区域。 
Pan Up 
将图表上边的部分移至显示区域。 
  
  
  
  
  
  
  
  
  
  
  
  
  
Pan Down 
将图表下边的部分移至显示区域。 
525 
Tools  
Browser 
打开“Results Browser”。 
  
  Calculator 
打开“Calculator”。 
Help  
",90
"do”。 
� 
：显示/隐藏网格，等同于“Graph”�“Grids On”。 
� 
：将每条波形单独分栏显示，等同于“Axis”�“Strip”。 
� 
：层叠显示子窗口，等同于“Graph”�“Layout”�“Card”。 
� 
：将选中波形移动到一个新建的“Waveform”子窗口中，等同于“Trace”�“New 
Graph”�“Copy New SubWindow”。 
� ",130
"择“Tools”�“Analog Environment”�“Waveform”。 
� 
在 ADE 窗口中，选择“Tools”�“Waveform”。 
� 
当仿真完成后，在 ADE 窗口中，点击“Plot Output”快捷键。 
� 
在“Results Browser”中，选择将仿真结果送至“Waveform”显示。 
� 
在“Calculator”中，选择将仿真结果送至“Wavef",110
"t Auto”：这是系统默认子窗口排列方式，将根据窗口
高和宽的比值自动选择合适的模式，当子窗口的宽度大于高度，采用竖排布局
的方式。当子窗口的宽度小于高度，则采用横排布局的方式。 
� 
选择“Graph”�“Layout Vertical”：如图 C- 4 所示，采用该方式时，子窗口
将成纵向排列。 
 
图 C- 4 纵向排列字窗口 
 
527 
图 C- 5 横向排列字窗口 
� 
选择",174
"C- 6 堆叠形式排列字窗口 
 
图 C- 7 设置背景颜色 
528 
C.3.2 
设置背景颜色 
 
对于 ADE WaveScan 和标准 SKILL WaveScan 程序，默认的背景颜色是黑色。但是
可以通过选择“Graph”�“Color Schemes”来设置背景颜色。候选项如图 C- 7 中所示： 
� 
Default：将背景色设置为白色。 
� 
Grey：设置背景色为灰色",145
"一次选择多个对象时，按住“Ctrl”键，用鼠标依次点击需要的对象。 
 
如果“.cdsenv”中“autoTraceSelect”选项为“true”（这是默认值），那么在选择波形时，
将自动选择离鼠标最近的波形，而不需要精确地点中波形。这在“Waveform”窗口中存在
多条波形的时候非常有用。反之当“autoTraceSelect”选项为“False”，那么必须点中波形才
能将其选择。 
2.",156
"dit”�“Reveal”。此时会出现一个列表显示被隐藏的对象名称。 如
图 C- 8 所示。 
2) 
在该列表中选择需要重现的对象。 
被选中的对象将重新出现在“Waveform”窗口中。 
529 
 
图 C- 8 重现隐藏对象 
 
图 C- 9 使用鼠标直接缩放窗口 
4. 
交换对象 
 
采用分栏显示的波形、统一图表中两个拥有相关 X 轴的 Y 坐标轴、以及两个子窗
口都可以通过下",158
"elete”，或者点击键盘上“Del”按键。 
选中的对象即从“Waveform”窗口中删除。 
6. 
撤销操作 
 
通过一下方法可以撤销最近的一次操作 
 
选择“Edit”�“Undo” 
 
注意：当执行“Undo”操作后，最近的一次操作就是该次“Undo”操作了。因此第二次
选择“Undo”命令的效果则是恢复上次被撤销的操作。 
C.4 缩放图表 
通过以下方式可以完成图表的缩放操作。",146
" 轴。选择“Zoom”�“X-Zoom”
后，鼠标变为“
”。点击鼠标确定 X 轴缩放的起始点，拖拽鼠标确定缩放范围，释放
鼠标确定缩放的结束点。然后根据选择的 X 轴范围重新显示图表。 
� 
“Y-Zoom”命令 
 
通过选择“Zoom”�“Y-Zoom”命令可以仅仅缩放 Y 轴。选择“Zoom”�“Y-Zoom”
后，鼠标变为“
”。点击鼠标确定 Y 轴缩放的起始点，拖拽鼠标确定缩放范围，",190
"31 
 
图 C- 10 “Zoom�ZoomIn”命令的缩小比例 
 
图 C- 11“Zoom�ZoomOut”命令的放大比例 
� 
 “ZoomOut”命令 
 
通过选择“Zoom”�“ZoomOut”，以图表中心点为坐标缩小图表，如图 C- 11 所
示。 
C.5 平移图表 
 
通过选择“Zoom”�“Pan”中的四个下拉菜单“Pan Right”， “Pan Left”， “P",128
"ht”一样，以对应坐标轴的 20%为平移量，只是平移方向不同。 
C.6 编辑图表属性 
 
图表的默认属性是通过“.cdsenv”中的选项设置的。如果需要修改图表属性，可以通
过以下步骤来实现。 
1) 
通过选择“Graph”�“Edit”，或者在图表中双击鼠标，打开“Graph Attributes”
对话框，如图 C- 14 所示。在“Title”栏中可以给图表命名，或者选择“Defaul",149
"。 
4) 
“Legend Row”栏后的“Show”选项表示是否显示图例。 
 
图 C- 14“Graph Attributes”对话框 
 
图 C- 15 移动“Legend”的滚动条 
5) 
在“Font”后的三个下拉菜单依次选择图表中文字的字体、字形和字号。 
6) 
在“Foreground/Background”中分别设置图表的前景和背景颜色。其中前景包括
了图表的标题、子标题",131
"的坐标将用一串问号显示，表示当前坐标没有单位。 
� 
从一个子窗口到另一个子窗口 
� 
从一个分栏到另一个分栏。 
当拖拽波形时，鼠标下方会显示拖拽波形的名称。当选中一条波形后，可以通过以
下菜单命令对创建新的波形窗口，括号中为对应菜单命令的快捷键。 
� 
“Trace”�“New Graph”�“Copy New Window”（ ） 
� 
“Trace”�“New Graph”�“Mo",168
"个图表包含多个波形时，可以将每个波形分栏显示。分栏
后的波形成纵向排列，所有的波形有其独立的 Y 坐标轴，但共用同一个 X 坐标轴。这
种分栏显示只对直角坐标系有效。通过一下的步骤，实现坐标的分栏显示。 
 
选择“Axis”�“Strips”(
)， 图 C- 15 显示了分栏前的图表，图 C- 16 显示了分
栏后的图表窗口。通过拖拽和释放波形，可以实现以下操作。 
� 
将波形放置到另一个分",190
" On”。 
 
如图 C- 17 所示，波形上的“× ”和“□”符号，有效地将两个波形区分。具体符号类型
和数目的设置，见 C.7.4。 
C.7.3 
给波形赋予坐标轴 
 
当“Waveform”窗口或者子窗口中包含多个波形时，可以为波形设置： 
� 
一个新的 Y 轴 
� 
一个已经存在的 Y 轴。如果该 Y 轴的单位和波形不符，则在坐标轴名称中出
现一串问号，表示该坐标轴没有明确的物理",178
"的物理单位。 
 
图 C- 18 波形共用 Y 轴和拥有独立 Y 轴 
537 
 
图 C- 19 波形拥有不同单位 
C.7.4 
修改波形属性 
 
波形的默认属性是通过“.cdsenv”中的选项设置的。如果需要修改波形属性，可以通
过一下步骤来实现。 
1) 
通过选择“Trace”�“Edit”，或者双击波形，打开“Trace Attributes”对话框，
如图 C- 20 所示。 ",148
"，“Strip Chart Visible Rows”栏失去作
用，变成灰色。在 Type/Style 中选择波形的类型 
第一个下拉菜单中选择图表的类型： 
� 
Line：线图。 
� 
Point：点图。 
� 
Bar：直线图。 
� 
Spectral：频谱图。 
� 
Histogram：矩形图。 
第二个下拉菜单中选择线形： 
538 
� 
Solid：实线。 
� 
Dashed",122
" 
� 
Box：空心矩形。 
� 
UpArrow：向上箭头。 
� 
DownArrow：向下箭头。 
� 
X：X 型。 
� 
Circle：空心圈。 
5) 
“Foreground”中选择波形的颜色 
6) 
“Cursor X/Y Offset”中设置鼠标 X/Y 坐标的偏差量。如果这两个值不为零，那
么波形光标的坐标则是根据这两个值的相对量。 
7) 
点击“OK”完成对波形属性的",153
" 
2) 
在“Label”栏中填入坐标中的名称，或者选择“Default”使用默认值。 
3) 
在“Scaling”中选择下面的一种模式，来设置坐标轴范围和网格划分。 
� 
Auto：自动选择坐标轴范围和网格划分。 
� 
Min-Max：手动设置坐标轴范围，自动设置网格划分。 
� 
Manual：手动设置坐标轴范围和网格划分。 
4) 
选择“Log”使用对数坐标 
5) 
选择“Ori",165
"its”中填入坐标轴刻度的有效位数。选择“Default”使用默认有效
位数，同时使“Significant Digits”栏中填入的数字失效。 
9) 
在“Foreground”中选择坐标轴的颜色。 
10) 当编辑 X 轴属性时，还有以下选项： 
540 
� 
如果选择的波形来自于非参变量扫描仿真结果，那么会出现“Plot vs”栏，
如图 C- 23 所示。在该下拉菜单中包含所有的该类型",149
" Analysis”中设置的扫面变量。
通过在该下拉菜单中的选择，可以将需要的扫面变量作为 X 轴，从新显示
波形。在图 C- 24 中，“temp”是 ADE 中的扫描变量，而“res”是“Parametric 
Analysis”中设置的扫面变量。在图 C- 25 中，左边的子窗口显示了以“temp”
作为 X 轴的方针结果，而右边的子窗口显示了以“res”作为 X 轴的仿真结
果。这种功能十",156
"下拉菜单中的内容 
 
图 C- 25 不同 x 轴的波形 
C.9 关于鼠标的操作 
C.9.1 
使用波形光标 
 
波形光标是一个沿着波形移动的光标，该光标的坐标在图表的左下角显示。同时图
表的右下角显示了鼠标光标的坐标值。如图 C- 26 所示。 
1) 
选择“Trace”�“Trace Cursor”，开启波形光标。 
2) 
通过以下方法移动波形光标： 
542 
� 
移动鼠标光标",175
"式： 
� 
“Graph”�“Snap Off”：波形光标在数据点间平滑的移动。 
� 
“Graph”�“Snap-to-Data”：波形光标从一个数据点跳跃到下一个数据
点。 
� 
“Graph”�“Snap-to-Peaks”：波形光标从一个峰值跳跃到下一个峰值。 
波形光标
鼠标光标坐标
波形光标坐标
 
图 C- 26 波形光标和其数据显示 
C.9.2 
使用垂直光标 
 
垂直光",171
"，这条直线和波形的交汇处用一个红色的空心
矩形显示。交汇处的 X/Y 坐标在图例区波形名称后对应显示。通过拖拽水平光标直线左
边的三角形来移动水平光标，当水平光标移动时，交汇处的 X/Y 坐标值也实时更新。选
择“Trace“�“Horiz Cursor”，开启水平光标。如图 C- 28 所示。 
 
图 C- 27 垂直光标和其数据显示 
C.9.4 
使用差值光标 
 
差值光标由一个红色和一",185
"坐标
水平光标
 
图 C- 28 水平光标和其数据显示 
 
 
545 
图 C- 29 差值光标和其数据显示 
差值的计算为： 
� 
dX=红色三角形的 X 坐标-蓝色三角形的 X 坐标。 
� 
dY=红色三角形的 Y 坐标-蓝色三角形的 Y 坐标。 
� 
S=dY/dX 
C.10 关于标签的使用 
 
图 C- 30 展示了“Waveform”窗口中所有的标签。这些标签都可以通过下",169
"”对话框已经打开，可以在图表中选择任意一个标
签对象来显示“Label Attributes”对话框。 
2) 
填入需要的信息，具体内容见 C.10.2。点击“Add”完成编辑。 
3) 
在图表中通过点击，将刚才编辑好的标签加入到鼠标点击的位子。 
546 
 
图 C- 31 “Label Attributes”对话框 
2. 
通过快捷键中的标签栏添加标签 
1) 
如果“Waveform",137
"1) 
选中需要编辑的标签，然后选择“Graph”�“Label”�“Edit”；或者双
击需要编辑的标签，此时“Label Attributes”对话框探出，如图 C- 31 所示。 
2) 
在“String”栏汇中填入标签的内容。“WaveScan”提供了多种变量（如表 C- 2
所示），这些变量可以嵌入到标签内容中。当嵌入变量的标签被加入到图
表中后，这些变量被估值，计算后的结果将替代标签",160
"nif Digits”栏中填入标签中数字的有效位数。选择“Default”采用默认
有效位数。 
5) 
在“Font”三个下拉菜单中依次选择标签中文字的字体、字形和字号。 
6) 
在“Foreground”中选择标签的颜色。 
7) 
在“Direction”中选择标签的方向。标签方向如图 C- 32 所示，标签的末尾
指向制定的方向。 
8) 
点击“OK”完成对标签的编辑。 
 
图 C-",148
"标签： 
� 
在标签上按住鼠标左键，拖拽标签到需要的位子，松开鼠标左键来释放标
签。 
� 
选择“Edit”�“Move”，在需要的位子点击鼠标左键重新放置标签。 
C.11 关于标记 
 
标记把相应的描述信息附着在波形的一个点上，标记的默认标签显示了该点的 X 和
Y 坐标。此外可以将一个表达式和标记相关联，当标记被放入图表中后，标记的标签将
显示该表达式的值，具体设置方法见 C.11.3",179
"reate”�“Marker”
创建一个新的标记。 
2) 
在“Label”栏中选择下面任意一种操作： 
� 
输入标记的字符串。在该字符串中也可以使用表 C- 2 中的变量。当标记被
添加到图表中后，这些变量将被估值，变量的值将代替字符串中的变量符
号出现在图表中。因此标记的内容可以包含坐标的坐标、波形的斜率、波
形的名称甚至一个标量表达式的值。 
� 
选中“Default”，使用默认值。默",163
" Y 坐标，并放置标记。 
� 
选择“Use Cursor”，在鼠标的位子放置标记。在“Constraints”中选择“Trace”
将把标记附着在最近的波形上；选择“Data Points”将把标记附着在最近的
波形上的数据点上。 
4) 
在“Type/Display”栏中选择标记的类型和显示方式（显示方式见 C.11.2）： 
� 
Trace：波形标记 
� 
Vertical：垂直标记",140
"“Marker Attributes”对话框 
 
图 C- 34 三种标记类型 
2. 
通过鼠标添加波形标记、垂直标记和水平标记 
 
通过下面的方法，可以通过鼠标在图表中添加波形标记、垂直标记和水平标记。 
� 
选择“Marker”�“ Place” �“ Trace Marker”、“Marker ”� “Place” � 
“Vert Marker”或者“Marker” � “Plac",121
"utoTraceSelect”选项为“true”，那么标记将添加到离鼠标最
近的波形上。 
� 
如果在“.cdsenv”中“autoTraceSelect”选项为“false”，那么标记将添加最后选中
（或者最好添加）的波形上。 
3. 
添加差值标记 
 
差值标记用来标记图表中两个点之间的差值。差值标记需要配合波形标记使用。在
添加差值标记前，必须刚刚添加或者选中一个波形标记。差值标记可以单",164
" 
选择一个已经存在的波形标记。 
2) 
选择“Marker”�“Add Delta”。 
3) 
点击鼠标添加第二个波形标记从而构成差值标记。或者跳过第二步，将鼠标移
动到合适的位子，通过点击快捷键“a”，加入波形标记，该波形标记自动和第
一步中的波形的坐标形成差值坐标。图 C- 35 中显示了差值坐标。在差值标记
的标签中显示了两个波形标记点之间的 X 坐标的差值和 Y 坐标的差值。 
当图",190
"52 
C.11.2 修改标记显示模式 
 
所有的标记（包括波形标记、垂直标记、水平标记和差值标记）拥有三种显示模式：
XY 模式、X 模式和 Y 模式。通过下面的步骤可以修改标记的显示模式： 
1) 
选择一个标记 
2) 
选择“Marker”�“Display Type”，或者选择“Marker”�“Edit”打开“Marker 
Attributes”对话框，在“Type/Display",134
"是差值标记，在标记的标签中将显示两
个波形坐标的 X 坐标差值和 Y 坐标差值。并且标记和标签间的连线采用斜线。 
X Model 
如果选择的标记是在波形标记、垂直标记或者水平标记的时候，在标记的标签中显示标记的 X 坐标。 
如果选择的标记是差值标记，在标记的标签中将显示两个波形坐标的 X 坐标差值。并且标记和标签间的
连线采用折线，折线垂直通标记 
Y Model 
如果选择的标记是在波形标",196
"要编辑的标记，然后选择：“Marker“�“Edit” 
 
在图 C- 37 中指出了标记和标记的标签在图表中的形式，请不要将两者混淆。 
553 
 
图 C- 37 标记和标记的标签 
 
通过上面的操作，将打开“Marker Attributes”对话框。 
2) 
通过 C.11.1 中介绍的内容修改标记的属性。 
3) 
点击“OK”完成对标记的编辑。 
C.11.4 移动标记 
 
",138
"e”，那么标记将可以
在多个波形间切换。 
� 
如果在“.cdsenv”中“autoTraceSelect”选项为“false”，那么标记只能沿
着波形移动，不能切换到其他的波形上。 
554 
C.12 保存与载入波形 
C.12.1 保存波形 
用户可以将波形文件保存为二进制文件。用户能够将这些二进制文件导入到
“WaveScan”中和仿真波形进行比较，也能够利用这些文件重新生成波形文件。 ",162
"2 载入波形 
通过下面的步骤可以载入波形文件： 
1) 
同样在图形界面窗口，选择“Trace”�“Load”，将会弹出“Open”对话框，
如图 C- 39 所示： 
2) 
在“Look In”下拉菜单中选择所要保存的文件路径。 
3) 
采用下面任意一种操作： 
� 
在“File name”中填写保存文件名。 
� 
在“Look In”下方的窗口中选择需要载入的波形文件 
4) 
点击",153
"C.15 保存图表 
使用“XML”格式保存图表，可以通过保存的对话设置完全恢复恢复该图片的信息。
以“XML”格式保存的图表保存如下信息： 
� 
数据保存位置，包含数据路径，数据设置，波形名称等，而不是具体的数据。
因此，由于仿真时的不同设置造成的数据的变化，将在图表载入中反映出来。 
� 
大部分的图表设置属性，如网格，背景颜色，标注，标记等。 
通过以下步骤以“XML”格式保存图表： 
1",162
"键入一个新的名称，从而保存一个新的波形文件。 
5) 
点击“Save”，保存文件。 
556 
 
图 C- 40 “Save Graph”窗口 
 
图 C- 41 “Save Image”对话框 
C.16 以图像格式保存图表 
用户也能够以图像格式保存图表。所有的格式都是无损模式保存。通过以下步骤可
以将图表以图片的形式保存下来： 
1) 
选择“File”�“Save as Image”",131
"外，如果选择的是“PNG”模式，而在“File”中填入“snapshot. Tiff”，
“WaveScan”
保存的文件为“snapshot.png”。 
3) 
填写需要保存的文件名，默认的文件名为“snapshot.png”。点击“Browser”可
以选择保存路径。 
4) 
点击“Save”，以图片模式保存图表。 
557 
C.17 打开保存的图表文件 
不能直接在“WaveScan”",109
"3) 
在“Files of Type”下拉菜单中根据文件的拓展名选择需要显示的波形文件。 
4) 
采用下面任意一种操作： 
� 
在“File name”中填写保存文件名。 
� 
在“Look In”下方的窗口中选择需要载入的波形文件 
5) 
点击“Open”，载入文件。 
C.18 建立一个图表模版 
当创建一个新的图表时，“WaveScan”会调用“.cdsenv”中的设置来决定该图表",143
"件相同的设置。 
� 
将选择的“Waveform”窗口作为模板： 
在“Waveform”窗口中选择“Graph”�“Template”�“Set Current” 
所有新建的“Waveform”窗口都将采用和该“Waveform”窗口相同的设置。但是这
样产生的一个模板，只对当前仿真对话设置有效。对于后续的仿真对话设置，
需要把该“Waveform”窗口保存为波形文件，在把它以模板的方式打开",143
"计算器，有代数和逆波兰（RPN， Reverse Polish 
Notation）两种工作模式。通过 Calculator 可以实现以下功能： 
� 
可以在“Calculator”中创建、打印和显示包含仿真输出数据的表达式。 
� 
在缓存中输入包含节点电压、端口电流、直流工作点、模型参数、噪声参数、设
计变量、数学公式以及算法控制变量的表达式。 
� 
把缓存中的内容保存的存储器中，并可以把",152
"ator 简介 
D.1.1 
 “Calculator”界面介绍 
 
图 D- 1 简要地说明了“Calculator”中各个区域和按键的功能。 
 
 
560 
图 D- 1 “Calculator”中各个区域和按键的功能 
D.1.2 
“Calculator”的菜单 
图 D- 2 列出了“Calculator”中的所有菜单，它们的功能见表 D- 1 
 
图 D- 2 “Calcul",125
" 
删除存储项。 
 
Undelete 
恢复已删除的存储项 
Select 
选择存储项 
Load 
从文件中读取保存过的存储项 
 
Save 
将存储项保存到文件中 
Const 
boltzmann 
波尔兹曼常数。 
charge 
单位电荷。 
DegPerRad 
角度弧度比 
 
epp0 
真空介电常数。 
561 
pi 
圆周率 
twopi 
两倍圆周率。 
sqrt2",128
" 所示。不选中“Set RPN”则是代数模
式。 
 
图 D- 3“Calculator”工作模式选择 
D.1.4 
输入常数 
 
在菜单中选择“Const”下拉菜单，可以在里面选择常用的常数，加入到缓存中，如图
D- 4 所示。 
 
562 
图 D- 4 “Calculator”中的常数 
 
这些常数包括： 
� 
botzmann： 
波尔兹曼常数。 
� 
charge：  
单",139
"”中的表达式需要按照正确的语法规则输入。例如在“Calculator”
表达式中，“2k”和“2p”所代表的是“2 kilo”（2000）和“2 pico”（2 e-12）。如果表达式
想包含“2 倍 p”项，则需要在表达式中按以下的方式键入“2*p”。如果在“2p”后面紧跟
一个不带数字的字符串，例如“2pfsfeg”，那么这个表达式将仅仅被认作“2p”，而不会报
语法错误。但是在紧跟得字符串中",165
"窗口中键入。 
� 
hiSetBindKey( “encap” “<Key>x” “calCalculatorFormCB()”)，即可用所希望的按键
代替 x。 
D.1.6 
开启“Calculator” 
 
有三种方法可以打开“Calculator” 
� 
在“Waveform”窗口或者“Simulation”窗口中选择“Tools”�“Calculator”，
如图 D- 5 所示。",111
"ator”，如图 D- 7
所示 
564 
 
图 D- 7 在“ADE”窗口中打开“Calculator” 
D.1.7 
关闭“Calculator”  
 
选择“Window”�“Close” 
D.2 选择数据 
 
在“Calculator”中有以下四种输入数据的方式， 
� 
通过键盘，按照 SKILL 语言规范直接在缓存中输入表达式。详细内容参见 Cadence
文档中的 SKI",122
"相应得表达式在缓
存中显示出来。图 D- 8 显示了常用的“Calculator”中常用的电路图表达式按键。 
注意这些按键已经按照仿真类型进行了分类。例如在运行了瞬态仿真（tran）后，需
要从电路图中获得节点电压的仿真数据，则在电路图表达式按键中的“tran”页面（如图
D- 8 中第一栏所示）里选择“vt”，然后在电路图中选择相应的节点，即可获得。如果选择
了其它页面中的按键，例如“ac”中",173
"取的数据类型 
vt 
瞬态仿真节点电压 
iv 
瞬态仿真端口电流 
vf 
交流节点电压 
if 
交流端口电流 
vdc 
直流工作点节点电压 
idc 
直流工作点端口电流 
vs 
直流扫描节点电压 
is 
直流扫描端口电流 
op 
直流工作点 
opt 
瞬态工作点 
var 
设计变量 
mp 
模型参数 
vn 
噪声电压 
 
 
 
 
通过以下的方法利用电路图表达式按键在",160
" 
在电路图数据中选择器件参数 
 
下面的内容适合使用“op”，“opt”，“mp”，“vn”或者“var”来获取数据，并且在获
取数据之前必须运行一次对应得仿真。 
1) 
在点击“op”，“opt”，“mp”，“vn”或者“var”电路图表达式按键中任意一个后，
“Select an instance”窗口弹出，如图 D- 9 所示。 
566 
 
图 D- 9“Select an ins",136
"所示。在该菜单中
选择需要的参数，例如 MOS 管的跨导“gm” 
 
图 D- 11 被选中器件的参数 
4) 
点击图 D- 10 窗口中的“OK”后，该参数被“Calculator”获取，并在缓存中显
示，如图 D- 12 所示 
567 
 
图 D- 12 选中的参数被传递到“Calculator”的缓存中 
2. 
选择电压或者电流 
 
通过以下方法在电路图中选择电压或者电流。以一个",149
"的表达式，是“Waveform”窗口中鼠标所在曲线的标题表达式，如图
D- 14 中，窗口底部状态栏中显示的“graph-1.trace():gain”。 
568 
 
图 D- 14 在“Waveform”窗口中选择曲线 
但是因为这个表达式仅仅是一个描述性的标题，不能被“Calculator”估值，因此系统
自动创建 SKILL 函数来表示选中的波形。最终“Calculator”获得的表达式",143
"ic Analysis”，根据不同的电阻值（res）获得了一组曲线，如
图 D- 16 所示。 
569 
 
图 D- 16 参变量扫描的输出波形，其中包含多条曲线 
我们可以通过以下的方法，将其中的一条而不是一组曲线捕获到“Calculator”中。 
1) 
在“Calculator”中取消“Family”选项。如图 D- 17 所示。 
2) 
保持“Select Mode”选中，在“Wa",139
"真，扫描对象是“频率”，扫描范围是“1~100k Hz”，扫描步进是“1 Hz”；那么
图形的坐标轴或者列表的编号将以“Hz”作为单位，范围是“1~100k Hz”，两个坐标点或
者编号间的间隔为“1 Hz”。 
570 
“Calculator”不能直接将存储器中的表达式的值显示，需要将这些表达式从存储器中
读取到缓存中才能显示。 
 
下面的两个按键分别是将缓存中的表达式按照图形和文本的形式显",180
"的功能 
下拉菜单 
功能 
Append 
在原来窗口的基础上显示新的波形。 
Replace 
清楚原来的窗口中的数据，显示新的波形。 
New SubWin 
在原来的窗口中，建立字窗口，用来显示新的波形。 
New Win 
创建一个新的窗口显示新的波形。 
 
在选择好波形窗口创建方式后，点击“ ”按键即可将缓存中的表达式值在波形窗口
中显示。 例如以附录 A 中图 A- 64 所示电路",162
"输到“Calculator”的缓存中 
4) 
在波形窗口创建方式下拉菜单中选择“New Win”，点击“
”按键后，在新的
波形窗口，显示共源极放大器的增益频率特性。如图 D- 20 所示。 
 
图 D- 20 共源极放大器的增益频率特性 
D.3.2 
以文本的形式输出“Calculator”缓存中表达式的值 
 
点击“
”按键，将把“Calculator”缓存中表达式的值以列表的形式输出",155
"“Display Results”窗口中的“Data”选择为“Value”，则表示将“Calculator”
缓存中表达式在坐标轴上所有的值都显示。输出结果如图 D- 22 所示。 
 
图 D- 22“Results Display Window”窗口 
� 
若将“Display Results”窗口中的“Data”选择为“Point”， “Display Results”
窗口将变成图 D-",105
"入的值不在仿真范围内，那么“Calculator”将
输出仿真扫描范围内，最靠近该数值的坐标点上的表达式的值。例如，扫描范围是
“1~100”，在“X Intercept”栏中填入“110”，则“Calculator”输出的值是“expr（100）” 
� 
若将“Display Results”窗口中的“Data”选择为“Range”， “Display Results”
窗口将变成图 D- 2",138
"”中确定的起始点开始，依次取数据，直
到跨过结束点为止。按照图 D- 25 中的设置，输出结果如图 D- 26 所示。 
574 
 
图 D- 26 横坐标的范围在 10~1000 内线性步进的仿真结果 
如果“Log”栏被选中，那么“Step/Scale”中的数据将作为“10”的指数计算一
个值作为倍乘系数。“Calculator”将从“Start/End”中确定的起始点开始，以倍乘的方
式取",157
"ries”下拉菜单中实现。“Memories”下拉菜单如图 D- 28 所示。
575 
 
图 D- 28 “Memories”下拉菜单 
D.4.1 
“Table”子菜单 
 
“Table”子菜单如图 D- 29 所示。在“Table”子菜单中包含 5 个菜单按钮，其功能一
次如下： 
 
图 D- 29“Table”子菜单 
� 
“Edit”：打开“Memories Editor”窗口",135
"的表达式，并要求对该存储项命名。 
注意：允许两个存储项有相同的表达式，但不能有相同的名称。 
� 
“Copy”：将选中的已有存储项的表达式复制到新的存储项中，并要求对新的表
达式命名。 
� 
“Delete”：删除存储项。在点击“OK”或“Apply”，确认删除前，被删除的存
储项仅仅变灰，如图 D- 30 所示。此时可以通过“Undelete”将其恢复。 
576 
 
图 D- 30 删",167
"点击“Save…”子菜单，“Save”窗口弹出，如图 D- 32 所示。 
577 
 
图 D- 32Save”窗口 
 
在“Save In”下拉菜单，和下面文件列表中选择合适的存储路径。在“File Name”中
填入保存文件的名称。文件内容是按照 SKILL 语言写成的命令。对应上文中存储器中的内
容。保存文件中的内容为： 
 
armSetCalcMemory( ""Vout"" ""VF(\",136
"据进行大量的处理，从而获得有用的信息。
只需要点击函数窗口中的函数项，就可以对当前缓存中的表达式使用相应的函数。 
在
以下的章节中将针对使用“RPN”模式的“Calculator”，介绍一些常用实用的函数，及其
使用方法。 
578 
D.5.1 
简单函数 
 
下面这些函数适合缓存中只有一个表达式的情况。见表 D- 4 
表 D- 4 简单函数的功能 
函数 
功能 
函数 
功能 
mag",153
"达式的函数和操作符 
 
在“RPN”模式中，一些函数或操作符同时作用于缓存和堆栈中最上层的表达式。对
于这些函数或操作符而言，堆栈中的表达式永远在缓存中表达式的左边，具体内容见表 D- 
5。在表 D- 5 中，堆栈中最上层表达式用“stack”表示，缓存中的表达式用“buffer”表示。 
表 D- 5 用两个表达式的函数和操作符及其功能 
函数 
功能 
y**x 
stackbuffer ",166
"析仿真结果有很大的帮助。在选择某些特殊函数时，函数窗口将转换
成对话框，在其中填入该函数所需要的其它数据。如图 D- 34 所示。其余的特殊函数直接
作用于缓存中的表达式。 
579 
 
图 D- 34“bandwidth”函数设置对话框 
 
例如通过以下步骤可以求一个电流在整个仿真范围内的品均值。 
1) 
将所需要的端口电流表达式捕捉到“Calculator”的缓存中。 
2) 
在函数窗",169
"        
（D-1） 
 
其中“to”和“from”是“ADE”中设置的仿真范围起始和结束值。如果需要选择不
同的求平均值范围，可以配合使用“clip”函数。 
2. 
“bandwidth”函数 
 
“bandwidth”函数计算“Calculator”缓存中表达式的带宽。注意，输入表达式必须是
直接对应电压值，而不是经过“dB20”处理过的数值。具体操作步骤如下： 
1) 
将所需",146
"
其它的节点电压表达式。 
� 
“Db”栏填入的是带宽频率上的值距峰值的距离，数据采用“dB”模式。 
� 
“Type”下拉菜单中，有如下三个选项。 
“low”：  
计算低通模式下的带宽。 
580 
“high”：  
计算高通模式下的带宽。 
“band”：  
计算带通模式下的带宽。 
4) 
点击“OK”。完成对“bandwidth”函数的设置。 
5) 
点击“
”，输出计算的带",170
"o”栏中填入新的输出范围。 
注意：假如新的范围大于仿真范围，那么在多出的范围内，“Calculator”将输出
仿真扫描范围内最靠近该数值的坐标点上的表达式的值。例如，对于表达式 f(x)，
仿真的扫描范围是“10~100”，而“clip”确定的新的范围是“1~200”。那么在“1~10”
的范围内的值为 f(10)，在“100~200”的范围内的值为 f(100)。 
4) 
点击“OK”完成",184
"”和“Signal2”栏中填入需要计算卷积的两个表达式。软件默认在这
两栏中填入当前“Calculator”缓存中的表达式。因此需要按照 SKILL 语法规范
填入需要的两个表达式。 
3) 
在“From”和“To”中填入卷积范围。 
4) 
“type”中选择的是卷积式的步进方式，有“linear”和“log”两种选项。 
5) 
点击“OK”完成对“convolve”函数的设置。 
6) 
",154
"穿过特定形式波形边沿阈值时的 x 轴坐标。具体步
骤操作如下。 
1) 
将所需要的表达式捕捉到“Calculator”的缓存中。 
2) 
在函数窗口中点击“cross”函数。然后函数窗口将变为如图 D- 37 所示的“cross”
对话框。 
582 
 
图 D- 37“cross”函数设置对话框 
3) 
在“cross”对话框中： 
� 
“Signal”栏中填入的是需要处理的节点电压表",157
"either”：上升或下降沿。 
4) 
点击“OK”。完成对“cross”函数的设置。 
5) 
点击“
”，输出电流的平均值。 
6. 
“delay”函数 
 
如图 D- 38 所示，“delay”函数利用“cross”函数，计算两个表达式分别穿过特定值
时的时间差。 
 
图 D- 38“delay”函数计算方法示意图 
具体操作步骤如下： 
1) 
在函数窗口中点击“delay”函数。",141
"对两个表达式的“cross”函数
设置。 
4) 
点击“OK”，完成对“delay”函数的设置。 
5) 
点击“
”，输出延时值。 
7. 
“deriv”函数 
 
“deriv”函数用来对“Calculator”缓存中的表达式求微分。在函数窗口中选择“deriv”
函数，然后点击“ ”输出微分后的表达式波形。 
8. 
“gainBwProd”函数 
 
“gainBwProd”函数计算表",127
"gin”函数给出“Calculator”缓存中的频率响应表达式相移为 180 度时的增
益大小（dB 值）。 
10. 
“iinteg”函数 
 
“iinteg”函数对“Calculator”缓存中的表达式对 X 轴上的变量进行不定积分。积分
结果可以在“Waveform”窗口中显示。 
11. 
“integ”函数 
“integ”函数对“Calculator”缓存中的表达式对 X 轴上的变",138
"开始和结束值。 
注意：上述两个值必须同时定义，或者都不定义。当没有限定定积分范围时，
“integ”函数将自动将积分范围设置为整个扫面范围。 
4) 
点击“OK”，完成“integ”函数设置。 
5) 
点击“
”，输出积分结果。 
12. 
“lshift”函数 
 
“lshift”函数将“Calculator”缓存中的表达式平移后输出到“Waveform”窗口中。平
移量在“lshift",146
"”函数 
 
“overshoot”函数将计算“Calculator”缓存中的表达式的过冲值相对跳变值的比例。
假如表达式的峰值为 M，跳变初始值为 I，跳变结束值为 F，如图 D- 42 所示。那么“overshoot”
函数的计算为： 
 
图 D- 42 “overshoot”函数计算方法示意图 
(
)*100
M
F
overshoot
F
I
−
=
−
             
 ",131
"nal Value”
中填入表达式跳变前后的值。 
如果“Initial/Final Value Type”中选择的是“x at y”，则直接在“Initial/Final Value”
中填入响应的 X 轴坐标值，用来标明表达式跳变前后的时间。系统自动根据 X
轴左边计算出响应得 y 值。 
4) 
点击“OK”完成“overshoot”函数的设置。 
5) 
点击“
”，输出结果。 
15. ",133
"这个时间作为函数的输出。 
587 
 
图 D- 44“settlingTime”函数设置对话框 
 
具体操作如下： 
1) 
将所需要的表达式捕捉到“Calculator”的缓存中。 
2) 
在函数窗口中点击“settlingTime”函数。然后函数窗口将变为如图 D- 44 所示的
“settlingTime”对话框。 
3) 
如果“Initial/Final Value Type”中",120
"用来计算容差范围。容差范围=（Final value 
– Initial value） × Percent of step 
5) 
点击“OK”完成“settlingTime”函数的设置。 
6) 
点击“
”，输出结果。 
 
17. 
“slewRate”函数 
 
“slewRate”函数可以计算“Calculator”缓存中的表达式的转换速率。它计算信号在
初始值和结束值范围内从低百分",123
"Final Value”
中填入表达式跳变前后的值。 
如果“Initial/Final Value Type”中选择的是“x at y”，则直接在“Initial/Final Value”
中填入响应的 X 轴坐标值，用来标明表达式跳变前后的时间。系统自动根据 X
轴左边计算出响应得 y 值。 
4) 
对于“Percent High”和“Percent Low”的取值方法如图 D- 46 所示",128
"“OK”完成“slewRate”函数的设置。 
589 
6) 
点击“
”，输出结果。 
 
590 
 
附录 E  Parametric Analysis 
“Parametric Analysis”在电路设计和验证过程中是一个非常实用的工具。它允许你对器
件参数、电路参数进行赋值。这种赋值可以是对一个变量在一定范围内的赋多个值，也可
以是对多个变量进行多组的同时赋值。然后对电路在这些特定值",139
"取数据，因此在 Parametric Analysis 仿真过程中，改变电路设置，将会引起 Parametric 
Analysis 的不准确。 
在后文中，我们将以 MOS 管阈值电压和温度以及 MOS 管尺寸间的关系为例，说明
“Parametric Analysis”的实用方法。 
E.1 “Parametric Analysis”的仿针环境设置 
“Parametric Analysis”",111
"gn Environment（ADE）窗口。设置好库文件，从电路图中获得变量
名并赋一个初始值。在仿真类型里面选择“dc”，然后选择保留直流工作点。这样仿真器将
会计算电路在各个变量等于初始值的时候，各个器件的直流工作点，对于 MOS 管，将包
含跨导、阈值电压等等信息。因为在每次“dc”仿真的时候，直流工作点只计算一次，因此
没有办法观察到 MOS 管阈值电压随温度变化的连续曲线。下面我们将利用",193
"Analysis”，如图 E- 3 所示。这时“Parametric 
Analysis”窗口将会弹出，如图 E- 4 所示。图 E- 5 列出了“Parametric Analysis”的所有下拉菜
单，它们的功能将在后文一一列出。 
E.3 “Parametric Analysis”的设置 
E.3.1 
“Parametric Analysis”中获得变量 
我们要获得 MOS 管阈值电压的",120
"
选择“Setup”�“Pick Name For Variable”�“SweepN”。如果现在只有一个扫描，那
么“Sweep1”是唯一的选择，如图 E- 6 所示。 
2) 
在新的弹出窗口里面选择“temp”作为该扫描的变量，并点击“OK”，如图 E- 7 所
示。 
注意：在弹出窗口里，只有在 ADE 中定义的变量才会显示出来。“temp”是作为系统
默认的变量存在的。此时“temp”在",149
"B 值结束，从而确定一个范围。 
� 
“Center/Span”： 
以 A 值为中心，以 B/2 值为正负方向的变化量，确定一个范
围。例如“Center=100， Span=20”，等同于“From=90， To=110” 
� 
“Center/Span%”：以 A 值为中心，以 A*（B/2）%为正负方向的变化量，   确定
一个范围。例如“Center=100， Span%=40”，等",144
"少个仿真点；当扫描范
围的最大值和最小值的比大于 50 时，将采用对数的方法分配仿真点；如果比值小于
50 讲采用线性的方式扫描。 
� 
Linear Step：按照用户设定的步进，扫描整个范围； 
� 
Linear 
：按照用户设定的仿真点数，平均划分仿真范围； 
� 
Decade 
：用户将设置每 10 倍程内的点数，仿真点之间是倍乘关系，倍乘系数
为101/steps per-deca",178
"
per-octave。要求在“From/To”模式中，从小到大设置范围。例如：范围是：“From=2， To=4”，
“Steps/Octave =5”，仿真点为：2，2.2974，2.63908，3.03143，3.4822，4；即：21，21.2，
21.4，21.6，21.8，22。 
� 
Logarithmic：用户设置总共的仿真点数，仿真点之间是倍乘关系，被乘系数为：
(To/Fro",148
"E- 11 完成设置后的“Parametric Analysis”窗口 
596 
E.3.3 
给一个变量添加多个扫描范围 
如果我们还想添加另外一个范围：40 0C 到 100 0C。也是在每个整数温度点上做一次
仿真。点击“Add Specification”下拉菜单，选择“Range”，如图 E- 12 
我们看到在 Sweep1 中，有多了一个“Range Type”和“Step Con",133
"13 添加新的扫描范围后的“Parametric Analysis”窗口 
E.4 查看仿真点 
在进行参变量分析之前，我们可以查看我们选择的仿真点。选择“Analysis-Show Sweep 
Sets”�“All sorted”，如图 E- 14 所示。 
� 
All Sorted ：显示全部仿真点，并按顺序排列 
� 
All  
 
：显示全部仿真点，不排序 
� 
Select So",119
" 16 所示。 
 
图 E- 16 “Analysis”下拉菜单中的内容 
如果我们选择“Start”，则在所有设置的范围内，对电路进行仿真，如果我们选择
“Start-Selected”，那么只对“Select”项选种的范围进行仿真，针对上面的设置，就是只仿真
40 0C 到 100 0C 的范围。 
我们在这里运行“Start-Selected” 
这时会有一个弹出窗口告诉你仿真信息，包含当",147
"
管的阈值电压。双击将其在“Graph Window”中显示，如图 E- 19 所示。我们可以看出当温
度上升时，MOS 管的阈值电压下降。 
 
图 E- 17 仿真状态显示窗口 
 
图 E- 18 在“Results Browser”中选择仿真结果 
599 
 
图 E- 19 MOS 管阈值电压的温度特性 
E.6 多个变量的“Parametric Analysis”的设置 
如果我们还",139
"“Sweep2”，如图
E- 21 所示。 
按照 E.3 的方法，将“L_N”加入到“Variable Name”中，扫描范围从 5um 到 15um。这次
“Range Type”采用“Center/Span%”，“Step Control”采用“Logarithmic”的方式，共扫描 5 个点。
设置如图 E- 22 所示。 
600 
 
图 E- 20 在“Parametric Anal",123
"的仿真点。结果如
图 E- 23 所示。 
可以看出“Parametric Analysis”是先固定“Sweep1”的值，对“Sweep2”的值进行循环，然
后再变化“Sweep1”的值。这说明在“N”个“Sweep”中“SweepN”是最内圈的循环。按照
“Sweep”从小到大的顺序，由外而内构成循环的嵌套。 
通过“Analysis”�“Start Selected”运行仿真。仿真后，通过“",147
"将“Sweep Var”
切换到“temp”，如图 E- 25 所示。 
 
图 E- 25 在“Axis Attributes”窗口中更改 x 轴变量 
我们可以得到在 5um 到 15um 的 5 个特定栅长上，M0 的阈值电压随温度变化的曲线，
如图 E- 26 所示。 
 
图 E- 26 更改 x 周变量后的仿真结果 
E.7 加入或者排除特定仿真点 
如果我们向扫描几个特定的值，例如 ",157
"55.2”填入其
中，以空格隔开。这样就把这两个特定的温度加入到扫描范围内了。如图 E- 28 所示。 
反之，如果我们在“Add Specification”中选择“Exclusion List”，那么将会有一个
“Exclusion List”栏会出现在“Sweep1”的最下端，在这一栏中填入的值，将从扫描范围内排
出。例如我们填入“15”，“16”和“17”，以空格隔开，将“Inclusio",151
"真点 
“15”，“16”，“17”已经从原来的仿真范围中删除了，而“27.5”和“55.2”被加了进去。第
二列中的“2u”是“L_N”在 ADE 中的默认值。因为关于“L_N”的扫描范围没有被选中，故采
用 ADE 中的默认值。 
E.8 删除变量和扫描范围 
如果设置的范围或者变量不再需要，通过下面的方法进行删除。 
E.8.1 
删除扫描范围 
选择“Setup”菜单，然后选择“Delet",177
"“Setup”�“Delete All Range Specification”，那么所有设置的扫描范围都
将被删除。 
605 
 
图 E- 31 删除扫描范围后的“Parametric Analysis”窗口 
E.8.2 
删除一个变量 
我们还是在“Setup”下拉菜单中选择“Delete Range”，“Parametric Analysis Delete 
Variable”窗口将弹",102
"
通过上面的方法，我们可以将多种参数放在一起进行仿真，仿真次数是所有变量扫描
次数的乘积。当变量多了以后，这将是一个很大的数字，而且我们可能只对其中的几种组
合比较感兴趣，因此其它的数据是多余的，将会浪费大量的仿真时间和计算资源。下面我
606 
们介绍另外的一种方法，可以实现多个变量间特定值的组合，从而观察这种组合下电路的
性能。例如我们要获得 MOS 管的阈值电压在下面 4 个温度和栅长的组合",200
"态，如图 E- 35 所示。这时我们需要填入“Variable Name”和“Value List”。
其 中 “Variable Name” 的 选 择 方 法 和 E.3 中 一 样 ， 在 “Setup”�“Pick Name For 
Variable-Sweep1”中选择“temp”。 在“Value”中依次填入“-15.1”，“23.5”，“12.8”，“66.5”，
并以空格隔开。接",114
"
 
图 E- 36 完成设置后的“Parametric Set”模式的界面 
 
图 E- 37 “Parametric Set”模式的仿真点 
可以看出，“temp”和“L_N”的值已经按我们需要，组合到一起了。如果在“Parametric Set”
模式下，我们将“SweepN”的“Variable Name”标示为“VarN”，“Value List”中的第 M 个值标示
为“SnVm”，",114
"
Case3 
S1V3 
S2V3 
SnV3 
…… 
…… 
…… 
…… 
CaseM 
S1Vm 
S2Vm 
…… 
SnVm 
E.10 保存“Parametric Analysis”的设置 
 
图 E- 38 “Tool”下拉菜单中的内容 
608 
“Parametric Analysis”的设置有两种保存模式： 
� 
暂时保存：“Parametric Analysis”的设",99
"图 E- 39 所示。 
 
图 E- 39 “Parametric Analysis Save”窗口 
在“Directory”中填入文件路径，在“File”中填入文件名，文件名的后缀是“.il”点击“OK”
或“Apply”将设置保存到文件中。然后通过“Tool”下拉菜单中的“Recall”来从文件中获取
“Parametric Analysis”的设置。 
保存 OCEAN Script。在",107
"器的原理、设置与结果分析。 
F.1 优化的作用和基本工作原理 
 
最初的电路设计通常不能满足所有的设计指标。例如运算放大器的带宽不够，或者电
路设计的冗余度不够，在一些特定条件下不能正常工作。通常可以通过调整器件参数来解
决这些问题。从众多的方案中挑选一个最好的，往往很难，而优化器可以提供必要的信息，
从而获得最佳的解决方案。 
 
对于优化器，需要设置一系列设计变量的初始值和变化范围，以及优",190
"，优化器决定使用何种优化算法。 
� 
LSQ（Least Square）算法适合对测量的、有噪声的、没有约束的数据进行优
化。例如，针对一个测量出来的频率响应数据，设计一个对应的滤波器，这
种算法就十分适用。 
� 
CFSQP（C version Feasible Sequential Quadratic Programming）对于大量的优
化问题都十分使用，包括有约束条件和没有约束条件的，",139
"个设计变量都进行微小的变化，然后再进行一次仿真。 
5） 利用敏感度中的信息，优化器为设计变量计算出一套新值。 
6） 优化器将上一步中的新值赋给设计变量，然后对电路进行仿真。如果仿真的结果
没有上一次的好，那么优化器将重复第 5 步。如果仿真的结果得到改善，那么在
第 5 步中计算出来的新值将作为初始值进入下一轮循环。 
7） 如果优化停止的标准没有达到，那么下一轮循环将从第 4 步开始。优化将",197
" 
Environment”（ADE）中获得。 
首先，我们绘制一个简单的电路图，如图 F- 1 所示，包含一个 NMOS 管，一个电阻，
一个电容和两个电压源。我们将两个电压源的大小，NMOS 管的栅长和栅宽，电阻值以及
电容值设为设计变量，一次命名为：“VDD”，“VG”，“W_N”，“L_N”，“res”，“cap”。 
 
图 F- 1 共源极放大器电路图 
打开 ADE 窗口，设置好库文",161
"通过使用“Optimization”，将获得增益大于 20dB，3dB 带宽大于 100Hz
的共源级放大器。 
 
图 F- 3 共源极放大器电路的幅频特性 
F.3  “Optimization”的启动和关闭 
在 ADE 中选择“Tools”�“Optimization”，如图 F- 4 所示。此时“Optimizer”窗口将会弹
出，如图 F- 5 所示。选择“Session”�“Quit",131
"Variables Pane”和“Tool Bar”。 
� 
Status Display 
 
在“Status Display”中显示的当前优化器所处的工作状态。例如，“Status Display”中的显
示表明优化器是在进行仿真，还是处于其他的工作状态。 
� 
Menu 
 
 
图 F- 7“Optimizer”窗口的菜单 
614 
 
图 F- 7 显示了“Optimizer”中",102
"
Option 
修改优化的选项。 
Reset 
删除所有设置。 
  
Quit 
关闭“Optimizer”窗口。 
Goals  
Retrieve Output 
将 ADE 中设置的仿真输出作为对象。 
Add 
直接添加新的对象，或者通过“Waveform Calculator”添加新的对象。 
Edit 
编辑对象。 
Delete 
删除对象。 
Enable 
开启对象。 
 ",92
"一个停止点开始，运行有限的 n 次循环。 
Stop 
在当前循环完成后，停止优化。 
Stop Now 
马上停止优化，可以不用完成当前的循环。 
  
Reset 
所有的仿真结果都将被删除，而对象，设计变量和显示设置保持不变。 
Result  
615 
Plot History 
显示输出数据。 
Set Plot Options 
设置显示选项。 
  
Update Design 
",112
"F- 2 “Goals Pane”中的项目及其功能 
项目 
功能 
Name 
给对象赋予的名称 
Direction 
包含以下几个选择:maximize, minimize, match,>=或者<= 
Target 
1）如果 Direction 是 match，那么优化器将会去匹配一个具体的数值或者波形。                       
2）如果 Direction 是 m",91
"ent 
显示由当前设计变量的值所计算出的对象表达式的值 
Enable 
显示“yes”或者“no”。 “yes”表示这个对象包含在当前优化中，“no”则反之。 
� 
Variables Pane 
 
图 F- 9“Optimizer”窗口的“Variables Pane” 
616 
在“Variables Pane”中包含了当前定义设计变量的信息，如图 F- 9 所示。具体内容见表
F-",114
"这个设计变量可以在当前优化中进行修改。“no”则反之。 
� 
Tool Bar： 
 
Tool Bar 中包含的按键实现了优化中最重要的功能。按照通常的使用顺序，按键从上
到下排列，依次为： 
� 
 ：添加/编辑对象（Add/Edit Goals） 
� 
 ：添加/编辑设计变量（Add/Edit Variables） 
� 
 ：删除（Delete） 
� 
 ：运行优化器（Run 优化器",124
"定义对象表达式在优化中变化的方向。（见表 F- 4） 
例如，将共源级放大器的在 1Hz 频率下的增益定位对象，需要给出表达式： 
(
)
(
)
(
)
20
""/
""
1
dB
value VF
OUT
 
接着需要给出在优化中，为了获得最大的增益，对象的方向为：maximize。 
下面介绍几种创建对象的方法。 
617 
1. 
将仿真输出作为对象 
1) 
在“Optimizer”窗口菜",151
".1）。 
3) 
在按照 F.5.1 要求完成对象编辑后，即建立了一个新的对象。 
 
图 F- 10 
“Goals”下拉菜单 
 
图 F- 11 将仿真输出作为对象 
注意：直到编辑了从 ADE 窗口中直接获得的对象，该对象才和 ADE 输出栏中的
表达式相关联起来。并且在编辑完该对象后，选择“Goal”�“Retrieve Outputs”将不会
对对象造成任何影响。 
2. 
直接输入",148
"sion”栏中按照 Cadence® SKILL 语言的表达式规范
写入对象的表达式。表达式可以是一个标量，也可以是一个波形。（完成后直接
跳到第 7 步。） 
4) 
如果利用“Waveform Calculator”建立一个新的对象：点击“Open”按键，此时
“Calculator”窗口弹出。 
5) 
在“Waveform Calculator”中建立所需要的表达式。图 F- 13 显示了",132
"值在优化过程中的变化趋势，具体
选项见 F.5.1.6。 
9) 
在“Target”栏中按照 Cadence SKILL 语言的表达式规范写入目标的表达式。或将
光标移至“Target”栏中，按照 4~6 步的方法从“Waveform Calculator”中获得目标的
表达式。 
注意：如果在第 3、6 步中获得的对象的表达式是一个标量，那么目标的表达式
也要是一个标量。反之，如果对象的表达式",163
"e SKILL 语言规范的表达式。或者
按照 4~6 步的方法从“Waveform Calculator”中获得表达式。 
注意：如果在第 3、6 步中获得的对象的表达式是一个标量，那么允许范围的表
达式也要是一个标量。如果对象的表达式是一个波形，那么允许范围的表达式可以是
一个波形，也可以是一个标量。 
� 
如果允许范围是一个标量，那么他需要满足表 F- 4 的要求；如果允许范围是
一个波形，",185
"式小 
>= 
必须比目标表达式的值小 
<= 
必须比目标表达式的值大 
� 
如果选择了“% wihin Target”，可以在“Acceptable”栏中确定一个标量或者波
形变化的百分比。一个小的百分比说明这个对象的优先级更高。 
注意：如果在第 3、6 步中获得的对象的表达式是一个标量，那么填入的百分比
也要是一个标量。如果对象的表达式是一个波形，那么填入的百分比可以是一个波形，
也可以",166
"，优化允
许范围为 2%的设置。图 F- 15 显示了图 F- 14 中设置的对象加入到“Optimizer”窗口后的
情况。 
620 
 
图 F- 14 目标为带宽大于 100Hz，优化允许范围为 2%的设置 
 
图 F- 15 添加新的对象后的“Optimizer”窗口。 
3. 
编辑优化对象 
1) 
在“Optimizer”窗口中选择需要编辑的对象。对象选中后将被高亮显示。 
2)",150
"的方法编辑对象。编辑后的“Editing Goals”窗口如图 F- 16 所
示。 
4) 
点击“OK”，发现选择的对象已经被修改，如图 F- 17 所示。 
 
图 F- 16 修改优化对象 
621 
 
图 F- 17 修改优化对象的“Optimizer”窗口 
4. 
删除优化对象 
1) 
在“Optimizer”窗口中选择需要删除的对象。对象选中后将被高亮显示。例如在图
F- 18",130
"timizer”窗口中选择需要开启或关闭的对象。对象选中后将被高亮显示 
2) 
选择“Goals”�“Enable”，或者“Goals”�“Disable”。  
6. 
优化器如何使用目标和目标允许范围的值 
 
优化器有两种方法使用目标值：作为对象的优化目标；作为对象优先级的权重。后面
将分开介绍两种情况。 
1) 
目标值作为对象的优化目标 
当优化方向定义为：match，>= 或者 <=",150
"器不会区分
match，minimize 和 maximize。优化器总会使对象表达式的最终值和目标值一致。具
体要求见表 F- 5。 
表 F- 5 优化方向和允许值的范围 
定义的优化方向（Direction） 
优化器尝试将对象表达式的值 
match 
和目标值一致 
>= 
必须比目标表达式的值大 
<= 
必须比目标表达式的值小 
minimize 
不管目标值，使对象表达式的值尽可能",154
"的权重。 
当对象的优化允许范围值更靠近目标值时，该对象有更高的优先级。类似的，当
目标和优化允许范围是波形时，两个波形更靠近的对象有更高的优先级。实际上，对
象优先级的权重是通过当前对象表达式的值（f），目标值（T）和允许范围值（A）计
算出来的。 
对象优先级的权重= f
T
A
T
−
−
 
例如对于下面两个对象如表 F- 6 所示： 
表 F- 6 优化对象 
对象名称 
优化方向 
目",195
"
50ns
10ns
−
=
=
−
 
可以发现在这种情况下，delay 有更高的权重。因此优化器将优先减小 delay，然
后再减小 power。 
F.5.2 
准备设计变量 
 
在使用优化器进行优化之前，需要指名哪些设计变量可以被优化器在优化过程中改
变。这些被选中的设计变量必须是仿真环境变量，例如器件参数和器件的模型参数。典型
的例子是电阻、电容的值，或者它们的长度和宽度。 
1. 
",174
"中“Name”栏中的设计变量，
可以发现它们是一致的。这说明优化器在优化时所改变的设计变量，都须要在 ADE
窗口中事先定义。 
624 
2) 
在“Name”栏中中选择我们需要添加的设计变量，被选中的设计变量将被高亮显
示，如图 F- 21 中的“res”设计变量。 
3) 
在“Initial Value”栏中填入在优化时，该设计变量的开始值。这里初始值有一个默
认值，即在 ADE 窗口中对",164
"被选中。 
完成所有设置的“Editing Variables”窗口，如图 F- 22 所示。 
7) 
点击“OK”。此时，设计变量就被添加到“Optimizer”窗口中，如图 F- 23 所示。 
 
图 F- 20“Editing Variables”窗口 
 
图 F- 21 选择“res”设计变量 
 
625 
图 F- 22 完成设置后的“Editing Variables”窗口 
",114
"ariables”窗口 
626 
2) 
选择 “Variables”�“Add”/“Edit” 或者点击“Tool Bar”中的“Add”/“Edit Variables”按
键，此时“Editing Variables”窗口弹出。如图 F- 25 所示。 
3) 
因为是编辑已有的设计变量，因此在“Name”栏中被编辑的设计变量名称已经是高
亮的。如果在“Name”中选择另外一个设计变量，那",127
" 完成所有设置的“Editing Variables”窗口 
6) 
在“Maximum Value”中填入设计变量新的上限，优化器永远不会给设计变量设置
大于上限的值 
7) 
如果想在当前优化中包含这个设计变量，请确定“Enable”栏被选中。完成所有设
置的“Editing Variables”窗口，如图 F- 27 所示。
627 
8) 
点击“OK”。 
此时，到“Optimizer”",126
"imizer”窗口中选择需要开启或关闭的设计变量。设计变量选中后将被高亮
显示 
2) 
选择“Variables”�“Enable”，或者“Variables”�“Disable”。 
F.5.3 
优化器的控制命令 
 
当完成对象定义和制定设计变量后，优化器可以开始优化工作了。下面的章节中将介
绍如何运行和停止优化，以及如何删除不需要保存的仿真结果。 
1. 
运行优化器 
1) 
如果上一",144
"，然后
停止。 
如 果 想 从 初 始 值 开 始 ， 那 么 在 选 择 “Optimizer”�“Step” 前 选 择
628 
“Optimizer”�“Reset”。 
� 
选择“Optimizer”�“Run n”：从最近的一个停止点开始，运行有限的 n 次循环。
此时弹出一个对话框，如图 F- 29 所示。 
 
图 F- 29 设置循环次的对话框 
在该对话框中，通过拖动滑块来",156
"� 
选择“Optimizer”�“Stop”或者点击“Tool Bar”中的“Stop”优化器：在当前循环
完成后停止优化。 
� 
选择“Optimizer”�“Stop Now”：马上停止优化，不论当前仿真是否完成。 
可以通过选择选择“Optimizer”�“Stop”来清除上一次因为出错而非正常停止的优化所
造成的状态。 
3. 
删除仿真结果 
 
选择“Optimizer”�“Res",124
"择“Results”�“Set Plot Options”，然后“Setting Plotting 
Option”窗口将弹出，如图 F- 30 所示。 
629 
 
图 F- 30“Setting Plotting Option”窗口 
2) 
如果需要追踪优化时的每一步，可以将“Auto Plot After Each Iteration”选中。 
如果不需要追踪优化时的每一步，而是在优化结",110
"Goals”，将按照图 F- 31 中展示的例子的方式，显示一个波
形对象是如何向目标靠近的。 
 
图 F- 31 优化波形 
如果有太多或者太少的波形需要显示，可以在“No. of Functional Iterations to 
Display”输入每次显示的波形数目。 
630 
4) 
设置“Waveform Window”的参数，以方便查阅。例如可以设置更大的字体和窗口
大小。 
5",130
"结果。如果优化结果没有自动显示，可以在优化完成后
通过以下的步骤将其显示。 
 
选择“Results”�“Plot History”或者点击“Tool Bar”中的“Plot History”。 
 
新建的“Waveform Window”窗口将按照显示选项中的设置建立，具体内容见 F.5.4。 
 
如果显示设置中选择了显示所有的输出数据，那么在前面设置的优化有如图 F- 32 所
示的输出",123
"。 
3) 
在 ADE 窗口中选择“Design”�“Check and Save”。 
F.6 保存，修改和读取对话设置信息 
 
在“Optimizer”窗口的对话（Session）下拉菜单中，我们可以保存当前对话状态，读取
以前保存的对话状态，或者改变优化选项设置，以及清除当前窗口中的所有信息。 
631 
F.6.1 
保存当前对话状态 
 
通过下面的步骤保存当前对话状态（对象，设计变",134
"选中
的状态名称。子状态将在“What to Save”栏中显示。通过开启和关闭这些子状态，
可以决定在保存对话状态时，这些子状态是否被保存。 
注意：只有保存了的子状态，才能在下次读取该状态时被恢复。 
 
优化器保存状态的默认路径是： 
 
 
在这个路径中，“LibraryName”和“CellName”将从被优化的设计中获取。而“StateName”
则是保存状态时赋予的状态名称。 
F.",137
"632 
2) 
在“Library”下拉菜单中选择保存需要读取状态的文件库。 
3) 
在“Cell”下拉菜单中选择保存需要读取状态的单元。 
4) 
在“State Name”中按照保存时的名称，选择需要读取的状态。 
5) 
在“What to Load”中选择需要读取的子状态。 
6) 
点击“OK”完成状态的读取。 
F.6.3 
保存脚本 
 
使用“Open Command Envi",125
"ADE 窗口，和相关的图形化工具（例如“Parametric Analysis”， 
“Optimization”）完成仿真和分析的设置，然后把设置内容按照脚本的形式保存下来。并且
可以在保存的脚本中加入进一步或者后处理的命令。 
 
通过下面的步骤可以将设置以脚本的形式保存下来。 
1) 
选择“Session”�“Save Script”，然后“Save Ocean Script”窗口弹出，如",136
"Options”，然后“Optimization Option”窗口弹出，如图 F- 36 所示。 
 
图 F- 36“Optimization Option”窗口 
2) 
制定一个特定的算法，在“Algorithm Selection”下拉菜单中选择“LSQ”和“CFSQP”
633 
中的一个。如果要优化器自动选择一个合适的算法，只需选择“Auto”。 
LSQ 最适合完全的曲线匹配问题，",120
"算法。LSQ 算法仅仅在下面两种情况都成立时才使用。 
� 
开启对象的优化方向是 match。 
� 
所有开启对象的目标都是波形。 
3) 
输入需要改变的优化器控制选项 
� 
“Percentage Finite Difference Perturbation”：将决定敏感度（见 F.1）是如何决
定的。 
注意：在一些优化对这个值十分敏感，改变它可能造成算法失效。推荐用户
使用默认值。如",150
"化。 
� 
“Relative Function Value Tolerance”的值影响所有算法的停止条件。 
例如，如果该值被定为：0.05，将使得所有算法，在“Optimizer”窗口中所有
表达式的相对变化小于 5%时，停止优化。 
注意：当“Relative Design Variable Tolerance”和“Relative Function Value 
Tolerance”栏",97
"Message for Long Simulation”选中。 
5) 
点击“OK”完成对优化选项的设置 
F.6.5 
删除所有设置信息 
 
选择“Session”�“Reset”即可以删除所有设置的信息，包括对象、设计变量和显示选项。 
634 
 
附录 G  Corner Analysis 
“Corner Analysis”（工艺角分析）提供了一种分析电路性能的方便的方法，可以一次性",110
"解工艺角分析窗口； 
� 
手动运行工艺角分析的实例演示； 
� 
使用工艺、设计和模型文件； 
� 
使用配置文件运行工艺角分析的实例演示。 
另外，本章还总体解释工艺角分析的理论背景，介绍怎样得到帮助以及如何打开
Virtuoso®模拟工艺角分析窗口。 
G.1 工艺角分析如何工作 
工艺角分析关注的是当工艺偏差参数达到极限时(称为“Corner”，或工作角)，或者温度、
电压等参数达到极限时",198
"路中所有的设计变量都设置了初始值； 
4) 
在 ADE 窗口中选择“Tools”�“Corners”选项。 
635 
 
图 G- 1 打开和关闭工艺角分析窗口 
如果已经按照前文定义了自动载入的定制文件，工艺角分析窗口就会出现。要关闭工
艺角分析窗口，则选择“File”�“Close”。 
G.2 工艺角分析用户界面 
如图 G- 2 所示，Virtuoso®工艺角仿真分析窗口分为几个区域，",166
"G- 2  工艺角定义界面上的按钮功能 
按钮 
功能 
Add Corner 
在已有的工艺角的右边添加新的可编辑列。 
Add Variable 
点击添加新的变量（行）于现有变量列表下方。 
Copy Corner 
复制选择的工艺角（列）到最右边 
Delete 
删除选定的工艺角（列）或者变量 
注意:  从 PCF 中载入的行或者列不能删除，从界面或者 DCF 文件中载入的行或列可以删",141
"中该按钮显示为停止（Stop），点击停止正在运行的分析。 
G.2.4 
输出设置界面—“Performance Measurement” 
输出界面位于工艺角的分析窗口的下半部，显示的是当前定义的输出信息，如图 G- 6
所示。 
 
图 G- 6 “Performance Measurement”输出界面 
这个界面的信息一般是从.cdsinit 文件中用 loadDcf 命令定义的设计定制文",122
"
剪切、复制、粘贴快捷键在表格中都可以使用，可以利用它们对输出表达式进行编辑。
输出界面中的各项目的功能描述如表 G- 3。 
表 G- 3 输出界面中的各项目的功能 
项目 
功能描述 
Measurement 列 
点击选定输出的“Measurement”列，修改这个输出的名字。该名字在出图的时
候用来标明输出系列。 
Expression 列 
点击选定输出的“Expression”列，修改",137
" 
 
图 G- 9 AC 仿真结果 
G.3.2 
设置工艺角分析 
打开工艺角分析的窗口是如图 G- 10 所示的空窗口的形式，此时可按下列方法进行工
艺角分析的手动设置。 
 
图 G- 10 工艺角分析的设定 
G.3.3 
建立一个工艺使用的工艺叫配置 
1) 
在菜单中选择“Setup”�“Add Process…”； 
643 
3) 
选择“Apply”，就加入了一组工艺角； 
4",157
"up Name 栏输入 MOS；在 Variants 栏中输入 tt ss sf ff fs，也就是 5 个工
艺角的名称，中间用空格隔开；点击 Apply 键，这一组工艺角就添加到了工艺角的分析界
面中。 
将 Group Name 栏改为 RES；在 Variants 栏中输入 restypical resfast resslow；然后点击
Apply，这时 RES 的工艺角组就添加到了界面中",118
"tion”�“Add Corner”，或者点击按钮“Add 
Corner”； 
2） 在弹出的对话框中输入工艺角的名字； 
3） 再在表格中对其他栏进行编辑。 
644 
2. 
复制并修改已有的工艺角 
1） 首先选定一个工艺角； 
2） 从菜单选择“Edit”�“Corner Definition”�“Copy Corner” 或者点击按钮“Copy 
Corners”； 
3） 在弹出的对",129
"有被禁用的工艺角； 
2） 选择“Edit”�“Corner Definition”�“Disable Corner”或“Disable”按钮。 
注：PCF 中载入的工艺角不能禁用。 
5. 
加入新设计变量 
有三类变量：组变量、工艺变量和设计变量。它们的区别见“用工艺角分析窗口修改工
艺模型信息”一节。这里介绍的是用界面添加设计变量。 
1） 选择“Edit”�“Corner Definit",143
"删除设计变量 
1） 选定需要删除； 
2） 在菜单中选择“Edit”�“CornerDefinition”�“Delete Selected”或者点击“Delete”按
钮，选定的列就会从界面上消失。 
注：PCF 中载入的工艺角和变量是不能删除的。 
在所有工艺角都设置完成之后界面如图 G- 16 所示： 
645 
 
图 G- 16 工艺角设置完成后的界面 
G.3.6 
设置输出 
输出",133
"需要将结果画成余量图(Residual Plot)
的形式，还要输入“Target”—目标值、“Lower”—下限和“Upper”—上限这三栏。 
2. 
用 Calculator 建立新的输出 
1） 选 定 “Edit”�“Performance Measurements”�“Add Measuments” 或 单 击 “Add 
Measurement”按钮； 
2） 在对话框中输出新输出的",102
"”，Calculator
中的表达式就会被截取过来； 
7） （可选）如果表达式的输出结果是标量，且需要将结果画成余量图(Residual Plot)
的形式，还要输入“Target”—目标值、“Lower”—下限和“Upper”—上限这三栏。 
3. 
删除输出： 
1） 选定一个输出； 
2） 选择菜单中的“Edit”�“Performance Measurement”�“Delete Mea",119
"析之前，可以有这些选项： 
� 
禁用不想运行的工艺角； 
� 
选择每个输出是采用文本还是用图输出。可以利用“Plot”和“Print”复选框控制。 
� 
全部设置完毕，点击按钮“Run”或者菜单“Simulation”�“Run”运行分析； 
� 
分析过程中，还可以点击“Stop”或者菜单“Simulation”�“Stop”停止分析； 
注：“Run”和“Stop”按钮按照是否有仿真运行",148
")，或者采用图形输出(Plot)。 
2. 
文本输出形式(Print)如下： 
� 
如果文本输出的是一个标量，例如前面设置的相位裕度，则输出如图 G- 18 所示。
窗口中每一列显示的是一个输出，每行是一个工艺角。 
 
图 G- 18 标量的文本输出形式 
� 
对于一个波形的输出，输入为文字形式会成如图 G- 19 所示一列显示的是分析的
数据点的 X 轴坐标，后面每一列都列出一个特定工艺",161
" 余量图 
� 
曲线族的显示模式输出图形式如图 G- 21 所示。这个图中的每一条曲线代表一个
工艺角的图线 
648 
 
图 G- 21 曲线族显示模式 
G.3.9 
保存和调用设置 
工艺角设置包含工艺角分析窗口中可以设置的一切信息，包括工艺角和输出的信息。 
1. 
保存 
� 
如果配置是从 PCF 或 DCF 文件读取的，在菜单中选择“File”�“Save Setup”可将
设置",155
"置
了。“Save As”窗口如图 G- 22 所示。 
 
图 G- 22 另存工艺角分析的配置文件 
649 
2. 
调用配置 
如果已经有了工艺提供的或者自己保存的设置，就可以直接通过载入配置文件配置工
艺角分析。可以在菜单中选择“File”�“Load”，然后选择需要载入的配置文件。 
需要注意的是，这里载入的仅仅是工艺角分析的配置。而 ADE 的配置，包括仿真类型、
输出、变量设置，仍",158
"
可以在工艺角分析窗口设定窗口设置好需要的分析，将设置保存成 OCEAN®脚本。该
脚本既可以用 OCEAN®直接运行，也可以编辑这个脚本，然后再从 OCEAN®中调用。 
选择菜单的“File”�“Save Script”，然后弹出和 windows 的保存窗口很相似的文件管理
器，从中指定脚本的路径和文件名。 
",130
